(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))_(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const S of I.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&_(S)}).observe(document,{childList:!0,subtree:!0});function h(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function _(b){if(b.ep)return;b.ep=!0;const I=h(b);fetch(b.href,I)}})();var Uw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $w(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Fv={exports:{}},Yd={},Bv={exports:{}},Et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gc=Symbol.for("react.element"),Zw=Symbol.for("react.portal"),qw=Symbol.for("react.fragment"),Gw=Symbol.for("react.strict_mode"),Hw=Symbol.for("react.profiler"),Ww=Symbol.for("react.provider"),Xw=Symbol.for("react.context"),Kw=Symbol.for("react.forward_ref"),Jw=Symbol.for("react.suspense"),Yw=Symbol.for("react.memo"),Qw=Symbol.for("react.lazy"),Iy=Symbol.iterator;function eb(i){return i===null||typeof i!="object"?null:(i=Iy&&i[Iy]||i["@@iterator"],typeof i=="function"?i:null)}var Ov={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Nv=Object.assign,Vv={};function Jl(i,o,h){this.props=i,this.context=o,this.refs=Vv,this.updater=h||Ov}Jl.prototype.isReactComponent={};Jl.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};Jl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function jv(){}jv.prototype=Jl.prototype;function Xm(i,o,h){this.props=i,this.context=o,this.refs=Vv,this.updater=h||Ov}var Km=Xm.prototype=new jv;Km.constructor=Xm;Nv(Km,Jl.prototype);Km.isPureReactComponent=!0;var Py=Array.isArray,Uv=Object.prototype.hasOwnProperty,Jm={current:null},$v={key:!0,ref:!0,__self:!0,__source:!0};function Zv(i,o,h){var _,b={},I=null,S=null;if(o!=null)for(_ in o.ref!==void 0&&(S=o.ref),o.key!==void 0&&(I=""+o.key),o)Uv.call(o,_)&&!$v.hasOwnProperty(_)&&(b[_]=o[_]);var d=arguments.length-2;if(d===1)b.children=h;else if(1<d){for(var G=Array(d),le=0;le<d;le++)G[le]=arguments[le+2];b.children=G}if(i&&i.defaultProps)for(_ in d=i.defaultProps,d)b[_]===void 0&&(b[_]=d[_]);return{$$typeof:Gc,type:i,key:I,ref:S,props:b,_owner:Jm.current}}function tb(i,o){return{$$typeof:Gc,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function Ym(i){return typeof i=="object"&&i!==null&&i.$$typeof===Gc}function rb(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return o[h]})}var Ey=/\/+/g;function Mf(i,o){return typeof i=="object"&&i!==null&&i.key!=null?rb(""+i.key):o.toString(36)}function gd(i,o,h,_,b){var I=typeof i;(I==="undefined"||I==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(I){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Gc:case Zw:S=!0}}if(S)return S=i,b=b(S),i=_===""?"."+Mf(S,0):_,Py(b)?(h="",i!=null&&(h=i.replace(Ey,"$&/")+"/"),gd(b,o,h,"",function(le){return le})):b!=null&&(Ym(b)&&(b=tb(b,h+(!b.key||S&&S.key===b.key?"":(""+b.key).replace(Ey,"$&/")+"/")+i)),o.push(b)),1;if(S=0,_=_===""?".":_+":",Py(i))for(var d=0;d<i.length;d++){I=i[d];var G=_+Mf(I,d);S+=gd(I,o,h,G,b)}else if(G=eb(i),typeof G=="function")for(i=G.call(i),d=0;!(I=i.next()).done;)I=I.value,G=_+Mf(I,d++),S+=gd(I,o,h,G,b);else if(I==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return S}function Qh(i,o,h){if(i==null)return i;var _=[],b=0;return gd(i,_,"","",function(I){return o.call(h,I,b++)}),_}function ib(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var Ii={current:null},_d={transition:null},nb={ReactCurrentDispatcher:Ii,ReactCurrentBatchConfig:_d,ReactCurrentOwner:Jm};function qv(){throw Error("act(...) is not supported in production builds of React.")}Et.Children={map:Qh,forEach:function(i,o,h){Qh(i,function(){o.apply(this,arguments)},h)},count:function(i){var o=0;return Qh(i,function(){o++}),o},toArray:function(i){return Qh(i,function(o){return o})||[]},only:function(i){if(!Ym(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Et.Component=Jl;Et.Fragment=qw;Et.Profiler=Hw;Et.PureComponent=Xm;Et.StrictMode=Gw;Et.Suspense=Jw;Et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nb;Et.act=qv;Et.cloneElement=function(i,o,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var _=Nv({},i.props),b=i.key,I=i.ref,S=i._owner;if(o!=null){if(o.ref!==void 0&&(I=o.ref,S=Jm.current),o.key!==void 0&&(b=""+o.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(G in o)Uv.call(o,G)&&!$v.hasOwnProperty(G)&&(_[G]=o[G]===void 0&&d!==void 0?d[G]:o[G])}var G=arguments.length-2;if(G===1)_.children=h;else if(1<G){d=Array(G);for(var le=0;le<G;le++)d[le]=arguments[le+2];_.children=d}return{$$typeof:Gc,type:i.type,key:b,ref:I,props:_,_owner:S}};Et.createContext=function(i){return i={$$typeof:Xw,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Ww,_context:i},i.Consumer=i};Et.createElement=Zv;Et.createFactory=function(i){var o=Zv.bind(null,i);return o.type=i,o};Et.createRef=function(){return{current:null}};Et.forwardRef=function(i){return{$$typeof:Kw,render:i}};Et.isValidElement=Ym;Et.lazy=function(i){return{$$typeof:Qw,_payload:{_status:-1,_result:i},_init:ib}};Et.memo=function(i,o){return{$$typeof:Yw,type:i,compare:o===void 0?null:o}};Et.startTransition=function(i){var o=_d.transition;_d.transition={};try{i()}finally{_d.transition=o}};Et.unstable_act=qv;Et.useCallback=function(i,o){return Ii.current.useCallback(i,o)};Et.useContext=function(i){return Ii.current.useContext(i)};Et.useDebugValue=function(){};Et.useDeferredValue=function(i){return Ii.current.useDeferredValue(i)};Et.useEffect=function(i,o){return Ii.current.useEffect(i,o)};Et.useId=function(){return Ii.current.useId()};Et.useImperativeHandle=function(i,o,h){return Ii.current.useImperativeHandle(i,o,h)};Et.useInsertionEffect=function(i,o){return Ii.current.useInsertionEffect(i,o)};Et.useLayoutEffect=function(i,o){return Ii.current.useLayoutEffect(i,o)};Et.useMemo=function(i,o){return Ii.current.useMemo(i,o)};Et.useReducer=function(i,o,h){return Ii.current.useReducer(i,o,h)};Et.useRef=function(i){return Ii.current.useRef(i)};Et.useState=function(i){return Ii.current.useState(i)};Et.useSyncExternalStore=function(i,o,h){return Ii.current.useSyncExternalStore(i,o,h)};Et.useTransition=function(){return Ii.current.useTransition()};Et.version="18.3.1";Bv.exports=Et;var Si=Bv.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sb=Si,ob=Symbol.for("react.element"),ab=Symbol.for("react.fragment"),lb=Object.prototype.hasOwnProperty,ub=sb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cb={key:!0,ref:!0,__self:!0,__source:!0};function Gv(i,o,h){var _,b={},I=null,S=null;h!==void 0&&(I=""+h),o.key!==void 0&&(I=""+o.key),o.ref!==void 0&&(S=o.ref);for(_ in o)lb.call(o,_)&&!cb.hasOwnProperty(_)&&(b[_]=o[_]);if(i&&i.defaultProps)for(_ in o=i.defaultProps,o)b[_]===void 0&&(b[_]=o[_]);return{$$typeof:ob,type:i,key:I,ref:S,props:b,_owner:ub.current}}Yd.Fragment=ab;Yd.jsx=Gv;Yd.jsxs=Gv;Fv.exports=Yd;var kl=Fv.exports,rm={},Hv={exports:{}},ln={},Wv={exports:{}},Xv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(We,dt){var pt=We.length;We.push(dt);e:for(;0<pt;){var kt=pt-1>>>1,Rt=We[kt];if(0<b(Rt,dt))We[kt]=dt,We[pt]=Rt,pt=kt;else break e}}function h(We){return We.length===0?null:We[0]}function _(We){if(We.length===0)return null;var dt=We[0],pt=We.pop();if(pt!==dt){We[0]=pt;e:for(var kt=0,Rt=We.length,Ui=Rt>>>1;kt<Ui;){var Dr=2*(kt+1)-1,ei=We[Dr],ti=Dr+1,xr=We[ti];if(0>b(ei,pt))ti<Rt&&0>b(xr,ei)?(We[kt]=xr,We[ti]=pt,kt=ti):(We[kt]=ei,We[Dr]=pt,kt=Dr);else if(ti<Rt&&0>b(xr,pt))We[kt]=xr,We[ti]=pt,kt=ti;else break e}}return dt}function b(We,dt){var pt=We.sortIndex-dt.sortIndex;return pt!==0?pt:We.id-dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;i.unstable_now=function(){return I.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var G=[],le=[],xe=1,re=null,H=3,Le=!1,Fe=!1,Be=!1,Tt=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(We){for(var dt=h(le);dt!==null;){if(dt.callback===null)_(le);else if(dt.startTime<=We)_(le),dt.sortIndex=dt.expirationTime,o(G,dt);else break;dt=h(le)}}function Te(We){if(Be=!1,ue(We),!Fe)if(h(G)!==null)Fe=!0,cn(je);else{var dt=h(le);dt!==null&&Qr(Te,dt.startTime-We)}}function je(We,dt){Fe=!1,Be&&(Be=!1,ce(Se),Se=-1),Le=!0;var pt=H;try{for(ue(dt),re=h(G);re!==null&&(!(re.expirationTime>dt)||We&&!ht());){var kt=re.callback;if(typeof kt=="function"){re.callback=null,H=re.priorityLevel;var Rt=kt(re.expirationTime<=dt);dt=i.unstable_now(),typeof Rt=="function"?re.callback=Rt:re===h(G)&&_(G),ue(dt)}else _(G);re=h(G)}if(re!==null)var Ui=!0;else{var Dr=h(le);Dr!==null&&Qr(Te,Dr.startTime-dt),Ui=!1}return Ui}finally{re=null,H=pt,Le=!1}}var He=!1,Ge=null,Se=-1,it=5,et=-1;function ht(){return!(i.unstable_now()-et<it)}function zr(){if(Ge!==null){var We=i.unstable_now();et=We;var dt=!0;try{dt=Ge(!0,We)}finally{dt?Ot():(He=!1,Ge=null)}}else He=!1}var Ot;if(typeof ie=="function")Ot=function(){ie(zr)};else if(typeof MessageChannel<"u"){var lr=new MessageChannel,Ar=lr.port2;lr.port1.onmessage=zr,Ot=function(){Ar.postMessage(null)}}else Ot=function(){Tt(zr,0)};function cn(We){Ge=We,He||(He=!0,Ot())}function Qr(We,dt){Se=Tt(function(){We(i.unstable_now())},dt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(We){We.callback=null},i.unstable_continueExecution=function(){Fe||Le||(Fe=!0,cn(je))},i.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<We?Math.floor(1e3/We):5},i.unstable_getCurrentPriorityLevel=function(){return H},i.unstable_getFirstCallbackNode=function(){return h(G)},i.unstable_next=function(We){switch(H){case 1:case 2:case 3:var dt=3;break;default:dt=H}var pt=H;H=dt;try{return We()}finally{H=pt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(We,dt){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var pt=H;H=We;try{return dt()}finally{H=pt}},i.unstable_scheduleCallback=function(We,dt,pt){var kt=i.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?kt+pt:kt):pt=kt,We){case 1:var Rt=-1;break;case 2:Rt=250;break;case 5:Rt=1073741823;break;case 4:Rt=1e4;break;default:Rt=5e3}return Rt=pt+Rt,We={id:xe++,callback:dt,priorityLevel:We,startTime:pt,expirationTime:Rt,sortIndex:-1},pt>kt?(We.sortIndex=pt,o(le,We),h(G)===null&&We===h(le)&&(Be?(ce(Se),Se=-1):Be=!0,Qr(Te,pt-kt))):(We.sortIndex=Rt,o(G,We),Fe||Le||(Fe=!0,cn(je))),We},i.unstable_shouldYield=ht,i.unstable_wrapCallback=function(We){var dt=H;return function(){var pt=H;H=dt;try{return We.apply(this,arguments)}finally{H=pt}}}})(Xv);Wv.exports=Xv;var hb=Wv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db=Si,an=hb;function Pe(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kv=new Set,Cc={};function Ea(i,o){Zl(i,o),Zl(i+"Capture",o)}function Zl(i,o){for(Cc[i]=o,i=0;i<o.length;i++)Kv.add(o[i])}var zs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),im=Object.prototype.hasOwnProperty,pb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Cy={},My={};function fb(i){return im.call(My,i)?!0:im.call(Cy,i)?!1:pb.test(i)?My[i]=!0:(Cy[i]=!0,!1)}function mb(i,o,h,_){if(h!==null&&h.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function gb(i,o,h,_){if(o===null||typeof o>"u"||mb(i,o,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Pi(i,o,h,_,b,I,S){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=i,this.type=o,this.sanitizeURL=I,this.removeEmptyString=S}var Yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Yr[i]=new Pi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];Yr[o]=new Pi(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Yr[i]=new Pi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Yr[i]=new Pi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Yr[i]=new Pi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Yr[i]=new Pi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Yr[i]=new Pi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Yr[i]=new Pi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Yr[i]=new Pi(i,5,!1,i.toLowerCase(),null,!1,!1)});var Qm=/[\-:]([a-z])/g;function eg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(Qm,eg);Yr[o]=new Pi(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(Qm,eg);Yr[o]=new Pi(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(Qm,eg);Yr[o]=new Pi(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Yr[i]=new Pi(i,1,!1,i.toLowerCase(),null,!1,!1)});Yr.xlinkHref=new Pi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Yr[i]=new Pi(i,1,!1,i.toLowerCase(),null,!0,!0)});function tg(i,o,h,_){var b=Yr.hasOwnProperty(o)?Yr[o]:null;(b!==null?b.type!==0:_||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(gb(o,h,b,_)&&(h=null),_||b===null?fb(o)&&(h===null?i.removeAttribute(o):i.setAttribute(o,""+h)):b.mustUseProperty?i[b.propertyName]=h===null?b.type===3?!1:"":h:(o=b.attributeName,_=b.attributeNamespace,h===null?i.removeAttribute(o):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,_?i.setAttributeNS(_,o,h):i.setAttribute(o,h))))}var Rs=db.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ed=Symbol.for("react.element"),Il=Symbol.for("react.portal"),Pl=Symbol.for("react.fragment"),rg=Symbol.for("react.strict_mode"),nm=Symbol.for("react.profiler"),Jv=Symbol.for("react.provider"),Yv=Symbol.for("react.context"),ig=Symbol.for("react.forward_ref"),sm=Symbol.for("react.suspense"),om=Symbol.for("react.suspense_list"),ng=Symbol.for("react.memo"),vo=Symbol.for("react.lazy"),Qv=Symbol.for("react.offscreen"),zy=Symbol.iterator;function lc(i){return i===null||typeof i!="object"?null:(i=zy&&i[zy]||i["@@iterator"],typeof i=="function"?i:null)}var pr=Object.assign,zf;function gc(i){if(zf===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);zf=o&&o[1]||""}return`
`+zf+i}var Af=!1;function Df(i,o){if(!i||Af)return"";Af=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(le){var _=le}Reflect.construct(i,[],o)}else{try{o.call()}catch(le){_=le}i.call(o.prototype)}else{try{throw Error()}catch(le){_=le}i()}}catch(le){if(le&&_&&typeof le.stack=="string"){for(var b=le.stack.split(`
`),I=_.stack.split(`
`),S=b.length-1,d=I.length-1;1<=S&&0<=d&&b[S]!==I[d];)d--;for(;1<=S&&0<=d;S--,d--)if(b[S]!==I[d]){if(S!==1||d!==1)do if(S--,d--,0>d||b[S]!==I[d]){var G=`
`+b[S].replace(" at new "," at ");return i.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",i.displayName)),G}while(1<=S&&0<=d);break}}}finally{Af=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?gc(i):""}function _b(i){switch(i.tag){case 5:return gc(i.type);case 16:return gc("Lazy");case 13:return gc("Suspense");case 19:return gc("SuspenseList");case 0:case 2:case 15:return i=Df(i.type,!1),i;case 11:return i=Df(i.type.render,!1),i;case 1:return i=Df(i.type,!0),i;default:return""}}function am(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Pl:return"Fragment";case Il:return"Portal";case nm:return"Profiler";case rg:return"StrictMode";case sm:return"Suspense";case om:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Yv:return(i.displayName||"Context")+".Consumer";case Jv:return(i._context.displayName||"Context")+".Provider";case ig:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case ng:return o=i.displayName||null,o!==null?o:am(i.type)||"Memo";case vo:o=i._payload,i=i._init;try{return am(i(o))}catch{}}return null}function yb(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return am(o);case 8:return o===rg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Do(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ex(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function vb(i){var o=ex(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),_=""+i[o];if(!i.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,I=h.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return b.call(this)},set:function(S){_=""+S,I.call(this,S)}}),Object.defineProperty(i,o,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(S){_=""+S},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function td(i){i._valueTracker||(i._valueTracker=vb(i))}function tx(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var h=o.getValue(),_="";return i&&(_=ex(i)?i.checked?"true":"false":i.value),i=_,i!==h?(o.setValue(i),!0):!1}function Ed(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function lm(i,o){var h=o.checked;return pr({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function Ay(i,o){var h=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;h=Do(o.value!=null?o.value:h),i._wrapperState={initialChecked:_,initialValue:h,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function rx(i,o){o=o.checked,o!=null&&tg(i,"checked",o,!1)}function um(i,o){rx(i,o);var h=Do(o.value),_=o.type;if(h!=null)_==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(_==="submit"||_==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?cm(i,o.type,h):o.hasOwnProperty("defaultValue")&&cm(i,o.type,Do(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function Dy(i,o,h){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,h||o===i.value||(i.value=o),i.defaultValue=o}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function cm(i,o,h){(o!=="number"||Ed(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var _c=Array.isArray;function Ol(i,o,h,_){if(i=i.options,o){o={};for(var b=0;b<h.length;b++)o["$"+h[b]]=!0;for(h=0;h<i.length;h++)b=o.hasOwnProperty("$"+i[h].value),i[h].selected!==b&&(i[h].selected=b),b&&_&&(i[h].defaultSelected=!0)}else{for(h=""+Do(h),o=null,b=0;b<i.length;b++){if(i[b].value===h){i[b].selected=!0,_&&(i[b].defaultSelected=!0);return}o!==null||i[b].disabled||(o=i[b])}o!==null&&(o.selected=!0)}}function hm(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Pe(91));return pr({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ly(i,o){var h=o.value;if(h==null){if(h=o.children,o=o.defaultValue,h!=null){if(o!=null)throw Error(Pe(92));if(_c(h)){if(1<h.length)throw Error(Pe(93));h=h[0]}o=h}o==null&&(o=""),h=o}i._wrapperState={initialValue:Do(h)}}function ix(i,o){var h=Do(o.value),_=Do(o.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),o.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),_!=null&&(i.defaultValue=""+_)}function Ry(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function nx(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dm(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?nx(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var rd,sx=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,h,_,b){MSApp.execUnsafeLocalFunction(function(){return i(o,h,_,b)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(rd=rd||document.createElement("div"),rd.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=rd.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function Mc(i,o){if(o){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=o;return}}i.textContent=o}var xc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xb=["Webkit","ms","Moz","O"];Object.keys(xc).forEach(function(i){xb.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),xc[o]=xc[i]})});function ox(i,o,h){return o==null||typeof o=="boolean"||o===""?"":h||typeof o!="number"||o===0||xc.hasOwnProperty(i)&&xc[i]?(""+o).trim():o+"px"}function ax(i,o){i=i.style;for(var h in o)if(o.hasOwnProperty(h)){var _=h.indexOf("--")===0,b=ox(h,o[h],_);h==="float"&&(h="cssFloat"),_?i.setProperty(h,b):i[h]=b}}var wb=pr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pm(i,o){if(o){if(wb[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Pe(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Pe(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Pe(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Pe(62))}}function fm(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mm=null;function sg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var gm=null,Nl=null,Vl=null;function Fy(i){if(i=Xc(i)){if(typeof gm!="function")throw Error(Pe(280));var o=i.stateNode;o&&(o=ip(o),gm(i.stateNode,i.type,o))}}function lx(i){Nl?Vl?Vl.push(i):Vl=[i]:Nl=i}function ux(){if(Nl){var i=Nl,o=Vl;if(Vl=Nl=null,Fy(i),o)for(i=0;i<o.length;i++)Fy(o[i])}}function cx(i,o){return i(o)}function hx(){}var Lf=!1;function dx(i,o,h){if(Lf)return i(o,h);Lf=!0;try{return cx(i,o,h)}finally{Lf=!1,(Nl!==null||Vl!==null)&&(hx(),ux())}}function zc(i,o){var h=i.stateNode;if(h===null)return null;var _=ip(h);if(_===null)return null;h=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(i=i.type,_=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!_;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Pe(231,o,typeof h));return h}var _m=!1;if(zs)try{var uc={};Object.defineProperty(uc,"passive",{get:function(){_m=!0}}),window.addEventListener("test",uc,uc),window.removeEventListener("test",uc,uc)}catch{_m=!1}function bb(i,o,h,_,b,I,S,d,G){var le=Array.prototype.slice.call(arguments,3);try{o.apply(h,le)}catch(xe){this.onError(xe)}}var wc=!1,Cd=null,Md=!1,ym=null,Sb={onError:function(i){wc=!0,Cd=i}};function Tb(i,o,h,_,b,I,S,d,G){wc=!1,Cd=null,bb.apply(Sb,arguments)}function kb(i,o,h,_,b,I,S,d,G){if(Tb.apply(this,arguments),wc){if(wc){var le=Cd;wc=!1,Cd=null}else throw Error(Pe(198));Md||(Md=!0,ym=le)}}function Ca(i){var o=i,h=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(h=o.return),i=o.return;while(i)}return o.tag===3?h:null}function px(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function By(i){if(Ca(i)!==i)throw Error(Pe(188))}function Ib(i){var o=i.alternate;if(!o){if(o=Ca(i),o===null)throw Error(Pe(188));return o!==i?null:i}for(var h=i,_=o;;){var b=h.return;if(b===null)break;var I=b.alternate;if(I===null){if(_=b.return,_!==null){h=_;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===h)return By(b),i;if(I===_)return By(b),o;I=I.sibling}throw Error(Pe(188))}if(h.return!==_.return)h=b,_=I;else{for(var S=!1,d=b.child;d;){if(d===h){S=!0,h=b,_=I;break}if(d===_){S=!0,_=b,h=I;break}d=d.sibling}if(!S){for(d=I.child;d;){if(d===h){S=!0,h=I,_=b;break}if(d===_){S=!0,_=I,h=b;break}d=d.sibling}if(!S)throw Error(Pe(189))}}if(h.alternate!==_)throw Error(Pe(190))}if(h.tag!==3)throw Error(Pe(188));return h.stateNode.current===h?i:o}function fx(i){return i=Ib(i),i!==null?mx(i):null}function mx(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=mx(i);if(o!==null)return o;i=i.sibling}return null}var gx=an.unstable_scheduleCallback,Oy=an.unstable_cancelCallback,Pb=an.unstable_shouldYield,Eb=an.unstable_requestPaint,vr=an.unstable_now,Cb=an.unstable_getCurrentPriorityLevel,og=an.unstable_ImmediatePriority,_x=an.unstable_UserBlockingPriority,zd=an.unstable_NormalPriority,Mb=an.unstable_LowPriority,yx=an.unstable_IdlePriority,Qd=null,ns=null;function zb(i){if(ns&&typeof ns.onCommitFiberRoot=="function")try{ns.onCommitFiberRoot(Qd,i,void 0,(i.current.flags&128)===128)}catch{}}var Nn=Math.clz32?Math.clz32:Lb,Ab=Math.log,Db=Math.LN2;function Lb(i){return i>>>=0,i===0?32:31-(Ab(i)/Db|0)|0}var id=64,nd=4194304;function yc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Ad(i,o){var h=i.pendingLanes;if(h===0)return 0;var _=0,b=i.suspendedLanes,I=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~b;d!==0?_=yc(d):(I&=S,I!==0&&(_=yc(I)))}else S=h&~b,S!==0?_=yc(S):I!==0&&(_=yc(I));if(_===0)return 0;if(o!==0&&o!==_&&!(o&b)&&(b=_&-_,I=o&-o,b>=I||b===16&&(I&4194240)!==0))return o;if(_&4&&(_|=h&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=_;0<o;)h=31-Nn(o),b=1<<h,_|=i[h],o&=~b;return _}function Rb(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fb(i,o){for(var h=i.suspendedLanes,_=i.pingedLanes,b=i.expirationTimes,I=i.pendingLanes;0<I;){var S=31-Nn(I),d=1<<S,G=b[S];G===-1?(!(d&h)||d&_)&&(b[S]=Rb(d,o)):G<=o&&(i.expiredLanes|=d),I&=~d}}function vm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function vx(){var i=id;return id<<=1,!(id&4194240)&&(id=64),i}function Rf(i){for(var o=[],h=0;31>h;h++)o.push(i);return o}function Hc(i,o,h){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-Nn(o),i[o]=h}function Bb(i,o){var h=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var _=i.eventTimes;for(i=i.expirationTimes;0<h;){var b=31-Nn(h),I=1<<b;o[b]=0,_[b]=-1,i[b]=-1,h&=~I}}function ag(i,o){var h=i.entangledLanes|=o;for(i=i.entanglements;h;){var _=31-Nn(h),b=1<<_;b&o|i[_]&o&&(i[_]|=o),h&=~b}}var qt=0;function xx(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var wx,lg,bx,Sx,Tx,xm=!1,sd=[],ko=null,Io=null,Po=null,Ac=new Map,Dc=new Map,wo=[],Ob="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ny(i,o){switch(i){case"focusin":case"focusout":ko=null;break;case"dragenter":case"dragleave":Io=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":Ac.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dc.delete(o.pointerId)}}function cc(i,o,h,_,b,I){return i===null||i.nativeEvent!==I?(i={blockedOn:o,domEventName:h,eventSystemFlags:_,nativeEvent:I,targetContainers:[b]},o!==null&&(o=Xc(o),o!==null&&lg(o)),i):(i.eventSystemFlags|=_,o=i.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),i)}function Nb(i,o,h,_,b){switch(o){case"focusin":return ko=cc(ko,i,o,h,_,b),!0;case"dragenter":return Io=cc(Io,i,o,h,_,b),!0;case"mouseover":return Po=cc(Po,i,o,h,_,b),!0;case"pointerover":var I=b.pointerId;return Ac.set(I,cc(Ac.get(I)||null,i,o,h,_,b)),!0;case"gotpointercapture":return I=b.pointerId,Dc.set(I,cc(Dc.get(I)||null,i,o,h,_,b)),!0}return!1}function kx(i){var o=ya(i.target);if(o!==null){var h=Ca(o);if(h!==null){if(o=h.tag,o===13){if(o=px(h),o!==null){i.blockedOn=o,Tx(i.priority,function(){bx(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function yd(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var h=wm(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var _=new h.constructor(h.type,h);mm=_,h.target.dispatchEvent(_),mm=null}else return o=Xc(h),o!==null&&lg(o),i.blockedOn=h,!1;o.shift()}return!0}function Vy(i,o,h){yd(i)&&h.delete(o)}function Vb(){xm=!1,ko!==null&&yd(ko)&&(ko=null),Io!==null&&yd(Io)&&(Io=null),Po!==null&&yd(Po)&&(Po=null),Ac.forEach(Vy),Dc.forEach(Vy)}function hc(i,o){i.blockedOn===o&&(i.blockedOn=null,xm||(xm=!0,an.unstable_scheduleCallback(an.unstable_NormalPriority,Vb)))}function Lc(i){function o(b){return hc(b,i)}if(0<sd.length){hc(sd[0],i);for(var h=1;h<sd.length;h++){var _=sd[h];_.blockedOn===i&&(_.blockedOn=null)}}for(ko!==null&&hc(ko,i),Io!==null&&hc(Io,i),Po!==null&&hc(Po,i),Ac.forEach(o),Dc.forEach(o),h=0;h<wo.length;h++)_=wo[h],_.blockedOn===i&&(_.blockedOn=null);for(;0<wo.length&&(h=wo[0],h.blockedOn===null);)kx(h),h.blockedOn===null&&wo.shift()}var jl=Rs.ReactCurrentBatchConfig,Dd=!0;function jb(i,o,h,_){var b=qt,I=jl.transition;jl.transition=null;try{qt=1,ug(i,o,h,_)}finally{qt=b,jl.transition=I}}function Ub(i,o,h,_){var b=qt,I=jl.transition;jl.transition=null;try{qt=4,ug(i,o,h,_)}finally{qt=b,jl.transition=I}}function ug(i,o,h,_){if(Dd){var b=wm(i,o,h,_);if(b===null)qf(i,o,_,Ld,h),Ny(i,_);else if(Nb(b,i,o,h,_))_.stopPropagation();else if(Ny(i,_),o&4&&-1<Ob.indexOf(i)){for(;b!==null;){var I=Xc(b);if(I!==null&&wx(I),I=wm(i,o,h,_),I===null&&qf(i,o,_,Ld,h),I===b)break;b=I}b!==null&&_.stopPropagation()}else qf(i,o,_,null,h)}}var Ld=null;function wm(i,o,h,_){if(Ld=null,i=sg(_),i=ya(i),i!==null)if(o=Ca(i),o===null)i=null;else if(h=o.tag,h===13){if(i=px(o),i!==null)return i;i=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return Ld=i,null}function Ix(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cb()){case og:return 1;case _x:return 4;case zd:case Mb:return 16;case yx:return 536870912;default:return 16}default:return 16}}var So=null,cg=null,vd=null;function Px(){if(vd)return vd;var i,o=cg,h=o.length,_,b="value"in So?So.value:So.textContent,I=b.length;for(i=0;i<h&&o[i]===b[i];i++);var S=h-i;for(_=1;_<=S&&o[h-_]===b[I-_];_++);return vd=b.slice(i,1<_?1-_:void 0)}function xd(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function od(){return!0}function jy(){return!1}function un(i){function o(h,_,b,I,S){this._reactName=h,this._targetInst=b,this.type=_,this.nativeEvent=I,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(I):I[d]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?od:jy,this.isPropagationStopped=jy,this}return pr(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=od)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=od)},persist:function(){},isPersistent:od}),o}var Yl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hg=un(Yl),Wc=pr({},Yl,{view:0,detail:0}),$b=un(Wc),Ff,Bf,dc,ep=pr({},Wc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==dc&&(dc&&i.type==="mousemove"?(Ff=i.screenX-dc.screenX,Bf=i.screenY-dc.screenY):Bf=Ff=0,dc=i),Ff)},movementY:function(i){return"movementY"in i?i.movementY:Bf}}),Uy=un(ep),Zb=pr({},ep,{dataTransfer:0}),qb=un(Zb),Gb=pr({},Wc,{relatedTarget:0}),Of=un(Gb),Hb=pr({},Yl,{animationName:0,elapsedTime:0,pseudoElement:0}),Wb=un(Hb),Xb=pr({},Yl,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Kb=un(Xb),Jb=pr({},Yl,{data:0}),$y=un(Jb),Yb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t2(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=e2[i])?!!o[i]:!1}function dg(){return t2}var r2=pr({},Wc,{key:function(i){if(i.key){var o=Yb[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=xd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Qb[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dg,charCode:function(i){return i.type==="keypress"?xd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?xd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),i2=un(r2),n2=pr({},ep,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zy=un(n2),s2=pr({},Wc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dg}),o2=un(s2),a2=pr({},Yl,{propertyName:0,elapsedTime:0,pseudoElement:0}),l2=un(a2),u2=pr({},ep,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),c2=un(u2),h2=[9,13,27,32],pg=zs&&"CompositionEvent"in window,bc=null;zs&&"documentMode"in document&&(bc=document.documentMode);var d2=zs&&"TextEvent"in window&&!bc,Ex=zs&&(!pg||bc&&8<bc&&11>=bc),qy=" ",Gy=!1;function Cx(i,o){switch(i){case"keyup":return h2.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mx(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var El=!1;function p2(i,o){switch(i){case"compositionend":return Mx(o);case"keypress":return o.which!==32?null:(Gy=!0,qy);case"textInput":return i=o.data,i===qy&&Gy?null:i;default:return null}}function f2(i,o){if(El)return i==="compositionend"||!pg&&Cx(i,o)?(i=Px(),vd=cg=So=null,El=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Ex&&o.locale!=="ko"?null:o.data;default:return null}}var m2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hy(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!m2[i.type]:o==="textarea"}function zx(i,o,h,_){lx(_),o=Rd(o,"onChange"),0<o.length&&(h=new hg("onChange","change",null,h,_),i.push({event:h,listeners:o}))}var Sc=null,Rc=null;function g2(i){Ux(i,0)}function tp(i){var o=zl(i);if(tx(o))return i}function _2(i,o){if(i==="change")return o}var Ax=!1;if(zs){var Nf;if(zs){var Vf="oninput"in document;if(!Vf){var Wy=document.createElement("div");Wy.setAttribute("oninput","return;"),Vf=typeof Wy.oninput=="function"}Nf=Vf}else Nf=!1;Ax=Nf&&(!document.documentMode||9<document.documentMode)}function Xy(){Sc&&(Sc.detachEvent("onpropertychange",Dx),Rc=Sc=null)}function Dx(i){if(i.propertyName==="value"&&tp(Rc)){var o=[];zx(o,Rc,i,sg(i)),dx(g2,o)}}function y2(i,o,h){i==="focusin"?(Xy(),Sc=o,Rc=h,Sc.attachEvent("onpropertychange",Dx)):i==="focusout"&&Xy()}function v2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return tp(Rc)}function x2(i,o){if(i==="click")return tp(o)}function w2(i,o){if(i==="input"||i==="change")return tp(o)}function b2(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var jn=typeof Object.is=="function"?Object.is:b2;function Fc(i,o){if(jn(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var h=Object.keys(i),_=Object.keys(o);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var b=h[_];if(!im.call(o,b)||!jn(i[b],o[b]))return!1}return!0}function Ky(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Jy(i,o){var h=Ky(i);i=0;for(var _;h;){if(h.nodeType===3){if(_=i+h.textContent.length,i<=o&&_>=o)return{node:h,offset:o-i};i=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Ky(h)}}function Lx(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Lx(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function Rx(){for(var i=window,o=Ed();o instanceof i.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)i=o.contentWindow;else break;o=Ed(i.document)}return o}function fg(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function S2(i){var o=Rx(),h=i.focusedElem,_=i.selectionRange;if(o!==h&&h&&h.ownerDocument&&Lx(h.ownerDocument.documentElement,h)){if(_!==null&&fg(h)){if(o=_.start,i=_.end,i===void 0&&(i=o),"selectionStart"in h)h.selectionStart=o,h.selectionEnd=Math.min(i,h.value.length);else if(i=(o=h.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var b=h.textContent.length,I=Math.min(_.start,b);_=_.end===void 0?I:Math.min(_.end,b),!i.extend&&I>_&&(b=_,_=I,I=b),b=Jy(h,I);var S=Jy(h,_);b&&S&&(i.rangeCount!==1||i.anchorNode!==b.node||i.anchorOffset!==b.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),i.removeAllRanges(),I>_?(i.addRange(o),i.extend(S.node,S.offset)):(o.setEnd(S.node,S.offset),i.addRange(o)))}}for(o=[],i=h;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<o.length;h++)i=o[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var T2=zs&&"documentMode"in document&&11>=document.documentMode,Cl=null,bm=null,Tc=null,Sm=!1;function Yy(i,o,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Sm||Cl==null||Cl!==Ed(_)||(_=Cl,"selectionStart"in _&&fg(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Tc&&Fc(Tc,_)||(Tc=_,_=Rd(bm,"onSelect"),0<_.length&&(o=new hg("onSelect","select",null,o,h),i.push({event:o,listeners:_}),o.target=Cl)))}function ad(i,o){var h={};return h[i.toLowerCase()]=o.toLowerCase(),h["Webkit"+i]="webkit"+o,h["Moz"+i]="moz"+o,h}var Ml={animationend:ad("Animation","AnimationEnd"),animationiteration:ad("Animation","AnimationIteration"),animationstart:ad("Animation","AnimationStart"),transitionend:ad("Transition","TransitionEnd")},jf={},Fx={};zs&&(Fx=document.createElement("div").style,"AnimationEvent"in window||(delete Ml.animationend.animation,delete Ml.animationiteration.animation,delete Ml.animationstart.animation),"TransitionEvent"in window||delete Ml.transitionend.transition);function rp(i){if(jf[i])return jf[i];if(!Ml[i])return i;var o=Ml[i],h;for(h in o)if(o.hasOwnProperty(h)&&h in Fx)return jf[i]=o[h];return i}var Bx=rp("animationend"),Ox=rp("animationiteration"),Nx=rp("animationstart"),Vx=rp("transitionend"),jx=new Map,Qy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ro(i,o){jx.set(i,o),Ea(o,[i])}for(var Uf=0;Uf<Qy.length;Uf++){var $f=Qy[Uf],k2=$f.toLowerCase(),I2=$f[0].toUpperCase()+$f.slice(1);Ro(k2,"on"+I2)}Ro(Bx,"onAnimationEnd");Ro(Ox,"onAnimationIteration");Ro(Nx,"onAnimationStart");Ro("dblclick","onDoubleClick");Ro("focusin","onFocus");Ro("focusout","onBlur");Ro(Vx,"onTransitionEnd");Zl("onMouseEnter",["mouseout","mouseover"]);Zl("onMouseLeave",["mouseout","mouseover"]);Zl("onPointerEnter",["pointerout","pointerover"]);Zl("onPointerLeave",["pointerout","pointerover"]);Ea("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ea("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ea("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ea("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P2=new Set("cancel close invalid load scroll toggle".split(" ").concat(vc));function ev(i,o,h){var _=i.type||"unknown-event";i.currentTarget=h,kb(_,o,void 0,i),i.currentTarget=null}function Ux(i,o){o=(o&4)!==0;for(var h=0;h<i.length;h++){var _=i[h],b=_.event;_=_.listeners;e:{var I=void 0;if(o)for(var S=_.length-1;0<=S;S--){var d=_[S],G=d.instance,le=d.currentTarget;if(d=d.listener,G!==I&&b.isPropagationStopped())break e;ev(b,d,le),I=G}else for(S=0;S<_.length;S++){if(d=_[S],G=d.instance,le=d.currentTarget,d=d.listener,G!==I&&b.isPropagationStopped())break e;ev(b,d,le),I=G}}}if(Md)throw i=ym,Md=!1,ym=null,i}function rr(i,o){var h=o[Em];h===void 0&&(h=o[Em]=new Set);var _=i+"__bubble";h.has(_)||($x(o,i,2,!1),h.add(_))}function Zf(i,o,h){var _=0;o&&(_|=4),$x(h,i,_,o)}var ld="_reactListening"+Math.random().toString(36).slice(2);function Bc(i){if(!i[ld]){i[ld]=!0,Kv.forEach(function(h){h!=="selectionchange"&&(P2.has(h)||Zf(h,!1,i),Zf(h,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[ld]||(o[ld]=!0,Zf("selectionchange",!1,o))}}function $x(i,o,h,_){switch(Ix(o)){case 1:var b=jb;break;case 4:b=Ub;break;default:b=ug}h=b.bind(null,o,h,i),b=void 0,!_m||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),_?b!==void 0?i.addEventListener(o,h,{capture:!0,passive:b}):i.addEventListener(o,h,!0):b!==void 0?i.addEventListener(o,h,{passive:b}):i.addEventListener(o,h,!1)}function qf(i,o,h,_,b){var I=_;if(!(o&1)&&!(o&2)&&_!==null)e:for(;;){if(_===null)return;var S=_.tag;if(S===3||S===4){var d=_.stateNode.containerInfo;if(d===b||d.nodeType===8&&d.parentNode===b)break;if(S===4)for(S=_.return;S!==null;){var G=S.tag;if((G===3||G===4)&&(G=S.stateNode.containerInfo,G===b||G.nodeType===8&&G.parentNode===b))return;S=S.return}for(;d!==null;){if(S=ya(d),S===null)return;if(G=S.tag,G===5||G===6){_=I=S;continue e}d=d.parentNode}}_=_.return}dx(function(){var le=I,xe=sg(h),re=[];e:{var H=jx.get(i);if(H!==void 0){var Le=hg,Fe=i;switch(i){case"keypress":if(xd(h)===0)break e;case"keydown":case"keyup":Le=i2;break;case"focusin":Fe="focus",Le=Of;break;case"focusout":Fe="blur",Le=Of;break;case"beforeblur":case"afterblur":Le=Of;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=Uy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=qb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=o2;break;case Bx:case Ox:case Nx:Le=Wb;break;case Vx:Le=l2;break;case"scroll":Le=$b;break;case"wheel":Le=c2;break;case"copy":case"cut":case"paste":Le=Kb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=Zy}var Be=(o&4)!==0,Tt=!Be&&i==="scroll",ce=Be?H!==null?H+"Capture":null:H;Be=[];for(var ie=le,ue;ie!==null;){ue=ie;var Te=ue.stateNode;if(ue.tag===5&&Te!==null&&(ue=Te,ce!==null&&(Te=zc(ie,ce),Te!=null&&Be.push(Oc(ie,Te,ue)))),Tt)break;ie=ie.return}0<Be.length&&(H=new Le(H,Fe,null,h,xe),re.push({event:H,listeners:Be}))}}if(!(o&7)){e:{if(H=i==="mouseover"||i==="pointerover",Le=i==="mouseout"||i==="pointerout",H&&h!==mm&&(Fe=h.relatedTarget||h.fromElement)&&(ya(Fe)||Fe[As]))break e;if((Le||H)&&(H=xe.window===xe?xe:(H=xe.ownerDocument)?H.defaultView||H.parentWindow:window,Le?(Fe=h.relatedTarget||h.toElement,Le=le,Fe=Fe?ya(Fe):null,Fe!==null&&(Tt=Ca(Fe),Fe!==Tt||Fe.tag!==5&&Fe.tag!==6)&&(Fe=null)):(Le=null,Fe=le),Le!==Fe)){if(Be=Uy,Te="onMouseLeave",ce="onMouseEnter",ie="mouse",(i==="pointerout"||i==="pointerover")&&(Be=Zy,Te="onPointerLeave",ce="onPointerEnter",ie="pointer"),Tt=Le==null?H:zl(Le),ue=Fe==null?H:zl(Fe),H=new Be(Te,ie+"leave",Le,h,xe),H.target=Tt,H.relatedTarget=ue,Te=null,ya(xe)===le&&(Be=new Be(ce,ie+"enter",Fe,h,xe),Be.target=ue,Be.relatedTarget=Tt,Te=Be),Tt=Te,Le&&Fe)t:{for(Be=Le,ce=Fe,ie=0,ue=Be;ue;ue=Tl(ue))ie++;for(ue=0,Te=ce;Te;Te=Tl(Te))ue++;for(;0<ie-ue;)Be=Tl(Be),ie--;for(;0<ue-ie;)ce=Tl(ce),ue--;for(;ie--;){if(Be===ce||ce!==null&&Be===ce.alternate)break t;Be=Tl(Be),ce=Tl(ce)}Be=null}else Be=null;Le!==null&&tv(re,H,Le,Be,!1),Fe!==null&&Tt!==null&&tv(re,Tt,Fe,Be,!0)}}e:{if(H=le?zl(le):window,Le=H.nodeName&&H.nodeName.toLowerCase(),Le==="select"||Le==="input"&&H.type==="file")var je=_2;else if(Hy(H))if(Ax)je=w2;else{je=v2;var He=y2}else(Le=H.nodeName)&&Le.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(je=x2);if(je&&(je=je(i,le))){zx(re,je,h,xe);break e}He&&He(i,H,le),i==="focusout"&&(He=H._wrapperState)&&He.controlled&&H.type==="number"&&cm(H,"number",H.value)}switch(He=le?zl(le):window,i){case"focusin":(Hy(He)||He.contentEditable==="true")&&(Cl=He,bm=le,Tc=null);break;case"focusout":Tc=bm=Cl=null;break;case"mousedown":Sm=!0;break;case"contextmenu":case"mouseup":case"dragend":Sm=!1,Yy(re,h,xe);break;case"selectionchange":if(T2)break;case"keydown":case"keyup":Yy(re,h,xe)}var Ge;if(pg)e:{switch(i){case"compositionstart":var Se="onCompositionStart";break e;case"compositionend":Se="onCompositionEnd";break e;case"compositionupdate":Se="onCompositionUpdate";break e}Se=void 0}else El?Cx(i,h)&&(Se="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(Se="onCompositionStart");Se&&(Ex&&h.locale!=="ko"&&(El||Se!=="onCompositionStart"?Se==="onCompositionEnd"&&El&&(Ge=Px()):(So=xe,cg="value"in So?So.value:So.textContent,El=!0)),He=Rd(le,Se),0<He.length&&(Se=new $y(Se,i,null,h,xe),re.push({event:Se,listeners:He}),Ge?Se.data=Ge:(Ge=Mx(h),Ge!==null&&(Se.data=Ge)))),(Ge=d2?p2(i,h):f2(i,h))&&(le=Rd(le,"onBeforeInput"),0<le.length&&(xe=new $y("onBeforeInput","beforeinput",null,h,xe),re.push({event:xe,listeners:le}),xe.data=Ge))}Ux(re,o)})}function Oc(i,o,h){return{instance:i,listener:o,currentTarget:h}}function Rd(i,o){for(var h=o+"Capture",_=[];i!==null;){var b=i,I=b.stateNode;b.tag===5&&I!==null&&(b=I,I=zc(i,h),I!=null&&_.unshift(Oc(i,I,b)),I=zc(i,o),I!=null&&_.push(Oc(i,I,b))),i=i.return}return _}function Tl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function tv(i,o,h,_,b){for(var I=o._reactName,S=[];h!==null&&h!==_;){var d=h,G=d.alternate,le=d.stateNode;if(G!==null&&G===_)break;d.tag===5&&le!==null&&(d=le,b?(G=zc(h,I),G!=null&&S.unshift(Oc(h,G,d))):b||(G=zc(h,I),G!=null&&S.push(Oc(h,G,d)))),h=h.return}S.length!==0&&i.push({event:o,listeners:S})}var E2=/\r\n?/g,C2=/\u0000|\uFFFD/g;function rv(i){return(typeof i=="string"?i:""+i).replace(E2,`
`).replace(C2,"")}function ud(i,o,h){if(o=rv(o),rv(i)!==o&&h)throw Error(Pe(425))}function Fd(){}var Tm=null,km=null;function Im(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Pm=typeof setTimeout=="function"?setTimeout:void 0,M2=typeof clearTimeout=="function"?clearTimeout:void 0,iv=typeof Promise=="function"?Promise:void 0,z2=typeof queueMicrotask=="function"?queueMicrotask:typeof iv<"u"?function(i){return iv.resolve(null).then(i).catch(A2)}:Pm;function A2(i){setTimeout(function(){throw i})}function Gf(i,o){var h=o,_=0;do{var b=h.nextSibling;if(i.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(_===0){i.removeChild(b),Lc(o);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=b}while(h);Lc(o)}function Eo(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function nv(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(o===0)return i;o--}else h==="/$"&&o++}i=i.previousSibling}return null}var Ql=Math.random().toString(36).slice(2),is="__reactFiber$"+Ql,Nc="__reactProps$"+Ql,As="__reactContainer$"+Ql,Em="__reactEvents$"+Ql,D2="__reactListeners$"+Ql,L2="__reactHandles$"+Ql;function ya(i){var o=i[is];if(o)return o;for(var h=i.parentNode;h;){if(o=h[As]||h[is]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(i=nv(i);i!==null;){if(h=i[is])return h;i=nv(i)}return o}i=h,h=i.parentNode}return null}function Xc(i){return i=i[is]||i[As],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function zl(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Pe(33))}function ip(i){return i[Nc]||null}var Cm=[],Al=-1;function Fo(i){return{current:i}}function ir(i){0>Al||(i.current=Cm[Al],Cm[Al]=null,Al--)}function Yt(i,o){Al++,Cm[Al]=i.current,i.current=o}var Lo={},fi=Fo(Lo),Ni=Fo(!1),Sa=Lo;function ql(i,o){var h=i.type.contextTypes;if(!h)return Lo;var _=i.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var b={},I;for(I in h)b[I]=o[I];return _&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=b),b}function Vi(i){return i=i.childContextTypes,i!=null}function Bd(){ir(Ni),ir(fi)}function sv(i,o,h){if(fi.current!==Lo)throw Error(Pe(168));Yt(fi,o),Yt(Ni,h)}function Zx(i,o,h){var _=i.stateNode;if(o=o.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var b in _)if(!(b in o))throw Error(Pe(108,yb(i)||"Unknown",b));return pr({},h,_)}function Od(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Lo,Sa=fi.current,Yt(fi,i),Yt(Ni,Ni.current),!0}function ov(i,o,h){var _=i.stateNode;if(!_)throw Error(Pe(169));h?(i=Zx(i,o,Sa),_.__reactInternalMemoizedMergedChildContext=i,ir(Ni),ir(fi),Yt(fi,i)):ir(Ni),Yt(Ni,h)}var Ps=null,np=!1,Hf=!1;function qx(i){Ps===null?Ps=[i]:Ps.push(i)}function R2(i){np=!0,qx(i)}function Bo(){if(!Hf&&Ps!==null){Hf=!0;var i=0,o=qt;try{var h=Ps;for(qt=1;i<h.length;i++){var _=h[i];do _=_(!0);while(_!==null)}Ps=null,np=!1}catch(b){throw Ps!==null&&(Ps=Ps.slice(i+1)),gx(og,Bo),b}finally{qt=o,Hf=!1}}return null}var Dl=[],Ll=0,Nd=null,Vd=0,wn=[],bn=0,Ta=null,Es=1,Cs="";function ga(i,o){Dl[Ll++]=Vd,Dl[Ll++]=Nd,Nd=i,Vd=o}function Gx(i,o,h){wn[bn++]=Es,wn[bn++]=Cs,wn[bn++]=Ta,Ta=i;var _=Es;i=Cs;var b=32-Nn(_)-1;_&=~(1<<b),h+=1;var I=32-Nn(o)+b;if(30<I){var S=b-b%5;I=(_&(1<<S)-1).toString(32),_>>=S,b-=S,Es=1<<32-Nn(o)+b|h<<b|_,Cs=I+i}else Es=1<<I|h<<b|_,Cs=i}function mg(i){i.return!==null&&(ga(i,1),Gx(i,1,0))}function gg(i){for(;i===Nd;)Nd=Dl[--Ll],Dl[Ll]=null,Vd=Dl[--Ll],Dl[Ll]=null;for(;i===Ta;)Ta=wn[--bn],wn[bn]=null,Cs=wn[--bn],wn[bn]=null,Es=wn[--bn],wn[bn]=null}var on=null,sn=null,ar=!1,On=null;function Hx(i,o){var h=Sn(5,null,null,0);h.elementType="DELETED",h.stateNode=o,h.return=i,o=i.deletions,o===null?(i.deletions=[h],i.flags|=16):o.push(h)}function av(i,o){switch(i.tag){case 5:var h=i.type;return o=o.nodeType!==1||h.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,on=i,sn=Eo(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,on=i,sn=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(h=Ta!==null?{id:Es,overflow:Cs}:null,i.memoizedState={dehydrated:o,treeContext:h,retryLane:1073741824},h=Sn(18,null,null,0),h.stateNode=o,h.return=i,i.child=h,on=i,sn=null,!0):!1;default:return!1}}function Mm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function zm(i){if(ar){var o=sn;if(o){var h=o;if(!av(i,o)){if(Mm(i))throw Error(Pe(418));o=Eo(h.nextSibling);var _=on;o&&av(i,o)?Hx(_,h):(i.flags=i.flags&-4097|2,ar=!1,on=i)}}else{if(Mm(i))throw Error(Pe(418));i.flags=i.flags&-4097|2,ar=!1,on=i}}}function lv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;on=i}function cd(i){if(i!==on)return!1;if(!ar)return lv(i),ar=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!Im(i.type,i.memoizedProps)),o&&(o=sn)){if(Mm(i))throw Wx(),Error(Pe(418));for(;o;)Hx(i,o),o=Eo(o.nextSibling)}if(lv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Pe(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(o===0){sn=Eo(i.nextSibling);break e}o--}else h!=="$"&&h!=="$!"&&h!=="$?"||o++}i=i.nextSibling}sn=null}}else sn=on?Eo(i.stateNode.nextSibling):null;return!0}function Wx(){for(var i=sn;i;)i=Eo(i.nextSibling)}function Gl(){sn=on=null,ar=!1}function _g(i){On===null?On=[i]:On.push(i)}var F2=Rs.ReactCurrentBatchConfig;function pc(i,o,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Pe(309));var _=h.stateNode}if(!_)throw Error(Pe(147,i));var b=_,I=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===I?o.ref:(o=function(S){var d=b.refs;S===null?delete d[I]:d[I]=S},o._stringRef=I,o)}if(typeof i!="string")throw Error(Pe(284));if(!h._owner)throw Error(Pe(290,i))}return i}function hd(i,o){throw i=Object.prototype.toString.call(o),Error(Pe(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function uv(i){var o=i._init;return o(i._payload)}function Xx(i){function o(ce,ie){if(i){var ue=ce.deletions;ue===null?(ce.deletions=[ie],ce.flags|=16):ue.push(ie)}}function h(ce,ie){if(!i)return null;for(;ie!==null;)o(ce,ie),ie=ie.sibling;return null}function _(ce,ie){for(ce=new Map;ie!==null;)ie.key!==null?ce.set(ie.key,ie):ce.set(ie.index,ie),ie=ie.sibling;return ce}function b(ce,ie){return ce=Ao(ce,ie),ce.index=0,ce.sibling=null,ce}function I(ce,ie,ue){return ce.index=ue,i?(ue=ce.alternate,ue!==null?(ue=ue.index,ue<ie?(ce.flags|=2,ie):ue):(ce.flags|=2,ie)):(ce.flags|=1048576,ie)}function S(ce){return i&&ce.alternate===null&&(ce.flags|=2),ce}function d(ce,ie,ue,Te){return ie===null||ie.tag!==6?(ie=em(ue,ce.mode,Te),ie.return=ce,ie):(ie=b(ie,ue),ie.return=ce,ie)}function G(ce,ie,ue,Te){var je=ue.type;return je===Pl?xe(ce,ie,ue.props.children,Te,ue.key):ie!==null&&(ie.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===vo&&uv(je)===ie.type)?(Te=b(ie,ue.props),Te.ref=pc(ce,ie,ue),Te.return=ce,Te):(Te=Pd(ue.type,ue.key,ue.props,null,ce.mode,Te),Te.ref=pc(ce,ie,ue),Te.return=ce,Te)}function le(ce,ie,ue,Te){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==ue.containerInfo||ie.stateNode.implementation!==ue.implementation?(ie=tm(ue,ce.mode,Te),ie.return=ce,ie):(ie=b(ie,ue.children||[]),ie.return=ce,ie)}function xe(ce,ie,ue,Te,je){return ie===null||ie.tag!==7?(ie=ba(ue,ce.mode,Te,je),ie.return=ce,ie):(ie=b(ie,ue),ie.return=ce,ie)}function re(ce,ie,ue){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=em(""+ie,ce.mode,ue),ie.return=ce,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case ed:return ue=Pd(ie.type,ie.key,ie.props,null,ce.mode,ue),ue.ref=pc(ce,null,ie),ue.return=ce,ue;case Il:return ie=tm(ie,ce.mode,ue),ie.return=ce,ie;case vo:var Te=ie._init;return re(ce,Te(ie._payload),ue)}if(_c(ie)||lc(ie))return ie=ba(ie,ce.mode,ue,null),ie.return=ce,ie;hd(ce,ie)}return null}function H(ce,ie,ue,Te){var je=ie!==null?ie.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return je!==null?null:d(ce,ie,""+ue,Te);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case ed:return ue.key===je?G(ce,ie,ue,Te):null;case Il:return ue.key===je?le(ce,ie,ue,Te):null;case vo:return je=ue._init,H(ce,ie,je(ue._payload),Te)}if(_c(ue)||lc(ue))return je!==null?null:xe(ce,ie,ue,Te,null);hd(ce,ue)}return null}function Le(ce,ie,ue,Te,je){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ce=ce.get(ue)||null,d(ie,ce,""+Te,je);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case ed:return ce=ce.get(Te.key===null?ue:Te.key)||null,G(ie,ce,Te,je);case Il:return ce=ce.get(Te.key===null?ue:Te.key)||null,le(ie,ce,Te,je);case vo:var He=Te._init;return Le(ce,ie,ue,He(Te._payload),je)}if(_c(Te)||lc(Te))return ce=ce.get(ue)||null,xe(ie,ce,Te,je,null);hd(ie,Te)}return null}function Fe(ce,ie,ue,Te){for(var je=null,He=null,Ge=ie,Se=ie=0,it=null;Ge!==null&&Se<ue.length;Se++){Ge.index>Se?(it=Ge,Ge=null):it=Ge.sibling;var et=H(ce,Ge,ue[Se],Te);if(et===null){Ge===null&&(Ge=it);break}i&&Ge&&et.alternate===null&&o(ce,Ge),ie=I(et,ie,Se),He===null?je=et:He.sibling=et,He=et,Ge=it}if(Se===ue.length)return h(ce,Ge),ar&&ga(ce,Se),je;if(Ge===null){for(;Se<ue.length;Se++)Ge=re(ce,ue[Se],Te),Ge!==null&&(ie=I(Ge,ie,Se),He===null?je=Ge:He.sibling=Ge,He=Ge);return ar&&ga(ce,Se),je}for(Ge=_(ce,Ge);Se<ue.length;Se++)it=Le(Ge,ce,Se,ue[Se],Te),it!==null&&(i&&it.alternate!==null&&Ge.delete(it.key===null?Se:it.key),ie=I(it,ie,Se),He===null?je=it:He.sibling=it,He=it);return i&&Ge.forEach(function(ht){return o(ce,ht)}),ar&&ga(ce,Se),je}function Be(ce,ie,ue,Te){var je=lc(ue);if(typeof je!="function")throw Error(Pe(150));if(ue=je.call(ue),ue==null)throw Error(Pe(151));for(var He=je=null,Ge=ie,Se=ie=0,it=null,et=ue.next();Ge!==null&&!et.done;Se++,et=ue.next()){Ge.index>Se?(it=Ge,Ge=null):it=Ge.sibling;var ht=H(ce,Ge,et.value,Te);if(ht===null){Ge===null&&(Ge=it);break}i&&Ge&&ht.alternate===null&&o(ce,Ge),ie=I(ht,ie,Se),He===null?je=ht:He.sibling=ht,He=ht,Ge=it}if(et.done)return h(ce,Ge),ar&&ga(ce,Se),je;if(Ge===null){for(;!et.done;Se++,et=ue.next())et=re(ce,et.value,Te),et!==null&&(ie=I(et,ie,Se),He===null?je=et:He.sibling=et,He=et);return ar&&ga(ce,Se),je}for(Ge=_(ce,Ge);!et.done;Se++,et=ue.next())et=Le(Ge,ce,Se,et.value,Te),et!==null&&(i&&et.alternate!==null&&Ge.delete(et.key===null?Se:et.key),ie=I(et,ie,Se),He===null?je=et:He.sibling=et,He=et);return i&&Ge.forEach(function(zr){return o(ce,zr)}),ar&&ga(ce,Se),je}function Tt(ce,ie,ue,Te){if(typeof ue=="object"&&ue!==null&&ue.type===Pl&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case ed:e:{for(var je=ue.key,He=ie;He!==null;){if(He.key===je){if(je=ue.type,je===Pl){if(He.tag===7){h(ce,He.sibling),ie=b(He,ue.props.children),ie.return=ce,ce=ie;break e}}else if(He.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===vo&&uv(je)===He.type){h(ce,He.sibling),ie=b(He,ue.props),ie.ref=pc(ce,He,ue),ie.return=ce,ce=ie;break e}h(ce,He);break}else o(ce,He);He=He.sibling}ue.type===Pl?(ie=ba(ue.props.children,ce.mode,Te,ue.key),ie.return=ce,ce=ie):(Te=Pd(ue.type,ue.key,ue.props,null,ce.mode,Te),Te.ref=pc(ce,ie,ue),Te.return=ce,ce=Te)}return S(ce);case Il:e:{for(He=ue.key;ie!==null;){if(ie.key===He)if(ie.tag===4&&ie.stateNode.containerInfo===ue.containerInfo&&ie.stateNode.implementation===ue.implementation){h(ce,ie.sibling),ie=b(ie,ue.children||[]),ie.return=ce,ce=ie;break e}else{h(ce,ie);break}else o(ce,ie);ie=ie.sibling}ie=tm(ue,ce.mode,Te),ie.return=ce,ce=ie}return S(ce);case vo:return He=ue._init,Tt(ce,ie,He(ue._payload),Te)}if(_c(ue))return Fe(ce,ie,ue,Te);if(lc(ue))return Be(ce,ie,ue,Te);hd(ce,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,ie!==null&&ie.tag===6?(h(ce,ie.sibling),ie=b(ie,ue),ie.return=ce,ce=ie):(h(ce,ie),ie=em(ue,ce.mode,Te),ie.return=ce,ce=ie),S(ce)):h(ce,ie)}return Tt}var Hl=Xx(!0),Kx=Xx(!1),jd=Fo(null),Ud=null,Rl=null,yg=null;function vg(){yg=Rl=Ud=null}function xg(i){var o=jd.current;ir(jd),i._currentValue=o}function Am(i,o,h){for(;i!==null;){var _=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,_!==null&&(_.childLanes|=o)):_!==null&&(_.childLanes&o)!==o&&(_.childLanes|=o),i===h)break;i=i.return}}function Ul(i,o){Ud=i,yg=Rl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&(Oi=!0),i.firstContext=null)}function kn(i){var o=i._currentValue;if(yg!==i)if(i={context:i,memoizedValue:o,next:null},Rl===null){if(Ud===null)throw Error(Pe(308));Rl=i,Ud.dependencies={lanes:0,firstContext:i}}else Rl=Rl.next=i;return o}var va=null;function wg(i){va===null?va=[i]:va.push(i)}function Jx(i,o,h,_){var b=o.interleaved;return b===null?(h.next=h,wg(o)):(h.next=b.next,b.next=h),o.interleaved=h,Ds(i,_)}function Ds(i,o){i.lanes|=o;var h=i.alternate;for(h!==null&&(h.lanes|=o),h=i,i=i.return;i!==null;)i.childLanes|=o,h=i.alternate,h!==null&&(h.childLanes|=o),h=i,i=i.return;return h.tag===3?h.stateNode:null}var xo=!1;function bg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yx(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ms(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function Co(i,o,h){var _=i.updateQueue;if(_===null)return null;if(_=_.shared,Lt&2){var b=_.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),_.pending=o,Ds(i,h)}return b=_.interleaved,b===null?(o.next=o,wg(_)):(o.next=b.next,b.next=o),_.interleaved=o,Ds(i,h)}function wd(i,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194240)!==0)){var _=o.lanes;_&=i.pendingLanes,h|=_,o.lanes=h,ag(i,h)}}function cv(i,o){var h=i.updateQueue,_=i.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var b=null,I=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};I===null?b=I=S:I=I.next=S,h=h.next}while(h!==null);I===null?b=I=o:I=I.next=o}else b=I=o;h={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:_.shared,effects:_.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=o:i.next=o,h.lastBaseUpdate=o}function $d(i,o,h,_){var b=i.updateQueue;xo=!1;var I=b.firstBaseUpdate,S=b.lastBaseUpdate,d=b.shared.pending;if(d!==null){b.shared.pending=null;var G=d,le=G.next;G.next=null,S===null?I=le:S.next=le,S=G;var xe=i.alternate;xe!==null&&(xe=xe.updateQueue,d=xe.lastBaseUpdate,d!==S&&(d===null?xe.firstBaseUpdate=le:d.next=le,xe.lastBaseUpdate=G))}if(I!==null){var re=b.baseState;S=0,xe=le=G=null,d=I;do{var H=d.lane,Le=d.eventTime;if((_&H)===H){xe!==null&&(xe=xe.next={eventTime:Le,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Fe=i,Be=d;switch(H=o,Le=h,Be.tag){case 1:if(Fe=Be.payload,typeof Fe=="function"){re=Fe.call(Le,re,H);break e}re=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Be.payload,H=typeof Fe=="function"?Fe.call(Le,re,H):Fe,H==null)break e;re=pr({},re,H);break e;case 2:xo=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,H=b.effects,H===null?b.effects=[d]:H.push(d))}else Le={eventTime:Le,lane:H,tag:d.tag,payload:d.payload,callback:d.callback,next:null},xe===null?(le=xe=Le,G=re):xe=xe.next=Le,S|=H;if(d=d.next,d===null){if(d=b.shared.pending,d===null)break;H=d,d=H.next,H.next=null,b.lastBaseUpdate=H,b.shared.pending=null}}while(!0);if(xe===null&&(G=re),b.baseState=G,b.firstBaseUpdate=le,b.lastBaseUpdate=xe,o=b.shared.interleaved,o!==null){b=o;do S|=b.lane,b=b.next;while(b!==o)}else I===null&&(b.shared.lanes=0);Ia|=S,i.lanes=S,i.memoizedState=re}}function hv(i,o,h){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var _=i[o],b=_.callback;if(b!==null){if(_.callback=null,_=h,typeof b!="function")throw Error(Pe(191,b));b.call(_)}}}var Kc={},ss=Fo(Kc),Vc=Fo(Kc),jc=Fo(Kc);function xa(i){if(i===Kc)throw Error(Pe(174));return i}function Sg(i,o){switch(Yt(jc,o),Yt(Vc,i),Yt(ss,Kc),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:dm(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=dm(o,i)}ir(ss),Yt(ss,o)}function Wl(){ir(ss),ir(Vc),ir(jc)}function Qx(i){xa(jc.current);var o=xa(ss.current),h=dm(o,i.type);o!==h&&(Yt(Vc,i),Yt(ss,h))}function Tg(i){Vc.current===i&&(ir(ss),ir(Vc))}var hr=Fo(0);function Zd(i){for(var o=i;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Wf=[];function kg(){for(var i=0;i<Wf.length;i++)Wf[i]._workInProgressVersionPrimary=null;Wf.length=0}var bd=Rs.ReactCurrentDispatcher,Xf=Rs.ReactCurrentBatchConfig,ka=0,dr=null,Cr=null,Ur=null,qd=!1,kc=!1,Uc=0,B2=0;function hi(){throw Error(Pe(321))}function Ig(i,o){if(o===null)return!1;for(var h=0;h<o.length&&h<i.length;h++)if(!jn(i[h],o[h]))return!1;return!0}function Pg(i,o,h,_,b,I){if(ka=I,dr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,bd.current=i===null||i.memoizedState===null?j2:U2,i=h(_,b),kc){I=0;do{if(kc=!1,Uc=0,25<=I)throw Error(Pe(301));I+=1,Ur=Cr=null,o.updateQueue=null,bd.current=$2,i=h(_,b)}while(kc)}if(bd.current=Gd,o=Cr!==null&&Cr.next!==null,ka=0,Ur=Cr=dr=null,qd=!1,o)throw Error(Pe(300));return i}function Eg(){var i=Uc!==0;return Uc=0,i}function rs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ur===null?dr.memoizedState=Ur=i:Ur=Ur.next=i,Ur}function In(){if(Cr===null){var i=dr.alternate;i=i!==null?i.memoizedState:null}else i=Cr.next;var o=Ur===null?dr.memoizedState:Ur.next;if(o!==null)Ur=o,Cr=i;else{if(i===null)throw Error(Pe(310));Cr=i,i={memoizedState:Cr.memoizedState,baseState:Cr.baseState,baseQueue:Cr.baseQueue,queue:Cr.queue,next:null},Ur===null?dr.memoizedState=Ur=i:Ur=Ur.next=i}return Ur}function $c(i,o){return typeof o=="function"?o(i):o}function Kf(i){var o=In(),h=o.queue;if(h===null)throw Error(Pe(311));h.lastRenderedReducer=i;var _=Cr,b=_.baseQueue,I=h.pending;if(I!==null){if(b!==null){var S=b.next;b.next=I.next,I.next=S}_.baseQueue=b=I,h.pending=null}if(b!==null){I=b.next,_=_.baseState;var d=S=null,G=null,le=I;do{var xe=le.lane;if((ka&xe)===xe)G!==null&&(G=G.next={lane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),_=le.hasEagerState?le.eagerState:i(_,le.action);else{var re={lane:xe,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null};G===null?(d=G=re,S=_):G=G.next=re,dr.lanes|=xe,Ia|=xe}le=le.next}while(le!==null&&le!==I);G===null?S=_:G.next=d,jn(_,o.memoizedState)||(Oi=!0),o.memoizedState=_,o.baseState=S,o.baseQueue=G,h.lastRenderedState=_}if(i=h.interleaved,i!==null){b=i;do I=b.lane,dr.lanes|=I,Ia|=I,b=b.next;while(b!==i)}else b===null&&(h.lanes=0);return[o.memoizedState,h.dispatch]}function Jf(i){var o=In(),h=o.queue;if(h===null)throw Error(Pe(311));h.lastRenderedReducer=i;var _=h.dispatch,b=h.pending,I=o.memoizedState;if(b!==null){h.pending=null;var S=b=b.next;do I=i(I,S.action),S=S.next;while(S!==b);jn(I,o.memoizedState)||(Oi=!0),o.memoizedState=I,o.baseQueue===null&&(o.baseState=I),h.lastRenderedState=I}return[I,_]}function e0(){}function t0(i,o){var h=dr,_=In(),b=o(),I=!jn(_.memoizedState,b);if(I&&(_.memoizedState=b,Oi=!0),_=_.queue,Cg(n0.bind(null,h,_,i),[i]),_.getSnapshot!==o||I||Ur!==null&&Ur.memoizedState.tag&1){if(h.flags|=2048,Zc(9,i0.bind(null,h,_,b,o),void 0,null),$r===null)throw Error(Pe(349));ka&30||r0(h,o,b)}return b}function r0(i,o,h){i.flags|=16384,i={getSnapshot:o,value:h},o=dr.updateQueue,o===null?(o={lastEffect:null,stores:null},dr.updateQueue=o,o.stores=[i]):(h=o.stores,h===null?o.stores=[i]:h.push(i))}function i0(i,o,h,_){o.value=h,o.getSnapshot=_,s0(o)&&o0(i)}function n0(i,o,h){return h(function(){s0(o)&&o0(i)})}function s0(i){var o=i.getSnapshot;i=i.value;try{var h=o();return!jn(i,h)}catch{return!0}}function o0(i){var o=Ds(i,1);o!==null&&Vn(o,i,1,-1)}function dv(i){var o=rs();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$c,lastRenderedState:i},o.queue=i,i=i.dispatch=V2.bind(null,dr,i),[o.memoizedState,i]}function Zc(i,o,h,_){return i={tag:i,create:o,destroy:h,deps:_,next:null},o=dr.updateQueue,o===null?(o={lastEffect:null,stores:null},dr.updateQueue=o,o.lastEffect=i.next=i):(h=o.lastEffect,h===null?o.lastEffect=i.next=i:(_=h.next,h.next=i,i.next=_,o.lastEffect=i)),i}function a0(){return In().memoizedState}function Sd(i,o,h,_){var b=rs();dr.flags|=i,b.memoizedState=Zc(1|o,h,void 0,_===void 0?null:_)}function sp(i,o,h,_){var b=In();_=_===void 0?null:_;var I=void 0;if(Cr!==null){var S=Cr.memoizedState;if(I=S.destroy,_!==null&&Ig(_,S.deps)){b.memoizedState=Zc(o,h,I,_);return}}dr.flags|=i,b.memoizedState=Zc(1|o,h,I,_)}function pv(i,o){return Sd(8390656,8,i,o)}function Cg(i,o){return sp(2048,8,i,o)}function l0(i,o){return sp(4,2,i,o)}function u0(i,o){return sp(4,4,i,o)}function c0(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function h0(i,o,h){return h=h!=null?h.concat([i]):null,sp(4,4,c0.bind(null,o,i),h)}function Mg(){}function d0(i,o){var h=In();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&Ig(o,_[1])?_[0]:(h.memoizedState=[i,o],i)}function p0(i,o){var h=In();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&Ig(o,_[1])?_[0]:(i=i(),h.memoizedState=[i,o],i)}function f0(i,o,h){return ka&21?(jn(h,o)||(h=vx(),dr.lanes|=h,Ia|=h,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,Oi=!0),i.memoizedState=h)}function O2(i,o){var h=qt;qt=h!==0&&4>h?h:4,i(!0);var _=Xf.transition;Xf.transition={};try{i(!1),o()}finally{qt=h,Xf.transition=_}}function m0(){return In().memoizedState}function N2(i,o,h){var _=zo(i);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},g0(i))_0(o,h);else if(h=Jx(i,o,h,_),h!==null){var b=ki();Vn(h,i,_,b),y0(h,o,_)}}function V2(i,o,h){var _=zo(i),b={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(g0(i))_0(o,b);else{var I=i.alternate;if(i.lanes===0&&(I===null||I.lanes===0)&&(I=o.lastRenderedReducer,I!==null))try{var S=o.lastRenderedState,d=I(S,h);if(b.hasEagerState=!0,b.eagerState=d,jn(d,S)){var G=o.interleaved;G===null?(b.next=b,wg(o)):(b.next=G.next,G.next=b),o.interleaved=b;return}}catch{}finally{}h=Jx(i,o,b,_),h!==null&&(b=ki(),Vn(h,i,_,b),y0(h,o,_))}}function g0(i){var o=i.alternate;return i===dr||o!==null&&o===dr}function _0(i,o){kc=qd=!0;var h=i.pending;h===null?o.next=o:(o.next=h.next,h.next=o),i.pending=o}function y0(i,o,h){if(h&4194240){var _=o.lanes;_&=i.pendingLanes,h|=_,o.lanes=h,ag(i,h)}}var Gd={readContext:kn,useCallback:hi,useContext:hi,useEffect:hi,useImperativeHandle:hi,useInsertionEffect:hi,useLayoutEffect:hi,useMemo:hi,useReducer:hi,useRef:hi,useState:hi,useDebugValue:hi,useDeferredValue:hi,useTransition:hi,useMutableSource:hi,useSyncExternalStore:hi,useId:hi,unstable_isNewReconciler:!1},j2={readContext:kn,useCallback:function(i,o){return rs().memoizedState=[i,o===void 0?null:o],i},useContext:kn,useEffect:pv,useImperativeHandle:function(i,o,h){return h=h!=null?h.concat([i]):null,Sd(4194308,4,c0.bind(null,o,i),h)},useLayoutEffect:function(i,o){return Sd(4194308,4,i,o)},useInsertionEffect:function(i,o){return Sd(4,2,i,o)},useMemo:function(i,o){var h=rs();return o=o===void 0?null:o,i=i(),h.memoizedState=[i,o],i},useReducer:function(i,o,h){var _=rs();return o=h!==void 0?h(o):o,_.memoizedState=_.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},_.queue=i,i=i.dispatch=N2.bind(null,dr,i),[_.memoizedState,i]},useRef:function(i){var o=rs();return i={current:i},o.memoizedState=i},useState:dv,useDebugValue:Mg,useDeferredValue:function(i){return rs().memoizedState=i},useTransition:function(){var i=dv(!1),o=i[0];return i=O2.bind(null,i[1]),rs().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,h){var _=dr,b=rs();if(ar){if(h===void 0)throw Error(Pe(407));h=h()}else{if(h=o(),$r===null)throw Error(Pe(349));ka&30||r0(_,o,h)}b.memoizedState=h;var I={value:h,getSnapshot:o};return b.queue=I,pv(n0.bind(null,_,I,i),[i]),_.flags|=2048,Zc(9,i0.bind(null,_,I,h,o),void 0,null),h},useId:function(){var i=rs(),o=$r.identifierPrefix;if(ar){var h=Cs,_=Es;h=(_&~(1<<32-Nn(_)-1)).toString(32)+h,o=":"+o+"R"+h,h=Uc++,0<h&&(o+="H"+h.toString(32)),o+=":"}else h=B2++,o=":"+o+"r"+h.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},U2={readContext:kn,useCallback:d0,useContext:kn,useEffect:Cg,useImperativeHandle:h0,useInsertionEffect:l0,useLayoutEffect:u0,useMemo:p0,useReducer:Kf,useRef:a0,useState:function(){return Kf($c)},useDebugValue:Mg,useDeferredValue:function(i){var o=In();return f0(o,Cr.memoizedState,i)},useTransition:function(){var i=Kf($c)[0],o=In().memoizedState;return[i,o]},useMutableSource:e0,useSyncExternalStore:t0,useId:m0,unstable_isNewReconciler:!1},$2={readContext:kn,useCallback:d0,useContext:kn,useEffect:Cg,useImperativeHandle:h0,useInsertionEffect:l0,useLayoutEffect:u0,useMemo:p0,useReducer:Jf,useRef:a0,useState:function(){return Jf($c)},useDebugValue:Mg,useDeferredValue:function(i){var o=In();return Cr===null?o.memoizedState=i:f0(o,Cr.memoizedState,i)},useTransition:function(){var i=Jf($c)[0],o=In().memoizedState;return[i,o]},useMutableSource:e0,useSyncExternalStore:t0,useId:m0,unstable_isNewReconciler:!1};function Fn(i,o){if(i&&i.defaultProps){o=pr({},o),i=i.defaultProps;for(var h in i)o[h]===void 0&&(o[h]=i[h]);return o}return o}function Dm(i,o,h,_){o=i.memoizedState,h=h(_,o),h=h==null?o:pr({},o,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var op={isMounted:function(i){return(i=i._reactInternals)?Ca(i)===i:!1},enqueueSetState:function(i,o,h){i=i._reactInternals;var _=ki(),b=zo(i),I=Ms(_,b);I.payload=o,h!=null&&(I.callback=h),o=Co(i,I,b),o!==null&&(Vn(o,i,b,_),wd(o,i,b))},enqueueReplaceState:function(i,o,h){i=i._reactInternals;var _=ki(),b=zo(i),I=Ms(_,b);I.tag=1,I.payload=o,h!=null&&(I.callback=h),o=Co(i,I,b),o!==null&&(Vn(o,i,b,_),wd(o,i,b))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var h=ki(),_=zo(i),b=Ms(h,_);b.tag=2,o!=null&&(b.callback=o),o=Co(i,b,_),o!==null&&(Vn(o,i,_,h),wd(o,i,_))}};function fv(i,o,h,_,b,I,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(_,I,S):o.prototype&&o.prototype.isPureReactComponent?!Fc(h,_)||!Fc(b,I):!0}function v0(i,o,h){var _=!1,b=Lo,I=o.contextType;return typeof I=="object"&&I!==null?I=kn(I):(b=Vi(o)?Sa:fi.current,_=o.contextTypes,I=(_=_!=null)?ql(i,b):Lo),o=new o(h,I),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=op,i.stateNode=o,o._reactInternals=i,_&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=b,i.__reactInternalMemoizedMaskedChildContext=I),o}function mv(i,o,h,_){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,_),o.state!==i&&op.enqueueReplaceState(o,o.state,null)}function Lm(i,o,h,_){var b=i.stateNode;b.props=h,b.state=i.memoizedState,b.refs={},bg(i);var I=o.contextType;typeof I=="object"&&I!==null?b.context=kn(I):(I=Vi(o)?Sa:fi.current,b.context=ql(i,I)),b.state=i.memoizedState,I=o.getDerivedStateFromProps,typeof I=="function"&&(Dm(i,o,I,h),b.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&op.enqueueReplaceState(b,b.state,null),$d(i,h,b,_),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308)}function Xl(i,o){try{var h="",_=o;do h+=_b(_),_=_.return;while(_);var b=h}catch(I){b=`
Error generating stack: `+I.message+`
`+I.stack}return{value:i,source:o,stack:b,digest:null}}function Yf(i,o,h){return{value:i,source:null,stack:h??null,digest:o??null}}function Rm(i,o){try{console.error(o.value)}catch(h){setTimeout(function(){throw h})}}var Z2=typeof WeakMap=="function"?WeakMap:Map;function x0(i,o,h){h=Ms(-1,h),h.tag=3,h.payload={element:null};var _=o.value;return h.callback=function(){Wd||(Wd=!0,qm=_),Rm(i,o)},h}function w0(i,o,h){h=Ms(-1,h),h.tag=3;var _=i.type.getDerivedStateFromError;if(typeof _=="function"){var b=o.value;h.payload=function(){return _(b)},h.callback=function(){Rm(i,o)}}var I=i.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(h.callback=function(){Rm(i,o),typeof _!="function"&&(Mo===null?Mo=new Set([this]):Mo.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})}),h}function gv(i,o,h){var _=i.pingCache;if(_===null){_=i.pingCache=new Z2;var b=new Set;_.set(o,b)}else b=_.get(o),b===void 0&&(b=new Set,_.set(o,b));b.has(h)||(b.add(h),i=nS.bind(null,i,o,h),o.then(i,i))}function _v(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function yv(i,o,h,_,b){return i.mode&1?(i.flags|=65536,i.lanes=b,i):(i===o?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(o=Ms(-1,1),o.tag=2,Co(h,o,1))),h.lanes|=1),i)}var q2=Rs.ReactCurrentOwner,Oi=!1;function Ti(i,o,h,_){o.child=i===null?Kx(o,null,h,_):Hl(o,i.child,h,_)}function vv(i,o,h,_,b){h=h.render;var I=o.ref;return Ul(o,b),_=Pg(i,o,h,_,I,b),h=Eg(),i!==null&&!Oi?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~b,Ls(i,o,b)):(ar&&h&&mg(o),o.flags|=1,Ti(i,o,_,b),o.child)}function xv(i,o,h,_,b){if(i===null){var I=h.type;return typeof I=="function"&&!Og(I)&&I.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(o.tag=15,o.type=I,b0(i,o,I,_,b)):(i=Pd(h.type,null,_,o,o.mode,b),i.ref=o.ref,i.return=o,o.child=i)}if(I=i.child,!(i.lanes&b)){var S=I.memoizedProps;if(h=h.compare,h=h!==null?h:Fc,h(S,_)&&i.ref===o.ref)return Ls(i,o,b)}return o.flags|=1,i=Ao(I,_),i.ref=o.ref,i.return=o,o.child=i}function b0(i,o,h,_,b){if(i!==null){var I=i.memoizedProps;if(Fc(I,_)&&i.ref===o.ref)if(Oi=!1,o.pendingProps=_=I,(i.lanes&b)!==0)i.flags&131072&&(Oi=!0);else return o.lanes=i.lanes,Ls(i,o,b)}return Fm(i,o,h,_,b)}function S0(i,o,h){var _=o.pendingProps,b=_.children,I=i!==null?i.memoizedState:null;if(_.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(Bl,nn),nn|=h;else{if(!(h&1073741824))return i=I!==null?I.baseLanes|h:h,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,Yt(Bl,nn),nn|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=I!==null?I.baseLanes:h,Yt(Bl,nn),nn|=_}else I!==null?(_=I.baseLanes|h,o.memoizedState=null):_=h,Yt(Bl,nn),nn|=_;return Ti(i,o,b,h),o.child}function T0(i,o){var h=o.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(o.flags|=512,o.flags|=2097152)}function Fm(i,o,h,_,b){var I=Vi(h)?Sa:fi.current;return I=ql(o,I),Ul(o,b),h=Pg(i,o,h,_,I,b),_=Eg(),i!==null&&!Oi?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~b,Ls(i,o,b)):(ar&&_&&mg(o),o.flags|=1,Ti(i,o,h,b),o.child)}function wv(i,o,h,_,b){if(Vi(h)){var I=!0;Od(o)}else I=!1;if(Ul(o,b),o.stateNode===null)Td(i,o),v0(o,h,_),Lm(o,h,_,b),_=!0;else if(i===null){var S=o.stateNode,d=o.memoizedProps;S.props=d;var G=S.context,le=h.contextType;typeof le=="object"&&le!==null?le=kn(le):(le=Vi(h)?Sa:fi.current,le=ql(o,le));var xe=h.getDerivedStateFromProps,re=typeof xe=="function"||typeof S.getSnapshotBeforeUpdate=="function";re||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==_||G!==le)&&mv(o,S,_,le),xo=!1;var H=o.memoizedState;S.state=H,$d(o,_,S,b),G=o.memoizedState,d!==_||H!==G||Ni.current||xo?(typeof xe=="function"&&(Dm(o,h,xe,_),G=o.memoizedState),(d=xo||fv(o,h,d,_,H,G,le))?(re||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(o.flags|=4194308)):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=_,o.memoizedState=G),S.props=_,S.state=G,S.context=le,_=d):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),_=!1)}else{S=o.stateNode,Yx(i,o),d=o.memoizedProps,le=o.type===o.elementType?d:Fn(o.type,d),S.props=le,re=o.pendingProps,H=S.context,G=h.contextType,typeof G=="object"&&G!==null?G=kn(G):(G=Vi(h)?Sa:fi.current,G=ql(o,G));var Le=h.getDerivedStateFromProps;(xe=typeof Le=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==re||H!==G)&&mv(o,S,_,G),xo=!1,H=o.memoizedState,S.state=H,$d(o,_,S,b);var Fe=o.memoizedState;d!==re||H!==Fe||Ni.current||xo?(typeof Le=="function"&&(Dm(o,h,Le,_),Fe=o.memoizedState),(le=xo||fv(o,h,le,_,H,Fe,G)||!1)?(xe||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(_,Fe,G),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(_,Fe,G)),typeof S.componentDidUpdate=="function"&&(o.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(o.flags|=1024),o.memoizedProps=_,o.memoizedState=Fe),S.props=_,S.state=Fe,S.context=G,_=le):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&H===i.memoizedState||(o.flags|=1024),_=!1)}return Bm(i,o,h,_,I,b)}function Bm(i,o,h,_,b,I){T0(i,o);var S=(o.flags&128)!==0;if(!_&&!S)return b&&ov(o,h,!1),Ls(i,o,I);_=o.stateNode,q2.current=o;var d=S&&typeof h.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,i!==null&&S?(o.child=Hl(o,i.child,null,I),o.child=Hl(o,null,d,I)):Ti(i,o,d,I),o.memoizedState=_.state,b&&ov(o,h,!0),o.child}function k0(i){var o=i.stateNode;o.pendingContext?sv(i,o.pendingContext,o.pendingContext!==o.context):o.context&&sv(i,o.context,!1),Sg(i,o.containerInfo)}function bv(i,o,h,_,b){return Gl(),_g(b),o.flags|=256,Ti(i,o,h,_),o.child}var Om={dehydrated:null,treeContext:null,retryLane:0};function Nm(i){return{baseLanes:i,cachePool:null,transitions:null}}function I0(i,o,h){var _=o.pendingProps,b=hr.current,I=!1,S=(o.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(b&2)!==0),d?(I=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(b|=1),Yt(hr,b&1),i===null)return zm(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(S=_.children,i=_.fallback,I?(_=o.mode,I=o.child,S={mode:"hidden",children:S},!(_&1)&&I!==null?(I.childLanes=0,I.pendingProps=S):I=up(S,_,0,null),i=ba(i,_,h,null),I.return=o,i.return=o,I.sibling=i,o.child=I,o.child.memoizedState=Nm(h),o.memoizedState=Om,i):zg(o,S));if(b=i.memoizedState,b!==null&&(d=b.dehydrated,d!==null))return G2(i,o,S,_,d,b,h);if(I){I=_.fallback,S=o.mode,b=i.child,d=b.sibling;var G={mode:"hidden",children:_.children};return!(S&1)&&o.child!==b?(_=o.child,_.childLanes=0,_.pendingProps=G,o.deletions=null):(_=Ao(b,G),_.subtreeFlags=b.subtreeFlags&14680064),d!==null?I=Ao(d,I):(I=ba(I,S,h,null),I.flags|=2),I.return=o,_.return=o,_.sibling=I,o.child=_,_=I,I=o.child,S=i.child.memoizedState,S=S===null?Nm(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},I.memoizedState=S,I.childLanes=i.childLanes&~h,o.memoizedState=Om,_}return I=i.child,i=I.sibling,_=Ao(I,{mode:"visible",children:_.children}),!(o.mode&1)&&(_.lanes=h),_.return=o,_.sibling=null,i!==null&&(h=o.deletions,h===null?(o.deletions=[i],o.flags|=16):h.push(i)),o.child=_,o.memoizedState=null,_}function zg(i,o){return o=up({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function dd(i,o,h,_){return _!==null&&_g(_),Hl(o,i.child,null,h),i=zg(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function G2(i,o,h,_,b,I,S){if(h)return o.flags&256?(o.flags&=-257,_=Yf(Error(Pe(422))),dd(i,o,S,_)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(I=_.fallback,b=o.mode,_=up({mode:"visible",children:_.children},b,0,null),I=ba(I,b,S,null),I.flags|=2,_.return=o,I.return=o,_.sibling=I,o.child=_,o.mode&1&&Hl(o,i.child,null,S),o.child.memoizedState=Nm(S),o.memoizedState=Om,I);if(!(o.mode&1))return dd(i,o,S,null);if(b.data==="$!"){if(_=b.nextSibling&&b.nextSibling.dataset,_)var d=_.dgst;return _=d,I=Error(Pe(419)),_=Yf(I,_,void 0),dd(i,o,S,_)}if(d=(S&i.childLanes)!==0,Oi||d){if(_=$r,_!==null){switch(S&-S){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(_.suspendedLanes|S)?0:b,b!==0&&b!==I.retryLane&&(I.retryLane=b,Ds(i,b),Vn(_,i,b,-1))}return Bg(),_=Yf(Error(Pe(421))),dd(i,o,S,_)}return b.data==="$?"?(o.flags|=128,o.child=i.child,o=sS.bind(null,i),b._reactRetry=o,null):(i=I.treeContext,sn=Eo(b.nextSibling),on=o,ar=!0,On=null,i!==null&&(wn[bn++]=Es,wn[bn++]=Cs,wn[bn++]=Ta,Es=i.id,Cs=i.overflow,Ta=o),o=zg(o,_.children),o.flags|=4096,o)}function Sv(i,o,h){i.lanes|=o;var _=i.alternate;_!==null&&(_.lanes|=o),Am(i.return,o,h)}function Qf(i,o,h,_,b){var I=i.memoizedState;I===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:b}:(I.isBackwards=o,I.rendering=null,I.renderingStartTime=0,I.last=_,I.tail=h,I.tailMode=b)}function P0(i,o,h){var _=o.pendingProps,b=_.revealOrder,I=_.tail;if(Ti(i,o,_.children,h),_=hr.current,_&2)_=_&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Sv(i,h,o);else if(i.tag===19)Sv(i,h,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}_&=1}if(Yt(hr,_),!(o.mode&1))o.memoizedState=null;else switch(b){case"forwards":for(h=o.child,b=null;h!==null;)i=h.alternate,i!==null&&Zd(i)===null&&(b=h),h=h.sibling;h=b,h===null?(b=o.child,o.child=null):(b=h.sibling,h.sibling=null),Qf(o,!1,b,h,I);break;case"backwards":for(h=null,b=o.child,o.child=null;b!==null;){if(i=b.alternate,i!==null&&Zd(i)===null){o.child=b;break}i=b.sibling,b.sibling=h,h=b,b=i}Qf(o,!0,h,null,I);break;case"together":Qf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Td(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function Ls(i,o,h){if(i!==null&&(o.dependencies=i.dependencies),Ia|=o.lanes,!(h&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(Pe(153));if(o.child!==null){for(i=o.child,h=Ao(i,i.pendingProps),o.child=h,h.return=o;i.sibling!==null;)i=i.sibling,h=h.sibling=Ao(i,i.pendingProps),h.return=o;h.sibling=null}return o.child}function H2(i,o,h){switch(o.tag){case 3:k0(o),Gl();break;case 5:Qx(o);break;case 1:Vi(o.type)&&Od(o);break;case 4:Sg(o,o.stateNode.containerInfo);break;case 10:var _=o.type._context,b=o.memoizedProps.value;Yt(jd,_._currentValue),_._currentValue=b;break;case 13:if(_=o.memoizedState,_!==null)return _.dehydrated!==null?(Yt(hr,hr.current&1),o.flags|=128,null):h&o.child.childLanes?I0(i,o,h):(Yt(hr,hr.current&1),i=Ls(i,o,h),i!==null?i.sibling:null);Yt(hr,hr.current&1);break;case 19:if(_=(h&o.childLanes)!==0,i.flags&128){if(_)return P0(i,o,h);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Yt(hr,hr.current),_)break;return null;case 22:case 23:return o.lanes=0,S0(i,o,h)}return Ls(i,o,h)}var E0,Vm,C0,M0;E0=function(i,o){for(var h=o.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break;for(;h.sibling===null;){if(h.return===null||h.return===o)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};Vm=function(){};C0=function(i,o,h,_){var b=i.memoizedProps;if(b!==_){i=o.stateNode,xa(ss.current);var I=null;switch(h){case"input":b=lm(i,b),_=lm(i,_),I=[];break;case"select":b=pr({},b,{value:void 0}),_=pr({},_,{value:void 0}),I=[];break;case"textarea":b=hm(i,b),_=hm(i,_),I=[];break;default:typeof b.onClick!="function"&&typeof _.onClick=="function"&&(i.onclick=Fd)}pm(h,_);var S;h=null;for(le in b)if(!_.hasOwnProperty(le)&&b.hasOwnProperty(le)&&b[le]!=null)if(le==="style"){var d=b[le];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else le!=="dangerouslySetInnerHTML"&&le!=="children"&&le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(Cc.hasOwnProperty(le)?I||(I=[]):(I=I||[]).push(le,null));for(le in _){var G=_[le];if(d=b!=null?b[le]:void 0,_.hasOwnProperty(le)&&G!==d&&(G!=null||d!=null))if(le==="style")if(d){for(S in d)!d.hasOwnProperty(S)||G&&G.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in G)G.hasOwnProperty(S)&&d[S]!==G[S]&&(h||(h={}),h[S]=G[S])}else h||(I||(I=[]),I.push(le,h)),h=G;else le==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,d=d?d.__html:void 0,G!=null&&d!==G&&(I=I||[]).push(le,G)):le==="children"?typeof G!="string"&&typeof G!="number"||(I=I||[]).push(le,""+G):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&(Cc.hasOwnProperty(le)?(G!=null&&le==="onScroll"&&rr("scroll",i),I||d===G||(I=[])):(I=I||[]).push(le,G))}h&&(I=I||[]).push("style",h);var le=I;(o.updateQueue=le)&&(o.flags|=4)}};M0=function(i,o,h,_){h!==_&&(o.flags|=4)};function fc(i,o){if(!ar)switch(i.tailMode){case"hidden":o=i.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:_.sibling=null}}function di(i){var o=i.alternate!==null&&i.alternate.child===i.child,h=0,_=0;if(o)for(var b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags&14680064,_|=b.flags&14680064,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=_,i.childLanes=h,o}function W2(i,o,h){var _=o.pendingProps;switch(gg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return di(o),null;case 1:return Vi(o.type)&&Bd(),di(o),null;case 3:return _=o.stateNode,Wl(),ir(Ni),ir(fi),kg(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(i===null||i.child===null)&&(cd(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,On!==null&&(Wm(On),On=null))),Vm(i,o),di(o),null;case 5:Tg(o);var b=xa(jc.current);if(h=o.type,i!==null&&o.stateNode!=null)C0(i,o,h,_,b),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!_){if(o.stateNode===null)throw Error(Pe(166));return di(o),null}if(i=xa(ss.current),cd(o)){_=o.stateNode,h=o.type;var I=o.memoizedProps;switch(_[is]=o,_[Nc]=I,i=(o.mode&1)!==0,h){case"dialog":rr("cancel",_),rr("close",_);break;case"iframe":case"object":case"embed":rr("load",_);break;case"video":case"audio":for(b=0;b<vc.length;b++)rr(vc[b],_);break;case"source":rr("error",_);break;case"img":case"image":case"link":rr("error",_),rr("load",_);break;case"details":rr("toggle",_);break;case"input":Ay(_,I),rr("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!I.multiple},rr("invalid",_);break;case"textarea":Ly(_,I),rr("invalid",_)}pm(h,I),b=null;for(var S in I)if(I.hasOwnProperty(S)){var d=I[S];S==="children"?typeof d=="string"?_.textContent!==d&&(I.suppressHydrationWarning!==!0&&ud(_.textContent,d,i),b=["children",d]):typeof d=="number"&&_.textContent!==""+d&&(I.suppressHydrationWarning!==!0&&ud(_.textContent,d,i),b=["children",""+d]):Cc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&rr("scroll",_)}switch(h){case"input":td(_),Dy(_,I,!0);break;case"textarea":td(_),Ry(_);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(_.onclick=Fd)}_=b,o.updateQueue=_,_!==null&&(o.flags|=4)}else{S=b.nodeType===9?b:b.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=nx(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof _.is=="string"?i=S.createElement(h,{is:_.is}):(i=S.createElement(h),h==="select"&&(S=i,_.multiple?S.multiple=!0:_.size&&(S.size=_.size))):i=S.createElementNS(i,h),i[is]=o,i[Nc]=_,E0(i,o,!1,!1),o.stateNode=i;e:{switch(S=fm(h,_),h){case"dialog":rr("cancel",i),rr("close",i),b=_;break;case"iframe":case"object":case"embed":rr("load",i),b=_;break;case"video":case"audio":for(b=0;b<vc.length;b++)rr(vc[b],i);b=_;break;case"source":rr("error",i),b=_;break;case"img":case"image":case"link":rr("error",i),rr("load",i),b=_;break;case"details":rr("toggle",i),b=_;break;case"input":Ay(i,_),b=lm(i,_),rr("invalid",i);break;case"option":b=_;break;case"select":i._wrapperState={wasMultiple:!!_.multiple},b=pr({},_,{value:void 0}),rr("invalid",i);break;case"textarea":Ly(i,_),b=hm(i,_),rr("invalid",i);break;default:b=_}pm(h,b),d=b;for(I in d)if(d.hasOwnProperty(I)){var G=d[I];I==="style"?ax(i,G):I==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&sx(i,G)):I==="children"?typeof G=="string"?(h!=="textarea"||G!=="")&&Mc(i,G):typeof G=="number"&&Mc(i,""+G):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Cc.hasOwnProperty(I)?G!=null&&I==="onScroll"&&rr("scroll",i):G!=null&&tg(i,I,G,S))}switch(h){case"input":td(i),Dy(i,_,!1);break;case"textarea":td(i),Ry(i);break;case"option":_.value!=null&&i.setAttribute("value",""+Do(_.value));break;case"select":i.multiple=!!_.multiple,I=_.value,I!=null?Ol(i,!!_.multiple,I,!1):_.defaultValue!=null&&Ol(i,!!_.multiple,_.defaultValue,!0);break;default:typeof b.onClick=="function"&&(i.onclick=Fd)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return di(o),null;case 6:if(i&&o.stateNode!=null)M0(i,o,i.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error(Pe(166));if(h=xa(jc.current),xa(ss.current),cd(o)){if(_=o.stateNode,h=o.memoizedProps,_[is]=o,(I=_.nodeValue!==h)&&(i=on,i!==null))switch(i.tag){case 3:ud(_.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&ud(_.nodeValue,h,(i.mode&1)!==0)}I&&(o.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[is]=o,o.stateNode=_}return di(o),null;case 13:if(ir(hr),_=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ar&&sn!==null&&o.mode&1&&!(o.flags&128))Wx(),Gl(),o.flags|=98560,I=!1;else if(I=cd(o),_!==null&&_.dehydrated!==null){if(i===null){if(!I)throw Error(Pe(318));if(I=o.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(Pe(317));I[is]=o}else Gl(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;di(o),I=!1}else On!==null&&(Wm(On),On=null),I=!0;if(!I)return o.flags&65536?o:null}return o.flags&128?(o.lanes=h,o):(_=_!==null,_!==(i!==null&&i.memoizedState!==null)&&_&&(o.child.flags|=8192,o.mode&1&&(i===null||hr.current&1?Mr===0&&(Mr=3):Bg())),o.updateQueue!==null&&(o.flags|=4),di(o),null);case 4:return Wl(),Vm(i,o),i===null&&Bc(o.stateNode.containerInfo),di(o),null;case 10:return xg(o.type._context),di(o),null;case 17:return Vi(o.type)&&Bd(),di(o),null;case 19:if(ir(hr),I=o.memoizedState,I===null)return di(o),null;if(_=(o.flags&128)!==0,S=I.rendering,S===null)if(_)fc(I,!1);else{if(Mr!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(S=Zd(i),S!==null){for(o.flags|=128,fc(I,!1),_=S.updateQueue,_!==null&&(o.updateQueue=_,o.flags|=4),o.subtreeFlags=0,_=h,h=o.child;h!==null;)I=h,i=_,I.flags&=14680066,S=I.alternate,S===null?(I.childLanes=0,I.lanes=i,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=S.childLanes,I.lanes=S.lanes,I.child=S.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=S.memoizedProps,I.memoizedState=S.memoizedState,I.updateQueue=S.updateQueue,I.type=S.type,i=S.dependencies,I.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return Yt(hr,hr.current&1|2),o.child}i=i.sibling}I.tail!==null&&vr()>Kl&&(o.flags|=128,_=!0,fc(I,!1),o.lanes=4194304)}else{if(!_)if(i=Zd(S),i!==null){if(o.flags|=128,_=!0,h=i.updateQueue,h!==null&&(o.updateQueue=h,o.flags|=4),fc(I,!0),I.tail===null&&I.tailMode==="hidden"&&!S.alternate&&!ar)return di(o),null}else 2*vr()-I.renderingStartTime>Kl&&h!==1073741824&&(o.flags|=128,_=!0,fc(I,!1),o.lanes=4194304);I.isBackwards?(S.sibling=o.child,o.child=S):(h=I.last,h!==null?h.sibling=S:o.child=S,I.last=S)}return I.tail!==null?(o=I.tail,I.rendering=o,I.tail=o.sibling,I.renderingStartTime=vr(),o.sibling=null,h=hr.current,Yt(hr,_?h&1|2:h&1),o):(di(o),null);case 22:case 23:return Fg(),_=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==_&&(o.flags|=8192),_&&o.mode&1?nn&1073741824&&(di(o),o.subtreeFlags&6&&(o.flags|=8192)):di(o),null;case 24:return null;case 25:return null}throw Error(Pe(156,o.tag))}function X2(i,o){switch(gg(o),o.tag){case 1:return Vi(o.type)&&Bd(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Wl(),ir(Ni),ir(fi),kg(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return Tg(o),null;case 13:if(ir(hr),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(Pe(340));Gl()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return ir(hr),null;case 4:return Wl(),null;case 10:return xg(o.type._context),null;case 22:case 23:return Fg(),null;case 24:return null;default:return null}}var pd=!1,pi=!1,K2=typeof WeakSet=="function"?WeakSet:Set,rt=null;function Fl(i,o){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){_r(i,o,_)}else h.current=null}function jm(i,o,h){try{h()}catch(_){_r(i,o,_)}}var Tv=!1;function J2(i,o){if(Tm=Dd,i=Rx(),fg(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var b=_.anchorOffset,I=_.focusNode;_=_.focusOffset;try{h.nodeType,I.nodeType}catch{h=null;break e}var S=0,d=-1,G=-1,le=0,xe=0,re=i,H=null;t:for(;;){for(var Le;re!==h||b!==0&&re.nodeType!==3||(d=S+b),re!==I||_!==0&&re.nodeType!==3||(G=S+_),re.nodeType===3&&(S+=re.nodeValue.length),(Le=re.firstChild)!==null;)H=re,re=Le;for(;;){if(re===i)break t;if(H===h&&++le===b&&(d=S),H===I&&++xe===_&&(G=S),(Le=re.nextSibling)!==null)break;re=H,H=re.parentNode}re=Le}h=d===-1||G===-1?null:{start:d,end:G}}else h=null}h=h||{start:0,end:0}}else h=null;for(km={focusedElem:i,selectionRange:h},Dd=!1,rt=o;rt!==null;)if(o=rt,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,rt=i;else for(;rt!==null;){o=rt;try{var Fe=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Fe!==null){var Be=Fe.memoizedProps,Tt=Fe.memoizedState,ce=o.stateNode,ie=ce.getSnapshotBeforeUpdate(o.elementType===o.type?Be:Fn(o.type,Be),Tt);ce.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var ue=o.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pe(163))}}catch(Te){_r(o,o.return,Te)}if(i=o.sibling,i!==null){i.return=o.return,rt=i;break}rt=o.return}return Fe=Tv,Tv=!1,Fe}function Ic(i,o,h){var _=o.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var b=_=_.next;do{if((b.tag&i)===i){var I=b.destroy;b.destroy=void 0,I!==void 0&&jm(o,h,I)}b=b.next}while(b!==_)}}function ap(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var h=o=o.next;do{if((h.tag&i)===i){var _=h.create;h.destroy=_()}h=h.next}while(h!==o)}}function Um(i){var o=i.ref;if(o!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof o=="function"?o(i):o.current=i}}function z0(i){var o=i.alternate;o!==null&&(i.alternate=null,z0(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[is],delete o[Nc],delete o[Em],delete o[D2],delete o[L2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function A0(i){return i.tag===5||i.tag===3||i.tag===4}function kv(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||A0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function $m(i,o,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,o?h.nodeType===8?h.parentNode.insertBefore(i,o):h.insertBefore(i,o):(h.nodeType===8?(o=h.parentNode,o.insertBefore(i,h)):(o=h,o.appendChild(i)),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=Fd));else if(_!==4&&(i=i.child,i!==null))for($m(i,o,h),i=i.sibling;i!==null;)$m(i,o,h),i=i.sibling}function Zm(i,o,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,o?h.insertBefore(i,o):h.appendChild(i);else if(_!==4&&(i=i.child,i!==null))for(Zm(i,o,h),i=i.sibling;i!==null;)Zm(i,o,h),i=i.sibling}var Kr=null,Bn=!1;function yo(i,o,h){for(h=h.child;h!==null;)D0(i,o,h),h=h.sibling}function D0(i,o,h){if(ns&&typeof ns.onCommitFiberUnmount=="function")try{ns.onCommitFiberUnmount(Qd,h)}catch{}switch(h.tag){case 5:pi||Fl(h,o);case 6:var _=Kr,b=Bn;Kr=null,yo(i,o,h),Kr=_,Bn=b,Kr!==null&&(Bn?(i=Kr,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):Kr.removeChild(h.stateNode));break;case 18:Kr!==null&&(Bn?(i=Kr,h=h.stateNode,i.nodeType===8?Gf(i.parentNode,h):i.nodeType===1&&Gf(i,h),Lc(i)):Gf(Kr,h.stateNode));break;case 4:_=Kr,b=Bn,Kr=h.stateNode.containerInfo,Bn=!0,yo(i,o,h),Kr=_,Bn=b;break;case 0:case 11:case 14:case 15:if(!pi&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){b=_=_.next;do{var I=b,S=I.destroy;I=I.tag,S!==void 0&&(I&2||I&4)&&jm(h,o,S),b=b.next}while(b!==_)}yo(i,o,h);break;case 1:if(!pi&&(Fl(h,o),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(d){_r(h,o,d)}yo(i,o,h);break;case 21:yo(i,o,h);break;case 22:h.mode&1?(pi=(_=pi)||h.memoizedState!==null,yo(i,o,h),pi=_):yo(i,o,h);break;default:yo(i,o,h)}}function Iv(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new K2),o.forEach(function(_){var b=oS.bind(null,i,_);h.has(_)||(h.add(_),_.then(b,b))})}}function Rn(i,o){var h=o.deletions;if(h!==null)for(var _=0;_<h.length;_++){var b=h[_];try{var I=i,S=o,d=S;e:for(;d!==null;){switch(d.tag){case 5:Kr=d.stateNode,Bn=!1;break e;case 3:Kr=d.stateNode.containerInfo,Bn=!0;break e;case 4:Kr=d.stateNode.containerInfo,Bn=!0;break e}d=d.return}if(Kr===null)throw Error(Pe(160));D0(I,S,b),Kr=null,Bn=!1;var G=b.alternate;G!==null&&(G.return=null),b.return=null}catch(le){_r(b,o,le)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)L0(o,i),o=o.sibling}function L0(i,o){var h=i.alternate,_=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Rn(o,i),ts(i),_&4){try{Ic(3,i,i.return),ap(3,i)}catch(Be){_r(i,i.return,Be)}try{Ic(5,i,i.return)}catch(Be){_r(i,i.return,Be)}}break;case 1:Rn(o,i),ts(i),_&512&&h!==null&&Fl(h,h.return);break;case 5:if(Rn(o,i),ts(i),_&512&&h!==null&&Fl(h,h.return),i.flags&32){var b=i.stateNode;try{Mc(b,"")}catch(Be){_r(i,i.return,Be)}}if(_&4&&(b=i.stateNode,b!=null)){var I=i.memoizedProps,S=h!==null?h.memoizedProps:I,d=i.type,G=i.updateQueue;if(i.updateQueue=null,G!==null)try{d==="input"&&I.type==="radio"&&I.name!=null&&rx(b,I),fm(d,S);var le=fm(d,I);for(S=0;S<G.length;S+=2){var xe=G[S],re=G[S+1];xe==="style"?ax(b,re):xe==="dangerouslySetInnerHTML"?sx(b,re):xe==="children"?Mc(b,re):tg(b,xe,re,le)}switch(d){case"input":um(b,I);break;case"textarea":ix(b,I);break;case"select":var H=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!I.multiple;var Le=I.value;Le!=null?Ol(b,!!I.multiple,Le,!1):H!==!!I.multiple&&(I.defaultValue!=null?Ol(b,!!I.multiple,I.defaultValue,!0):Ol(b,!!I.multiple,I.multiple?[]:"",!1))}b[Nc]=I}catch(Be){_r(i,i.return,Be)}}break;case 6:if(Rn(o,i),ts(i),_&4){if(i.stateNode===null)throw Error(Pe(162));b=i.stateNode,I=i.memoizedProps;try{b.nodeValue=I}catch(Be){_r(i,i.return,Be)}}break;case 3:if(Rn(o,i),ts(i),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Lc(o.containerInfo)}catch(Be){_r(i,i.return,Be)}break;case 4:Rn(o,i),ts(i);break;case 13:Rn(o,i),ts(i),b=i.child,b.flags&8192&&(I=b.memoizedState!==null,b.stateNode.isHidden=I,!I||b.alternate!==null&&b.alternate.memoizedState!==null||(Lg=vr())),_&4&&Iv(i);break;case 22:if(xe=h!==null&&h.memoizedState!==null,i.mode&1?(pi=(le=pi)||xe,Rn(o,i),pi=le):Rn(o,i),ts(i),_&8192){if(le=i.memoizedState!==null,(i.stateNode.isHidden=le)&&!xe&&i.mode&1)for(rt=i,xe=i.child;xe!==null;){for(re=rt=xe;rt!==null;){switch(H=rt,Le=H.child,H.tag){case 0:case 11:case 14:case 15:Ic(4,H,H.return);break;case 1:Fl(H,H.return);var Fe=H.stateNode;if(typeof Fe.componentWillUnmount=="function"){_=H,h=H.return;try{o=_,Fe.props=o.memoizedProps,Fe.state=o.memoizedState,Fe.componentWillUnmount()}catch(Be){_r(_,h,Be)}}break;case 5:Fl(H,H.return);break;case 22:if(H.memoizedState!==null){Ev(re);continue}}Le!==null?(Le.return=H,rt=Le):Ev(re)}xe=xe.sibling}e:for(xe=null,re=i;;){if(re.tag===5){if(xe===null){xe=re;try{b=re.stateNode,le?(I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(d=re.stateNode,G=re.memoizedProps.style,S=G!=null&&G.hasOwnProperty("display")?G.display:null,d.style.display=ox("display",S))}catch(Be){_r(i,i.return,Be)}}}else if(re.tag===6){if(xe===null)try{re.stateNode.nodeValue=le?"":re.memoizedProps}catch(Be){_r(i,i.return,Be)}}else if((re.tag!==22&&re.tag!==23||re.memoizedState===null||re===i)&&re.child!==null){re.child.return=re,re=re.child;continue}if(re===i)break e;for(;re.sibling===null;){if(re.return===null||re.return===i)break e;xe===re&&(xe=null),re=re.return}xe===re&&(xe=null),re.sibling.return=re.return,re=re.sibling}}break;case 19:Rn(o,i),ts(i),_&4&&Iv(i);break;case 21:break;default:Rn(o,i),ts(i)}}function ts(i){var o=i.flags;if(o&2){try{e:{for(var h=i.return;h!==null;){if(A0(h)){var _=h;break e}h=h.return}throw Error(Pe(160))}switch(_.tag){case 5:var b=_.stateNode;_.flags&32&&(Mc(b,""),_.flags&=-33);var I=kv(i);Zm(i,I,b);break;case 3:case 4:var S=_.stateNode.containerInfo,d=kv(i);$m(i,d,S);break;default:throw Error(Pe(161))}}catch(G){_r(i,i.return,G)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function Y2(i,o,h){rt=i,R0(i)}function R0(i,o,h){for(var _=(i.mode&1)!==0;rt!==null;){var b=rt,I=b.child;if(b.tag===22&&_){var S=b.memoizedState!==null||pd;if(!S){var d=b.alternate,G=d!==null&&d.memoizedState!==null||pi;d=pd;var le=pi;if(pd=S,(pi=G)&&!le)for(rt=b;rt!==null;)S=rt,G=S.child,S.tag===22&&S.memoizedState!==null?Cv(b):G!==null?(G.return=S,rt=G):Cv(b);for(;I!==null;)rt=I,R0(I),I=I.sibling;rt=b,pd=d,pi=le}Pv(i)}else b.subtreeFlags&8772&&I!==null?(I.return=b,rt=I):Pv(i)}}function Pv(i){for(;rt!==null;){var o=rt;if(o.flags&8772){var h=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:pi||ap(5,o);break;case 1:var _=o.stateNode;if(o.flags&4&&!pi)if(h===null)_.componentDidMount();else{var b=o.elementType===o.type?h.memoizedProps:Fn(o.type,h.memoizedProps);_.componentDidUpdate(b,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var I=o.updateQueue;I!==null&&hv(o,I,_);break;case 3:var S=o.updateQueue;if(S!==null){if(h=null,o.child!==null)switch(o.child.tag){case 5:h=o.child.stateNode;break;case 1:h=o.child.stateNode}hv(o,S,h)}break;case 5:var d=o.stateNode;if(h===null&&o.flags&4){h=d;var G=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&h.focus();break;case"img":G.src&&(h.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var le=o.alternate;if(le!==null){var xe=le.memoizedState;if(xe!==null){var re=xe.dehydrated;re!==null&&Lc(re)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pe(163))}pi||o.flags&512&&Um(o)}catch(H){_r(o,o.return,H)}}if(o===i){rt=null;break}if(h=o.sibling,h!==null){h.return=o.return,rt=h;break}rt=o.return}}function Ev(i){for(;rt!==null;){var o=rt;if(o===i){rt=null;break}var h=o.sibling;if(h!==null){h.return=o.return,rt=h;break}rt=o.return}}function Cv(i){for(;rt!==null;){var o=rt;try{switch(o.tag){case 0:case 11:case 15:var h=o.return;try{ap(4,o)}catch(G){_r(o,h,G)}break;case 1:var _=o.stateNode;if(typeof _.componentDidMount=="function"){var b=o.return;try{_.componentDidMount()}catch(G){_r(o,b,G)}}var I=o.return;try{Um(o)}catch(G){_r(o,I,G)}break;case 5:var S=o.return;try{Um(o)}catch(G){_r(o,S,G)}}}catch(G){_r(o,o.return,G)}if(o===i){rt=null;break}var d=o.sibling;if(d!==null){d.return=o.return,rt=d;break}rt=o.return}}var Q2=Math.ceil,Hd=Rs.ReactCurrentDispatcher,Ag=Rs.ReactCurrentOwner,Tn=Rs.ReactCurrentBatchConfig,Lt=0,$r=null,kr=null,Jr=0,nn=0,Bl=Fo(0),Mr=0,qc=null,Ia=0,lp=0,Dg=0,Pc=null,Bi=null,Lg=0,Kl=1/0,Is=null,Wd=!1,qm=null,Mo=null,fd=!1,To=null,Xd=0,Ec=0,Gm=null,kd=-1,Id=0;function ki(){return Lt&6?vr():kd!==-1?kd:kd=vr()}function zo(i){return i.mode&1?Lt&2&&Jr!==0?Jr&-Jr:F2.transition!==null?(Id===0&&(Id=vx()),Id):(i=qt,i!==0||(i=window.event,i=i===void 0?16:Ix(i.type)),i):1}function Vn(i,o,h,_){if(50<Ec)throw Ec=0,Gm=null,Error(Pe(185));Hc(i,h,_),(!(Lt&2)||i!==$r)&&(i===$r&&(!(Lt&2)&&(lp|=h),Mr===4&&bo(i,Jr)),ji(i,_),h===1&&Lt===0&&!(o.mode&1)&&(Kl=vr()+500,np&&Bo()))}function ji(i,o){var h=i.callbackNode;Fb(i,o);var _=Ad(i,i===$r?Jr:0);if(_===0)h!==null&&Oy(h),i.callbackNode=null,i.callbackPriority=0;else if(o=_&-_,i.callbackPriority!==o){if(h!=null&&Oy(h),o===1)i.tag===0?R2(Mv.bind(null,i)):qx(Mv.bind(null,i)),z2(function(){!(Lt&6)&&Bo()}),h=null;else{switch(xx(_)){case 1:h=og;break;case 4:h=_x;break;case 16:h=zd;break;case 536870912:h=yx;break;default:h=zd}h=$0(h,F0.bind(null,i))}i.callbackPriority=o,i.callbackNode=h}}function F0(i,o){if(kd=-1,Id=0,Lt&6)throw Error(Pe(327));var h=i.callbackNode;if($l()&&i.callbackNode!==h)return null;var _=Ad(i,i===$r?Jr:0);if(_===0)return null;if(_&30||_&i.expiredLanes||o)o=Kd(i,_);else{o=_;var b=Lt;Lt|=2;var I=O0();($r!==i||Jr!==o)&&(Is=null,Kl=vr()+500,wa(i,o));do try{rS();break}catch(d){B0(i,d)}while(!0);vg(),Hd.current=I,Lt=b,kr!==null?o=0:($r=null,Jr=0,o=Mr)}if(o!==0){if(o===2&&(b=vm(i),b!==0&&(_=b,o=Hm(i,b))),o===1)throw h=qc,wa(i,0),bo(i,_),ji(i,vr()),h;if(o===6)bo(i,_);else{if(b=i.current.alternate,!(_&30)&&!eS(b)&&(o=Kd(i,_),o===2&&(I=vm(i),I!==0&&(_=I,o=Hm(i,I))),o===1))throw h=qc,wa(i,0),bo(i,_),ji(i,vr()),h;switch(i.finishedWork=b,i.finishedLanes=_,o){case 0:case 1:throw Error(Pe(345));case 2:_a(i,Bi,Is);break;case 3:if(bo(i,_),(_&130023424)===_&&(o=Lg+500-vr(),10<o)){if(Ad(i,0)!==0)break;if(b=i.suspendedLanes,(b&_)!==_){ki(),i.pingedLanes|=i.suspendedLanes&b;break}i.timeoutHandle=Pm(_a.bind(null,i,Bi,Is),o);break}_a(i,Bi,Is);break;case 4:if(bo(i,_),(_&4194240)===_)break;for(o=i.eventTimes,b=-1;0<_;){var S=31-Nn(_);I=1<<S,S=o[S],S>b&&(b=S),_&=~I}if(_=b,_=vr()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*Q2(_/1960))-_,10<_){i.timeoutHandle=Pm(_a.bind(null,i,Bi,Is),_);break}_a(i,Bi,Is);break;case 5:_a(i,Bi,Is);break;default:throw Error(Pe(329))}}}return ji(i,vr()),i.callbackNode===h?F0.bind(null,i):null}function Hm(i,o){var h=Pc;return i.current.memoizedState.isDehydrated&&(wa(i,o).flags|=256),i=Kd(i,o),i!==2&&(o=Bi,Bi=h,o!==null&&Wm(o)),i}function Wm(i){Bi===null?Bi=i:Bi.push.apply(Bi,i)}function eS(i){for(var o=i;;){if(o.flags&16384){var h=o.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var b=h[_],I=b.getSnapshot;b=b.value;try{if(!jn(I(),b))return!1}catch{return!1}}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function bo(i,o){for(o&=~Dg,o&=~lp,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var h=31-Nn(o),_=1<<h;i[h]=-1,o&=~_}}function Mv(i){if(Lt&6)throw Error(Pe(327));$l();var o=Ad(i,0);if(!(o&1))return ji(i,vr()),null;var h=Kd(i,o);if(i.tag!==0&&h===2){var _=vm(i);_!==0&&(o=_,h=Hm(i,_))}if(h===1)throw h=qc,wa(i,0),bo(i,o),ji(i,vr()),h;if(h===6)throw Error(Pe(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,_a(i,Bi,Is),ji(i,vr()),null}function Rg(i,o){var h=Lt;Lt|=1;try{return i(o)}finally{Lt=h,Lt===0&&(Kl=vr()+500,np&&Bo())}}function Pa(i){To!==null&&To.tag===0&&!(Lt&6)&&$l();var o=Lt;Lt|=1;var h=Tn.transition,_=qt;try{if(Tn.transition=null,qt=1,i)return i()}finally{qt=_,Tn.transition=h,Lt=o,!(Lt&6)&&Bo()}}function Fg(){nn=Bl.current,ir(Bl)}function wa(i,o){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,M2(h)),kr!==null)for(h=kr.return;h!==null;){var _=h;switch(gg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&Bd();break;case 3:Wl(),ir(Ni),ir(fi),kg();break;case 5:Tg(_);break;case 4:Wl();break;case 13:ir(hr);break;case 19:ir(hr);break;case 10:xg(_.type._context);break;case 22:case 23:Fg()}h=h.return}if($r=i,kr=i=Ao(i.current,null),Jr=nn=o,Mr=0,qc=null,Dg=lp=Ia=0,Bi=Pc=null,va!==null){for(o=0;o<va.length;o++)if(h=va[o],_=h.interleaved,_!==null){h.interleaved=null;var b=_.next,I=h.pending;if(I!==null){var S=I.next;I.next=b,_.next=S}h.pending=_}va=null}return i}function B0(i,o){do{var h=kr;try{if(vg(),bd.current=Gd,qd){for(var _=dr.memoizedState;_!==null;){var b=_.queue;b!==null&&(b.pending=null),_=_.next}qd=!1}if(ka=0,Ur=Cr=dr=null,kc=!1,Uc=0,Ag.current=null,h===null||h.return===null){Mr=1,qc=o,kr=null;break}e:{var I=i,S=h.return,d=h,G=o;if(o=Jr,d.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var le=G,xe=d,re=xe.tag;if(!(xe.mode&1)&&(re===0||re===11||re===15)){var H=xe.alternate;H?(xe.updateQueue=H.updateQueue,xe.memoizedState=H.memoizedState,xe.lanes=H.lanes):(xe.updateQueue=null,xe.memoizedState=null)}var Le=_v(S);if(Le!==null){Le.flags&=-257,yv(Le,S,d,I,o),Le.mode&1&&gv(I,le,o),o=Le,G=le;var Fe=o.updateQueue;if(Fe===null){var Be=new Set;Be.add(G),o.updateQueue=Be}else Fe.add(G);break e}else{if(!(o&1)){gv(I,le,o),Bg();break e}G=Error(Pe(426))}}else if(ar&&d.mode&1){var Tt=_v(S);if(Tt!==null){!(Tt.flags&65536)&&(Tt.flags|=256),yv(Tt,S,d,I,o),_g(Xl(G,d));break e}}I=G=Xl(G,d),Mr!==4&&(Mr=2),Pc===null?Pc=[I]:Pc.push(I),I=S;do{switch(I.tag){case 3:I.flags|=65536,o&=-o,I.lanes|=o;var ce=x0(I,G,o);cv(I,ce);break e;case 1:d=G;var ie=I.type,ue=I.stateNode;if(!(I.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Mo===null||!Mo.has(ue)))){I.flags|=65536,o&=-o,I.lanes|=o;var Te=w0(I,d,o);cv(I,Te);break e}}I=I.return}while(I!==null)}V0(h)}catch(je){o=je,kr===h&&h!==null&&(kr=h=h.return);continue}break}while(!0)}function O0(){var i=Hd.current;return Hd.current=Gd,i===null?Gd:i}function Bg(){(Mr===0||Mr===3||Mr===2)&&(Mr=4),$r===null||!(Ia&268435455)&&!(lp&268435455)||bo($r,Jr)}function Kd(i,o){var h=Lt;Lt|=2;var _=O0();($r!==i||Jr!==o)&&(Is=null,wa(i,o));do try{tS();break}catch(b){B0(i,b)}while(!0);if(vg(),Lt=h,Hd.current=_,kr!==null)throw Error(Pe(261));return $r=null,Jr=0,Mr}function tS(){for(;kr!==null;)N0(kr)}function rS(){for(;kr!==null&&!Pb();)N0(kr)}function N0(i){var o=U0(i.alternate,i,nn);i.memoizedProps=i.pendingProps,o===null?V0(i):kr=o,Ag.current=null}function V0(i){var o=i;do{var h=o.alternate;if(i=o.return,o.flags&32768){if(h=X2(h,o),h!==null){h.flags&=32767,kr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Mr=6,kr=null;return}}else if(h=W2(h,o,nn),h!==null){kr=h;return}if(o=o.sibling,o!==null){kr=o;return}kr=o=i}while(o!==null);Mr===0&&(Mr=5)}function _a(i,o,h){var _=qt,b=Tn.transition;try{Tn.transition=null,qt=1,iS(i,o,h,_)}finally{Tn.transition=b,qt=_}return null}function iS(i,o,h,_){do $l();while(To!==null);if(Lt&6)throw Error(Pe(327));h=i.finishedWork;var b=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Pe(177));i.callbackNode=null,i.callbackPriority=0;var I=h.lanes|h.childLanes;if(Bb(i,I),i===$r&&(kr=$r=null,Jr=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||fd||(fd=!0,$0(zd,function(){return $l(),null})),I=(h.flags&15990)!==0,h.subtreeFlags&15990||I){I=Tn.transition,Tn.transition=null;var S=qt;qt=1;var d=Lt;Lt|=4,Ag.current=null,J2(i,h),L0(h,i),S2(km),Dd=!!Tm,km=Tm=null,i.current=h,Y2(h),Eb(),Lt=d,qt=S,Tn.transition=I}else i.current=h;if(fd&&(fd=!1,To=i,Xd=b),I=i.pendingLanes,I===0&&(Mo=null),zb(h.stateNode),ji(i,vr()),o!==null)for(_=i.onRecoverableError,h=0;h<o.length;h++)b=o[h],_(b.value,{componentStack:b.stack,digest:b.digest});if(Wd)throw Wd=!1,i=qm,qm=null,i;return Xd&1&&i.tag!==0&&$l(),I=i.pendingLanes,I&1?i===Gm?Ec++:(Ec=0,Gm=i):Ec=0,Bo(),null}function $l(){if(To!==null){var i=xx(Xd),o=Tn.transition,h=qt;try{if(Tn.transition=null,qt=16>i?16:i,To===null)var _=!1;else{if(i=To,To=null,Xd=0,Lt&6)throw Error(Pe(331));var b=Lt;for(Lt|=4,rt=i.current;rt!==null;){var I=rt,S=I.child;if(rt.flags&16){var d=I.deletions;if(d!==null){for(var G=0;G<d.length;G++){var le=d[G];for(rt=le;rt!==null;){var xe=rt;switch(xe.tag){case 0:case 11:case 15:Ic(8,xe,I)}var re=xe.child;if(re!==null)re.return=xe,rt=re;else for(;rt!==null;){xe=rt;var H=xe.sibling,Le=xe.return;if(z0(xe),xe===le){rt=null;break}if(H!==null){H.return=Le,rt=H;break}rt=Le}}}var Fe=I.alternate;if(Fe!==null){var Be=Fe.child;if(Be!==null){Fe.child=null;do{var Tt=Be.sibling;Be.sibling=null,Be=Tt}while(Be!==null)}}rt=I}}if(I.subtreeFlags&2064&&S!==null)S.return=I,rt=S;else e:for(;rt!==null;){if(I=rt,I.flags&2048)switch(I.tag){case 0:case 11:case 15:Ic(9,I,I.return)}var ce=I.sibling;if(ce!==null){ce.return=I.return,rt=ce;break e}rt=I.return}}var ie=i.current;for(rt=ie;rt!==null;){S=rt;var ue=S.child;if(S.subtreeFlags&2064&&ue!==null)ue.return=S,rt=ue;else e:for(S=ie;rt!==null;){if(d=rt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:ap(9,d)}}catch(je){_r(d,d.return,je)}if(d===S){rt=null;break e}var Te=d.sibling;if(Te!==null){Te.return=d.return,rt=Te;break e}rt=d.return}}if(Lt=b,Bo(),ns&&typeof ns.onPostCommitFiberRoot=="function")try{ns.onPostCommitFiberRoot(Qd,i)}catch{}_=!0}return _}finally{qt=h,Tn.transition=o}}return!1}function zv(i,o,h){o=Xl(h,o),o=x0(i,o,1),i=Co(i,o,1),o=ki(),i!==null&&(Hc(i,1,o),ji(i,o))}function _r(i,o,h){if(i.tag===3)zv(i,i,h);else for(;o!==null;){if(o.tag===3){zv(o,i,h);break}else if(o.tag===1){var _=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Mo===null||!Mo.has(_))){i=Xl(h,i),i=w0(o,i,1),o=Co(o,i,1),i=ki(),o!==null&&(Hc(o,1,i),ji(o,i));break}}o=o.return}}function nS(i,o,h){var _=i.pingCache;_!==null&&_.delete(o),o=ki(),i.pingedLanes|=i.suspendedLanes&h,$r===i&&(Jr&h)===h&&(Mr===4||Mr===3&&(Jr&130023424)===Jr&&500>vr()-Lg?wa(i,0):Dg|=h),ji(i,o)}function j0(i,o){o===0&&(i.mode&1?(o=nd,nd<<=1,!(nd&130023424)&&(nd=4194304)):o=1);var h=ki();i=Ds(i,o),i!==null&&(Hc(i,o,h),ji(i,h))}function sS(i){var o=i.memoizedState,h=0;o!==null&&(h=o.retryLane),j0(i,h)}function oS(i,o){var h=0;switch(i.tag){case 13:var _=i.stateNode,b=i.memoizedState;b!==null&&(h=b.retryLane);break;case 19:_=i.stateNode;break;default:throw Error(Pe(314))}_!==null&&_.delete(o),j0(i,h)}var U0;U0=function(i,o,h){if(i!==null)if(i.memoizedProps!==o.pendingProps||Ni.current)Oi=!0;else{if(!(i.lanes&h)&&!(o.flags&128))return Oi=!1,H2(i,o,h);Oi=!!(i.flags&131072)}else Oi=!1,ar&&o.flags&1048576&&Gx(o,Vd,o.index);switch(o.lanes=0,o.tag){case 2:var _=o.type;Td(i,o),i=o.pendingProps;var b=ql(o,fi.current);Ul(o,h),b=Pg(null,o,_,i,b,h);var I=Eg();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Vi(_)?(I=!0,Od(o)):I=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,bg(o),b.updater=op,o.stateNode=b,b._reactInternals=o,Lm(o,_,i,h),o=Bm(null,o,_,!0,I,h)):(o.tag=0,ar&&I&&mg(o),Ti(null,o,b,h),o=o.child),o;case 16:_=o.elementType;e:{switch(Td(i,o),i=o.pendingProps,b=_._init,_=b(_._payload),o.type=_,b=o.tag=lS(_),i=Fn(_,i),b){case 0:o=Fm(null,o,_,i,h);break e;case 1:o=wv(null,o,_,i,h);break e;case 11:o=vv(null,o,_,i,h);break e;case 14:o=xv(null,o,_,Fn(_.type,i),h);break e}throw Error(Pe(306,_,""))}return o;case 0:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),Fm(i,o,_,b,h);case 1:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),wv(i,o,_,b,h);case 3:e:{if(k0(o),i===null)throw Error(Pe(387));_=o.pendingProps,I=o.memoizedState,b=I.element,Yx(i,o),$d(o,_,null,h);var S=o.memoizedState;if(_=S.element,I.isDehydrated)if(I={element:_,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},o.updateQueue.baseState=I,o.memoizedState=I,o.flags&256){b=Xl(Error(Pe(423)),o),o=bv(i,o,_,h,b);break e}else if(_!==b){b=Xl(Error(Pe(424)),o),o=bv(i,o,_,h,b);break e}else for(sn=Eo(o.stateNode.containerInfo.firstChild),on=o,ar=!0,On=null,h=Kx(o,null,_,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Gl(),_===b){o=Ls(i,o,h);break e}Ti(i,o,_,h)}o=o.child}return o;case 5:return Qx(o),i===null&&zm(o),_=o.type,b=o.pendingProps,I=i!==null?i.memoizedProps:null,S=b.children,Im(_,b)?S=null:I!==null&&Im(_,I)&&(o.flags|=32),T0(i,o),Ti(i,o,S,h),o.child;case 6:return i===null&&zm(o),null;case 13:return I0(i,o,h);case 4:return Sg(o,o.stateNode.containerInfo),_=o.pendingProps,i===null?o.child=Hl(o,null,_,h):Ti(i,o,_,h),o.child;case 11:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),vv(i,o,_,b,h);case 7:return Ti(i,o,o.pendingProps,h),o.child;case 8:return Ti(i,o,o.pendingProps.children,h),o.child;case 12:return Ti(i,o,o.pendingProps.children,h),o.child;case 10:e:{if(_=o.type._context,b=o.pendingProps,I=o.memoizedProps,S=b.value,Yt(jd,_._currentValue),_._currentValue=S,I!==null)if(jn(I.value,S)){if(I.children===b.children&&!Ni.current){o=Ls(i,o,h);break e}}else for(I=o.child,I!==null&&(I.return=o);I!==null;){var d=I.dependencies;if(d!==null){S=I.child;for(var G=d.firstContext;G!==null;){if(G.context===_){if(I.tag===1){G=Ms(-1,h&-h),G.tag=2;var le=I.updateQueue;if(le!==null){le=le.shared;var xe=le.pending;xe===null?G.next=G:(G.next=xe.next,xe.next=G),le.pending=G}}I.lanes|=h,G=I.alternate,G!==null&&(G.lanes|=h),Am(I.return,h,o),d.lanes|=h;break}G=G.next}}else if(I.tag===10)S=I.type===o.type?null:I.child;else if(I.tag===18){if(S=I.return,S===null)throw Error(Pe(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),Am(S,h,o),S=I.sibling}else S=I.child;if(S!==null)S.return=I;else for(S=I;S!==null;){if(S===o){S=null;break}if(I=S.sibling,I!==null){I.return=S.return,S=I;break}S=S.return}I=S}Ti(i,o,b.children,h),o=o.child}return o;case 9:return b=o.type,_=o.pendingProps.children,Ul(o,h),b=kn(b),_=_(b),o.flags|=1,Ti(i,o,_,h),o.child;case 14:return _=o.type,b=Fn(_,o.pendingProps),b=Fn(_.type,b),xv(i,o,_,b,h);case 15:return b0(i,o,o.type,o.pendingProps,h);case 17:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),Td(i,o),o.tag=1,Vi(_)?(i=!0,Od(o)):i=!1,Ul(o,h),v0(o,_,b),Lm(o,_,b,h),Bm(null,o,_,!0,i,h);case 19:return P0(i,o,h);case 22:return S0(i,o,h)}throw Error(Pe(156,o.tag))};function $0(i,o){return gx(i,o)}function aS(i,o,h,_){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(i,o,h,_){return new aS(i,o,h,_)}function Og(i){return i=i.prototype,!(!i||!i.isReactComponent)}function lS(i){if(typeof i=="function")return Og(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ig)return 11;if(i===ng)return 14}return 2}function Ao(i,o){var h=i.alternate;return h===null?(h=Sn(i.tag,o,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=o,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,o=i.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Pd(i,o,h,_,b,I){var S=2;if(_=i,typeof i=="function")Og(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case Pl:return ba(h.children,b,I,o);case rg:S=8,b|=8;break;case nm:return i=Sn(12,h,o,b|2),i.elementType=nm,i.lanes=I,i;case sm:return i=Sn(13,h,o,b),i.elementType=sm,i.lanes=I,i;case om:return i=Sn(19,h,o,b),i.elementType=om,i.lanes=I,i;case Qv:return up(h,b,I,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Jv:S=10;break e;case Yv:S=9;break e;case ig:S=11;break e;case ng:S=14;break e;case vo:S=16,_=null;break e}throw Error(Pe(130,i==null?i:typeof i,""))}return o=Sn(S,h,o,b),o.elementType=i,o.type=_,o.lanes=I,o}function ba(i,o,h,_){return i=Sn(7,i,_,o),i.lanes=h,i}function up(i,o,h,_){return i=Sn(22,i,_,o),i.elementType=Qv,i.lanes=h,i.stateNode={isHidden:!1},i}function em(i,o,h){return i=Sn(6,i,null,o),i.lanes=h,i}function tm(i,o,h){return o=Sn(4,i.children!==null?i.children:[],i.key,o),o.lanes=h,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function uS(i,o,h,_,b){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rf(0),this.expirationTimes=Rf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rf(0),this.identifierPrefix=_,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Ng(i,o,h,_,b,I,S,d,G){return i=new uS(i,o,h,d,G),o===1?(o=1,I===!0&&(o|=8)):o=0,I=Sn(3,null,null,o),i.current=I,I.stateNode=i,I.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},bg(I),i}function cS(i,o,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Il,key:_==null?null:""+_,children:i,containerInfo:o,implementation:h}}function Z0(i){if(!i)return Lo;i=i._reactInternals;e:{if(Ca(i)!==i||i.tag!==1)throw Error(Pe(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Vi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Pe(171))}if(i.tag===1){var h=i.type;if(Vi(h))return Zx(i,h,o)}return o}function q0(i,o,h,_,b,I,S,d,G){return i=Ng(h,_,!0,i,b,I,S,d,G),i.context=Z0(null),h=i.current,_=ki(),b=zo(h),I=Ms(_,b),I.callback=o??null,Co(h,I,b),i.current.lanes=b,Hc(i,b,_),ji(i,_),i}function cp(i,o,h,_){var b=o.current,I=ki(),S=zo(b);return h=Z0(h),o.context===null?o.context=h:o.pendingContext=h,o=Ms(I,S),o.payload={element:i},_=_===void 0?null:_,_!==null&&(o.callback=_),i=Co(b,o,S),i!==null&&(Vn(i,b,S,I),wd(i,b,S)),S}function Jd(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Av(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<o?h:o}}function Vg(i,o){Av(i,o),(i=i.alternate)&&Av(i,o)}function hS(){return null}var G0=typeof reportError=="function"?reportError:function(i){console.error(i)};function jg(i){this._internalRoot=i}hp.prototype.render=jg.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(Pe(409));cp(i,o,null,null)};hp.prototype.unmount=jg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Pa(function(){cp(null,i,null,null)}),o[As]=null}};function hp(i){this._internalRoot=i}hp.prototype.unstable_scheduleHydration=function(i){if(i){var o=Sx();i={blockedOn:null,target:i,priority:o};for(var h=0;h<wo.length&&o!==0&&o<wo[h].priority;h++);wo.splice(h,0,i),h===0&&kx(i)}};function Ug(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function dp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Dv(){}function dS(i,o,h,_,b){if(b){if(typeof _=="function"){var I=_;_=function(){var le=Jd(S);I.call(le)}}var S=q0(o,_,i,0,null,!1,!1,"",Dv);return i._reactRootContainer=S,i[As]=S.current,Bc(i.nodeType===8?i.parentNode:i),Pa(),S}for(;b=i.lastChild;)i.removeChild(b);if(typeof _=="function"){var d=_;_=function(){var le=Jd(G);d.call(le)}}var G=Ng(i,0,!1,null,null,!1,!1,"",Dv);return i._reactRootContainer=G,i[As]=G.current,Bc(i.nodeType===8?i.parentNode:i),Pa(function(){cp(o,G,h,_)}),G}function pp(i,o,h,_,b){var I=h._reactRootContainer;if(I){var S=I;if(typeof b=="function"){var d=b;b=function(){var G=Jd(S);d.call(G)}}cp(o,S,i,b)}else S=dS(h,o,i,b,_);return Jd(S)}wx=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var h=yc(o.pendingLanes);h!==0&&(ag(o,h|1),ji(o,vr()),!(Lt&6)&&(Kl=vr()+500,Bo()))}break;case 13:Pa(function(){var _=Ds(i,1);if(_!==null){var b=ki();Vn(_,i,1,b)}}),Vg(i,1)}};lg=function(i){if(i.tag===13){var o=Ds(i,134217728);if(o!==null){var h=ki();Vn(o,i,134217728,h)}Vg(i,134217728)}};bx=function(i){if(i.tag===13){var o=zo(i),h=Ds(i,o);if(h!==null){var _=ki();Vn(h,i,o,_)}Vg(i,o)}};Sx=function(){return qt};Tx=function(i,o){var h=qt;try{return qt=i,o()}finally{qt=h}};gm=function(i,o,h){switch(o){case"input":if(um(i,h),o=h.name,h.type==="radio"&&o!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<h.length;o++){var _=h[o];if(_!==i&&_.form===i.form){var b=ip(_);if(!b)throw Error(Pe(90));tx(_),um(_,b)}}}break;case"textarea":ix(i,h);break;case"select":o=h.value,o!=null&&Ol(i,!!h.multiple,o,!1)}};cx=Rg;hx=Pa;var pS={usingClientEntryPoint:!1,Events:[Xc,zl,ip,lx,ux,Rg]},mc={findFiberByHostInstance:ya,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fS={bundleType:mc.bundleType,version:mc.version,rendererPackageName:mc.rendererPackageName,rendererConfig:mc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Rs.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=fx(i),i===null?null:i.stateNode},findFiberByHostInstance:mc.findFiberByHostInstance||hS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!md.isDisabled&&md.supportsFiber)try{Qd=md.inject(fS),ns=md}catch{}}ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pS;ln.createPortal=function(i,o){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ug(o))throw Error(Pe(200));return cS(i,o,null,h)};ln.createRoot=function(i,o){if(!Ug(i))throw Error(Pe(299));var h=!1,_="",b=G0;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=Ng(i,1,!1,null,null,h,!1,_,b),i[As]=o.current,Bc(i.nodeType===8?i.parentNode:i),new jg(o)};ln.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(Pe(188)):(i=Object.keys(i).join(","),Error(Pe(268,i)));return i=fx(o),i=i===null?null:i.stateNode,i};ln.flushSync=function(i){return Pa(i)};ln.hydrate=function(i,o,h){if(!dp(o))throw Error(Pe(200));return pp(null,i,o,!0,h)};ln.hydrateRoot=function(i,o,h){if(!Ug(i))throw Error(Pe(405));var _=h!=null&&h.hydratedSources||null,b=!1,I="",S=G0;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),o=q0(o,null,i,1,h??null,b,!1,I,S),i[As]=o.current,Bc(i),_)for(i=0;i<_.length;i++)h=_[i],b=h._getVersion,b=b(h._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[h,b]:o.mutableSourceEagerHydrationData.push(h,b);return new hp(o)};ln.render=function(i,o,h){if(!dp(o))throw Error(Pe(200));return pp(null,i,o,!1,h)};ln.unmountComponentAtNode=function(i){if(!dp(i))throw Error(Pe(40));return i._reactRootContainer?(Pa(function(){pp(null,null,i,!1,function(){i._reactRootContainer=null,i[As]=null})}),!0):!1};ln.unstable_batchedUpdates=Rg;ln.unstable_renderSubtreeIntoContainer=function(i,o,h,_){if(!dp(h))throw Error(Pe(200));if(i==null||i._reactInternals===void 0)throw Error(Pe(38));return pp(i,o,h,!1,_)};ln.version="18.3.1-next-f1338f8080-20240426";function H0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(H0)}catch(i){console.error(i)}}H0(),Hv.exports=ln;var mS=Hv.exports,Lv=mS;rm.createRoot=Lv.createRoot,rm.hydrateRoot=Lv.hydrateRoot;var W0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,o){(function(h,_){i.exports=_()})(Uw,function(){var h={},_={};function b(S,d,G){if(_[S]=G,S==="index"){var le="var sharedModule = {}; ("+_.shared+")(sharedModule); ("+_.worker+")(sharedModule);",xe={};return _.shared(xe),_.index(h,xe),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([le],{type:"text/javascript"}))),h}}b("shared",["exports"],function(S){function d(r,t,n,a){return new(n||(n=Promise))(function(c,m){function g(k){try{x(a.next(k))}catch(P){m(P)}}function y(k){try{x(a.throw(k))}catch(P){m(P)}}function x(k){var P;k.done?c(k.value):(P=k.value,P instanceof n?P:new n(function(C){C(P)})).then(g,y)}x((a=a.apply(r,t||[])).next())})}function G(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var le=xe;function xe(r,t){this.x=r,this.y=t}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,t){var n=Math.cos(r),a=Math.sin(r),c=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(r){return r instanceof xe?r:Array.isArray(r)?new xe(r[0],r[1]):r};var re=G(le),H=Le;function Le(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}Le.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));a++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Fe=G(H);let Be,Tt;function ce(){return Be==null&&(Be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Be}function ie(){if(Tt==null&&(Tt=!1,ce())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&n[a]!==a){Tt=!0;break}}}return Tt||!1}function ue(r,t,n,a){const c=new Fe(r,t,n,a);return m=>c.solve(m)}const Te=ue(.25,.1,.25,1);function je(r,t,n){return Math.min(n,Math.max(t,r))}function He(r,t,n){const a=n-t,c=((r-t)%a+a)%a+t;return c===t?n:c}function Ge(r,...t){for(const n of t)for(const a in n)r[a]=n[a];return r}let Se=1;function it(r,t,n){const a={};for(const c in r)a[c]=t.call(this,r[c],c,r);return a}function et(r,t,n){const a={};for(const c in r)t.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function ht(r){return Array.isArray(r)?r.map(ht):typeof r=="object"&&r?it(r,ht):r}const zr={};function Ot(r){zr[r]||(typeof console<"u"&&console.warn(r),zr[r]=!0)}function lr(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Ar(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let cn=null;function Qr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function dt(r,t,n,a,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const y=g.startsWith("BGR"),x=new Uint8ClampedArray(a*c*4);if(yield m.copyTo(x,function(k,P,C,A,R){const B=4*Math.max(-P,0),O=(Math.max(0,C)-C)*A*4+B,$=4*A,X=Math.max(0,P),de=Math.max(0,C);return{rect:{x:X,y:de,width:Math.min(k.width,P+A)-X,height:Math.min(k.height,C+R)-de},layout:[{offset:O,stride:$}]}}(r,t,n,a,c)),y)for(let k=0;k<x.length;k+=4){const P=x[k];x[k]=x[k+2],x[k+2]=P}return x}finally{m.close()}})}let pt,kt;const Rt="AbortError";function Ui(){return new Error(Rt)}const Dr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ei(r){return Dr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const ti="global-dispatcher";class xr extends Error{constructor(t,n,a,c){super(`AJAXError: ${n} (${t}): ${a}`),this.status=t,this.statusText=n,this.url=a,this.body=c}}const $i=()=>Ar(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,os=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const a=ei(r.url);if(a)return a(r,t);if(Ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:ti},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test($i())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,c){return d(this,void 0,void 0,function*(){const m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:$i(),signal:c.signal});a.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const k=yield g.blob();throw new xr(g.status,g.statusText,a.url,k)}let y;y=a.type==="arrayBuffer"||a.type==="image"?g.arrayBuffer():a.type==="json"?g.json():g.text();const x=yield y;if(c.signal.aborted)throw Ui();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(Ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:ti},t)}var n;return function(a,c){return new Promise((m,g)=>{var y;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const k in a.headers)x.setRequestHeader(k,a.headers[k]);a.type==="json"&&(x.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let k=x.response;if(a.type==="json")try{k=JSON.parse(x.response)}catch(P){return void g(P)}m({data:k,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const k=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new xr(x.status,x.statusText,a.url,k))}},c.signal.addEventListener("abort",()=>{x.abort(),g(Ui())}),x.send(a.body)})}(r,t)};function as(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Oo(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Pn(r,t,n){if(n&&n[r]){const a=n[r].indexOf(t);a!==-1&&n[r].splice(a,1)}}class Un{constructor(t,n={}){Ge(this,n),this.type=t}}class $n extends Un{constructor(t,n={}){super("error",Ge({error:t},n))}}class Fs{on(t,n){return this._listeners=this._listeners||{},Oo(t,n,this._listeners),this}off(t,n){return Pn(t,n,this._listeners),Pn(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Oo(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){typeof t=="string"&&(t=new Un(t,n||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of m)Pn(a,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof $n&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ls=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function No(r,t){const n={};for(const a in r)a!=="ref"&&(n[a]=r[a]);return ls.forEach(a=>{a in t&&(n[a]=t[a])}),n}function zt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!zt(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!zt(r[n],t[n]))return!1;return!0}return r===t}function Qt(r,t){r.push(t)}function Vo(r,t,n){Qt(n,{command:"addSource",args:[r,t[r]]})}function Zn(r,t,n){Qt(t,{command:"removeSource",args:[r]}),n[r]=!0}function En(r,t,n,a){Zn(r,n,a),Vo(r,t,n)}function Bs(r,t,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!zt(r[n][a],t[n][a]))return!1;for(a in t[n])if(Object.prototype.hasOwnProperty.call(t[n],a)&&a!=="data"&&!zt(r[n][a],t[n][a]))return!1;return!0}function Ei(r,t,n,a,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(zt(r[g],t[g])||n.push({command:m,args:[a,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(zt(r[g],t[g])||n.push({command:m,args:[a,g,t[g],c]}))}function jo(r){return r.id}function Uo(r,t){return r[t.id]=t,r}class Ie{constructor(t,n,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function hn(r,...t){for(const n of t)for(const a in n)r[a]=n[a];return r}class Zr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class dn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[a,c]of n)this.bindings[a]=c}concat(t){return new dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const qn={kind:"null"},ze={kind:"number"},_t={kind:"string"},at={kind:"boolean"},ri={kind:"color"},Zi={kind:"object"},ft={kind:"value"},pn={kind:"collator"},Cn={kind:"formatted"},Gn={kind:"padding"},fn={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function L(r,t){return{kind:"array",itemType:r,N:t}}function D(r){if(r.kind==="array"){const t=D(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const N=[qn,ze,_t,at,ri,Cn,Zi,L(ft),Gn,fn,W];function Z(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Z(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of N)if(!Z(n,t))return null}}return`Expected ${D(r)} but found ${D(t)} instead.`}function te(r,t){return t.some(n=>n.kind===r.kind)}function se(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function he(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Y=.96422,_e=.82521,we=4/29,fe=6/29,Ee=3*fe*fe,tt=fe*fe*fe,nt=Math.PI/180,It=180/Math.PI;function mt(r){return(r%=360)<0&&(r+=360),r}function Pt([r,t,n,a]){let c,m;const g=fr((.2225045*(r=xt(r))+.7168786*(t=xt(t))+.0606169*(n=xt(n)))/1);r===t&&t===n?c=m=g:(c=fr((.4360747*r+.3850649*t+.1430804*n)/Y),m=fr((.0139322*r+.0971045*t+.7141733*n)/_e));const y=116*g-16;return[y<0?0:y,500*(c-g),200*(g-m),a]}function xt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function fr(r){return r>tt?Math.pow(r,1/3):r/Ee+we}function er([r,t,n,a]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*Ft(c),m=Y*Ft(m),g=_e*Ft(g),[yt(3.1338561*m-1.6168667*c-.4906146*g),yt(-.9787684*m+1.9161415*c+.033454*g),yt(.0719453*m-.2289914*c+1.4052427*g),a]}function yt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Ft(r){return r>fe?r*r*r:Ee*(r-we)}function Jt(r){return parseInt(r.padEnd(2,r),16)/255}function wr(r,t){return Ir(t?r/100:r,0,1)}function Ir(r,t,n){return Math.min(Math.max(t,r),n)}function qr(r){return!r.some(Number.isNaN)}const Os={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bt{constructor(t,n,a,c=1,m=!0){this.r=t,this.g=n,this.b=a,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,a,c]))}static parse(t){if(t instanceof Bt)return t;if(typeof t!="string")return;const n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Os[a];if(c){const[g,y,x]=c;return[g/255,y/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const g=a.length<6?1:2;let y=1;return[Jt(a.slice(y,y+=g)),Jt(a.slice(y,y+=g)),Jt(a.slice(y,y+=g)),Jt(a.slice(y,y+g)||"ff")]}if(a.startsWith("rgb")){const g=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,k,P,C,A,R,B,O,$,X,de]=g,ee=[P||" ",R||" ",$].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[k,A,O].join(""),ge=ae==="%%%"?100:ae===""?255:0;if(ge){const be=[Ir(+x/ge,0,1),Ir(+C/ge,0,1),Ir(+B/ge,0,1),X?wr(+X,de):1];if(qr(be))return be}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,y,x,k,P,C,A,R,B]=m,O=[x||" ",P||" ",A].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const $=[+y,Ir(+k,0,100),Ir(+C,0,100),R?wr(+R,B):1];if(qr($))return function([X,de,ee,ae]){function ge(be){const Ve=(be+X/30)%12,st=de*Math.min(ee,1-ee);return ee-st*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return X=mt(X),de/=100,ee/=100,[ge(0),ge(8),ge(4),ae]}($)}}}(t);return n?new Bt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:a,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,a/m,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,a,c,m]=Pt(t),g=Math.sqrt(a*a+c*c);return[Math.round(1e4*g)?mt(Math.atan2(c,a)*It):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Pt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,a,c]=this.rgb;return`rgba(${[t,n,a].map(m=>Math.round(255*m)).join(",")},${c})`}}Bt.black=new Bt(0,0,0,1),Bt.white=new Bt(1,1,1,1),Bt.transparent=new Bt(0,0,0,0),Bt.red=new Bt(1,0,0,1);class eu{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tu{constructor(t,n,a,c,m){this.text=t,this.image=n,this.scale=a,this.fontStack=c,this.textColor=m}}class mi{constructor(t){this.sections=t}static fromString(t){return new mi([new tu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof mi?t:mi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class gi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gi)return t;if(typeof t=="number")return new gi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new gi(t)}}toString(){return JSON.stringify(this.values)}}const fp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ci{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ci)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const a=t[n],c=t[n+1];if(typeof a!="string"||!fp.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ci(t)}}toString(){return JSON.stringify(this.values)}}class _i{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new _i({name:t,available:!1}):null}}function Ns(r,t,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,n,a]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function us(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Bt||r instanceof eu||r instanceof mi||r instanceof gi||r instanceof Ci||r instanceof _i)return!0;if(Array.isArray(r)){for(const t of r)if(!us(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!us(r[t]))return!1;return!0}return!1}function mr(r){if(r===null)return qn;if(typeof r=="string")return _t;if(typeof r=="boolean")return at;if(typeof r=="number")return ze;if(r instanceof Bt)return ri;if(r instanceof eu)return pn;if(r instanceof mi)return Cn;if(r instanceof gi)return Gn;if(r instanceof Ci)return W;if(r instanceof _i)return fn;if(Array.isArray(r)){const t=r.length;let n;for(const a of r){const c=mr(a);if(n){if(n===c)continue;n=ft;break}n=c}return L(n||ft,t)}return Zi}function $o(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Bt||r instanceof mi||r instanceof gi||r instanceof Ci||r instanceof _i?r.toString():JSON.stringify(r)}class qi{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!us(t[1]))return n.error("invalid value");const a=t[1];let c=mr(a);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new qi(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ur{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ma={string:_t,number:ze,boolean:at,object:Zi};class Gi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,c=1;const m=t[0];if(m==="array"){let y,x;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in Ma)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ma[k],c++}else y=ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}a=L(y,x)}else{if(!Ma[m])throw new Error(`Types doesn't contain name = ${m}`);a=Ma[m]}const g=[];for(;c<t.length;c++){const y=n.parse(t[c],c,ft);if(!y)return null;g.push(y)}return new Gi(a,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(t);if(!Z(this.type,mr(a)))return a;if(n===this.args.length-1)throw new ur(`Expected value to be of type ${D(this.type)}, but found ${D(mr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ru={"to-boolean":at,"to-color":ri,"to-number":ze,"to-string":_t};class Hi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[0];if(!ru[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=ru[a],m=[];for(let g=1;g<t.length;g++){const y=n.parse(t[g],g,ft);if(!y)return null;m.push(y)}return new Hi(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,a;for(const c of this.args){if(n=c.evaluate(t),a=null,n instanceof Bt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ns(n[0],n[1],n[2],n[3]),!a))return new Bt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ur(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const a of this.args){n=a.evaluate(t);const c=gi.parse(n);if(c)return c}throw new ur(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const a of this.args){n=a.evaluate(t);const c=Ci.parse(n);if(c)return c}throw new ur(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const a of this.args){if(n=a.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new ur(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return mi.fromString($o(this.args[0].evaluate(t)));case"resolvedImage":return _i.fromString($o(this.args[0].evaluate(t)));default:return $o(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const mp=["Unknown","Point","LineString","Polygon"];class za{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Bt.parse(t)),n}}class cs{constructor(t,n,a=[],c,m=new dn,g=[]){this.registry=t,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,a,c,m={}){return n?this.concat(n,a,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function a(c,m,g){return g==="assert"?new Gi(m,[c]):g==="coerce"?new Hi(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"assert")}if(!(g instanceof qi)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const y=new za;try{g=new qi(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){const c=typeof t=="number"?this.path.concat(t):this.path,m=a?this.scope.concat(a):this.scope;return new cs(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Zr(a,t))}checkSubtype(t,n){const a=Z(t,n);return a&&this.error(a),a}}class Hn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const y=n.parse(t[m+1],m+1);if(!y)return null;a.push([g,y])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return c?new Hn(a,c):null}outputDefined(){return this.result.outputDefined()}}class At{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=t[1];return n.scope.has(a)?new At(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class iu{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ze),c=n.parse(t[2],2,L(n.expectedType||ft));return a&&c?new iu(c.type.itemType,a,c):null}evaluate(t){const n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new ur(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new ur(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new ur(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class nu{constructor(t,n){this.type=at,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ft),c=n.parse(t[2],2,ft);return a&&c?te(a.type,[at,_t,ze,qn,ft])?new nu(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!se(n,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${D(mr(n))} instead.`);if(!se(a,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${D(mr(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Vs{constructor(t,n,a){this.type=ze,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ft),c=n.parse(t[2],2,ft);if(!a||!c)return null;if(!te(a.type,[at,_t,ze,qn,ft]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,ze);return m?new Vs(a,c,m):null}return new Vs(a,c)}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!se(n,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${D(mr(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),se(a,["string"])){const m=a.indexOf(n,c);return m===-1?-1:[...a.slice(0,m)].length}if(se(a,["array"]))return a.indexOf(n,c);throw new ur(`Expected second argument to be of type array or string, but found ${D(mr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class su{constructor(t,n,a,c,m,g){this.inputType=t,this.type=n,this.input=a,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let k=2;k<t.length-1;k+=2){let P=t[k];const C=t[k+1];Array.isArray(P)||(P=[P]);const A=n.concat(k);if(P.length===0)return A.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return A.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,mr(B)))return null}else a=mr(B);if(m[String(B)]!==void 0)return A.error("Branch labels must be unique.");m[String(B)]=g.length}const R=n.parse(C,k,c);if(!R)return null;c=c||R.type,g.push(R)}const y=n.parse(t[1],1,ft);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new su(a,c,y,m,g,x):null}evaluate(t){const n=this.input.evaluate(t);return(mr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Aa{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const y=n.parse(t[g],g,at);if(!y)return null;const x=n.parse(t[g+1],g+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}const m=n.parse(t[t.length-1],t.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Aa(a,c,m)}evaluate(t){for(const[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Zo{constructor(t,n,a,c){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ft),c=n.parse(t[2],2,ze);if(!a||!c)return null;if(!te(a.type,[L(ft),_t,ft]))return n.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,ze);return m?new Zo(a.type,a,c,m):null}return new Zo(a.type,a,c)}evaluate(t){const n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),se(n,["string"]))return[...n].slice(a,c).join("");if(se(n,["array"]))return n.slice(a,c);throw new ur(`Expected first argument to be of type array or string, but found ${D(mr(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Da(r,t){const n=r.length-1;let a,c,m=0,g=n,y=0;for(;m<=g;)if(y=Math.floor((m+g)/2),a=r[y],c=r[y+1],a<=t){if(y===n||t<c)return y;m=y+1}else{if(!(a>t))throw new ur("Input is not a number.");g=y-1}return 0}class js{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(t[1],1,ze);if(!a)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const y=g===1?-1/0:t[g],x=t[g+1],k=g,P=g+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const C=n.parse(x,P,m);if(!C)return null;m=m||C.type,c.push([y,C])}return new js(m,a,c)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return a[0].evaluate(t);const m=n.length;return c>=n[m-1]?a[m-1].evaluate(t):a[Da(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var gp=Yc;function Yc(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}Yc.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));a++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var _p=Jc(gp);function hs(r,t,n){return r+n*(t-r)}function qo(r,t,n){return r.map((a,c)=>hs(a,t[c],n))}const ii={number:hs,color:function(r,t,n,a="rgb"){switch(a){case"rgb":{const[c,m,g,y]=qo(r.rgb,t.rgb,n);return new Bt(c,m,g,y,!1)}case"hcl":{const[c,m,g,y]=r.hcl,[x,k,P,C]=t.hcl;let A,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?A=NaN:(A=x,g!==1&&g!==0||(R=k)):(A=c,P!==1&&P!==0||(R=m));else{let de=x-c;x>c&&de>180?de-=360:x<c&&c-x>180&&(de+=360),A=c+n*de}const[B,O,$,X]=function([de,ee,ae,ge]){return de=isNaN(de)?0:de*nt,er([ae,Math.cos(de)*ee,Math.sin(de)*ee,ge])}([A,R??hs(m,k,n),hs(g,P,n),hs(y,C,n)]);return new Bt(B,O,$,X,!1)}case"lab":{const[c,m,g,y]=er(qo(r.lab,t.lab,n));return new Bt(c,m,g,y,!1)}}},array:qo,padding:function(r,t,n){return new gi(qo(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const a=r.values,c=t.values;if(a.length!==c.length)throw new ur(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<a.length;g+=2){if(a[g]!==c[g])throw new ur(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${a[g]}, to[${g}]: ${c[g]}`);m.push(a[g]);const[y,x]=a[g+1],[k,P]=c[g+1];m.push([hs(y,k,n),hs(x,P,n)])}return new Ci(m)}};class ni{constructor(t,n,a,c,m){this.type=t,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of m)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,n,a,c){let m=0;if(t.name==="exponential")m=La(n,t.base,a,c);else if(t.name==="linear")m=La(n,1,a,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new _p(g[0],g[1],g[2],g[3]).solve(La(n,1,a,c))}return m}static parse(t,n){let[a,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,ze),!m)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=ri:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let k=0;k<g.length;k+=2){const P=g[k],C=g[k+1],A=k+3,R=k+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(y.length&&y[y.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const B=n.parse(C,R,x);if(!B)return null;x=x||B.type,y.push([P,B])}return he(x,ze)||he(x,ri)||he(x,Gn)||he(x,W)||he(x,L(ze))?new ni(x,a,c,m,y):n.error(`Type ${D(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return a[0].evaluate(t);const m=n.length;if(c>=n[m-1])return a[m-1].evaluate(t);const g=Da(n,c),y=ni.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=a[g].evaluate(t),k=a[g+1].evaluate(t);switch(this.operator){case"interpolate":return ii[this.type.kind](x,k,y);case"interpolate-hcl":return ii.color(x,k,y,"hcl");case"interpolate-lab":return ii.color(x,k,y,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function La(r,t,n,a){const c=a-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class Ra{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null;const c=n.expectedType;c&&c.kind!=="value"&&(a=c);const m=[];for(const y of t.slice(1)){const x=n.parse(y,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,m.push(x)}if(!a)throw new Error("No output type");const g=c&&m.some(y=>Z(c,y.type));return new Ra(g?ft:a,m)}evaluate(t){let n,a=null,c=0;for(const m of this.args)if(c++,a=m.evaluate(t),a&&a instanceof _i&&!a.available&&(n||(n=a.name),a=null,c===this.args.length&&(a=n)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Fa(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Qc(r,t,n,a){return a.compare(t,n)===0}function Us(r,t,n){const a=r!=="=="&&r!=="!=";return class X0{constructor(m,g,y){this.type=at,this.lhs=m,this.rhs=g,this.collator=y,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const y=m[0];let x=g.parse(m[1],1,ft);if(!x)return null;if(!Fa(y,x.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${D(x.type)}'.`);let k=g.parse(m[2],2,ft);if(!k)return null;if(!Fa(y,k.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${D(k.type)}'.`);if(x.type.kind!==k.type.kind&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${D(x.type)}' and '${D(k.type)}'.`);a&&(x.type.kind==="value"&&k.type.kind!=="value"?x=new Gi(k.type,[x]):x.type.kind!=="value"&&k.type.kind==="value"&&(k=new Gi(x.type,[k])));let P=null;if(m.length===4){if(x.type.kind!=="string"&&k.type.kind!=="string"&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(m[3],3,pn),!P)return null}return new X0(x,k,P)}evaluate(m){const g=this.lhs.evaluate(m),y=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const x=mr(g),k=mr(y);if(x.kind!==k.kind||x.kind!=="string"&&x.kind!=="number")throw new ur(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=mr(g),k=mr(y);if(x.kind!=="string"||k.kind!=="string")return t(m,g,y)}return this.collator?n(m,g,y,this.collator.evaluate(m)):t(m,g,y)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const yp=Us("==",function(r,t,n){return t===n},Qc),eh=Us("!=",function(r,t,n){return t!==n},function(r,t,n,a){return!Qc(0,t,n,a)}),th=Us("<",function(r,t,n){return t<n},function(r,t,n,a){return a.compare(t,n)<0}),vp=Us(">",function(r,t,n){return t>n},function(r,t,n,a){return a.compare(t,n)>0}),xp=Us("<=",function(r,t,n){return t<=n},function(r,t,n,a){return a.compare(t,n)<=0}),rh=Us(">=",function(r,t,n){return t>=n},function(r,t,n,a){return a.compare(t,n)>=0});class Go{constructor(t,n,a){this.type=pn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,at);if(!c)return null;const m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,at);if(!m)return null;let g=null;return a.locale&&(g=n.parse(a.locale,1,_t),!g)?null:new Go(c,m,g)}evaluate(t){return new eu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ou{constructor(t,n,a,c,m){this.type=_t,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const a=n.parse(t[1],1,ze);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,_t),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,_t),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,ze),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,ze),!x)?null:new ou(a,m,g,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ba{constructor(t){this.type=Cn,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(m&&typeof y=="object"&&!Array.isArray(y)){m=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,ze),!x))return null;let k=null;if(y["text-font"]&&(k=n.parse(y["text-font"],1,L(_t)),!k))return null;let P=null;if(y["text-color"]&&(P=n.parse(y["text-color"],1,ri),!P))return null;const C=c[c.length-1];C.scale=x,C.font=k,C.textColor=P}else{const x=n.parse(t[g],1,ft);if(!x)return null;const k=x.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Ba(c)}evaluate(t){return new mi(this.sections.map(n=>{const a=n.content.evaluate(t);return mr(a)===fn?new tu("",a,null,null,null):new tu($o(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class au{constructor(t){this.type=fn,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const a=n.parse(t[1],1,_t);return a?new au(a):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),a=_i.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class lu{constructor(t){this.type=ze,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new lu(a):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new ur(`Expected value to be of type string or array, but found ${D(mr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const mn=8192;function wp(r,t){const n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*mn),Math.round(a*c*mn)]}function uu(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/mn+t.x)/n,360*c-180),(a=(r[1]/mn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function ds(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Wn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Dt(r,t,n){const a=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return a*g-m*c==0&&a*m<=0&&c*g<=0}function Oa(r,t,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!nh(r,t,n,a)||!nh(n,a,r,t));var c,m}function bp(r,t,n){for(const a of n)for(let c=0;c<a.length-1;++c)if(Oa(r,t,a[c],a[c+1]))return!0;return!1}function $s(r,t,n=!1){let a=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(Dt(r,y[x],y[x+1]))return n;(m=y[x])[1]>(c=r)[1]!=(g=y[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(a=!a)}var c,m,g;return a}function Sp(r,t){for(const n of t)if($s(r,n))return!0;return!1}function ih(r,t){for(const n of r)if(!$s(n,t))return!1;for(let n=0;n<r.length-1;++n)if(bp(r[n],r[n+1],t))return!1;return!0}function Tp(r,t){for(const n of t)if(ih(r,n))return!0;return!1}function nh(r,t,n,a){const c=a[0]-n[0],m=a[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),y=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&y<0||g<0&&y>0}function cu(r,t,n){const a=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const y=wp(r[c][g],n);ds(t,y),m.push(y)}a.push(m)}return a}function sh(r,t,n){const a=[];for(let c=0;c<r.length;c++){const m=cu(r[c],t,n);a.push(m)}return a}function oh(r,t,n,a){if(r[0]<n[0]||r[0]>n[2]){const c=.5*a;let m=r[0]-n[0]>c?-a:n[0]-r[0]>c?a:0;m===0&&(m=r[0]-n[2]>c?-a:n[2]-r[0]>c?a:0),r[0]+=m}ds(t,r)}function ah(r,t,n,a){const c=Math.pow(2,a.z)*mn,m=[a.x*mn,a.y*mn],g=[];for(const y of r)for(const x of y){const k=[x.x+m[0],x.y+m[1]];oh(k,t,n,c),g.push(k)}return g}function lh(r,t,n,a){const c=Math.pow(2,a.z)*mn,m=[a.x*mn,a.y*mn],g=[];for(const x of r){const k=[];for(const P of x){const C=[P.x+m[0],P.y+m[1]];ds(t,C),k.push(C)}g.push(k)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of g)for(const k of x)oh(k,t,n,c)}var y;return g}class ps{constructor(t,n){this.type=at,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(us(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const m of a.features){const{type:g,coordinates:y}=m.geometry;g==="Polygon"&&c.push(y),g==="MultiPolygon"&&c.push(...y)}if(c.length)return new ps(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ps(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ps(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(a.type==="Polygon"){const y=cu(a.coordinates,m,g),x=ah(n.geometry(),c,m,g);if(!Wn(c,m))return!1;for(const k of x)if(!$s(k,y))return!1}if(a.type==="MultiPolygon"){const y=sh(a.coordinates,m,g),x=ah(n.geometry(),c,m,g);if(!Wn(c,m))return!1;for(const k of x)if(!Sp(k,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(a.type==="Polygon"){const y=cu(a.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!Wn(c,m))return!1;for(const k of x)if(!ih(k,y))return!1}if(a.type==="MultiPolygon"){const y=sh(a.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!Wn(c,m))return!1;for(const k of x)if(!Tp(k,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let uh=class{constructor(r=[],t=(n,a)=>n<a?-1:n>a?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,a=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(a,m)>=0)break;t[r]=m,r=c}t[r]=a}_down(r){const{data:t,compare:n}=this,a=this.length>>1,c=t[r];for(;r<a;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function kp(r,t,n,a,c){ch(r,t,n,a||r.length-1,c||Ip)}function ch(r,t,n,a,c){for(;a>n;){if(a-n>600){var m=a-n+1,g=t-n+1,y=Math.log(m),x=.5*Math.exp(2*y/3),k=.5*Math.sqrt(y*x*(m-x)/m)*(g-m/2<0?-1:1);ch(r,t,Math.max(n,Math.floor(t-g*x/m+k)),Math.min(a,Math.floor(t+(m-g)*x/m+k)),c)}var P=r[t],C=n,A=a;for(Ho(r,n,t),c(r[a],P)>0&&Ho(r,n,a);C<A;){for(Ho(r,C,A),C++,A--;c(r[C],P)<0;)C++;for(;c(r[A],P)>0;)A--}c(r[n],P)===0?Ho(r,n,A):Ho(r,++A,a),A<=t&&(n=A+1),t<=A&&(a=A-1)}}function Ho(r,t,n){var a=r[t];r[t]=r[n],r[n]=a}function Ip(r,t){return r<t?-1:r>t?1:0}function Na(r,t){if(r.length<=1)return[r];const n=[];let a,c;for(const m of r){const g=Ep(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(a&&n.push(a),a=[m]):a.push(m))}if(a&&n.push(a),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(kp(n[m],t,1,n[m].length-1,Pp),n[m]=n[m].slice(0,t));return n}function Pp(r,t){return t.area-r.area}function Ep(r){let t=0;for(let n,a,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],a=r[g],t+=(a.x-n.x)*(n.y+a.y);return t}const hh=1/298.257223563,dh=hh*(2-hh),ph=Math.PI/180;class hu{constructor(t){const n=6378.137*ph*1e3,a=Math.cos(t*ph),c=1/(1-dh*(1-a*a)),m=Math.sqrt(c);this.kx=n*m*a,this.ky=n*m*c*(1-dh)}distance(t,n){const a=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,n){let a,c,m,g,y=1/0;for(let x=0;x<t.length-1;x++){let k=t[x][0],P=t[x][1],C=this.wrap(t[x+1][0]-k)*this.kx,A=(t[x+1][1]-P)*this.ky,R=0;C===0&&A===0||(R=(this.wrap(n[0]-k)*this.kx*C+(n[1]-P)*this.ky*A)/(C*C+A*A),R>1?(k=t[x+1][0],P=t[x+1][1]):R>0&&(k+=C/this.kx*R,P+=A/this.ky*R)),C=this.wrap(n[0]-k)*this.kx,A=(n[1]-P)*this.ky;const B=C*C+A*A;B<y&&(y=B,a=k,c=P,m=x,g=R)}return{point:[a,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function fh(r,t){return t[0]-r[0]}function Va(r){return r[1]-r[0]+1}function Mn(r,t){return r[1]>=r[0]&&r[1]<t}function du(r,t){if(r[0]>r[1])return[null,null];const n=Va(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const a=Math.floor(n/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}function pu(r,t){if(!Mn(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ds(n,r[a]);return n}function fu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const a of n)ds(t,a);return t}function ja(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function mu(r,t,n){if(!ja(r)||!ja(t))return NaN;let a=0,c=0;return r[2]<t[0]&&(a=t[0]-r[2]),r[0]>t[2]&&(a=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[a,c])}function fs(r,t,n){const a=n.pointOnLine(t,r);return n.distance(r,a.point)}function gu(r,t,n,a,c){const m=Math.min(fs(r,[n,a],c),fs(t,[n,a],c)),g=Math.min(fs(n,[r,t],c),fs(a,[r,t],c));return Math.min(m,g)}function Cp(r,t,n,a,c){if(!Mn(t,r.length)||!Mn(a,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const y=r[g],x=r[g+1];for(let k=a[0];k<a[1];++k){const P=n[k],C=n[k+1];if(Oa(y,x,P,C))return 0;m=Math.min(m,gu(y,x,P,C,c))}}return m}function nr(r,t,n,a,c){if(!Mn(t,r.length)||!Mn(a,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let y=a[0];y<=a[1];++y)if(m=Math.min(m,c.distance(r[g],n[y])),m===0)return m;return m}function Mp(r,t,n){if($s(r,t,!0))return 0;let a=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(a=Math.min(a,fs(r,[g,m],n)),a===0))return a;const y=n.pointOnLine(c,r);if(a=Math.min(a,n.distance(r,y.point)),a===0)return a}return a}function vt(r,t,n,a){if(!Mn(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if($s(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],y=r[m+1];for(const x of n)for(let k=0,P=x.length,C=P-1;k<P;C=k++){const A=x[C],R=x[k];if(Oa(g,y,A,R))return 0;c=Math.min(c,gu(g,y,A,R,a))}}return c}function Ua(r,t){for(const n of r)for(const a of n)if($s(a,t,!0))return!0;return!1}function $t(r,t,n,a=1/0){const c=fu(r),m=fu(t);if(a!==1/0&&mu(c,m,n)>=a)return a;if(Wn(c,m)){if(Ua(r,t))return 0}else if(Ua(t,r))return 0;let g=1/0;for(const y of r)for(let x=0,k=y.length,P=k-1;x<k;P=x++){const C=y[P],A=y[x];for(const R of t)for(let B=0,O=R.length,$=O-1;B<O;$=B++){const X=R[$],de=R[B];if(Oa(C,A,X,de))return 0;g=Math.min(g,gu(C,A,X,de,n))}}return g}function Nt(r,t,n,a,c,m){if(!m)return;const g=mu(pu(a,m),c,n);g<t&&r.push([g,m,[0,0]])}function ms(r,t,n,a,c,m,g){if(!m||!g)return;const y=mu(pu(a,m),pu(c,g),n);y<t&&r.push([y,m,g])}function Wo(r,t,n,a,c=1/0){let m=Math.min(a.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new uh([[0,[0,r.length-1],[0,0]]],fh),y=fu(n);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const k=x[1],P=t?50:100;if(Va(k)<=P){if(!Mn(k,r.length))return NaN;if(t){const C=vt(r,k,n,a);if(isNaN(C)||C===0)return C;m=Math.min(m,C)}else for(let C=k[0];C<=k[1];++C){const A=Mp(r[C],n,a);if(m=Math.min(m,A),m===0)return 0}}else{const C=du(k,t);Nt(g,m,a,r,y,C[0]),Nt(g,m,a,r,y,C[1])}}return m}function Xo(r,t,n,a,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const y=new uh([[0,[0,r.length-1],[0,n.length-1]]],fh);for(;y.length>0;){const x=y.pop();if(x[0]>=g)continue;const k=x[1],P=x[2],C=t?50:100,A=a?50:100;if(Va(k)<=C&&Va(P)<=A){if(!Mn(k,r.length)&&Mn(P,n.length))return NaN;let R;if(t&&a)R=Cp(r,k,n,P,c),g=Math.min(g,R);else if(t&&!a){const B=r.slice(k[0],k[1]+1);for(let O=P[0];O<=P[1];++O)if(R=fs(n[O],B,c),g=Math.min(g,R),g===0)return g}else if(!t&&a){const B=n.slice(P[0],P[1]+1);for(let O=k[0];O<=k[1];++O)if(R=fs(r[O],B,c),g=Math.min(g,R),g===0)return g}else R=nr(r,k,n,P,c),g=Math.min(g,R)}else{const R=du(k,t),B=du(P,a);ms(y,g,c,r,n,R[0],B[0]),ms(y,g,c,r,n,R[0],B[1]),ms(y,g,c,r,n,R[1],B[0]),ms(y,g,c,r,n,R[1],B[1])}}return g}function _u(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class gs{constructor(t,n){this.type=ze,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(us(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new gs(a,a.features.map(c=>_u(c.geometry)).flat());if(a.type==="Feature")return new gs(a,_u(a.geometry));if("type"in a&&"coordinates"in a)return new gs(a,_u(a))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){const c=n.geometry(),m=c.flat().map(x=>uu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new hu(m[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Xo(m,!1,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Xo(m,!1,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Wo(m,!1,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){const c=n.geometry(),m=c.flat().map(x=>uu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new hu(m[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Xo(m,!0,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Xo(m,!0,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Wo(m,!0,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,a){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=Na(c,0).map(x=>x.map(k=>k.map(P=>uu([P.x,P.y],n.canonical)))),g=new hu(m[0][0][0][1]);let y=1/0;for(const x of a)for(const k of m){switch(x.type){case"Point":y=Math.min(y,Wo([x.coordinates],!1,k,g,y));break;case"LineString":y=Math.min(y,Wo(x.coordinates,!0,k,g,y));break;case"Polygon":y=Math.min(y,$t(k,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Zs={"==":yp,"!=":eh,">":vp,"<":th,">=":rh,"<=":xp,array:Gi,at:iu,boolean:Gi,case:Aa,coalesce:Ra,collator:Go,format:Ba,image:au,in:nu,"index-of":Vs,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:lu,let:Hn,literal:qi,match:su,number:Gi,"number-format":ou,object:Gi,slice:Zo,step:js,string:Gi,"to-boolean":Hi,"to-color":Hi,"to-number":Hi,"to-string":Hi,var:At,within:ps,distance:gs};class Mi{constructor(t,n,a,c){this.name=t,this.type=n,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const a=t[0],c=Mi.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let x=null;for(const[k,P]of y){x=new cs(n.registry,Ko,n.path,null,n.scope);const C=[];let A=!1;for(let R=1;R<t.length;R++){const B=t[R],O=Array.isArray(k)?k[R-1]:k.type,$=x.parse(B,1+C.length,O);if(!$){A=!0;break}C.push($)}if(!A)if(Array.isArray(k)&&k.length!==C.length)x.error(`Expected ${k.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const B=Array.isArray(k)?k[R]:k.type,O=C[R];x.concat(R+1).checkSubtype(B,O.type)}if(x.errors.length===0)return new Mi(a,m,P,C)}}if(y.length===1)n.errors.push(...x.errors);else{const k=(y.length?y:g).map(([C])=>{return A=C,Array.isArray(A)?`(${A.map(D).join(", ")})`:`(${D(A.type)}...)`;var A}).join(" | "),P=[];for(let C=1;C<t.length;C++){const A=n.parse(t[C],1+P.length);if(!A)return null;P.push(D(A.type))}n.error(`Expected arguments of type ${k}, but found (${P.join(", ")}) instead.`)}return null}static register(t,n){Mi.definitions=n;for(const a in n)t[a]=Mi}}function yu(r,[t,n,a,c]){t=t.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const m=c?c.evaluate(r):1,g=Ns(t,n,a,m);if(g)throw new ur(g);return new Bt(t/255,n/255,a/255,m,!1)}function vu(r,t){return r in t}function xu(r,t){const n=t[r];return n===void 0?null:n}function _s(r){return{type:r}}function Ko(r){if(r instanceof At)return Ko(r.boundExpression);if(r instanceof Mi&&r.name==="error"||r instanceof Go||r instanceof ps||r instanceof gs)return!1;const t=r instanceof Hi||r instanceof Gi;let n=!0;return r.eachChild(a=>{n=t?n&&Ko(a):n&&a instanceof qi}),!!n&&Jo(r)&&Yo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Jo(r){if(r instanceof Mi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ps||r instanceof gs)return!1;let t=!0;return r.eachChild(n=>{t&&!Jo(n)&&(t=!1)}),t}function qs(r){if(r instanceof Mi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!qs(n)&&(t=!1)}),t}function Yo(r,t){if(r instanceof Mi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!Yo(a,t)&&(n=!1)}),n}function $a(r){return{result:"success",value:r}}function Gs(r){return{result:"error",value:r}}function Hs(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function mh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function wu(r){return!!r.expression&&r.expression.interpolated}function Ct(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Za(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function zp(r){return r}function gh(r,t){const n=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),m=r.type||(wu(t)?"exponential":"interval");if(n||t.type==="padding"){const P=n?Bt.parse:gi.parse;(r=hn({},r)).stops&&(r.stops=r.stops.map(C=>[C[0],P(C[1])])),r.default=P(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let y,x,k;if(m==="exponential")y=yh;else if(m==="interval")y=qa;else if(m==="categorical"){y=_h,x=Object.create(null);for(const P of r.stops)x[P[0]]=P[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=vh}if(a){const P={},C=[];for(let B=0;B<r.stops.length;B++){const O=r.stops[B],$=O[0].zoom;P[$]===void 0&&(P[$]={zoom:$,type:r.type,property:r.property,default:r.default,stops:[]},C.push($)),P[$].stops.push([O[0].value,O[1]])}const A=[];for(const B of C)A.push([P[B].zoom,gh(P[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:ni.interpolationFactor.bind(void 0,R),zoomStops:A.map(B=>B[0]),evaluate:({zoom:B},O)=>yh({stops:A,base:r.base},t,B).evaluate(B,O)}}if(c){const P=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ni.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(r,t,C,x,k)}}return{kind:"source",evaluate(P,C){const A=C&&C.properties?C.properties[r.property]:void 0;return A===void 0?Ws(r.default,t.default):y(r,t,A,x,k)}}}function Ws(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function _h(r,t,n,a,c){return Ws(typeof n===c?a[n]:void 0,r.default,t.default)}function qa(r,t,n){if(Ct(n)!=="number")return Ws(r.default,t.default);const a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];const c=Da(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function yh(r,t,n){const a=r.base!==void 0?r.base:1;if(Ct(n)!=="number")return Ws(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=Da(r.stops.map(P=>P[0]),n),g=function(P,C,A,R){const B=R-A,O=P-A;return B===0?0:C===1?O/B:(Math.pow(C,O)-1)/(Math.pow(C,B)-1)}(n,a,r.stops[m][0],r.stops[m+1][0]),y=r.stops[m][1],x=r.stops[m+1][1],k=ii[t.type]||zp;return typeof y.evaluate=="function"?{evaluate(...P){const C=y.evaluate.apply(void 0,P),A=x.evaluate.apply(void 0,P);if(C!==void 0&&A!==void 0)return k(C,A,g,r.colorSpace)}}:k(y,x,g,r.colorSpace)}function vh(r,t,n){switch(t.type){case"color":n=Bt.parse(n);break;case"formatted":n=mi.fromString(n.toString());break;case"resolvedImage":n=_i.fromString(n.toString());break;case"padding":n=gi.parse(n);break;default:Ct(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Ws(n,r.default,t.default)}Mi.register(Zs,{error:[{kind:"error"},[_t],(r,[t])=>{throw new ur(t.evaluate(r))}],typeof:[_t,[ft],(r,[t])=>D(mr(t.evaluate(r)))],"to-rgba":[L(ze,4),[ri],(r,[t])=>{const[n,a,c,m]=t.evaluate(r).rgb;return[255*n,255*a,255*c,m]}],rgb:[ri,[ze,ze,ze],yu],rgba:[ri,[ze,ze,ze,ze],yu],has:{type:at,overloads:[[[_t],(r,[t])=>vu(t.evaluate(r),r.properties())],[[_t,Zi],(r,[t,n])=>vu(t.evaluate(r),n.evaluate(r))]]},get:{type:ft,overloads:[[[_t],(r,[t])=>xu(t.evaluate(r),r.properties())],[[_t,Zi],(r,[t,n])=>xu(t.evaluate(r),n.evaluate(r))]]},"feature-state":[ft,[_t],(r,[t])=>xu(t.evaluate(r),r.featureState||{})],properties:[Zi,[],r=>r.properties()],"geometry-type":[_t,[],r=>r.geometryType()],id:[ft,[],r=>r.id()],zoom:[ze,[],r=>r.globals.zoom],"heatmap-density":[ze,[],r=>r.globals.heatmapDensity||0],"line-progress":[ze,[],r=>r.globals.lineProgress||0],accumulated:[ft,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ze,_s(ze),(r,t)=>{let n=0;for(const a of t)n+=a.evaluate(r);return n}],"*":[ze,_s(ze),(r,t)=>{let n=1;for(const a of t)n*=a.evaluate(r);return n}],"-":{type:ze,overloads:[[[ze,ze],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[ze],(r,[t])=>-t.evaluate(r)]]},"/":[ze,[ze,ze],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[ze,[ze,ze],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[ze,[],()=>Math.LN2],pi:[ze,[],()=>Math.PI],e:[ze,[],()=>Math.E],"^":[ze,[ze,ze],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[ze,[ze],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[ze,[ze],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[ze,[ze],(r,[t])=>Math.log(t.evaluate(r))],log2:[ze,[ze],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[ze,[ze],(r,[t])=>Math.sin(t.evaluate(r))],cos:[ze,[ze],(r,[t])=>Math.cos(t.evaluate(r))],tan:[ze,[ze],(r,[t])=>Math.tan(t.evaluate(r))],asin:[ze,[ze],(r,[t])=>Math.asin(t.evaluate(r))],acos:[ze,[ze],(r,[t])=>Math.acos(t.evaluate(r))],atan:[ze,[ze],(r,[t])=>Math.atan(t.evaluate(r))],min:[ze,_s(ze),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[ze,_s(ze),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[ze,[ze],(r,[t])=>Math.abs(t.evaluate(r))],round:[ze,[ze],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[ze,[ze],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[ze,[ze],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[at,[_t,ft],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[at,[ft],(r,[t])=>r.id()===t.value],"filter-type-==":[at,[_t],(r,[t])=>r.geometryType()===t.value],"filter-<":[at,[_t,ft],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[at,[ft],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[at,[_t,ft],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[at,[ft],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[at,[_t,ft],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[at,[ft],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[at,[_t,ft],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[at,[ft],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[at,[ft],(r,[t])=>t.value in r.properties()],"filter-has-id":[at,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[at,[L(_t)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[at,[L(ft)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[at,[_t,L(ft)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[at,[_t,L(ft)],(r,[t,n])=>function(a,c,m,g){for(;m<=g;){const y=m+g>>1;if(c[y]===a)return!0;c[y]>a?g=y-1:m=y+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:at,overloads:[[[at,at],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[_s(at),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:at,overloads:[[[at,at],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[_s(at),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[at,[at],(r,[t])=>!t.evaluate(r)],"is-supported-script":[at,[_t],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[_t,[_t],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[_t,[_t],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[_t,_s(ft),(r,t)=>t.map(n=>$o(n.evaluate(r))).join("")],"resolved-locale":[_t,[pn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ga{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new za,this._defaultValue=n?(a=n).type==="color"&&Za(a.default)?new Bt(0,0,0,0):a.type==="color"?Bt.parse(a.default)||null:a.type==="padding"?gi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Ci.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Ha(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Zs}function Xs(r,t){const n=new cs(Zs,Ko,[],t?function(c){const m={color:ri,string:_t,number:ze,enum:_t,boolean:at,formatted:Cn,padding:Gn,resolvedImage:fn,variableAnchorOffsetCollection:W};return c.type==="array"?L(m[c.value]||ft,c.length):m[c.type]}(t):void 0),a=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?$a(new Ga(a,t)):Gs(n.errors)}class Ks{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!qs(n.expression)}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,c,m,g)}evaluate(t,n,a,c,m,g){return this._styleExpression.evaluate(t,n,a,c,m,g)}}class Js{constructor(t,n,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!qs(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,c,m,g)}evaluate(t,n,a,c,m,g){return this._styleExpression.evaluate(t,n,a,c,m,g)}interpolationFactor(t,n,a){return this.interpolationType?ni.interpolationFactor(this.interpolationType,t,n,a):0}}function bu(r,t){const n=Xs(r,t);if(n.result==="error")return n;const a=n.value.expression,c=Jo(a);if(!c&&!Hs(t))return Gs([new Zr("","data expressions not supported")]);const m=Yo(a,["zoom"]);if(!m&&!mh(t))return Gs([new Zr("","zoom expressions not supported")]);const g=Qo(a);return g||m?g instanceof Zr?Gs([g]):g instanceof ni&&!wu(t)?Gs([new Zr("",'"interpolate" expressions cannot be used with this property')]):$a(g?new Js(c?"camera":"composite",n.value,g.labels,g instanceof ni?g.interpolation:void 0):new Ks(c?"constant":"source",n.value)):Gs([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ys{constructor(t,n){this._parameters=t,this._specification=n,hn(this,gh(this._parameters,this._specification))}static deserialize(t){return new Ys(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Qo(r){let t=null;if(r instanceof Hn)t=Qo(r.result);else if(r instanceof Ra){for(const n of r.args)if(t=Qo(n),t)break}else(r instanceof js||r instanceof ni)&&r.input instanceof Mi&&r.input.name==="zoom"&&(t=r);return t instanceof Zr||r.eachChild(n=>{const a=Qo(n);a instanceof Zr?t=a:!t&&a?t=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Wa(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Wa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Xa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Su(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Wa(r)||(r=Ka(r));const t=Xs(r,Xa);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,c)=>t.value.evaluate(n,a,{},c),needGeometry:xh(r)}}function Ap(r,t){return r<t?-1:r>t?1:0}function xh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(xh(r[t]))return!0;return!1}function Ka(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Tu(r[1],r[2],"=="):t==="!="?Lr(Tu(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Tu(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Ka))):t==="all"?["all"].concat(r.slice(1).map(Ka)):t==="none"?["all"].concat(r.slice(1).map(Ka).map(Lr)):t==="in"?ea(r[1],r.slice(2)):t==="!in"?Lr(ea(r[1],r.slice(2))):t==="has"?ta(r[1]):t!=="!has"||Lr(ta(r[1]));var n}function Tu(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function ea(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Ap)]]:["filter-in-small",r,["literal",t]]}}function ta(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Lr(r){return["!",r]}function ys(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${ys(m)},`;return`${c}]`}const n=Object.keys(r).sort();let a="{";for(let c=0;c<n.length;c++)a+=`${JSON.stringify(n[c])}:${ys(r[n[c]])},`;return`${a}}`}function wh(r){let t="";for(const n of ls)t+=`/${ys(r[n])}`;return t}function bh(r){const t=r.value;return t?[new Ie(r.key,t,"constants have been deprecated as of v8")]:[]}function sr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Wi(r){if(Array.isArray(r))return r.map(Wi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Wi(r[n]);return t}return sr(r)}function yi(r){const t=r.key,n=r.value,a=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,y=r.validateSpec;let x=[];const k=Ct(n);if(k!=="object")return[new Ie(t,n,`object expected, ${k} found`)];for(const P in n){const C=P.split(".")[0],A=a[C]||a["*"];let R;if(c[C])R=c[C];else if(a[C])R=y;else if(c["*"])R=c["*"];else{if(!a["*"]){x.push(new Ie(t,n[P],`unknown property "${P}"`));continue}R=y}x=x.concat(R({key:(t&&`${t}.`)+P,value:n[P],valueSpec:A,style:m,styleSpec:g,object:n,objectKey:P,validateSpec:y},n))}for(const P in a)c[P]||a[P].required&&a[P].default===void 0&&n[P]===void 0&&x.push(new Ie(t,n,`missing required property "${P}"`));return x}function ra(r){const t=r.value,n=r.valueSpec,a=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Ct(t)!=="array")return[new Ie(m,t,`array expected, ${Ct(t)} found`)];if(n.length&&t.length!==n.length)return[new Ie(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ie(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};c.$version<7&&(y.function=n.function),Ct(n.value)==="object"&&(y=n.value);let x=[];for(let k=0;k<t.length;k++)x=x.concat(g({array:t,arrayIndex:k,value:t[k],valueSpec:y,validateSpec:r.validateSpec,style:a,styleSpec:c,key:`${m}[${k}]`}));return x}function ku(r){const t=r.key,n=r.value,a=r.valueSpec;let c=Ct(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ie(t,n,`number expected, ${c} found`)]:"minimum"in a&&n<a.minimum?[new Ie(t,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new Ie(t,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function Ja(r){const t=r.valueSpec,n=sr(r.value.type);let a,c,m,g={};const y=n!=="categorical"&&r.value.property===void 0,x=!y,k=Ct(r.value.stops)==="array"&&Ct(r.value.stops[0])==="array"&&Ct(r.value.stops[0][0])==="object",P=yi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Ie(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const O=R.value;return B=B.concat(ra({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),Ct(O)==="array"&&O.length===0&&B.push(new Ie(R.key,O,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&y&&P.push(new Ie(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||P.push(new Ie(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!wu(r.valueSpec)&&P.push(new Ie(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Hs(r.valueSpec)?P.push(new Ie(r.key,r.value,"property functions not supported")):y&&!mh(r.valueSpec)&&P.push(new Ie(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||P.push(new Ie(r.key,r.value,'"property" property is required')),P;function C(R){let B=[];const O=R.value,$=R.key;if(Ct(O)!=="array")return[new Ie($,O,`array expected, ${Ct(O)} found`)];if(O.length!==2)return[new Ie($,O,`array length 2 expected, length ${O.length} found`)];if(k){if(Ct(O[0])!=="object")return[new Ie($,O,`object expected, ${Ct(O[0])} found`)];if(O[0].zoom===void 0)return[new Ie($,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Ie($,O,"object stop key must have value")];if(m&&m>sr(O[0].zoom))return[new Ie($,O[0].zoom,"stop zoom values must appear in ascending order")];sr(O[0].zoom)!==m&&(m=sr(O[0].zoom),c=void 0,g={}),B=B.concat(yi({key:`${$}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:ku,value:A}}))}else B=B.concat(A({key:`${$}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return Ha(Wi(O[1]))?B.concat([new Ie(`${$}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${$}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function A(R,B){const O=Ct(R.value),$=sr(R.value),X=R.value!==null?R.value:B;if(a){if(O!==a)return[new Ie(R.key,X,`${O} stop domain type must match previous stop domain type ${a}`)]}else a=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Ie(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let de=`number expected, ${O} found`;return Hs(t)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(R.key,X,de)]}return n!=="categorical"||O!=="number"||isFinite($)&&Math.floor($)===$?n!=="categorical"&&O==="number"&&c!==void 0&&$<c?[new Ie(R.key,X,"stop domain values must appear in ascending order")]:(c=$,n==="categorical"&&$ in g?[new Ie(R.key,X,"stop domain values must be unique")]:(g[$]=!0,[])):[new Ie(R.key,X,`integer expected, found ${$}`)]}}function Qs(r){const t=(r.expressionContext==="property"?bu:Xs)(Wi(r.value),r.valueSpec);if(t.result==="error")return t.value.map(a=>new Ie(`${r.key}${a.key}`,r.value,a.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ie(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!qs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!qs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Yo(n,["zoom","feature-state"]))return[new Ie(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Jo(n))return[new Ie(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zn(r){const t=r.key,n=r.value,a=r.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(sr(n))===-1&&c.push(new Ie(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(sr(n))===-1&&c.push(new Ie(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Iu(r){return Wa(Wi(r.value))?Qs(hn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ya(r)}function Ya(r){const t=r.value,n=r.key;if(Ct(t)!=="array")return[new Ie(n,t,`array expected, ${Ct(t)} found`)];const a=r.styleSpec;let c,m=[];if(t.length<1)return[new Ie(n,t,"filter array must have at least 1 element")];switch(m=m.concat(zn({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),sr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&sr(t[1])==="$type"&&m.push(new Ie(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ie(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Ct(t[1]),c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Ct(t[g]),sr(t[1])==="$type"?m=m.concat(zn({key:`${n}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ie(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Ya({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Ct(t[1]),t.length!==2?m.push(new Ie(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Pu(r,t){const n=r.key,a=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,y=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const k=y.match(/^(.*)-transition$/);if(t==="paint"&&k&&x[k[1]]&&x[k[1]].transition)return a({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const P=r.valueSpec||x[y];if(!P)return[new Ie(n,g,`unknown property "${y}"`)];let C;if(Ct(g)==="string"&&Hs(P)&&!P.tokens&&(C=/^{([^}]+)}$/.exec(g)))return[new Ie(n,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const A=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&A.push(new Ie(n,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Za(Wi(g))&&sr(g.type)==="identity"&&A.push(new Ie(n,g,'"text-font" does not support identity functions'))),A.concat(a({key:r.key,value:g,valueSpec:P,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:y}))}function Qa(r){return Pu(r,"paint")}function Eu(r){return Pu(r,"layout")}function Cu(r){let t=[];const n=r.value,a=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ie(a,n,'either "type" or "ref" is required'));let g=sr(n.type);const y=sr(n.ref);if(n.id){const x=sr(n.id);for(let k=0;k<r.arrayIndex;k++){const P=c.layers[k];sr(P.id)===x&&t.push(new Ie(a,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&t.push(new Ie(a,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{sr(k.id)===y&&(x=k)}),x?x.ref?t.push(new Ie(a,n.ref,"ref cannot reference another ref layer")):g=sr(x.type):t.push(new Ie(a,n.ref,`ref layer "${y}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],k=x&&sr(x.type);x?k==="vector"&&g==="raster"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?t.push(new Ie(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&x.lineMetrics||t.push(new Ie(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ie(a,n.source,`source "${n.source}" not found`))}else t.push(new Ie(a,n,'missing required property "source"'));return t=t.concat(yi({key:a,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Iu,layout:x=>yi({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>Eu(hn({layerType:g},k))}}),paint:x=>yi({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>Qa(hn({layerType:g},k))}})}})),t}function vs(r){const t=r.value,n=r.key,a=Ct(t);return a!=="string"?[new Ie(n,t,`string expected, ${a} found`)]:[]}const el={promoteId:function({key:r,value:t}){if(Ct(t)==="string")return vs({key:r,value:t});{const n=[];for(const a in t)n.push(...vs({key:`${r}.${a}`,value:t[a]}));return n}}};function ia(r){const t=r.value,n=r.key,a=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ie(n,t,'"type" is required')];const g=sr(t.type);let y;switch(g){case"vector":case"raster":return y=yi({key:n,value:t,valueSpec:a[`source_${g.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:el,validateSpec:m}),y;case"raster-dem":return y=function(x){var k;const P=(k=x.sourceName)!==null&&k!==void 0?k:"",C=x.value,A=x.styleSpec,R=A.source_raster_dem,B=x.style;let O=[];const $=Ct(C);if(C===void 0)return O;if($!=="object")return O.push(new Ie("source_raster_dem",C,`object expected, ${$} found`)),O;const X=sr(C.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],ee=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ae in C)!X&&de.includes(ae)?O.push(new Ie(ae,C[ae],`In "${P}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[ae]?O=O.concat(x.validateSpec({key:ae,value:C[ae],valueSpec:R[ae],validateSpec:x.validateSpec,style:B,styleSpec:A})):O.push(new Ie(ae,C[ae],`unknown property "${ae}"`));return O}({sourceName:n,value:t,style:r.style,styleSpec:a,validateSpec:m}),y;case"geojson":if(y=yi({key:n,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:m,objectElementValidators:el}),t.cluster)for(const x in t.clusterProperties){const[k,P]=t.clusterProperties[x],C=typeof k=="string"?[k,["accumulated"],["get",x]]:k;y.push(...Qs({key:`${n}.${x}.map`,value:P,expressionContext:"cluster-map"})),y.push(...Qs({key:`${n}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return yi({key:n,value:t,valueSpec:a.source_video,style:c,validateSpec:m,styleSpec:a});case"image":return yi({key:n,value:t,valueSpec:a.source_image,style:c,validateSpec:m,styleSpec:a});case"canvas":return[new Ie(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zn({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Mu(r){const t=r.value,n=r.styleSpec,a=n.light,c=r.style;let m=[];const g=Ct(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("light",t,`object expected, ${g} found`)]),m;for(const y in t){const x=y.match(/^(.*)-transition$/);m=m.concat(x&&a[x[1]]&&a[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)])}return m}function zu(r){const t=r.value,n=r.styleSpec,a=n.sky,c=r.style,m=Ct(t);if(t===void 0)return[];if(m!=="object")return[new Ie("sky",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return g}function Au(r){const t=r.value,n=r.styleSpec,a=n.terrain,c=r.style;let m=[];const g=Ct(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("terrain",t,`object expected, ${g} found`)]),m;for(const y in t)m=m.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return m}function Du(r){let t=[];const n=r.value,a=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ie(a,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ie(a,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(yi({key:`${a}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return vs({key:a,value:n})}const tl={"*":()=>[],array:ra,boolean:function(r){const t=r.value,n=r.key,a=Ct(t);return a!=="boolean"?[new Ie(n,t,`boolean expected, ${a} found`)]:[]},number:ku,color:function(r){const t=r.key,n=r.value,a=Ct(n);return a!=="string"?[new Ie(t,n,`color expected, ${a} found`)]:Bt.parse(String(n))?[]:[new Ie(t,n,`color expected, "${n}" found`)]},constants:bh,enum:zn,filter:Iu,function:Ja,layer:Cu,object:yi,source:ia,light:Mu,sky:zu,terrain:Au,projection:function(r){const t=r.value,n=r.styleSpec,a=n.projection,c=r.style,m=Ct(t);if(t===void 0)return[];if(m!=="object")return[new Ie("projection",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return g},string:vs,formatted:function(r){return vs(r).length===0?[]:Qs(r)},resolvedImage:function(r){return vs(r).length===0?[]:Qs(r)},padding:function(r){const t=r.key,n=r.value;if(Ct(n)==="array"){if(n.length<1||n.length>4)return[new Ie(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const a={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:a}));return c}return ku({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,a=Ct(n),c=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new Ie(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(zn({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(ra({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Du};function na(r){const t=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=na,n.expression&&Za(sr(t))?Ja(r):n.expression&&Ha(Wi(t))?Qs(r):n.type&&tl[n.type]?tl[n.type](r):yi(hn({},r,{valueSpec:n.type?a[n.type]:n}))}function Sh(r){const t=r.value,n=r.key,a=vs(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ie(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ie(n,t,'"glyphs" url must include a "{range}" token'))),a}function zi(r,t=me){let n=[];return n=n.concat(na({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:na,objectElementValidators:{glyphs:Sh,"*":()=>[]}})),r.constants&&(n=n.concat(bh({key:"constants",value:r.constants}))),Lu(n)}function gn(r){return function(t){return r({...t,validateSpec:na})}}function Lu(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Xi(r){return function(...t){return Lu(r.apply(this,t))}}zi.source=Xi(gn(ia)),zi.sprite=Xi(gn(Du)),zi.glyphs=Xi(gn(Sh)),zi.light=Xi(gn(Mu)),zi.sky=Xi(gn(zu)),zi.terrain=Xi(gn(Au)),zi.layer=Xi(gn(Cu)),zi.filter=Xi(gn(Iu)),zi.paintProperty=Xi(gn(Qa)),zi.layoutProperty=Xi(gn(Eu));const xs=zi,Dp=xs.light,Lp=xs.sky,Th=xs.paintProperty,kh=xs.layoutProperty;function Ru(r,t){let n=!1;if(t&&t.length)for(const a of t)r.fire(new $n(new Error(a.message))),n=!0;return n}class eo{constructor(t,n,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(a=g[2]);for(let x=0;x<this.d*this.d;x++){const k=g[3+x],P=g[3+x+1];c.push(k===P?null:g.subarray(k,P))}const y=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],y),this.bboxes=g.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;const m=a/n*t;this.min=-m,this.max=t+m}insert(t,n,a,c,m){this._forEachCell(n,a,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,a,c,m,g){this.cells[m].push(g)}query(t,n,a,c,m){const g=this.min,y=this.max;if(t<=g&&n<=g&&y<=a&&y<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,a,c,this._queryCell,x,{},m),x}}_queryCell(t,n,a,c,m,g,y,x){const k=this.cells[m];if(k!==null){const P=this.keys,C=this.bboxes;for(let A=0;A<k.length;A++){const R=k[A];if(y[R]===void 0){const B=4*R;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):t<=C[B+2]&&n<=C[B+3]&&a>=C[B+0]&&c>=C[B+1])?(y[R]=!0,g.push(P[R])):y[R]=!1}}}}_forEachCell(t,n,a,c,m,g,y,x){const k=this._convertToCellCoord(t),P=this._convertToCellCoord(n),C=this._convertToCellCoord(a),A=this._convertToCellCoord(c);for(let R=k;R<=C;R++)for(let B=P;B<=A;B++){const O=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&m.call(this,t,n,a,c,O,g,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let a=0;for(let g=0;g<this.cells.length;g++)a+=this.cells[g].length;const c=new Int32Array(n+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const y=t[g];c[3+g]=m,c.set(y,m),m+=y.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(t){return new eo(t.buffer)}}const Ai={};function Ze(r,t,n={}){if(Ai[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Ai[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ze("Object",Object),Ze("TransferableGridIndex",eo),Ze("Color",Bt),Ze("Error",Error),Ze("AJAXError",xr),Ze("ResolvedImage",_i),Ze("StylePropertyFunction",Ys),Ze("StyleExpression",Ga,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",Js),Ze("ZoomConstantExpression",Ks),Ze("CompoundExpression",Mi,{omit:["_evaluate"]});for(const r in Zs)Zs[r]._classRegistryKey||Ze(`Expression_${r}`,Zs[r]);function rl(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Fu(r){return r.$name||r.constructor._classRegistryKey}function Ih(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=Fu(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||rl(r)||Qr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function to(r,t){if(Ih(r))return(rl(r)||Qr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(to(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=Fu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Ai[n])throw new Error(`${n} is not registered.`);const{klass:a}=Ai[n],c=a.serialize?a.serialize(r,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Ai[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Ai[n].shallow.indexOf(m)>=0?g:to(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function ro(r){if(Ih(r))return r;if(Array.isArray(r))return r.map(ro);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Fu(r)||"Object";if(!Ai[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Ai[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const a=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];a[c]=Ai[t].shallow.indexOf(c)>=0?m:ro(m)}return a}class Bu{constructor(){this.first=!0}update(t,n){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const bt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Ou(r){for(const t of r)if(Vu(t.charCodeAt(0)))return!0;return!1}function Rp(r){for(const t of r)if(!io(t.charCodeAt(0)))return!1;return!0}function Nu(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Fp=Nu(["Arab","Dupl","Mong","Ougr","Syrc"]);function io(r){return!Fp.test(String.fromCodePoint(r))}const Ph=Nu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Vu(r){return!(r!==746&&r!==747&&(r<4352||!(bt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||bt["CJK Compatibility"](r)||bt["CJK Strokes"](r)||!(!bt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||bt["Enclosed CJK Letters and Months"](r)||bt["Ideographic Description Characters"](r)||bt.Kanbun(r)||bt.Katakana(r)&&r!==12540||!(!bt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!bt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||bt["Vertical Forms"](r)||bt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Ph.test(String.fromCodePoint(r)))))}function Eh(r){return!(Vu(r)||function(t){return!!(bt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||bt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||bt["Letterlike Symbols"](t)||bt["Number Forms"](t)||bt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||bt["Control Pictures"](t)&&t!==9251||bt["Optical Character Recognition"](t)||bt["Enclosed Alphanumerics"](t)||bt["Geometric Shapes"](t)||bt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||bt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||bt["CJK Symbols and Punctuation"](t)||bt.Katakana(t)||bt["Private Use Area"](t)||bt["CJK Compatibility Forms"](t)||bt["Small Form Variants"](t)||bt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Bp=Nu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ju(r){return Bp.test(String.fromCodePoint(r))}function Op(r,t){return!(!t&&ju(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||bt.Khmer(r))}function Np(r){for(const t of r)if(ju(t.charCodeAt(0)))return!0;return!1}const vi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Gt{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bu,this.transition={})}isSupportedScript(t){return function(n,a){for(const c of n)if(!Op(c.charCodeAt(0),a))return!1;return!0}(t,vi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class no{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,c){if(Za(a))return new Ys(a,c);if(Ha(a)){const m=bu(a,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=a;return c.type==="color"&&typeof a=="string"?m=Bt.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(m=Ci.parse(a)):m=gi.parse(a),{kind:"constant",evaluate:()=>m}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class il{constructor(t){this.property=t,this.value=new no(t,void 0)}transitioned(t,n){return new Ch(this.property,this.value,n,Ge({},t.transition,this.transition),t.now)}untransitioned(){return new Ch(this.property,this.value,null,{},0)}}class nl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ht(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new il(this._values[t].property)),this._values[t].value=new no(this._values[t].property,n===null?void 0:ht(n))}getTransition(t){return ht(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new il(this._values[t].property)),this._values[t].transition=ht(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const a=new sa(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,n._values[c]);return a}untransitioned(){const t=new sa(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Ch{constructor(t,n,a,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,a),m,function(x){if(x<=0)return 0;if(x>=1)return 1;const k=x*x,P=k*x;return 4*(x<.5?P:3*(x-k)+P-.75)}(y))}}return m}}class sa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){const c=new aa(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class oa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ht(this._values[t].value)}setValue(t,n){this._values[t]=new no(this._values[t].property,n===null?void 0:ht(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){const c=new aa(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,a);return c}}class _n{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,a,c){return this.property.evaluate(this.value,this.parameters,t,n,a,c)}}class aa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xe{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,a){const c=ii[this.specification.type];return c?c(t,n,a):t}}class ot{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,c){return new _n(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,c)}:t.expression,n)}interpolate(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new _n(this,{kind:"constant",value:void 0},t.parameters);const c=ii[this.specification.type];if(c){const m=c(t.value.value,n.value.value,a);return new _n(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,a,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,a,c,m,g)}}class sl extends ot{possiblyEvaluate(t,n,a,c){if(t.value===void 0)return new _n(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},a,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,y=this._calculate(g,g,g,n);return new _n(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new _n(this,{kind:"constant",value:m},n)}return new _n(this,t.expression,n)}evaluate(t,n,a,c,m,g){if(t.kind==="source"){const y=t.evaluate(n,a,c,m,g);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,c),t.evaluate({zoom:Math.floor(n.zoom)},a,c),t.evaluate({zoom:Math.floor(n.zoom)+1},a,c),n):t.value}_calculate(t,n,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class ol{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},a,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new Gt(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Gt(Math.floor(n.zoom),n)),t.expression.evaluate(new Gt(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Uu{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,c){return!!t.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const a=t[n];a.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new no(a,void 0),m=this.defaultTransitionablePropertyValues[n]=new il(a);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}Ze("DataDrivenProperty",ot),Ze("DataConstantProperty",Xe),Ze("CrossFadedDataDrivenProperty",sl),Ze("CrossFadedProperty",ol),Ze("ColorRampProperty",Uu);const e="-transition";class s extends Fs{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new oa(n.layout)),n.paint)){this._transitionablePaint=new nl(n.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new aa(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){n!=null&&this._validate(kh,`layers.${this.id}.layout.${t}`,t,n,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(n!=null&&this._validate(Th,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),et(t,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(t,n,a,c,m={}){return(!m||m.validate!==!1)&&Ru(this,t.call(xs,{key:n,layerType:this.type,objectKey:a,value:c,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof _n&&Hs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let n=0,a=0;return{members:r.map(c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=w(n,Math.max(t,m)),y=c.components||1;return a=Math.max(a,m),n+=m*y,{name:c.name,type:c.type,components:y,offset:g}}),size:w(n,Math.max(a,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=a,t}}T.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",T);class E extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,t}}E.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",E);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,c)}emplace(t,n,a,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=m,t}}M.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",M);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}z.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4i12",z);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=4*t,k=8*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.uint8[k+4]=c,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=y,t}}F.prototype.bytesPerElement=8,Ze("StructArrayLayout2i4ub8",F);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=a,t}}V.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",V);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,P){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,a,c,m,g,y,x,k,P)}emplace(t,n,a,c,m,g,y,x,k,P,C){const A=10*t;return this.uint16[A+0]=n,this.uint16[A+1]=a,this.uint16[A+2]=c,this.uint16[A+3]=m,this.uint16[A+4]=g,this.uint16[A+5]=y,this.uint16[A+6]=x,this.uint16[A+7]=k,this.uint16[A+8]=P,this.uint16[A+9]=C,t}}j.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",j);class q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,P,C,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,a,c,m,g,y,x,k,P,C,A)}emplace(t,n,a,c,m,g,y,x,k,P,C,A,R){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=k,this.int16[B+8]=P,this.int16[B+9]=C,this.int16[B+10]=A,this.int16[B+11]=R,t}}q.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",q);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,t}}K.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",K);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}J.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",J);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k){const P=this.length;return this.resize(P+1),this.emplace(P,t,n,a,c,m,g,y,x,k)}emplace(t,n,a,c,m,g,y,x,k,P){const C=10*t,A=5*t;return this.int16[C+0]=n,this.int16[C+1]=a,this.int16[C+2]=c,this.int16[C+3]=m,this.int16[C+4]=g,this.int16[C+5]=y,this.uint32[A+3]=x,this.uint16[C+8]=k,this.uint16[C+9]=P,t}}Q.prototype.bytesPerElement=20,Ze("StructArrayLayout6i1ul2ui20",Q);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}U.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",U);class ne extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,c,m)}emplace(t,n,a,c,m,g){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}ne.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",ne);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=16*t,k=4*t,P=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=a,this.float32[k+1]=c,this.float32[k+2]=m,this.int16[P+6]=g,this.int16[P+7]=y,t}}oe.prototype.bytesPerElement=16,Ze("StructArrayLayout2ub2f2i16",oe);class pe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,t}}pe.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",pe);class ve extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X){const de=this.length;return this.resize(de+1),this.emplace(de,t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X)}emplace(t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X,de){const ee=24*t,ae=12*t,ge=48*t;return this.int16[ee+0]=n,this.int16[ee+1]=a,this.uint16[ee+2]=c,this.uint16[ee+3]=m,this.uint32[ae+2]=g,this.uint32[ae+3]=y,this.uint32[ae+4]=x,this.uint16[ee+10]=k,this.uint16[ee+11]=P,this.uint16[ee+12]=C,this.float32[ae+7]=A,this.float32[ae+8]=R,this.uint8[ge+36]=B,this.uint8[ge+37]=O,this.uint8[ge+38]=$,this.uint32[ae+10]=X,this.int16[ee+22]=de,t}}ve.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ve);class ke extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X,de,ee,ae,ge,be,Ve,st,Oe,De,Ye,qe){const $e=this.length;return this.resize($e+1),this.emplace($e,t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X,de,ee,ae,ge,be,Ve,st,Oe,De,Ye,qe)}emplace(t,n,a,c,m,g,y,x,k,P,C,A,R,B,O,$,X,de,ee,ae,ge,be,Ve,st,Oe,De,Ye,qe,$e){const ye=32*t,Qe=16*t;return this.int16[ye+0]=n,this.int16[ye+1]=a,this.int16[ye+2]=c,this.int16[ye+3]=m,this.int16[ye+4]=g,this.int16[ye+5]=y,this.int16[ye+6]=x,this.int16[ye+7]=k,this.uint16[ye+8]=P,this.uint16[ye+9]=C,this.uint16[ye+10]=A,this.uint16[ye+11]=R,this.uint16[ye+12]=B,this.uint16[ye+13]=O,this.uint16[ye+14]=$,this.uint16[ye+15]=X,this.uint16[ye+16]=de,this.uint16[ye+17]=ee,this.uint16[ye+18]=ae,this.uint16[ye+19]=ge,this.uint16[ye+20]=be,this.uint16[ye+21]=Ve,this.uint16[ye+22]=st,this.uint32[Qe+12]=Oe,this.float32[Qe+13]=De,this.float32[Qe+14]=Ye,this.uint16[ye+30]=qe,this.uint16[ye+31]=$e,t}}ke.prototype.bytesPerElement=64,Ze("StructArrayLayout8i15ui1ul2f2ui64",ke);class Re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Re.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",Re);class Ue extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,t}}Ue.prototype.bytesPerElement=12,Ze("StructArrayLayout1ui2f12",Ue);class Me extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,t}}Me.prototype.bytesPerElement=8,Ze("StructArrayLayout1ul2ui8",Me);class Ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=a,t}}Ce.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",Ce);class Ke extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Ke.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",Ke);class ct extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,c)}emplace(t,n,a,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=m,t}}ct.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",ct);class Ae extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new re(this.anchorPointX,this.anchorPointY)}}Ae.prototype.size=20;class Ne extends Q{get(t){return new Ae(this,t)}}Ze("CollisionBoxArray",Ne);class lt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}lt.prototype.size=48;class Ht extends ve{get(t){return new lt(this,t)}}Ze("PlacedSymbolArray",Ht);class gt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}gt.prototype.size=64;class wt extends ke{get(t){return new gt(this,t)}}Ze("SymbolInstanceArray",wt);class Wt extends Re{getoffsetX(t){return this.float32[1*t+0]}}Ze("GlyphOffsetArray",Wt);class Rr extends E{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ze("SymbolLineVertexArray",Rr);class Ki extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ki.prototype.size=12;class Xt extends Ue{get(t){return new Ki(this,t)}}Ze("TextAnchorOffsetArray",Xt);class si extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}si.prototype.size=8;class Gr extends Me{get(t){return new si(this,t)}}Ze("FeatureIndexArray",Gr);class Fr extends T{}class Hr extends T{}class yn extends T{}class so extends z{}class al extends F{}class oo extends V{}class Di extends j{}class ll extends q{}class $u extends K{}class Li extends J{}class Ri extends U{}class Xn extends oe{}class Ji extends pe{}class Pr extends Ce{}const Br=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=Br;class St{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,c){let m=this.segments[this.segments.length-1];return t>St.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${St.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>St.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,c){return new St([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function ws(r,t){return 256*(r=je(Math.floor(r),0,255))+je(Math.floor(t),0,255)}St.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",St);const ao=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var lo={exports:{}},Mh={exports:{}};Mh.exports=function(r,t){var n,a,c,m,g,y,x,k;for(a=r.length-(n=3&r.length),c=t,g=3432918353,y=461845907,k=0;k<a;)x=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(k+2))<<16;case 2:x^=(255&r.charCodeAt(k+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(k)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Vp=Mh.exports,zh={exports:{}};zh.exports=function(r,t){for(var n,a=r.length,c=t^a,m=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Kn=Vp,Ah=zh.exports;lo.exports=Kn,lo.exports.murmur3=Kn,lo.exports.murmur2=Ah;var ul=G(lo.exports);class la{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,c){this.ids.push(cl(t)),this.positions.push(n,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=cl(t);let a=0,c=this.ids.length-1;for(;a<c;){const g=a+c>>1;this.ids[g]>=n?c=g:a=g+1}const m=[];for(;this.ids[a]===n;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(t,n){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return hl(a,c,0,a.length-1),n&&n.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const n=new la;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function cl(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ul(String(r))}function hl(r,t,n,a){for(;n<a;){const c=r[n+a>>1];let m=n-1,g=a+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;uo(r,m,g),uo(t,3*m,3*g),uo(t,3*m+1,3*g+1),uo(t,3*m+2,3*g+2)}g-n<a-g?(hl(r,t,n,g),n=g+1):(hl(r,t,g+1,a),a=g)}}function uo(r,t,n){const a=r[t];r[t]=r[n],r[n]=a}Ze("FeaturePositionMap",la);class ua{constructor(t,n){this.gl=t.gl,this.location=n}}class Dh extends ua{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class $g extends ua{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Zg extends ua{constructor(t,n){super(t,n),this.current=Bt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const K0=new Float32Array(16);function jp(r){return[ws(255*r.r,255*r.g),ws(255*r.b,255*r.a)]}class Zu{constructor(t,n,a){this.value=t,this.uniformNames=n.map(c=>`u_${c}`),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return this.type==="color"?new Zg(t,n):new Dh(t,n)}}class dl{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,a,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,a){return a.substr(0,9)==="u_pattern"?new $g(t,n):new Dh(t,n)}}class bs{constructor(t,n,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,n,a,c,m){const g=this.paintVertexArray.length,y=this.expression.evaluate(new Gt(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,y)}updatePaintArray(t,n,a,c){const m=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,a){if(this.type==="color"){const c=jp(a);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class An{constructor(t,n,a,c,m,g){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,a,c,m){const g=this.expression.evaluate(new Gt(this.zoom),n,{},c,[],m),y=this.expression.evaluate(new Gt(this.zoom+1),n,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,y)}updatePaintArray(t,n,a,c){const m=this.expression.evaluate({zoom:this.zoom},a,c),g=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,a,c){if(this.type==="color"){const m=jp(a),g=jp(c);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=je(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,a){return new Dh(t,n)}}class co{constructor(t,n,a,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,c,m){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(t,n,a,c){if(!c||!a)return;const{min:m,mid:g,max:y}=a,x=c[m],k=c[g],P=c[y];if(x&&k&&P)for(let C=t;C<n;C++)this.zoomInPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],k.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],k.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ao.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ao.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qg{constructor(t,n,a){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!a(m))continue;const g=t.paint.get(m);if(!(g instanceof _n&&Hs(g.property.specification)))continue;const y=J0(m,t.type),x=g.value,k=g.property.specification.type,P=g.property.useIntegerZoom,C=g.property.specification["property-type"],A=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=A?new dl(x.value,y):new Zu(x.value,y,k),c.push(`/u_${m}`);else if(x.kind==="source"||A){const R=Gg(m,k,"source");this.binders[m]=A?new co(x,k,P,n,R,t.id):new bs(x,y,k,R),c.push(`/a_${m}`)}else{const R=Gg(m,k,"composite");this.binders[m]=new An(x,y,k,P,n,R),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof bs||n instanceof An?n.maxValue:0}populatePaintArrays(t,n,a,c,m){for(const g in this.binders){const y=this.binders[g];(y instanceof bs||y instanceof An||y instanceof co)&&y.populatePaintArray(t,n,a,c,m)}}setConstantPatternPositions(t,n){for(const a in this.binders){const c=this.binders[a];c instanceof dl&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,a,c,m){let g=!1;for(const y in t){const x=n.getPositions(y);for(const k of x){const P=a.feature(k.index);for(const C in this.binders){const A=this.binders[C];if((A instanceof bs||A instanceof An||A instanceof co)&&A.expression.isStateDependent===!0){const R=c.paint.get(C);A.expression=R.value,A.updatePaintArray(k.start,k.end,P,t[y],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Zu||a instanceof dl)&&t.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof bs||a instanceof An)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof co)for(let c=0;c<ao.members.length;c++)t.push(ao.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Zu||a instanceof dl||a instanceof An)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const a=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Zu||m instanceof dl||m instanceof An){for(const g of m.uniformNames)if(n[g]){const y=m.getBinding(t,n[g],g);a.push({name:g,property:c,binding:y})}}}return a}setUniforms(t,n,a,c){for(const{name:m,property:g,binding:y}of n)this.binders[g].setUniform(y,c,a.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(t&&a instanceof co){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof bs||a instanceof An)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const n in this.binders){const a=this.binders[n];(a instanceof bs||a instanceof An||a instanceof co)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof bs||n instanceof An||n instanceof co)&&n.destroy()}}}class ca{constructor(t,n,a=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new qg(c,n,a);this.needsUpload=!1,this._featureMap=new la,this._bufferOffset=0}populatePaintArrays(t,n,a,c,m,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,c){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function J0(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Gg(r,t,n){const a={color:{source:V,composite:ct},number:{source:Re,composite:V}},c=function(m){return{"line-pattern":{source:Di,composite:Di},"fill-pattern":{source:Di,composite:Di},"fill-extrusion-pattern":{source:Di,composite:Di}}[m]}(r);return c&&c[n]||a[t][n]}Ze("ConstantBinder",Zu),Ze("CrossFadedConstantBinder",dl),Ze("SourceExpressionBinder",bs),Ze("CrossFadedCompositeBinder",co),Ze("CompositeExpressionBinder",An),Ze("ProgramConfiguration",qg,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",ca);const gr=8192,Up=Math.pow(2,14)-1,Hg=-Up-1;function ha(r){const t=gr/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){const c=n[a];for(let m=0;m<c.length;m++){const g=c[m],y=Math.round(g.x*t),x=Math.round(g.y*t);g.x=je(y,Hg,Up),g.y=je(x,Hg,Up),(y<g.x||y>g.x+1||x<g.y||x>g.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function da(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?ha(r):[]}}function Lh(r,t,n,a,c){r.emplaceBack(2*t+(a+1)/2,2*n+(c+1)/2)}class $p{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Hr,this.indexArray=new Ji,this.segments=new St,this.programConfigurations=new ca(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){const c=this.layers[0],m=[];let g=null,y=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),y=!g.isConstant());for(const{feature:x,id:k,index:P,sourceLayerIndex:C}of t){const A=this.layers[0]._featureFilter.needGeometry,R=da(x,A);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),R,a))continue;const B=y?g.evaluate(R,{},a):void 0,O={id:k,properties:x.properties,type:x.type,sourceLayerIndex:C,index:P,geometry:A?R.geometry:ha(x),patterns:{},sortKey:B};m.push(O)}y&&m.sort((x,k)=>x.sortKey-k.sortKey);for(const x of m){const{geometry:k,index:P,sourceLayerIndex:C}=x,A=t[P].feature;this.addFeature(x,k,P,a),n.featureIndex.insert(A,k,P,C,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,c){for(const m of n)for(const g of m){const y=g.x,x=g.y;if(y<0||y>=gr||x<0||x>=gr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=k.vertexLength;Lh(this.layoutVertexArray,y,x,-1,-1),Lh(this.layoutVertexArray,y,x,1,-1),Lh(this.layoutVertexArray,y,x,1,1),Lh(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function Wg(r,t){for(let n=0;n<r.length;n++)if(pl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(pl(r,t[n]))return!0;return!!Zp(r,t)}function Y0(r,t,n){return!!pl(r,t)||!!qp(t,r,n)}function Xg(r,t){if(r.length===1)return Jg(t,r[0]);for(let n=0;n<t.length;n++){const a=t[n];for(let c=0;c<a.length;c++)if(pl(r,a[c]))return!0}for(let n=0;n<r.length;n++)if(Jg(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Zp(r,t[n]))return!0;return!1}function Q0(r,t,n){if(r.length>1){if(Zp(r,t))return!0;for(let a=0;a<t.length;a++)if(qp(t[a],r,n))return!0}for(let a=0;a<r.length;a++)if(qp(r[a],t,n))return!0;return!1}function Zp(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const a=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(e1(a,c,t[m],t[m+1]))return!0}return!1}function e1(r,t,n,a){return lr(r,n,a)!==lr(t,n,a)&&lr(r,t,n)!==lr(r,t,a)}function qp(r,t,n){const a=n*n;if(t.length===1)return r.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(Kg(r,t[c-1],t[c])<a)return!0;return!1}function Kg(r,t,n){const a=t.distSqr(n);if(a===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/a;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function Jg(r,t){let n,a,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let y=0,x=n.length-1;y<n.length;x=y++)a=n[y],c=n[x],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function pl(r,t){let n=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const m=r[a],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function t1(r,t,n){const a=n[0],c=n[2];if(r.x<a.x&&t.x<a.x||r.x>c.x&&t.x>c.x||r.y<a.y&&t.y<a.y||r.y>c.y&&t.y>c.y)return!1;const m=lr(r,t,n[0]);return m!==lr(r,t,n[1])||m!==lr(r,t,n[2])||m!==lr(r,t,n[3])}function qu(r,t,n){const a=t.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Rh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Fh(r,t,n,a,c){if(!t[0]&&!t[1])return r;const m=re.convert(t)._mult(c);n==="viewport"&&m._rotate(-a);const g=[];for(let y=0;y<r.length;y++)g.push(r[y].sub(m));return g}let Yg,Qg;Ze("CircleBucket",$p,{omit:["layers"]});var r1={get paint(){return Qg=Qg||new f({"circle-radius":new ot(me.paint_circle["circle-radius"]),"circle-color":new ot(me.paint_circle["circle-color"]),"circle-blur":new ot(me.paint_circle["circle-blur"]),"circle-opacity":new ot(me.paint_circle["circle-opacity"]),"circle-translate":new Xe(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(me.paint_circle["circle-stroke-opacity"])})},get layout(){return Yg=Yg||new f({"circle-sort-key":new ot(me.layout_circle["circle-sort-key"])})}},oi=1e-6,fl=typeof Float32Array<"u"?Float32Array:Array;function Gp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function e_(r,t,n){var a=t[0],c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],P=t[7],C=t[8],A=t[9],R=t[10],B=t[11],O=t[12],$=t[13],X=t[14],de=t[15],ee=n[0],ae=n[1],ge=n[2],be=n[3];return r[0]=ee*a+ae*y+ge*C+be*O,r[1]=ee*c+ae*x+ge*A+be*$,r[2]=ee*m+ae*k+ge*R+be*X,r[3]=ee*g+ae*P+ge*B+be*de,r[4]=(ee=n[4])*a+(ae=n[5])*y+(ge=n[6])*C+(be=n[7])*O,r[5]=ee*c+ae*x+ge*A+be*$,r[6]=ee*m+ae*k+ge*R+be*X,r[7]=ee*g+ae*P+ge*B+be*de,r[8]=(ee=n[8])*a+(ae=n[9])*y+(ge=n[10])*C+(be=n[11])*O,r[9]=ee*c+ae*x+ge*A+be*$,r[10]=ee*m+ae*k+ge*R+be*X,r[11]=ee*g+ae*P+ge*B+be*de,r[12]=(ee=n[12])*a+(ae=n[13])*y+(ge=n[14])*C+(be=n[15])*O,r[13]=ee*c+ae*x+ge*A+be*$,r[14]=ee*m+ae*k+ge*R+be*X,r[15]=ee*g+ae*P+ge*B+be*de,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Gu,i1=e_;function Bh(r,t,n){var a=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*a+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*a+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*a+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*a+n[7]*c+n[11]*m+n[15]*g,r}Gu=new fl(4),fl!=Float32Array&&(Gu[0]=0,Gu[1]=0,Gu[2]=0,Gu[3]=0);class n1 extends s{constructor(t){super(t,r1)}createBucket(t){return new $p(t)}queryRadius(t){const n=t;return qu("circle-radius",this,n)+qu("circle-stroke-width",this,n)+Rh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y,x){const k=Fh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,y),P=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),C=this.paint.get("circle-pitch-alignment")==="map",A=C?k:function(B,O){return B.map($=>t_($,O))}(k,x),R=C?P*y:P;for(const B of c)for(const O of B){const $=C?O:t_(O,x);let X=R;const de=Bh([],[O.x,O.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=de[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=g.cameraToCenterDistance/de[3]),Y0(A,$,X))return!0}return!1}}function t_(r,t){const n=Bh([],[r.x,r.y,0,1],t);return new re(n[0]/n[3],n[1]/n[3])}class r_ extends $p{}let i_;Ze("HeatmapBucket",r_,{omit:["layers"]});var s1={get paint(){return i_=i_||new f({"heatmap-radius":new ot(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uu(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(me.paint_heatmap["heatmap-opacity"])})}};function Hp(r,{width:t,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*a}`)}else c=new Uint8Array(t*n*a);return r.width=t,r.height=n,r.data=c,r}function n_(r,{width:t,height:n},a){if(t===r.width&&n===r.height)return;const c=Hp({},{width:t,height:n},a);Wp(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},a),r.width=t,r.height=n,r.data=c.data}function Wp(r,t,n,a,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,y=t.data;if(g===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const k=((n.y+x)*r.width+n.x)*m,P=((a.y+x)*t.width+a.x)*m;for(let C=0;C<c.width*m;C++)y[P+C]=g[k+C]}return t}class Hu{constructor(t,n){Hp(this,t,1,n)}resize(t){n_(this,t,1)}clone(){return new Hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,c,m){Wp(t,n,a,c,m,1)}}class Yi{constructor(t,n){Hp(this,t,4,n)}resize(t){n_(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Yi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,c,m){Wp(t,n,a,c,m,4)}}function s_(r){const t={},n=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Yi({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,y,x)=>{t[r.evaluationKey]=x;const k=r.expression.evaluate(t);c.data[g+y+0]=Math.floor(255*k.r/k.a),c.data[g+y+1]=Math.floor(255*k.g/k.a),c.data[g+y+2]=Math.floor(255*k.b/k.a),c.data[g+y+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,y=0;g<a;++g,y+=4*n)for(let x=0,k=0;x<n;x++,k+=4){const P=x/(n-1),{start:C,end:A}=r.clips[g];m(y,k,C*(1-P)+A*P)}else for(let g=0,y=0;g<n;g++,y+=4)m(0,y,g/(n-1));return c}Ze("AlphaImage",Hu),Ze("RGBAImage",Yi);const Xp="big-fb";class o1 extends s{createBucket(t){return new r_(t)}constructor(t){super(t,s1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=s_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xp)&&this.heatmapFbos.delete(Xp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let o_;var a1={get paint(){return o_=o_||new f({"hillshade-illumination-direction":new Xe(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(me.paint_hillshade["hillshade-accent-color"])})}};class l1 extends s{constructor(t){super(t,a1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const u1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:c1}=u1;function a_(r,t,n=2){const a=t&&t.length,c=a?t[0]*n:r.length;let m=l_(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let y,x,k;if(a&&(m=function(P,C,A,R){const B=[];for(let O=0,$=C.length;O<$;O++){const X=l_(P,C[O]*R,O<$-1?C[O+1]*R:P.length,R,!1);X===X.next&&(X.steiner=!0),B.push(y1(X))}B.sort(m1);for(let O=0;O<B.length;O++)A=g1(B[O],A);return A}(r,t,m,n)),r.length>80*n){y=1/0,x=1/0;let P=-1/0,C=-1/0;for(let A=n;A<c;A+=n){const R=r[A],B=r[A+1];R<y&&(y=R),B<x&&(x=B),R>P&&(P=R),B>C&&(C=B)}k=Math.max(P-y,C-x),k=k!==0?32767/k:0}return Wu(m,g,n,y,x,k,0),g}function l_(r,t,n,a,c){let m;if(c===function(g,y,x,k){let P=0;for(let C=y,A=x-k;C<x;C+=k)P+=(g[A]-g[C])*(g[C+1]+g[A+1]),A=C;return P}(r,t,n,a)>0)for(let g=t;g<n;g+=a)m=h_(g/a|0,r[g],r[g+1],m);else for(let g=n-a;g>=t;g-=a)m=h_(g/a|0,r[g],r[g+1],m);return m&&Oh(m,m.next)&&(Ku(m),m=m.next),m}function pa(r,t){if(!r)return r;t||(t=r);let n,a=r;do if(n=!1,a.steiner||!Oh(a,a.next)&&cr(a.prev,a,a.next)!==0)a=a.next;else{if(Ku(a),a=t=a.prev,a===a.next)break;n=!0}while(n||a!==t);return t}function Wu(r,t,n,a,c,m,g){if(!r)return;!g&&m&&function(x,k,P,C){let A=x;do A.z===0&&(A.z=Kp(A.x,A.y,k,P,C)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(R){let B,O=1;do{let $,X=R;R=null;let de=null;for(B=0;X;){B++;let ee=X,ae=0;for(let be=0;be<O&&(ae++,ee=ee.nextZ,ee);be++);let ge=O;for(;ae>0||ge>0&&ee;)ae!==0&&(ge===0||!ee||X.z<=ee.z)?($=X,X=X.nextZ,ae--):($=ee,ee=ee.nextZ,ge--),de?de.nextZ=$:R=$,$.prevZ=de,de=$;X=ee}de.nextZ=null,O*=2}while(B>1)}(A)}(r,a,c,m);let y=r;for(;r.prev!==r.next;){const x=r.prev,k=r.next;if(m?d1(r,a,c,m):h1(r))t.push(x.i,r.i,k.i),Ku(r),r=k.next,y=k.next;else if((r=k)===y){g?g===1?Wu(r=p1(pa(r),t),t,n,a,c,m,2):g===2&&f1(r,t,n,a,c,m):Wu(pa(r),t,n,a,c,m,1);break}}}function h1(r){const t=r.prev,n=r,a=r.next;if(cr(t,n,a)>=0)return!1;const c=t.x,m=n.x,g=a.x,y=t.y,x=n.y,k=a.y,P=c<m?c<g?c:g:m<g?m:g,C=y<x?y<k?y:k:x<k?x:k,A=c>m?c>g?c:g:m>g?m:g,R=y>x?y>k?y:k:x>k?x:k;let B=a.next;for(;B!==t;){if(B.x>=P&&B.x<=A&&B.y>=C&&B.y<=R&&ml(c,y,m,x,g,k,B.x,B.y)&&cr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function d1(r,t,n,a){const c=r.prev,m=r,g=r.next;if(cr(c,m,g)>=0)return!1;const y=c.x,x=m.x,k=g.x,P=c.y,C=m.y,A=g.y,R=y<x?y<k?y:k:x<k?x:k,B=P<C?P<A?P:A:C<A?C:A,O=y>x?y>k?y:k:x>k?x:k,$=P>C?P>A?P:A:C>A?C:A,X=Kp(R,B,t,n,a),de=Kp(O,$,t,n,a);let ee=r.prevZ,ae=r.nextZ;for(;ee&&ee.z>=X&&ae&&ae.z<=de;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&ml(y,P,x,C,k,A,ee.x,ee.y)&&cr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=R&&ae.x<=O&&ae.y>=B&&ae.y<=$&&ae!==c&&ae!==g&&ml(y,P,x,C,k,A,ae.x,ae.y)&&cr(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=X;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&ml(y,P,x,C,k,A,ee.x,ee.y)&&cr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=de;){if(ae.x>=R&&ae.x<=O&&ae.y>=B&&ae.y<=$&&ae!==c&&ae!==g&&ml(y,P,x,C,k,A,ae.x,ae.y)&&cr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function p1(r,t){let n=r;do{const a=n.prev,c=n.next.next;!Oh(a,c)&&u_(a,n,n.next,c)&&Xu(a,c)&&Xu(c,a)&&(t.push(a.i,n.i,c.i),Ku(n),Ku(n.next),n=r=c),n=n.next}while(n!==r);return pa(n)}function f1(r,t,n,a,c,m){let g=r;do{let y=g.next.next;for(;y!==g.prev;){if(g.i!==y.i&&v1(g,y)){let x=c_(g,y);return g=pa(g,g.next),x=pa(x,x.next),Wu(g,t,n,a,c,m,0),void Wu(x,t,n,a,c,m,0)}y=y.next}g=g.next}while(g!==r)}function m1(r,t){return r.x-t.x}function g1(r,t){const n=function(c,m){let g=m;const y=c.x,x=c.y;let k,P=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const O=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(O<=y&&O>P&&(P=O,k=g.x<g.next.x?g:g.next,O===y))return k}g=g.next}while(g!==m);if(!k)return null;const C=k,A=k.x,R=k.y;let B=1/0;g=k;do{if(y>=g.x&&g.x>=A&&y!==g.x&&ml(x<R?y:P,x,A,R,x<R?P:y,x,g.x,g.y)){const O=Math.abs(x-g.y)/(y-g.x);Xu(g,c)&&(O<B||O===B&&(g.x>k.x||g.x===k.x&&_1(k,g)))&&(k=g,B=O)}g=g.next}while(g!==C);return k}(r,t);if(!n)return t;const a=c_(n,r);return pa(a,a.next),pa(n,n.next)}function _1(r,t){return cr(r.prev,r,t.prev)<0&&cr(t.next,r,r.next)<0}function Kp(r,t,n,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function ml(r,t,n,a,c,m,g,y){return(c-g)*(t-y)>=(r-g)*(m-y)&&(r-g)*(a-y)>=(n-g)*(t-y)&&(n-g)*(m-y)>=(c-g)*(a-y)}function v1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&u_(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(r,t)&&(Xu(r,t)&&Xu(t,r)&&function(n,a){let c=n,m=!1;const g=(n.x+a.x)/2,y=(n.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,t)&&(cr(r.prev,r,t.prev)||cr(r,t.prev,t))||Oh(r,t)&&cr(r.prev,r,r.next)>0&&cr(t.prev,t,t.next)>0)}function cr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function Oh(r,t){return r.x===t.x&&r.y===t.y}function u_(r,t,n,a){const c=Vh(cr(r,t,n)),m=Vh(cr(r,t,a)),g=Vh(cr(n,a,r)),y=Vh(cr(n,a,t));return c!==m&&g!==y||!(c!==0||!Nh(r,n,t))||!(m!==0||!Nh(r,a,t))||!(g!==0||!Nh(n,r,a))||!(y!==0||!Nh(n,t,a))}function Nh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function Vh(r){return r>0?1:r<0?-1:0}function Xu(r,t){return cr(r.prev,r,r.next)<0?cr(r,t,r.next)>=0&&cr(r,r.prev,t)>=0:cr(r,t,r.prev)<0||cr(r,r.next,t)<0}function c_(r,t){const n=Jp(r.i,r.x,r.y),a=Jp(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function h_(r,t,n,a){const c=Jp(r,t,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Ku(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Jp(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Yp(r,t,n){const a=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,a[y.to]=!0,a[y.from]=!0)}return c}function Qp(r,t,n,a,c){const m=c.patternDependencies;for(const g of t){const y=g.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a-1},n,{},c.availableImages),k=y.evaluate({zoom:a},n,{},c.availableImages),P=y.evaluate({zoom:a+1},n,{},c.availableImages);x=x&&x.name?x.name:x,k=k&&k.name?k.name:k,P=P&&P.name?P.name:P,m[x]=!0,m[k]=!0,m[P]=!0,n.patterns[g.id]={min:x,mid:k,max:P}}}return n}class ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yn,this.indexArray=new Ji,this.indexArray2=new Pr,this.programConfigurations=new ca(t.layers,t.zoom),this.segments=new St,this.segments2=new St,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Yp("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:P}of t){const C=this.layers[0]._featureFilter.needGeometry,A=da(y,C);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),A,a))continue;const R=m?c.evaluate(A,{},a,n.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:P,index:k,geometry:C?A.geometry:ha(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:P}=y;if(this.hasPattern){const C=Qp("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,a,{});n.featureIndex.insert(t[k].feature,x,k,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,c1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,c,m){for(const g of Na(n,500)){let y=0;for(const R of g)y+=R.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),k=x.vertexLength,P=[],C=[];for(const R of g){if(R.length===0)continue;R!==g[0]&&C.push(P.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(O+R.length-1,O),P.push(R[0].x),P.push(R[0].y);for(let $=1;$<R.length;$++)this.layoutVertexArray.emplaceBack(R[$].x,R[$].y),this.indexArray2.emplaceBack(O+$-1,O+$),P.push(R[$].x),P.push(R[$].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const A=a_(P,C);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(k+A[R],k+A[R+1],k+A[R+2]);x.vertexLength+=y,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}let d_,p_;Ze("FillBucket",ef,{omit:["layers","patternFeatures"]});var x1={get paint(){return p_=p_||new f({"fill-antialias":new Xe(me.paint_fill["fill-antialias"]),"fill-opacity":new ot(me.paint_fill["fill-opacity"]),"fill-color":new ot(me.paint_fill["fill-color"]),"fill-outline-color":new ot(me.paint_fill["fill-outline-color"]),"fill-translate":new Xe(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new sl(me.paint_fill["fill-pattern"])})},get layout(){return d_=d_||new f({"fill-sort-key":new ot(me.layout_fill["fill-sort-key"])})}};class w1 extends s{constructor(t){super(t,x1)}recalculate(t,n){super.recalculate(t,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ef(t)}queryRadius(){return Rh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y){return Xg(Fh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,y),c)}isTileClipped(){return!0}}const b1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),S1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:T1}=b1;var ho={},k1=le,f_=gl;function gl(r,t,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=c,r.readFields(I1,this,t)}function I1(r,t,n){r==1?t.id=n.readVarint():r==2?function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var g=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[g]=y}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function P1(r){for(var t,n,a=0,c=0,m=r.length,g=m-1;c<m;g=c++)a+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return a}gl.types=["Unknown","Point","LineString","Polygon"],gl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,a=1,c=0,m=0,g=0,y=[];r.pos<n;){if(c<=0){var x=r.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)m+=r.readSVarint(),g+=r.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new k1(m,g));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},gl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,a=0,c=0,m=0,g=1/0,y=-1/0,x=1/0,k=-1/0;r.pos<t;){if(a<=0){var P=r.readVarint();n=7&P,a=P>>3}if(a--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>y&&(y=c),(m+=r.readSVarint())<x&&(x=m),m>k&&(k=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,y,k]},gl.prototype.toGeoJSON=function(r,t,n){var a,c,m=this.extent*Math.pow(2,n),g=this.extent*r,y=this.extent*t,x=this.loadGeometry(),k=gl.types[this.type];function P(R){for(var B=0;B<R.length;B++){var O=R[B];R[B]=[360*(O.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+y)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<x.length;a++)C[a]=x[a][0];P(x=C);break;case 2:for(a=0;a<x.length;a++)P(x[a]);break;case 3:for(x=function(R){var B=R.length;if(B<=1)return[R];for(var O,$,X=[],de=0;de<B;de++){var ee=P1(R[de]);ee!==0&&($===void 0&&($=ee<0),$===ee<0?(O&&X.push(O),O=[R[de]]):O.push(R[de]))}return O&&X.push(O),X}(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)P(x[a][c])}x.length===1?x=x[0]:k="Multi"+k;var A={type:"Feature",geometry:{type:k,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var E1=f_,m_=g_;function g_(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(C1,this,t),this.length=this._features.length}function C1(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return c}(n))}g_.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new E1(this._pbf,t,this.extent,this._keys,this._values)};var M1=m_;function z1(r,t,n){if(r===3){var a=new M1(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}ho.VectorTile=function(r,t){this.layers=r.readFields(z1,{},t)},ho.VectorTileFeature=f_,ho.VectorTileLayer=m_;const A1=ho.VectorTileFeature.types,tf=Math.pow(2,13);function Ju(r,t,n,a,c,m,g,y){r.emplaceBack(t,n,2*Math.floor(a*tf)+g,c*tf*2,m*tf*2,Math.round(y))}class rf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new so,this.centroidVertexArray=new Fr,this.indexArray=new Ji,this.programConfigurations=new ca(t.layers,t.zoom),this.segments=new St,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.features=[],this.hasPattern=Yp("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,k=da(c,x);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),k,a))continue;const P={id:m,sourceLayerIndex:y,index:g,geometry:x?k.geometry:ha(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Qp("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,g,a,{}),n.featureIndex.insert(c,P.geometry,g,y,this.index,!0)}}addFeatures(t,n,a){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,a)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,S1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,a,c,m){for(const g of Na(n,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const B of g)x+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of g){if(B.length===0||L1(B))continue;let O=0;for(let $=0;$<B.length;$++){const X=B[$];if($>=1){const de=B[$-1];if(!D1(X,de)){k.vertexLength+4>St.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=X.sub(de)._perp()._unit(),ae=de.dist(X);O+ae>32768&&(O=0),Ju(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,0,O),Ju(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,1,O),y.x+=2*X.x,y.y+=2*X.y,y.vertexCount+=2,O+=ae,Ju(this.layoutVertexArray,de.x,de.y,ee.x,ee.y,0,0,O),Ju(this.layoutVertexArray,de.x,de.y,ee.x,ee.y,0,1,O),y.x+=2*de.x,y.y+=2*de.y,y.vertexCount+=2;const ge=k.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+x>St.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),A1[t.type]!=="Polygon")continue;const P=[],C=[],A=k.vertexLength;for(const B of g)if(B.length!==0){B!==g[0]&&C.push(P.length/2);for(let O=0;O<B.length;O++){const $=B[O];Ju(this.layoutVertexArray,$.x,$.y,0,0,1,1,0),y.x+=$.x,y.y+=$.y,y.vertexCount+=1,P.push($.x),P.push($.y)}}const R=a_(P,C);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(A+R[B],A+R[B+2],A+R[B+1]);k.primitiveLength+=R.length/3,k.vertexLength+=x;for(let B=0;B<y.vertexCount;B++){const O=Math.floor(y.x/y.vertexCount),$=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(O,$)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}function D1(r,t){return r.x===t.x&&(r.x<0||r.x>gr)||r.y===t.y&&(r.y<0||r.y>gr)}function L1(r){return r.every(t=>t.x<0)||r.every(t=>t.x>gr)||r.every(t=>t.y<0)||r.every(t=>t.y>gr)}let __;Ze("FillExtrusionBucket",rf,{omit:["layers","features"]});var R1={get paint(){return __=__||new f({"fill-extrusion-opacity":new Xe(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sl(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class F1 extends s{constructor(t){super(t,R1)}createBucket(t){return new rf(t)}queryRadius(){return Rh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,a,c,m,g,y,x){const k=Fh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,y),P=this.paint.get("fill-extrusion-height").evaluate(n,a),C=this.paint.get("fill-extrusion-base").evaluate(n,a),A=function(B,O,$,X){const de=[];for(const ee of B){const ae=[ee.x,ee.y,0,1];Bh(ae,ae,O),de.push(new re(ae[0]/ae[3],ae[1]/ae[3]))}return de}(k,x),R=function(B,O,$,X){const de=[],ee=[],ae=X[8]*O,ge=X[9]*O,be=X[10]*O,Ve=X[11]*O,st=X[8]*$,Oe=X[9]*$,De=X[10]*$,Ye=X[11]*$;for(const qe of B){const $e=[],ye=[];for(const Qe of qe){const Je=Qe.x,ut=Qe.y,Ut=X[0]*Je+X[4]*ut+X[12],jt=X[1]*Je+X[5]*ut+X[13],br=X[2]*Je+X[6]*ut+X[14],vn=X[3]*Je+X[7]*ut+X[15],Nr=br+be,Sr=vn+Ve,ai=Ut+st,li=jt+Oe,ui=br+De,or=vn+Ye,Tr=new re((Ut+ae)/Sr,(jt+ge)/Sr);Tr.z=Nr/Sr,$e.push(Tr);const Wr=new re(ai/or,li/or);Wr.z=ui/or,ye.push(Wr)}de.push($e),ee.push(ye)}return[de,ee]}(c,C,P,x);return function(B,O,$){let X=1/0;Xg($,O)&&(X=y_($,O[0]));for(let de=0;de<O.length;de++){const ee=O[de],ae=B[de];for(let ge=0;ge<ee.length-1;ge++){const be=ee[ge],Ve=[be,ee[ge+1],ae[ge+1],ae[ge],be];Wg($,Ve)&&(X=Math.min(X,y_($,Ve)))}}return X!==1/0&&X}(R[0],R[1],A)}}function Yu(r,t){return r.x*t.x+r.y*t.y}function y_(r,t){if(r.length===1){let n=0;const a=t[n++];let c;for(;!c||a.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],y=c.sub(a),x=m.sub(a),k=g.sub(a),P=Yu(y,y),C=Yu(y,x),A=Yu(x,x),R=Yu(k,y),B=Yu(k,x),O=P*A-C*C,$=(A*R-C*B)/O,X=(P*B-C*R)/O,de=a.z*(1-$-X)+c.z*$+m.z*X;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const a of t)n=Math.min(n,a.z);return n}}const B1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:O1}=B1,N1=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:V1}=N1,j1=ho.VectorTileFeature.types,U1=Math.cos(Math.PI/180*37.5),v_=Math.pow(2,14)/.5;class nf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new al,this.layoutVertexArray2=new oo,this.indexArray=new Ji,this.programConfigurations=new ca(t.layers,t.zoom),this.segments=new St,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Yp("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:P}of t){const C=this.layers[0]._featureFilter.needGeometry,A=da(y,C);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),A,a))continue;const R=m?c.evaluate(A,{},a):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:P,index:k,geometry:C?A.geometry:ha(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:P}=y;if(this.hasPattern){const C=Qp("line",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,a,{});n.featureIndex.insert(t[k].feature,x,k,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,V1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,O1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,c,m){const g=this.layers[0].layout,y=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),k=g.get("line-miter-limit"),P=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const C of n)this.addLine(C,t,y,x,k,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}addLine(t,n,a,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=j1[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let k=0;for(;k<x-1&&t[k].equals(t[k+1]);)k++;if(x<(y?3:2))return;a==="bevel"&&(m=1.05);const P=this.overscaling<=16?15*gr/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,R,B,O,$;this.e1=this.e2=-1,y&&(A=t[x-2],$=t[k].sub(A)._unit()._perp());for(let X=k;X<x;X++){if(B=X===x-1?y?t[k+1]:void 0:t[X+1],B&&t[X].equals(B))continue;$&&(O=$),A&&(R=A),A=t[X],$=B?B.sub(A)._unit()._perp():O,O=O||$;let de=O.add($);de.x===0&&de.y===0||de._unit();const ee=O.x*$.x+O.y*$.y,ae=de.x*$.x+de.y*$.y,ge=ae!==0?1/ae:1/0,be=2*Math.sqrt(2-2*ae),Ve=ae<U1&&R&&B,st=O.x*$.y-O.y*$.x>0;if(Ve&&X>k){const Ye=A.dist(R);if(Ye>2*P){const qe=A.sub(A.sub(R)._mult(P/Ye)._round());this.updateDistance(R,qe),this.addCurrentVertex(qe,O,0,0,C),R=qe}}const Oe=R&&B;let De=Oe?a:y?"butt":c;if(Oe&&De==="round"&&(ge<g?De="miter":ge<=2&&(De="fakeround")),De==="miter"&&ge>m&&(De="bevel"),De==="bevel"&&(ge>2&&(De="flipbevel"),ge<m&&(De="miter")),R&&this.updateDistance(R,A),De==="miter")de._mult(ge),this.addCurrentVertex(A,de,0,0,C);else if(De==="flipbevel"){if(ge>100)de=$.mult(-1);else{const Ye=ge*O.add($).mag()/O.sub($).mag();de._perp()._mult(Ye*(st?-1:1))}this.addCurrentVertex(A,de,0,0,C),this.addCurrentVertex(A,de.mult(-1),0,0,C)}else if(De==="bevel"||De==="fakeround"){const Ye=-Math.sqrt(ge*ge-1),qe=st?Ye:0,$e=st?0:Ye;if(R&&this.addCurrentVertex(A,O,qe,$e,C),De==="fakeround"){const ye=Math.round(180*be/Math.PI/20);for(let Qe=1;Qe<ye;Qe++){let Je=Qe/ye;if(Je!==.5){const Ut=Je-.5;Je+=Je*Ut*(Je-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Ut*Ut+(.848013+ee*(.215638*ee-1.06021)))}const ut=$.sub(O)._mult(Je)._add(O)._unit()._mult(st?-1:1);this.addHalfVertex(A,ut.x,ut.y,!1,st,0,C)}}B&&this.addCurrentVertex(A,$,-qe,-$e,C)}else if(De==="butt")this.addCurrentVertex(A,de,0,0,C);else if(De==="square"){const Ye=R?1:-1;this.addCurrentVertex(A,de,Ye,Ye,C)}else De==="round"&&(R&&(this.addCurrentVertex(A,O,0,0,C),this.addCurrentVertex(A,O,1,1,C,!0)),B&&(this.addCurrentVertex(A,$,-1,-1,C,!0),this.addCurrentVertex(A,$,0,0,C)));if(Ve&&X<x-1){const Ye=A.dist(B);if(Ye>2*P){const qe=A.add(B.sub(A)._mult(P/Ye)._round());this.updateDistance(A,qe),this.addCurrentVertex(qe,$,0,0,C),A=qe}}}}addCurrentVertex(t,n,a,c,m,g=!1){const y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,g,!1,a,m),this.addHalfVertex(t,y,x,g,!0,-c,m),this.distance>v_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,a,c,m,g))}addHalfVertex({x:t,y:n},a,c,m,g,y,x){const k=.5*(this.lineClips?this.scaledDistance*(v_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),x.primitiveLength++),g?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let x_,w_;Ze("LineBucket",nf,{omit:["layers","patternFeatures"]});var b_={get paint(){return w_=w_||new f({"line-opacity":new ot(me.paint_line["line-opacity"]),"line-color":new ot(me.paint_line["line-color"]),"line-translate":new Xe(me.paint_line["line-translate"]),"line-translate-anchor":new Xe(me.paint_line["line-translate-anchor"]),"line-width":new ot(me.paint_line["line-width"]),"line-gap-width":new ot(me.paint_line["line-gap-width"]),"line-offset":new ot(me.paint_line["line-offset"]),"line-blur":new ot(me.paint_line["line-blur"]),"line-dasharray":new ol(me.paint_line["line-dasharray"]),"line-pattern":new sl(me.paint_line["line-pattern"]),"line-gradient":new Uu(me.paint_line["line-gradient"])})},get layout(){return x_=x_||new f({"line-cap":new Xe(me.layout_line["line-cap"]),"line-join":new ot(me.layout_line["line-join"]),"line-miter-limit":new Xe(me.layout_line["line-miter-limit"]),"line-round-limit":new Xe(me.layout_line["line-round-limit"]),"line-sort-key":new ot(me.layout_line["line-sort-key"])})}};class $1 extends ot{possiblyEvaluate(t,n){return n=new Gt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,a,c){return n=Ge({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,a,c)}}let jh;class Z1 extends s{constructor(t){super(t,b_),this.gradientVersion=0,jh||(jh=new $1(b_.paint.properties["line-width"].specification),jh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof js,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=jh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new nf(t)}queryRadius(t){const n=t,a=S_(qu("line-width",this,n),qu("line-gap-width",this,n)),c=qu("line-offset",this,n);return a/2+Math.abs(c)+Rh(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y){const x=Fh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,y),k=y/2*S_(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),P=this.paint.get("line-offset").evaluate(n,a);return P&&(c=function(C,A){const R=[];for(let B=0;B<C.length;B++){const O=C[B],$=[];for(let X=0;X<O.length;X++){const de=O[X-1],ee=O[X],ae=O[X+1],ge=X===0?new re(0,0):ee.sub(de)._unit()._perp(),be=X===O.length-1?new re(0,0):ae.sub(ee)._unit()._perp(),Ve=ge._add(be)._unit(),st=Ve.x*be.x+Ve.y*be.y;st!==0&&Ve._mult(1/st),$.push(Ve._mult(A)._add(ee))}R.push($)}return R}(c,P*y)),function(C,A,R){for(let B=0;B<A.length;B++){const O=A[B];if(C.length>=3){for(let $=0;$<O.length;$++)if(pl(C,O[$]))return!0}if(Q0(C,O,R))return!0}return!1}(x,c,k)}isTileClipped(){return!0}}function S_(r,t){return t>0?t+2*r:r}const q1=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),G1=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const H1=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const T_=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),W1=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function X1(r,t,n){return r.sections.forEach(a=>{a.text=function(c,m,g){const y=m.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),vi.applyArabicShaping&&(c=vi.applyArabicShaping(c)),c}(a.text,t,n)}),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var yr=24,k_=Vt,I_=function(r,t,n,a,c){var m,g,y=8*c-a-1,x=(1<<y)-1,k=x>>1,P=-7,C=c-1,A=-1,R=r[t+C];for(C+=A,m=R&(1<<-P)-1,R>>=-P,P+=y;P>0;m=256*m+r[t+C],C+=A,P-=8);for(g=m&(1<<-P)-1,m>>=-P,P+=a;P>0;g=256*g+r[t+C],C+=A,P-=8);if(m===0)m=1-k;else{if(m===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,a),m-=k}return(R?-1:1)*g*Math.pow(2,m-a)},P_=function(r,t,n,a,c,m){var g,y,x,k=8*m-c-1,P=(1<<k)-1,C=P>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=P):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+C>=1?A/x:A*Math.pow(2,1-C))*x>=2&&(g++,x/=2),g+C>=P?(y=0,g=P):g+C>=1?(y=(t*x-1)*Math.pow(2,c),g+=C):(y=t*Math.pow(2,C-1)*Math.pow(2,c),g=0));c>=8;r[n+R]=255&y,R+=B,y/=256,c-=8);for(g=g<<c|y,k+=c;k>0;r[n+R]=255&g,R+=B,g/=256,k-=8);r[n+R-B]|=128*O};function Vt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var sf=4294967296,E_=1/sf,C_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ss(r){return r.type===Vt.Bytes?r.readVarint()+r.pos:r.pos+1}function _l(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function M_(r,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=r;c--)n.buf[c+a]=n.buf[c]}function K1(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function J1(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function Y1(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function Q1(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function ew(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function tw(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function rw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function iw(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function nw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function Uh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function yl(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function z_(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Vt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,r(c,t,this),this.pos===m&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Uh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=z_(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Uh(this.buf,this.pos)+Uh(this.buf,this.pos+4)*sf;return this.pos+=8,r},readSFixed64:function(){var r=Uh(this.buf,this.pos)+z_(this.buf,this.pos+4)*sf;return this.pos+=8,r},readFloat:function(){var r=I_(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=I_(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(c,m,g){var y,x,k=g.buf;if(y=(112&(x=k[g.pos++]))>>4,x<128||(y|=(127&(x=k[g.pos++]))<<3,x<128)||(y|=(127&(x=k[g.pos++]))<<10,x<128)||(y|=(127&(x=k[g.pos++]))<<17,x<128)||(y|=(127&(x=k[g.pos++]))<<24,x<128)||(y|=(1&(x=k[g.pos++]))<<31,x<128))return _l(c,y,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&C_?function(n,a,c){return C_.decode(n.subarray(a,c))}(this.buf,t,r):function(n,a,c){for(var m="",g=a;g<c;){var y,x,k,P=n[g],C=null,A=P>239?4:P>223?3:P>191?2:1;if(g+A>c)break;A===1?P<128&&(C=P):A===2?(192&(y=n[g+1]))==128&&(C=(31&P)<<6|63&y)<=127&&(C=null):A===3?(x=n[g+2],(192&(y=n[g+1]))==128&&(192&x)==128&&((C=(15&P)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):A===4&&(x=n[g+2],k=n[g+3],(192&(y=n[g+1]))==128&&(192&x)==128&&(192&k)==128&&((C=(15&P)<<18|(63&y)<<12|(63&x)<<6|63&k)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,A=1):C>65535&&(C-=65536,m+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),m+=String.fromCharCode(C),g+=A}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Vt.Bytes)return r.push(this.readVarint(t));var n=Ss(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Vt.Bytes)return r.push(this.readSVarint());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Vt.Bytes)return r.push(this.readBoolean());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Vt.Bytes)return r.push(this.readFloat());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Vt.Bytes)return r.push(this.readDouble());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Vt.Bytes)return r.push(this.readFixed32());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Vt.Bytes)return r.push(this.readSFixed32());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Vt.Bytes)return r.push(this.readFixed64());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Vt.Bytes)return r.push(this.readSFixed64());var t=Ss(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Vt.Fixed32)this.pos+=4;else{if(t!==Vt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),yl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),yl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),yl(this.buf,-1&r,this.pos),yl(this.buf,Math.floor(r*E_),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),yl(this.buf,-1&r,this.pos),yl(this.buf,Math.floor(r*E_),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,y){y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,y.buf[y.pos]=127&(m>>>=7)}(a,0,n),function(m,g){var y=(7&m)<<4;g.buf[g.pos++]|=y|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(a,c,m){for(var g,y,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!y){g>56319||x+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):y=g;continue}if(g<56320){a[m++]=239,a[m++]=191,a[m++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(a[m++]=239,a[m++]=191,a[m++]=189,y=null);g<128?a[m++]=g:(g<2048?a[m++]=g>>6|192:(g<65536?a[m++]=g>>12|224:(a[m++]=g>>18|240,a[m++]=g>>12&63|128),a[m++]=g>>6&63|128),a[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&M_(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),P_(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),P_(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var a=this.pos-n;a>=128&&M_(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,n){this.writeTag(r,Vt.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,K1,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,J1,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,ew,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Y1,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Q1,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,tw,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,rw,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,iw,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,nw,t)},writeBytesField:function(r,t){this.writeTag(r,Vt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Vt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Vt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Vt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Vt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Vt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Vt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Vt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Vt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Vt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var of=G(k_);const af=3;function sw(r,t,n){r===1&&n.readMessage(ow,t)}function ow(r,t,n){if(r===3){const{id:a,bitmap:c,width:m,height:g,left:y,top:x,advance:k}=n.readMessage(aw,{});t.push({id:a,bitmap:new Hu({width:m+2*af,height:g+2*af},c),metrics:{width:m,height:g,left:y,top:x,advance:k}})}}function aw(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const A_=af;function D_(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,y)=>y.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const k=a.pop();y<a.length&&(a[y]=k)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(a.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const wi=1;class lf{constructor(t,{pixelRatio:n,version:a,stretchX:c,stretchY:m,content:g,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=a,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+wi,this.paddedRect.y+wi]}get br(){return[this.paddedRect.x+this.paddedRect.w-wi,this.paddedRect.y+this.paddedRect.h-wi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wi)/this.pixelRatio,(this.paddedRect.h-2*wi)/this.pixelRatio]}}class L_{constructor(t,n){const a={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,a,m),this.addImages(n,c,m);const{w:g,h:y}=D_(m),x=new Yi({width:g||1,height:y||1});for(const k in t){const P=t[k],C=a[k].paddedRect;Yi.copy(P.data,x,{x:0,y:0},{x:C.x+wi,y:C.y+wi},P.data)}for(const k in n){const P=n[k],C=c[k].paddedRect,A=C.x+wi,R=C.y+wi,B=P.data.width,O=P.data.height;Yi.copy(P.data,x,{x:0,y:0},{x:A,y:R},P.data),Yi.copy(P.data,x,{x:0,y:O-1},{x:A,y:R-1},{width:B,height:1}),Yi.copy(P.data,x,{x:0,y:0},{x:A,y:R+O},{width:B,height:1}),Yi.copy(P.data,x,{x:B-1,y:0},{x:A-1,y:R},{width:1,height:O}),Yi.copy(P.data,x,{x:0,y:0},{x:A+B,y:R},{width:1,height:O})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(t,n,a){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*wi,h:m.data.height+2*wi};a.push(g),n[c]=new lf(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;a.update(n.data,void 0,{x:c,y:m})}}var po;Ze("ImagePosition",lf),Ze("ImageAtlas",L_),S.ah=void 0,(po=S.ah||(S.ah={}))[po.none=0]="none",po[po.horizontal=1]="horizontal",po[po.vertical=2]="vertical",po[po.horizontalOnly=3]="horizontalOnly";const ec=-17;class tc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const a=new tc;return a.scale=t||1,a.fontStack=n,a}static forImage(t){const n=new tc;return n.imageName=t,n}}class vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const a=new vl;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,m=t.charCodeAt(a-1)||null;n+=c&&Eh(c)&&!Qu[t[a+1]]||m&&Eh(m)&&!Qu[t[a-1]]||!Qu[t[a]]?t[a]:Qu[t[a]]}return n}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Zh[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Zh[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const a=new vl;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(tc.forText(t.scale,t.fontStack||n));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Ot("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(tc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $h(r,t,n,a,c,m,g,y,x,k,P,C,A,R,B){const O=vl.fromFeature(r,c);let $;C===S.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:de}=vi;if(X&&O.sections.length===1){$=[];const ge=X(O.toString(),uf(O,k,m,t,a,R));for(const be of ge){const Ve=new vl;Ve.text=be,Ve.sections=O.sections;for(let st=0;st<be.length;st++)Ve.sectionIndex.push(0);$.push(Ve)}}else if(de){$=[];const ge=de(O.text,O.sectionIndex,uf(O,k,m,t,a,R));for(const be of ge){const Ve=new vl;Ve.text=be[0],Ve.sectionIndex=be[1],Ve.sections=O.sections,$.push(Ve)}}else $=function(ge,be){const Ve=[],st=ge.text;let Oe=0;for(const De of be)Ve.push(ge.substring(Oe,De)),Oe=De;return Oe<st.length&&Ve.push(ge.substring(Oe,st.length)),Ve}(O,uf(O,k,m,t,a,R));const ee=[],ae={positionedLines:ee,text:O.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(ge,be,Ve,st,Oe,De,Ye,qe,$e,ye,Qe,Je){let ut=0,Ut=ec,jt=0,br=0;const vn=qe==="right"?1:qe==="left"?0:.5;let Nr=0;for(const or of Oe){or.trim();const Tr=or.getMaxScale(),Wr=(Tr-1)*yr,Vr={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Nr]=Vr;const ci=Vr.positionedGlyphs;let jr=0;if(!or.length()){Ut+=De,++Nr;continue}for(let bi=0;bi<or.length();bi++){const Mt=or.getSection(bi),Zt=or.getSectionIndex(bi),Kt=or.getCharCode(bi);let Fi=0,tr=null,Sl=null,Yn=null,Qn=yr;const xn=!($e===S.ah.horizontal||!Qe&&!Vu(Kt)||Qe&&(Zh[Kt]||(Sr=Kt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Sr)))));if(Mt.imageName){const tn=st[Mt.imageName];if(!tn)continue;Yn=Mt.imageName,ge.iconsInText=ge.iconsInText||!0,Sl=tn.paddedRect;const Er=tn.displaySize;Mt.scale=Mt.scale*yr/Je,tr={width:Er[0],height:Er[1],left:wi,top:-A_,advance:xn?Er[1]:Er[0]},Fi=Wr+(yr-Er[1]*Mt.scale),Qn=tr.advance;const Ts=xn?Er[0]*Mt.scale-yr*Tr:Er[1]*Mt.scale-yr*Tr;Ts>0&&Ts>jr&&(jr=Ts)}else{const tn=Ve[Mt.fontStack],Er=tn&&tn[Kt];if(Er&&Er.rect)Sl=Er.rect,tr=Er.metrics;else{const Ts=be[Mt.fontStack],ac=Ts&&Ts[Kt];if(!ac)continue;tr=ac.metrics}Fi=(Tr-Mt.scale)*yr}xn?(ge.verticalizable=!0,ci.push({glyph:Kt,imageName:Yn,x:ut,y:Ut+Fi,vertical:xn,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Zt,metrics:tr,rect:Sl}),ut+=Qn*Mt.scale+ye):(ci.push({glyph:Kt,imageName:Yn,x:ut,y:Ut+Fi,vertical:xn,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Zt,metrics:tr,rect:Sl}),ut+=tr.advance*Mt.scale+ye)}ci.length!==0&&(jt=Math.max(ut-ye,jt),hw(ci,0,ci.length-1,vn,jr)),ut=0;const en=De*Tr+jr;Vr.lineOffset=Math.max(jr,Wr),Ut+=en,br=Math.max(en,br),++Nr}var Sr;const ai=Ut-ec,{horizontalAlign:li,verticalAlign:ui}=cf(Ye);(function(or,Tr,Wr,Vr,ci,jr,en,bi,Mt){const Zt=(Tr-Wr)*ci;let Kt=0;Kt=jr!==en?-bi*Vr-ec:(-Vr*Mt+.5)*en;for(const Fi of or)for(const tr of Fi.positionedGlyphs)tr.x+=Zt,tr.y+=Kt})(ge.positionedLines,vn,li,ui,jt,br,De,ai,Oe.length),ge.top+=-ui*ai,ge.bottom=ge.top+ai,ge.left+=-li*jt,ge.right=ge.left+jt}(ae,t,n,a,$,g,y,x,C,k,A,B),!function(ge){for(const be of ge)if(be.positionedGlyphs.length!==0)return!1;return!0}(ee)&&ae}const Zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},uw={40:!0};function R_(r,t,n,a,c,m){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*yr/m+c:0}{const g=n[t.fontStack],y=g&&g[r];return y?y.metrics.advance*t.scale+c:0}}function F_(r,t,n,a){const c=Math.pow(r-t,2);return a?r<t?c/2:2*c:c+Math.abs(n)*n}function cw(r,t,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function B_(r,t,n,a,c,m){let g=null,y=F_(t,n,c,m);for(const x of a){const k=F_(t-x.x,n,c,m)+x.badness;k<=y&&(g=x,y=k)}return{index:r,x:t,priorBreak:g,badness:y}}function O_(r){return r?O_(r.priorBreak).concat(r.index):[]}function uf(r,t,n,a,c,m){if(!r)return[];const g=[],y=function(C,A,R,B,O,$){let X=0;for(let de=0;de<C.length();de++){const ee=C.getSection(de);X+=R_(C.getCharCode(de),ee,B,O,A,$)}return X/Math.max(1,Math.ceil(X/R))}(r,t,n,a,c,m),x=r.text.indexOf("")>=0;let k=0;for(let C=0;C<r.length();C++){const A=r.getSection(C),R=r.getCharCode(C);if(Zh[R]||(k+=R_(R,A,a,c,t,m)),C<r.length()-1){const B=!((P=R)<11904)&&(!!bt["CJK Compatibility Forms"](P)||!!bt["CJK Compatibility"](P)||!!bt["CJK Strokes"](P)||!!bt["CJK Symbols and Punctuation"](P)||!!bt["Enclosed CJK Letters and Months"](P)||!!bt["Halfwidth and Fullwidth Forms"](P)||!!bt["Ideographic Description Characters"](P)||!!bt["Vertical Forms"](P)||Ph.test(String.fromCodePoint(P)));(lw[R]||B||A.imageName||C!==r.length()-2&&uw[r.getCharCode(C+1)])&&g.push(B_(C+1,k,y,g,cw(R,r.getCharCode(C+1),B&&x),!1))}}var P;return O_(B_(r.length(),k,y,g,0,!0))}function cf(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function hw(r,t,n,a,c){if(!a&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*a;for(let y=t;y<=n;y++)r[y].x-=g,r[y].y+=c}function dw(r,t,n){const{horizontalAlign:a,verticalAlign:c}=cf(n),m=t[0]-r.displaySize[0]*a,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function N_(r){var t,n;let a=r.left,c=r.top,m=r.right-a,g=r.bottom-c;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",k=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&m/g<k||y==="proportional"){const P=Math.ceil(g*k);a*=P/m,m=P}}else if(y==="proportional"&&x==="stretchOnly"&&k!==0&&m/g>k){const P=Math.ceil(m/k);c*=P/g,g=P}return{x1:a,y1:c,x2:a+m,y2:c+g}}function V_(r,t,n,a,c,m){const g=r.image;let y;if(g.content){const $=g.content,X=g.pixelRatio||1;y=[$[0]/X,$[1]/X,g.displaySize[0]-$[2]/X,g.displaySize[1]-$[3]/X]}const x=t.left*m,k=t.right*m;let P,C,A,R;n==="width"||n==="both"?(R=c[0]+x-a[3],C=c[0]+k+a[1]):(R=c[0]+(x+k-g.displaySize[0])/2,C=R+g.displaySize[0]);const B=t.top*m,O=t.bottom*m;return n==="height"||n==="both"?(P=c[1]+B-a[0],A=c[1]+O+a[2]):(P=c[1]+(B+O-g.displaySize[1])/2,A=P+g.displaySize[1]),{image:g,top:P,right:C,bottom:A,left:R,collisionPadding:y}}const rc=255,Jn=128,fo=rc*Jn;function j_(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Gt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=n;let m=0;for(;m<a.length&&a[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<a.length&&a[g]<r+1;)g++;g=Math.min(a.length-1,g);const y=a[m],x=a[g];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new Gt(y)),maxSize:n.evaluate(new Gt(x)),interpolationType:c}}}function hf(r,t,n){let a="never";const c=r.get(t);return c?a=c:r.get(n)&&(a="always"),a}const pw=ho.VectorTileFeature.types,fw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qh(r,t,n,a,c,m,g,y,x,k,P,C,A){const R=y?Math.min(fo,Math.round(y[0])):0,B=y?Math.min(fo,Math.round(y[1])):0;r.emplaceBack(t,n,Math.round(32*a),Math.round(32*c),m,g,(R<<1)+(x?1:0),B,16*k,16*P,256*C,256*A)}function df(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function mw(r){for(const t of r.sections)if(Np(t.text))return!0;return!1}class pf{constructor(t){this.layoutVertexArray=new ll,this.indexArray=new Ji,this.programConfigurations=t,this.segments=new St,this.dynamicLayoutVertexArray=new $u,this.opacityVertexArray=new Li,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ht}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,q1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,G1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,fw,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",pf);class ff{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new St,this.collisionVertexArray=new Xn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,H1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ze("CollisionBuffers",ff);class xl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gp([]),this.placementViewportMatrix=Gp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=j_(this.zoom,n["text-size"]),this.iconSizeData=j_(this.zoom,n["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=hf(a,"text-overlap","text-allow-overlap")!=="never"||hf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new pf(new ca(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new pf(new ca(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Wt,this.lineVertexArray=new Rr,this.symbolInstances=new wt,this.textAnchorOffsets=new Xt}calculateGlyphDependencies(t,n,a,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(a||c)&&m){const y=Qu[t.charAt(g)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,a){const c=this.layers[0],m=c.layout,g=m.get("text-font"),y=m.get("text-field"),x=m.get("icon-image"),k=(y.value.kind!=="constant"||y.value.value instanceof mi&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),P=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=m.get("symbol-sort-key");if(this.features=[],!k&&!P)return;const A=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,O=new Gt(this.zoom);for(const{feature:$,id:X,index:de,sourceLayerIndex:ee}of t){const ae=c._featureFilter.needGeometry,ge=da($,ae);if(!c._featureFilter.filter(O,ge,a))continue;let be,Ve;if(ae||(ge.geometry=ha($)),k){const Oe=c.getValueAndResolveTokens("text-field",ge,a,B),De=mi.factory(Oe),Ye=this.hasRTLText=this.hasRTLText||mw(De);(!Ye||vi.getRTLTextPluginStatus()==="unavailable"||Ye&&vi.isParsed())&&(be=X1(De,c,ge))}if(P){const Oe=c.getValueAndResolveTokens("icon-image",ge,a,B);Ve=Oe instanceof _i?Oe:_i.fromString(Oe)}if(!be&&!Ve)continue;const st=this.sortFeaturesByKey?C.evaluate(ge,{},a):void 0;if(this.features.push({id:X,text:be,icon:Ve,index:de,sourceLayerIndex:ee,geometry:ge.geometry,properties:$.properties,type:pw[$.type],sortKey:st}),Ve&&(A[Ve.name]=!0),be){const Oe=g.evaluate(ge,{},a).join(","),De=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Ye of be.sections)if(Ye.image)A[Ye.image.name]=!0;else{const qe=Ou(be.toString()),$e=Ye.fontStack||Oe,ye=R[$e]=R[$e]||{};this.calculateGlyphDependencies(Ye.text,ye,De,this.allowVerticalPlacement,qe)}}}m.get("symbol-placement")==="line"&&(this.features=function($){const X={},de={},ee=[];let ae=0;function ge(Oe){ee.push($[Oe]),ae++}function be(Oe,De,Ye){const qe=de[Oe];return delete de[Oe],de[De]=qe,ee[qe].geometry[0].pop(),ee[qe].geometry[0]=ee[qe].geometry[0].concat(Ye[0]),qe}function Ve(Oe,De,Ye){const qe=X[De];return delete X[De],X[Oe]=qe,ee[qe].geometry[0].shift(),ee[qe].geometry[0]=Ye[0].concat(ee[qe].geometry[0]),qe}function st(Oe,De,Ye){const qe=Ye?De[0][De[0].length-1]:De[0][0];return`${Oe}:${qe.x}:${qe.y}`}for(let Oe=0;Oe<$.length;Oe++){const De=$[Oe],Ye=De.geometry,qe=De.text?De.text.toString():null;if(!qe){ge(Oe);continue}const $e=st(qe,Ye),ye=st(qe,Ye,!0);if($e in de&&ye in X&&de[$e]!==X[ye]){const Qe=Ve($e,ye,Ye),Je=be($e,ye,ee[Qe].geometry);delete X[$e],delete de[ye],de[st(qe,ee[Je].geometry,!0)]=Je,ee[Qe].geometry=null}else $e in de?be($e,ye,Ye):ye in X?Ve($e,ye,Ye):(ge(Oe),X[$e]=ae-1,de[ye]=ae-1)}return ee.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,X)=>$.sortKey-X.sortKey)}update(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let y=t.segment+1;y<n.length;y++)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:c},y<n.length-1&&(c+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:m},y>0&&(m+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=g[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,c,m,g,y,x,k,P,C,A){const R=t.indexArray,B=t.layoutVertexArray,O=t.segments.prepareSegment(4*n.length,B,R,this.canOverlap?g.sortKey:void 0),$=this.glyphOffsetArray.length,X=O.vertexLength,de=this.allowVerticalPlacement&&y===S.ah.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:ge,tr:be,bl:Ve,br:st,tex:Oe,pixelOffsetTL:De,pixelOffsetBR:Ye,minFontScaleX:qe,minFontScaleY:$e,glyphOffset:ye,isSDF:Qe,sectionIndex:Je}=n[ae],ut=O.vertexLength,Ut=ye[1];qh(B,x.x,x.y,ge.x,Ut+ge.y,Oe.x,Oe.y,a,Qe,De.x,De.y,qe,$e),qh(B,x.x,x.y,be.x,Ut+be.y,Oe.x+Oe.w,Oe.y,a,Qe,Ye.x,De.y,qe,$e),qh(B,x.x,x.y,Ve.x,Ut+Ve.y,Oe.x,Oe.y+Oe.h,a,Qe,De.x,Ye.y,qe,$e),qh(B,x.x,x.y,st.x,Ut+st.y,Oe.x+Oe.w,Oe.y+Oe.h,a,Qe,Ye.x,Ye.y,qe,$e),df(t.dynamicLayoutVertexArray,x,de),R.emplaceBack(ut,ut+1,ut+2),R.emplaceBack(ut+1,ut+2,ut+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ye[0]),ae!==n.length-1&&Je===n[ae+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,g,g.index,{},A,ee&&ee[Je])}t.placedSymbolArray.emplaceBack(x.x,x.y,$,this.glyphOffsetArray.length-$,X,k,P,x.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,C)}_addCollisionDebugVertex(t,n,a,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,a,c,m,g,y){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=x.vertexLength,P=m.layoutVertexArray,C=m.collisionVertexArray,A=y.anchorX,R=y.anchorY;this._addCollisionDebugVertex(P,C,g,A,R,new re(t,n)),this._addCollisionDebugVertex(P,C,g,A,R,new re(a,n)),this._addCollisionDebugVertex(P,C,g,A,R,new re(a,c)),this._addCollisionDebugVertex(P,C,g,A,R,new re(t,c)),x.vertexLength+=4;const B=m.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,a,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ff(Ri,T_.members,Pr),this.iconCollisionBox=new ff(Ri,T_.members,Pr);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,a,c,m,g,y,x,k){const P={};for(let C=n;C<a;C++){const A=t.get(C);P.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},P.textFeatureIndex=A.featureIndex;break}for(let C=c;C<m;C++){const A=t.get(C);P.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},P.verticalTextFeatureIndex=A.featureIndex;break}for(let C=g;C<y;C++){const A=t.get(C);P.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},P.iconFeatureIndex=A.featureIndex;break}for(let C=x;C<k;C++){const A=t.get(C);P.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},P.verticalIconFeatureIndex=A.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const a=t.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),a=Math.cos(t),c=[],m=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.anchorX+a*x.anchorY)),m.push(x.featureIndex)}return g.sort((y,x)=>c[y]-c[x]||m[x]-m[y]),g}addToSortKeyRanges(t,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let U_,$_;Ze("SymbolBucket",xl,{omit:["layers","collisionBoxArray","features","compareText"]}),xl.MAX_GLYPHS=65535,xl.addDynamicAttributes=df;var mf={get paint(){return $_=$_||new f({"icon-opacity":new ot(me.paint_symbol["icon-opacity"]),"icon-color":new ot(me.paint_symbol["icon-color"]),"icon-halo-color":new ot(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(me.paint_symbol["text-opacity"]),"text-color":new ot(me.paint_symbol["text-color"],{runtimeType:ri,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ot(me.paint_symbol["text-halo-color"]),"text-halo-width":new ot(me.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(me.paint_symbol["text-halo-blur"]),"text-translate":new Xe(me.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(me.paint_symbol["text-translate-anchor"])})},get layout(){return U_=U_||new f({"symbol-placement":new Xe(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xe(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xe(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xe(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(me.layout_symbol["icon-size"]),"icon-text-fit":new Xe(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xe(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(me.layout_symbol["icon-image"]),"icon-rotate":new ot(me.layout_symbol["icon-rotate"]),"icon-padding":new ot(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(me.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(me.layout_symbol["icon-offset"]),"icon-anchor":new ot(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(me.layout_symbol["text-rotation-alignment"]),"text-field":new ot(me.layout_symbol["text-field"]),"text-font":new ot(me.layout_symbol["text-font"]),"text-size":new ot(me.layout_symbol["text-size"]),"text-max-width":new ot(me.layout_symbol["text-max-width"]),"text-line-height":new Xe(me.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(me.layout_symbol["text-letter-spacing"]),"text-justify":new ot(me.layout_symbol["text-justify"]),"text-radial-offset":new ot(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(me.layout_symbol["text-anchor"]),"text-max-angle":new Xe(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(me.layout_symbol["text-writing-mode"]),"text-rotate":new ot(me.layout_symbol["text-rotate"]),"text-padding":new Xe(me.layout_symbol["text-padding"]),"text-keep-upright":new Xe(me.layout_symbol["text-keep-upright"]),"text-transform":new ot(me.layout_symbol["text-transform"]),"text-offset":new ot(me.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(me.layout_symbol["text-allow-overlap"]),"text-overlap":new Xe(me.layout_symbol["text-overlap"]),"text-ignore-placement":new Xe(me.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(me.layout_symbol["text-optional"])})}};class Z_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:qn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",Z_,{omit:["defaultValue"]});class Gh extends s{constructor(t){super(t,mf)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,c){const m=this.layout.get(t).evaluate(n,{},a,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Ha(g.value)||!m?m:function(y,x){return x.replace(/{([^{}]+)}/g,(k,P)=>y&&P in y?String(y[P]):"")}(n.properties,m)}createBucket(t){return new xl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of mf.paint.overridableProperties){if(!Gh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),a=new Z_(n),c=new Ga(a,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Ks("source",c):new Js("composite",c,n.value.zoomStops),this.paint._values[t]=new _n(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Gh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const a=t.get("text-field"),c=mf.paint.properties[n];let m=!1;const g=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof mi)g(a.value.value.sections);else if(a.value.kind==="source"){const y=k=>{m||(k instanceof qi&&mr(k.value)===Cn?g(k.value.sections):k instanceof Ba?g(k.sections):k.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return m}}let q_;var gw={get paint(){return q_=q_||new f({"background-color":new Xe(me.paint_background["background-color"]),"background-pattern":new ol(me.paint_background["background-pattern"]),"background-opacity":new Xe(me.paint_background["background-opacity"])})}};class _w extends s{constructor(t){super(t,gw)}}let G_;var yw={get paint(){return G_=G_||new f({"raster-opacity":new Xe(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xe(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(me.paint_raster["raster-saturation"]),"raster-contrast":new Xe(me.paint_raster["raster-contrast"]),"raster-resampling":new Xe(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(me.paint_raster["raster-fade-duration"])})}};class vw extends s{constructor(t){super(t,yw)}}class xw extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ww{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const gf=63710088e-1;class mo{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mo(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,a=this.lat*n,c=t.lat*n,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return gf*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof mo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new mo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new mo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const H_=2*Math.PI*gf;function W_(r){return H_*Math.cos(r*Math.PI/180)}function X_(r){return(180+r)/360}function K_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function J_(r,t){return r/W_(t)}function _f(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class ic{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){const a=mo.convert(t);return new ic(X_(a.lng),K_(a.lat),J_(n,a.lat))}toLngLat(){return new mo(360*this.x-180,_f(this.y))}toAltitude(){return this.z*W_(_f(this.y))}meterInMercatorCoordinateUnits(){return 1/H_*(t=_f(this.y),1/Math.cos(t*Math.PI/180));var t}}function Y_(r,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class yf{constructor(t,n,a){if(!function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))}(t,n,a))throw new Error(`x=${n}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=a,this.key=nc(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,a){const c=(g=this.y,y=this.z,x=Y_(256*(m=this.x),256*(g=Math.pow(2,y)-g-1),y),k=Y_(256*(m+1),256*(g+1),y),x[0]+","+x[1]+","+k[0]+","+k[1]);var m,g,y,x,k;const P=function(C,A,R){let B,O="";for(let $=C;$>0;$--)B=1<<$-1,O+=(A&B?1:0)+(R&B?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new re((t.x*n-this.x)*gr,(t.y*n-this.y)*gr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Q_{constructor(t,n){this.wrap=t,this.canonical=n,this.key=nc(t,n.z,n.z,n.x,n.y)}}class Qi{constructor(t,n,a,c,m){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=n,this.canonical=new yf(a,+c,+m),this.key=nc(n,t,a,c,m)}clone(){return new Qi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Qi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qi(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?nc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):nc(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Qi(n,this.wrap,n,a,c),new Qi(n,this.wrap,n,a+1,c),new Qi(n,this.wrap,n,a,c+1),new Qi(n,this.wrap,n,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Qi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Q_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ic(t.x-this.wrap,t.y))}}function nc(r,t,n,a,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+a).toString(36)+n.toString(36)+t.toString(36)}Ze("CanonicalTileID",yf),Ze("OverscaledTileID",Qi,{omit:["posMatrix"]});class ey{constructor(t,n,a,c=1,m=1,g=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Ot(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<x;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(x,k)]=this.data[this._idx(x-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,x)]=this.data[this._idx(k,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<x;k++)for(let P=0;P<x;P++){const C=this.get(k,P);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,n){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,a){return t*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Yi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:g=y-1;break;case 1:y=g+1}const x=-n*this.dim,k=-a*this.dim;for(let P=g;P<y;P++)for(let C=c;C<m;C++)this.data[this._idx(C,P)]=t.data[this._idx(C+x,P+k)]}}Ze("DEMData",ey);class ty{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ry{constructor(t,n,a,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class iy{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new eo(gr,16,0),this.grid3D=new eo(gr,16,0),this.featureIndexArray=new Gr,this.promoteId=n}insert(t,n,a,c,m,g){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m);const x=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const P=n[k],C=[1/0,1/0,-1/0,-1/0];for(let A=0;A<P.length;A++){const R=P[A];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<gr&&C[1]<gr&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ho.VectorTile(new of(this.rawTileData)).layers,this.sourceLayerCoder=new ty(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,a,c){this.loadVTLayers();const m=t.params||{},g=gr/t.tileSize/t.scale,y=Su(m.filter),x=t.queryGeometry,k=t.queryPadding*g,P=sy(x),C=this.grid.query(P.minX-k,P.minY-k,P.maxX+k,P.maxY+k),A=sy(t.cameraQueryGeometry),R=this.grid3D.query(A.minX-k,A.minY-k,A.maxX+k,A.maxY+k,($,X,de,ee)=>function(ae,ge,be,Ve,st){for(const De of ae)if(ge<=De.x&&be<=De.y&&Ve>=De.x&&st>=De.y)return!0;const Oe=[new re(ge,be),new re(ge,st),new re(Ve,st),new re(Ve,be)];if(ae.length>2){for(const De of Oe)if(pl(ae,De))return!0}for(let De=0;De<ae.length-1;De++)if(t1(ae[De],ae[De+1],Oe))return!0;return!1}(t.cameraQueryGeometry,$-k,X-k,de+k,ee+k));for(const $ of R)C.push($);C.sort(bw);const B={};let O;for(let $=0;$<C.length;$++){const X=C[$];if(X===O)continue;O=X;const de=this.featureIndexArray.get(X);let ee=null;this.loadMatchingFeature(B,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,y,m.layers,m.availableImages,n,a,c,(ae,ge,be)=>(ee||(ee=ha(ae)),ge.queryIntersectsFeature(x,ae,be,ee,this.z,t.transform,g,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,a,c,m,g,y,x,k,P,C){const A=this.bucketLayerIDs[n];if(g&&!function($,X){for(let de=0;de<$.length;de++)if(X.indexOf($[de])>=0)return!0;return!1}(g,A))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(c);if(m.needGeometry){const $=da(B,!0);if(!m.filter(new Gt(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!m.filter(new Gt(this.tileID.overscaledZ),B))return;const O=this.getId(B,R);for(let $=0;$<A.length;$++){const X=A[$];if(g&&g.indexOf(X)<0)continue;const de=x[X];if(!de)continue;let ee={};O&&P&&(ee=P.getState(de.sourceLayer||"_geojsonTileLayer",O));const ae=Ge({},k[X]);ae.paint=ny(ae.paint,de.paint,B,ee,y),ae.layout=ny(ae.layout,de.layout,B,ee,y);const ge=!C||C(B,de,ee);if(!ge)continue;const be=new ry(B,this.z,this.x,this.y,O);be.layer=ae;let Ve=t[X];Ve===void 0&&(Ve=t[X]=[]),Ve.push({featureIndex:c,feature:be,intersectionZ:ge})}}lookupSymbolFeatures(t,n,a,c,m,g,y,x){const k={};this.loadVTLayers();const P=Su(m);for(const C of t)this.loadMatchingFeature(k,a,c,C,P,g,y,x,n);return k}hasLayer(t){for(const n of this.bucketLayerIDs)for(const a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function ny(r,t,n,a,c){return it(r,(m,g)=>{const y=t instanceof aa?t.get(g):null;return y&&y.evaluate?y.evaluate(n,a,c):y})}function sy(r){let t=1/0,n=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:a,maxY:c}}function bw(r,t){return t-r}function oy(r,t,n,a,c){const m=[];for(let g=0;g<r.length;g++){const y=r[g];let x;for(let k=0;k<y.length-1;k++){let P=y[k],C=y[k+1];P.x<t&&C.x<t||(P.x<t?P=new re(t,P.y+(t-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x<t&&(C=new re(t,P.y+(t-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y<n&&C.y<n||(P.y<n?P=new re(P.x+(n-P.y)/(C.y-P.y)*(C.x-P.x),n)._round():C.y<n&&(C=new re(P.x+(n-P.y)/(C.y-P.y)*(C.x-P.x),n)._round()),P.x>=a&&C.x>=a||(P.x>=a?P=new re(a,P.y+(a-P.x)/(C.x-P.x)*(C.y-P.y))._round():C.x>=a&&(C=new re(a,P.y+(a-P.x)/(C.x-P.x)*(C.y-P.y))._round()),P.y>=c&&C.y>=c||(P.y>=c?P=new re(P.x+(c-P.y)/(C.y-P.y)*(C.x-P.x),c)._round():C.y>=c&&(C=new re(P.x+(c-P.y)/(C.y-P.y)*(C.x-P.x),c)._round()),x&&P.equals(x[x.length-1])||(x=[P],m.push(x)),x.push(C)))))}}return m}Ze("FeatureIndex",iy,{omit:["rawTileData","sourceLayerCoder"]});class go extends re{constructor(t,n,a,c){super(t,n),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new go(this.x,this.y,this.angle,this.segment)}}function ay(r,t,n,a,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=r[g].dist(m),m=r[g]}y+=r[g].dist(r[g+1]),g++;const x=[];let k=0;for(;y<n/2;){const P=r[g],C=r[g+1];if(!C)return!1;let A=r[g-1].angleTo(P)-P.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:A}),k+=A;y-x[0].distance>a;)k-=x.shift().angleDelta;if(k>c)return!1;g++,y+=P.dist(C)}return!0}function ly(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function uy(r,t,n){return r?.6*t*n:0}function cy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Sw(r,t,n,a,c,m){const g=uy(n,c,m),y=cy(n,a)*m;let x=0;const k=ly(r)/2;for(let P=0;P<r.length-1;P++){const C=r[P],A=r[P+1],R=C.dist(A);if(x+R>k){const B=(k-x)/R,O=ii.number(C.x,A.x,B),$=ii.number(C.y,A.y,B),X=new go(O,$,A.angleTo(C),P);return X._round(),!g||ay(r,X,y,g,t)?X:void 0}x+=R}}function Tw(r,t,n,a,c,m,g,y,x){const k=uy(a,m,g),P=cy(a,c),C=P*g,A=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-C<t/4&&(t=C+t/4),hy(r,A?t/2*y%t:(P/2+2*m)*g*y%t,t,k,n,C,A,!1,x)}function hy(r,t,n,a,c,m,g,y,x){const k=m/2,P=ly(r);let C=0,A=t-n,R=[];for(let B=0;B<r.length-1;B++){const O=r[B],$=r[B+1],X=O.dist($),de=$.angleTo(O);for(;A+n<C+X;){A+=n;const ee=(A-C)/X,ae=ii.number(O.x,$.x,ee),ge=ii.number(O.y,$.y,ee);if(ae>=0&&ae<x&&ge>=0&&ge<x&&A-k>=0&&A+k<=P){const be=new go(ae,ge,de,B);be._round(),a&&!ay(r,be,m,a,c)||R.push(be)}}C+=X}return y||R.length||g||(R=hy(r,C/2,n,a,c,m,g,!0,x)),R}Ze("Anchor",go);const wl=wi;function dy(r,t,n,a){const c=[],m=r.image,g=m.pixelRatio,y=m.paddedRect.w-2*wl,x=m.paddedRect.h-2*wl;let k={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const P=m.stretchX||[[0,y]],C=m.stretchY||[[0,x]],A=(ye,Qe)=>ye+Qe[1]-Qe[0],R=P.reduce(A,0),B=C.reduce(A,0),O=y-R,$=x-B;let X=0,de=R,ee=0,ae=B,ge=0,be=O,Ve=0,st=$;if(m.content&&a){const ye=m.content,Qe=ye[2]-ye[0],Je=ye[3]-ye[1];(m.textFitWidth||m.textFitHeight)&&(k=N_(r)),X=Hh(P,0,ye[0]),ee=Hh(C,0,ye[1]),de=Hh(P,ye[0],ye[2]),ae=Hh(C,ye[1],ye[3]),ge=ye[0]-X,Ve=ye[1]-ee,be=Qe-de,st=Je-ae}const Oe=k.x1,De=k.y1,Ye=k.x2-Oe,qe=k.y2-De,$e=(ye,Qe,Je,ut)=>{const Ut=Wh(ye.stretch-X,de,Ye,Oe),jt=Xh(ye.fixed-ge,be,ye.stretch,R),br=Wh(Qe.stretch-ee,ae,qe,De),vn=Xh(Qe.fixed-Ve,st,Qe.stretch,B),Nr=Wh(Je.stretch-X,de,Ye,Oe),Sr=Xh(Je.fixed-ge,be,Je.stretch,R),ai=Wh(ut.stretch-ee,ae,qe,De),li=Xh(ut.fixed-Ve,st,ut.stretch,B),ui=new re(Ut,br),or=new re(Nr,br),Tr=new re(Nr,ai),Wr=new re(Ut,ai),Vr=new re(jt/g,vn/g),ci=new re(Sr/g,li/g),jr=t*Math.PI/180;if(jr){const Mt=Math.sin(jr),Zt=Math.cos(jr),Kt=[Zt,-Mt,Mt,Zt];ui._matMult(Kt),or._matMult(Kt),Wr._matMult(Kt),Tr._matMult(Kt)}const en=ye.stretch+ye.fixed,bi=Qe.stretch+Qe.fixed;return{tl:ui,tr:or,bl:Wr,br:Tr,tex:{x:m.paddedRect.x+wl+en,y:m.paddedRect.y+wl+bi,w:Je.stretch+Je.fixed-en,h:ut.stretch+ut.fixed-bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:ci,minFontScaleX:be/g/Ye,minFontScaleY:st/g/qe,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){const ye=py(P,O,R),Qe=py(C,$,B);for(let Je=0;Je<ye.length-1;Je++){const ut=ye[Je],Ut=ye[Je+1];for(let jt=0;jt<Qe.length-1;jt++)c.push($e(ut,Qe[jt],Ut,Qe[jt+1]))}}else c.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Hh(r,t,n){let a=0;for(const c of r)a+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return a}function py(r,t,n){const a=[{fixed:-wl,stretch:0}];for(const[c,m]of r){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return a.push({fixed:t+wl,stretch:n}),a}function Wh(r,t,n,a){return r/t*n+a}function Xh(r,t,n,a){return r-t*n/a}class Kh{constructor(t,n,a,c,m,g,y,x,k,P){var C;if(this.boxStartIndex=t.length,k){let A=g.top,R=g.bottom;const B=g.collisionPadding;B&&(A-=B[1],R+=B[3]);let O=R-A;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const A=!((C=g.image)===null||C===void 0)&&C.content&&(g.image.textFitWidth||g.image.textFitHeight)?N_(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};A.y1=A.y1*y-x[0],A.y2=A.y2*y+x[2],A.x1=A.x1*y-x[3],A.x2=A.x2*y+x[1];const R=g.collisionPadding;if(R&&(A.x1-=R[0]*y,A.y1-=R[1]*y,A.x2+=R[2]*y,A.y2+=R[3]*y),P){const B=new re(A.x1,A.y1),O=new re(A.x2,A.y1),$=new re(A.x1,A.y2),X=new re(A.x2,A.y2),de=P*Math.PI/180;B._rotate(de),O._rotate(de),$._rotate(de),X._rotate(de),A.x1=Math.min(B.x,O.x,$.x,X.x),A.x2=Math.max(B.x,O.x,$.x,X.x),A.y1=Math.min(B.y,O.y,$.y,X.y),A.y2=Math.max(B.y,O.y,$.y,X.y)}t.emplaceBack(n.x,n.y,A.x1,A.y1,A.x2,A.y2,a,c,m)}this.boxEndIndex=t.length}}class kw{constructor(t=[],n=(a,c)=>a<c?-1:a>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:a}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(a(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:a}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const y=g+1;if(y<this.length&&a(n[y],n[g])<0&&(g=y),a(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function Iw(r,t=1,n=!1){let a=1/0,c=1/0,m=-1/0,g=-1/0;const y=r[0];for(let R=0;R<y.length;R++){const B=y[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<c)&&(c=B.y),(!R||B.x>m)&&(m=B.x),(!R||B.y>g)&&(g=B.y)}const x=Math.min(m-a,g-c);let k=x/2;const P=new kw([],Pw);if(x===0)return new re(a,c);for(let R=a;R<m;R+=x)for(let B=c;B<g;B+=x)P.push(new bl(R+k,B+k,k,r));let C=function(R){let B=0,O=0,$=0;const X=R[0];for(let de=0,ee=X.length,ae=ee-1;de<ee;ae=de++){const ge=X[de],be=X[ae],Ve=ge.x*be.y-be.x*ge.y;O+=(ge.x+be.x)*Ve,$+=(ge.y+be.y)*Ve,B+=3*Ve}return new bl(O/B,$/B,0,R)}(r),A=P.length;for(;P.length;){const R=P.pop();(R.d>C.d||!C.d)&&(C=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-C.d<=t||(k=R.h/2,P.push(new bl(R.p.x-k,R.p.y-k,k,r)),P.push(new bl(R.p.x+k,R.p.y-k,k,r)),P.push(new bl(R.p.x-k,R.p.y+k,k,r)),P.push(new bl(R.p.x+k,R.p.y+k,k,r)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function Pw(r,t){return t.max-r.max}function bl(r,t,n,a){this.p=new re(r,t),this.h=n,this.d=function(c,m){let g=!1,y=1/0;for(let x=0;x<m.length;x++){const k=m[x];for(let P=0,C=k.length,A=C-1;P<C;A=P++){const R=k[P],B=k[A];R.y>c.y!=B.y>c.y&&c.x<(B.x-R.x)*(c.y-R.y)/(B.y-R.y)+R.x&&(g=!g),y=Math.min(y,Kg(c,R,B))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Or;S.aq=void 0,(Or=S.aq||(S.aq={}))[Or.center=1]="center",Or[Or.left=2]="left",Or[Or.right=3]="right",Or[Or.top=4]="top",Or[Or.bottom=5]="bottom",Or[Or["top-left"]=6]="top-left",Or[Or["top-right"]=7]="top-right",Or[Or["bottom-left"]=8]="bottom-left",Or[Or["bottom-right"]=9]="bottom-right";const _o=7,vf=Number.POSITIVE_INFINITY;function fy(r,t){return t[1]!==vf?function(n,a,c){let m=0,g=0;switch(a=Math.abs(a),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-_o;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+_o}switch(n){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,g]}(r,t[0],t[1]):function(n,a){let c=0,m=0;a<0&&(a=0);const g=a/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-_o;break;case"bottom-right":case"bottom-left":m=-g+_o;break;case"bottom":m=-a+_o;break;case"top":m=a-_o}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=a;break;case"right":c=-a}return[c,m]}(r,t[0])}function my(r,t,n){var a;const c=r.layout,m=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},n);if(m){const y=m.values,x=[];for(let k=0;k<y.length;k+=2){const P=x[k]=y[k],C=y[k+1].map(A=>A*yr);P.startsWith("top")?C[1]-=_o:P.startsWith("bottom")&&(C[1]+=_o),x[k+1]=C}return new Ci(x)}const g=c.get("text-variable-anchor");if(g){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*yr,vf]:c.get("text-offset").evaluate(t,{},n).map(k=>k*yr);const x=[];for(const k of g)x.push(k,fy(k,y));return new Ci(x)}return null}function xf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ew(r,t,n,a,c,m,g,y,x,k,P){let C=m.textMaxSize.evaluate(t,{});C===void 0&&(C=g);const A=r.layers[0].layout,R=A.get("icon-offset").evaluate(t,{},P),B=_y(n.horizontal),O=g/24,$=r.tilePixelRatio*O,X=r.tilePixelRatio*C/24,de=r.tilePixelRatio*y,ee=r.tilePixelRatio*A.get("symbol-spacing"),ae=A.get("text-padding")*r.tilePixelRatio,ge=function(ye,Qe,Je,ut=1){const Ut=ye.get("icon-padding").evaluate(Qe,{},Je),jt=Ut&&Ut.values;return[jt[0]*ut,jt[1]*ut,jt[2]*ut,jt[3]*ut]}(A,t,P,r.tilePixelRatio),be=A.get("text-max-angle")/180*Math.PI,Ve=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",st=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Oe=A.get("symbol-placement"),De=ee/2,Ye=A.get("icon-text-fit");let qe;a&&Ye!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(qe=V_(a,n.vertical,Ye,A.get("icon-text-fit-padding"),R,O)),B&&(a=V_(a,B,Ye,A.get("icon-text-fit-padding"),R,O)));const $e=(ye,Qe)=>{Qe.x<0||Qe.x>=gr||Qe.y<0||Qe.y>=gr||function(Je,ut,Ut,jt,br,vn,Nr,Sr,ai,li,ui,or,Tr,Wr,Vr,ci,jr,en,bi,Mt,Zt,Kt,Fi,tr,Sl){const Yn=Je.addToLineVertexArray(ut,Ut);let Qn,xn,tn,Er,Ts=0,ac=0,wy=0,by=0,Ef=-1,Cf=-1;const ks={};let Sy=ul("");if(Je.allowVerticalPlacement&&jt.vertical){const Xr=Sr.layout.get("text-rotate").evaluate(Zt,{},tr)+90;tn=new Kh(ai,ut,li,ui,or,jt.vertical,Tr,Wr,Vr,Xr),Nr&&(Er=new Kh(ai,ut,li,ui,or,Nr,jr,en,Vr,Xr))}if(br){const Xr=Sr.layout.get("icon-rotate").evaluate(Zt,{}),rn=Sr.layout.get("icon-text-fit")!=="none",fa=dy(br,Xr,Fi,rn),Ln=Nr?dy(Nr,Xr,Fi,rn):void 0;xn=new Kh(ai,ut,li,ui,or,br,jr,en,!1,Xr),Ts=4*fa.length;const ma=Je.iconSizeData;let es=null;ma.kind==="source"?(es=[Jn*Sr.layout.get("icon-size").evaluate(Zt,{})],es[0]>fo&&Ot(`${Je.layerIds[0]}: Value for "icon-size" is >= ${rc}. Reduce your "icon-size".`)):ma.kind==="composite"&&(es=[Jn*Kt.compositeIconSizes[0].evaluate(Zt,{},tr),Jn*Kt.compositeIconSizes[1].evaluate(Zt,{},tr)],(es[0]>fo||es[1]>fo)&&Ot(`${Je.layerIds[0]}: Value for "icon-size" is >= ${rc}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,fa,es,Mt,bi,Zt,S.ah.none,ut,Yn.lineStartIndex,Yn.lineLength,-1,tr),Ef=Je.icon.placedSymbolArray.length-1,Ln&&(ac=4*Ln.length,Je.addSymbols(Je.icon,Ln,es,Mt,bi,Zt,S.ah.vertical,ut,Yn.lineStartIndex,Yn.lineLength,-1,tr),Cf=Je.icon.placedSymbolArray.length-1)}const Ty=Object.keys(jt.horizontal);for(const Xr of Ty){const rn=jt.horizontal[Xr];if(!Qn){Sy=ul(rn.text);const Ln=Sr.layout.get("text-rotate").evaluate(Zt,{},tr);Qn=new Kh(ai,ut,li,ui,or,rn,Tr,Wr,Vr,Ln)}const fa=rn.positionedLines.length===1;if(wy+=gy(Je,ut,rn,vn,Sr,Vr,Zt,ci,Yn,jt.vertical?S.ah.horizontal:S.ah.horizontalOnly,fa?Ty:[Xr],ks,Ef,Kt,tr),fa)break}jt.vertical&&(by+=gy(Je,ut,jt.vertical,vn,Sr,Vr,Zt,ci,Yn,S.ah.vertical,["vertical"],ks,Cf,Kt,tr));const zw=Qn?Qn.boxStartIndex:Je.collisionBoxArray.length,Aw=Qn?Qn.boxEndIndex:Je.collisionBoxArray.length,Dw=tn?tn.boxStartIndex:Je.collisionBoxArray.length,Lw=tn?tn.boxEndIndex:Je.collisionBoxArray.length,Rw=xn?xn.boxStartIndex:Je.collisionBoxArray.length,Fw=xn?xn.boxEndIndex:Je.collisionBoxArray.length,Bw=Er?Er.boxStartIndex:Je.collisionBoxArray.length,Ow=Er?Er.boxEndIndex:Je.collisionBoxArray.length;let Dn=-1;const Yh=(Xr,rn)=>Xr&&Xr.circleDiameter?Math.max(Xr.circleDiameter,rn):rn;Dn=Yh(Qn,Dn),Dn=Yh(tn,Dn),Dn=Yh(xn,Dn),Dn=Yh(Er,Dn);const ky=Dn>-1?1:0;ky&&(Dn*=Sl/yr),Je.glyphOffsetArray.length>=xl.MAX_GLYPHS&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,Zt.sortKey);const Nw=my(Sr,Zt,tr),[Vw,jw]=function(Xr,rn){const fa=Xr.length,Ln=rn==null?void 0:rn.values;if((Ln==null?void 0:Ln.length)>0)for(let ma=0;ma<Ln.length;ma+=2){const es=Ln[ma+1];Xr.emplaceBack(S.aq[Ln[ma]],es[0],es[1])}return[fa,Xr.length]}(Je.textAnchorOffsets,Nw);Je.symbolInstances.emplaceBack(ut.x,ut.y,ks.right>=0?ks.right:-1,ks.center>=0?ks.center:-1,ks.left>=0?ks.left:-1,ks.vertical||-1,Ef,Cf,Sy,zw,Aw,Dw,Lw,Rw,Fw,Bw,Ow,li,wy,by,Ts,ac,ky,0,Tr,Dn,Vw,jw)}(r,Qe,ye,n,a,c,qe,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,$,[ae,ae,ae,ae],Ve,x,de,ge,st,R,t,m,k,P,g)};if(Oe==="line")for(const ye of oy(t.geometry,0,0,gr,gr)){const Qe=Tw(ye,ee,be,n.vertical||B,a,24,X,r.overscaling,gr);for(const Je of Qe)B&&Cw(r,B.text,De,Je)||$e(ye,Je)}else if(Oe==="line-center"){for(const ye of t.geometry)if(ye.length>1){const Qe=Sw(ye,be,n.vertical||B,a,24,X);Qe&&$e(ye,Qe)}}else if(t.type==="Polygon")for(const ye of Na(t.geometry,0)){const Qe=Iw(ye,16);$e(ye[0],new go(Qe.x,Qe.y,0))}else if(t.type==="LineString")for(const ye of t.geometry)$e(ye,new go(ye[0].x,ye[0].y,0));else if(t.type==="Point")for(const ye of t.geometry)for(const Qe of ye)$e([Qe],new go(Qe.x,Qe.y,0))}function gy(r,t,n,a,c,m,g,y,x,k,P,C,A,R,B){const O=function(de,ee,ae,ge,be,Ve,st,Oe){const De=ge.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Ye=[];for(const qe of ee.positionedLines)for(const $e of qe.positionedGlyphs){if(!$e.rect)continue;const ye=$e.rect||{};let Qe=A_+1,Je=!0,ut=1,Ut=0;const jt=(be||Oe)&&$e.vertical,br=$e.metrics.advance*$e.scale/2;if(Oe&&ee.verticalizable&&(Ut=qe.lineOffset/2-($e.imageName?-(yr-$e.metrics.width*$e.scale)/2:($e.scale-1)*yr)),$e.imageName){const Mt=st[$e.imageName];Je=Mt.sdf,ut=Mt.pixelRatio,Qe=wi/ut}const vn=be?[$e.x+br,$e.y]:[0,0];let Nr=be?[0,0]:[$e.x+br+ae[0],$e.y+ae[1]-Ut],Sr=[0,0];jt&&(Sr=Nr,Nr=[0,0]);const ai=$e.metrics.isDoubleResolution?2:1,li=($e.metrics.left-Qe)*$e.scale-br+Nr[0],ui=(-$e.metrics.top-Qe)*$e.scale+Nr[1],or=li+ye.w/ai*$e.scale/ut,Tr=ui+ye.h/ai*$e.scale/ut,Wr=new re(li,ui),Vr=new re(or,ui),ci=new re(li,Tr),jr=new re(or,Tr);if(jt){const Mt=new re(-br,br-ec),Zt=-Math.PI/2,Kt=yr/2-br,Fi=new re(5-ec-Kt,-($e.imageName?Kt:0)),tr=new re(...Sr);Wr._rotateAround(Zt,Mt)._add(Fi)._add(tr),Vr._rotateAround(Zt,Mt)._add(Fi)._add(tr),ci._rotateAround(Zt,Mt)._add(Fi)._add(tr),jr._rotateAround(Zt,Mt)._add(Fi)._add(tr)}if(De){const Mt=Math.sin(De),Zt=Math.cos(De),Kt=[Zt,-Mt,Mt,Zt];Wr._matMult(Kt),Vr._matMult(Kt),ci._matMult(Kt),jr._matMult(Kt)}const en=new re(0,0),bi=new re(0,0);Ye.push({tl:Wr,tr:Vr,bl:ci,br:jr,tex:ye,writingMode:ee.writingMode,glyphOffset:vn,sectionIndex:$e.sectionIndex,isSDF:Je,pixelOffsetTL:en,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,n,y,c,m,g,a,r.allowVerticalPlacement),$=r.textSizeData;let X=null;$.kind==="source"?(X=[Jn*c.layout.get("text-size").evaluate(g,{})],X[0]>fo&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= ${rc}. Reduce your "text-size".`)):$.kind==="composite"&&(X=[Jn*R.compositeTextSizes[0].evaluate(g,{},B),Jn*R.compositeTextSizes[1].evaluate(g,{},B)],(X[0]>fo||X[1]>fo)&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= ${rc}. Reduce your "text-size".`)),r.addSymbols(r.text,O,X,y,m,g,k,t,x.lineStartIndex,x.lineLength,A,B);for(const de of P)C[de]=r.text.placedSymbolArray.length-1;return 4*O.length}function _y(r){for(const t in r)return r[t];return null}function Cw(r,t,n,a){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(a),!1}const yy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=yy[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new wf(y,g,m,t)}constructor(t,n=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=yy.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=n,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return bf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:y}=this,x=[0,m.length-1,0],k=[];for(;x.length;){const P=x.pop()||0,C=x.pop()||0,A=x.pop()||0;if(C-A<=y){for(let $=A;$<=C;$++){const X=g[2*$],de=g[2*$+1];X>=t&&X<=a&&de>=n&&de<=c&&k.push(m[$])}continue}const R=A+C>>1,B=g[2*R],O=g[2*R+1];B>=t&&B<=a&&O>=n&&O<=c&&k.push(m[R]),(P===0?t<=B:n<=O)&&(x.push(A),x.push(R-1),x.push(1-P)),(P===0?a>=B:c>=O)&&(x.push(R+1),x.push(C),x.push(1-P))}return k}within(t,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,y=[0,c.length-1,0],x=[],k=a*a;for(;y.length;){const P=y.pop()||0,C=y.pop()||0,A=y.pop()||0;if(C-A<=g){for(let $=A;$<=C;$++)xy(m[2*$],m[2*$+1],t,n)<=k&&x.push(c[$]);continue}const R=A+C>>1,B=m[2*R],O=m[2*R+1];xy(B,O,t,n)<=k&&x.push(c[R]),(P===0?t-a<=B:n-a<=O)&&(y.push(A),y.push(R-1),y.push(1-P)),(P===0?t+a>=B:n+a>=O)&&(y.push(R+1),y.push(C),y.push(1-P))}return x}}function bf(r,t,n,a,c,m){if(c-a<=n)return;const g=a+c>>1;vy(r,t,g,a,c,m),bf(r,t,n,a,g-1,1-m),bf(r,t,n,g+1,c,1-m)}function vy(r,t,n,a,c,m){for(;c>a;){if(c-a>600){const k=c-a+1,P=n-a+1,C=Math.log(k),A=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*A*(k-A)/k)*(P-k/2<0?-1:1);vy(r,t,n,Math.max(a,Math.floor(n-P*A/k+R)),Math.min(c,Math.floor(n+(k-P)*A/k+R)),m)}const g=t[2*n+m];let y=a,x=c;for(sc(r,t,a,n),t[2*c+m]>g&&sc(r,t,a,c);y<x;){for(sc(r,t,y,x),y++,x--;t[2*y+m]<g;)y++;for(;t[2*x+m]>g;)x--}t[2*a+m]===g?sc(r,t,a,x):(x++,sc(r,t,x,c)),x<=n&&(a=x+1),n<=x&&(c=x-1)}}function sc(r,t,n,a){Sf(r,n,a),Sf(t,2*n,2*a),Sf(t,2*n+1,2*a+1)}function Sf(r,t,n){const a=r[t];r[t]=r[n],r[n]=a}function xy(r,t,n,a){const c=r-n,m=t-a;return c*c+m*m}var Tf;S.bg=void 0,(Tf=S.bg||(S.bg={})).create="create",Tf.load="load",Tf.fullLoad="fullLoad";let Jh=null,oc=[];const kf=1e3/60,If="loadTime",Pf="fullLoadTime",Mw={mark(r){performance.mark(r)},frame(r){const t=r;Jh!=null&&oc.push(t-Jh),Jh=t},clearMetrics(){Jh=null,oc=[],performance.clearMeasures(If),performance.clearMeasures(Pf);for(const r in S.bg)performance.clearMarks(S.bg[r])},getPerformanceMetrics(){performance.measure(If,S.bg.create,S.bg.load),performance.measure(Pf,S.bg.create,S.bg.fullLoad);const r=performance.getEntriesByName(If)[0].duration,t=performance.getEntriesByName(Pf)[0].duration,n=oc.length,a=1/(oc.reduce((m,g)=>m+g,0)/n/1e3),c=oc.filter(m=>m>kf).reduce((m,g)=>m+(g-kf)/kf,0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=class extends M{},S.A=fl,S.B=Lp,S.C=function(r){if(cn==null){const t=r.navigator?r.navigator.userAgent:null;cn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return cn},S.D=Xe,S.E=Fs,S.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ww(()=>this.process()),this.subscription=function(n,a,c,m){return n.addEventListener(a,c,!1),{unsubscribe:()=>{n.removeEventListener(a,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Ar(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:to(r.data,m)});this.target.postMessage(g,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const a=this.abortControllers[n];return delete this.abortControllers[n],void(a&&a.abort())}if(Ar(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(ro(t.error)):c.resolve(ro(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ro(t.data),a=new AbortController;this.abortControllers[r]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,a);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,t,n){const a=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?to(t):null,data:to(n,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=ti,S.H=function(){var r=new fl(16);return fl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.I=lf,S.J=function(r,t,n){var a,c,m,g,y,x,k,P,C,A,R,B,O=n[0],$=n[1],X=n[2];return t===r?(r[12]=t[0]*O+t[4]*$+t[8]*X+t[12],r[13]=t[1]*O+t[5]*$+t[9]*X+t[13],r[14]=t[2]*O+t[6]*$+t[10]*X+t[14],r[15]=t[3]*O+t[7]*$+t[11]*X+t[15]):(c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],P=t[7],C=t[8],A=t[9],R=t[10],B=t[11],r[0]=a=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=y,r[5]=x,r[6]=k,r[7]=P,r[8]=C,r[9]=A,r[10]=R,r[11]=B,r[12]=a*O+y*$+C*X+t[12],r[13]=c*O+x*$+A*X+t[13],r[14]=m*O+k*$+R*X+t[14],r[15]=g*O+P*$+B*X+t[15]),r},S.K=function(r,t,n){var a=n[0],c=n[1],m=n[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.L=e_,S.M=function(r,t){const n={};for(let a=0;a<t.length;a++){const c=t[a];c in r&&(n[c]=r[c])}return n},S.N=mo,S.O=X_,S.P=re,S.Q=K_,S.R=Yi,S.S=Qi,S.T=nl,S.U=ce,S.V=ie,S.W=dt,S.X=gr,S.Y=v,S.Z=ic,S._=d,S.a=Dr,S.a$=function(r,t){var n=r[0],a=r[1],c=r[2],m=r[3],g=r[4],y=r[5],x=r[6],k=r[7],P=r[8],C=r[9],A=r[10],R=r[11],B=r[12],O=r[13],$=r[14],X=r[15],de=t[0],ee=t[1],ae=t[2],ge=t[3],be=t[4],Ve=t[5],st=t[6],Oe=t[7],De=t[8],Ye=t[9],qe=t[10],$e=t[11],ye=t[12],Qe=t[13],Je=t[14],ut=t[15];return Math.abs(n-de)<=oi*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(a-ee)<=oi*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-ae)<=oi*Math.max(1,Math.abs(c),Math.abs(ae))&&Math.abs(m-ge)<=oi*Math.max(1,Math.abs(m),Math.abs(ge))&&Math.abs(g-be)<=oi*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(y-Ve)<=oi*Math.max(1,Math.abs(y),Math.abs(Ve))&&Math.abs(x-st)<=oi*Math.max(1,Math.abs(x),Math.abs(st))&&Math.abs(k-Oe)<=oi*Math.max(1,Math.abs(k),Math.abs(Oe))&&Math.abs(P-De)<=oi*Math.max(1,Math.abs(P),Math.abs(De))&&Math.abs(C-Ye)<=oi*Math.max(1,Math.abs(C),Math.abs(Ye))&&Math.abs(A-qe)<=oi*Math.max(1,Math.abs(A),Math.abs(qe))&&Math.abs(R-$e)<=oi*Math.max(1,Math.abs(R),Math.abs($e))&&Math.abs(B-ye)<=oi*Math.max(1,Math.abs(B),Math.abs(ye))&&Math.abs(O-Qe)<=oi*Math.max(1,Math.abs(O),Math.abs(Qe))&&Math.abs($-Je)<=oi*Math.max(1,Math.abs($),Math.abs(Je))&&Math.abs(X-ut)<=oi*Math.max(1,Math.abs(X),Math.abs(ut))},S.a0=St,S.a1=yf,S.a2=Ie,S.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const a of r){const c=window.document.createElement("source");as(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}})},S.a4=function(){return Se++},S.a5=Ne,S.a6=xl,S.a7=Su,S.a8=da,S.a9=ry,S.aA=function(r){if(r.type==="custom")return new xw(r);switch(r.type){case"background":return new _w(r);case"circle":return new n1(r);case"fill":return new w1(r);case"fill-extrusion":return new F1(r);case"heatmap":return new o1(r);case"hillshade":return new l1(r);case"line":return new Z1(r);case"raster":return new vw(r);case"symbol":return new Gh(r)}},S.aB=ht,S.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!zt(r.version,t.version))return[{command:"setStyle",args:[t]}];zt(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),zt(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),zt(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),zt(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),zt(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),zt(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),zt(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),zt(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),zt(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),zt(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),zt(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(g,y,x,k){let P;for(P in y=y||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(Object.prototype.hasOwnProperty.call(y,P)||Zn(P,x,k));for(P in y)Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(g,P)?zt(g[P],y[P])||(g[P].type==="geojson"&&y[P].type==="geojson"&&Bs(g,y,P)?Qt(x,{command:"setGeoJSONSourceData",args:[P,y[P].data]}):En(P,y,x,k)):Vo(P,y,x))})(r.sources,t.sources,c,a);const m=[];r.layers&&r.layers.forEach(g=>{"source"in g&&a[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,y,x){y=y||[];const k=(g=g||[]).map(jo),P=y.map(jo),C=g.reduce(Uo,{}),A=y.reduce(Uo,{}),R=k.slice(),B=Object.create(null);let O,$,X,de,ee;for(let ae=0,ge=0;ae<k.length;ae++)O=k[ae],Object.prototype.hasOwnProperty.call(A,O)?ge++:(Qt(x,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,ge),1));for(let ae=0,ge=0;ae<P.length;ae++)O=P[P.length-1-ae],R[R.length-1-ae]!==O&&(Object.prototype.hasOwnProperty.call(C,O)?(Qt(x,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-ge),1)):ge++,de=R[R.length-ae],Qt(x,{command:"addLayer",args:[A[O],de]}),R.splice(R.length-ae,0,O),B[O]=!0);for(let ae=0;ae<P.length;ae++)if(O=P[ae],$=C[O],X=A[O],!B[O]&&!zt($,X))if(zt($.source,X.source)&&zt($["source-layer"],X["source-layer"])&&zt($.type,X.type)){for(ee in Ei($.layout,X.layout,x,O,null,"setLayoutProperty"),Ei($.paint,X.paint,x,O,null,"setPaintProperty"),zt($.filter,X.filter)||Qt(x,{command:"setFilter",args:[O,X.filter]}),zt($.minzoom,X.minzoom)&&zt($.maxzoom,X.maxzoom)||Qt(x,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ei($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):zt($[ee],X[ee])||Qt(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}));for(ee in X)Object.prototype.hasOwnProperty.call(X,ee)&&!Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ei($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):zt($[ee],X[ee])||Qt(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}))}else Qt(x,{command:"removeLayer",args:[O]}),de=R[R.lastIndexOf(O)+1],Qt(x,{command:"addLayer",args:[X,de]})}(m,t.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:"setStyle",args:[t]}]}return n},S.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],n[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const a in t)if(!r(t[a],n[a]))return!1;return!0}return t===n},S.aF=it,S.aG=et,S.aH=class extends ua{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Dh,S.aJ=class extends ua{constructor(r,t){super(r,t),this.current=K0}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=$g,S.aL=Zg,S.aM=Bt,S.aN=class extends ua{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aO=class extends ua{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aP=function(r,t,n,a,c,m,g){var y=1/(t-n),x=1/(a-c),k=1/(m-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(t+n)*y,r[13]=(c+a)*x,r[14]=(g+m)*k,r[15]=1,r},S.aQ=i1,S.aR=class extends ne{},S.aS=W1,S.aT=class extends pe{},S.aU=Xp,S.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aW=s_,S.aX=Fr,S.aY=Ji,S.aZ=class extends Ke{},S.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,m)=>{const g=c||m;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ab=function(r,t){const n=[];for(const a in r)a in t||n.push(a);return n},S.ac=je,S.ad=function(r,t,n){var a=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],y=t[2],x=t[3],k=t[4],P=t[5],C=t[6],A=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+k*a,r[1]=g*c+P*a,r[2]=y*c+C*a,r[3]=x*c+A*a,r[4]=k*c-m*a,r[5]=P*c-g*a,r[6]=C*c-y*a,r[7]=A*c-x*a,r},S.ae=function(r){var t=new fl(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.af=Bh,S.ag=function(r,t){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,y=c?je(ni.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?a=ii.number(r.minSize,r.maxSize,y):n=y}return{uSizeT:n,uSize:a}},S.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/Jn:r.kind==="composite"?ii.number(a/Jn,c/Jn,n):t},S.aj=df,S.ak=function(r,t,n,a){const c=t.y-r.y,m=t.x-r.x,g=a.y-n.y,y=a.x-n.x,x=g*m-y*c;if(x===0)return null;const k=(y*(r.y-n.y)-g*(r.x-n.x))/x;return new re(r.x+k*m,r.y+k*c)},S.al=oy,S.am=Wg,S.an=Gp,S.ao=function(r){let t=1/0,n=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return[t,n,a,c]},S.ap=yr,S.ar=hf,S.as=function(r,t){var n=t[0],a=t[1],c=t[2],m=t[3],g=t[4],y=t[5],x=t[6],k=t[7],P=t[8],C=t[9],A=t[10],R=t[11],B=t[12],O=t[13],$=t[14],X=t[15],de=n*y-a*g,ee=n*x-c*g,ae=n*k-m*g,ge=a*x-c*y,be=a*k-m*y,Ve=c*k-m*x,st=P*O-C*B,Oe=P*$-A*B,De=P*X-R*B,Ye=C*$-A*O,qe=C*X-R*O,$e=A*X-R*$,ye=de*$e-ee*qe+ae*Ye+ge*De-be*Oe+Ve*st;return ye?(r[0]=(y*$e-x*qe+k*Ye)*(ye=1/ye),r[1]=(c*qe-a*$e-m*Ye)*ye,r[2]=(O*Ve-$*be+X*ge)*ye,r[3]=(A*be-C*Ve-R*ge)*ye,r[4]=(x*De-g*$e-k*Oe)*ye,r[5]=(n*$e-c*De+m*Oe)*ye,r[6]=($*ae-B*Ve-X*ee)*ye,r[7]=(P*Ve-A*ae+R*ee)*ye,r[8]=(g*qe-y*De+k*st)*ye,r[9]=(a*De-n*qe-m*st)*ye,r[10]=(B*be-O*ae+X*de)*ye,r[11]=(C*ae-P*be-R*de)*ye,r[12]=(y*Oe-g*Ye-x*st)*ye,r[13]=(n*Ye-a*Oe+c*st)*ye,r[14]=(O*ee-B*ge-$*de)*ye,r[15]=(P*ge-C*ee+A*de)*ye,r):null},S.at=xf,S.au=cf,S.av=wf,S.aw=function(){const r={},t=me.$version;for(const n in me.$root){const a=me.$root[n];if(a.required){let c=null;c=n==="version"?t:a.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Bu,S.ay=$i,S.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=No(r[n],t[r[n].ref]));return r},S.b=Qr,S.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},S.b3=He,S.b4=Q_,S.b5=J_,S.b6=function(r,t,n,a,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+a)*(m=1/(a-c)),r[14]=2*c*a*m):(r[10]=-1,r[14]=-2*a),r},S.b7=function(r,t,n){var a=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],y=t[6],x=t[7],k=t[8],P=t[9],C=t[10],A=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+k*a,r[5]=g*c+P*a,r[6]=y*c+C*a,r[7]=x*c+A*a,r[8]=k*c-m*a,r[9]=P*c-g*a,r[10]=C*c-y*a,r[11]=A*c-x*a,r},S.b8=ue,S.b9=Te,S.bA=k_,S.bB=function(r){return r.message===Rt},S.bC=Xs,S.bD=vi,S.ba=function(r){return r*Math.PI/180},S.bb=function(r,t){const{x:n,y:a}=ic.fromLngLat(t);return!(r<0||r>25||a<0||a>=1||n<0||n>=1)},S.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bd=class extends E{},S.be=gf,S.bf=Mw,S.bh=xr,S.bi=function(r,t){Dr.REGISTERED_PROTOCOLS[r]=t},S.bj=function(r){delete Dr.REGISTERED_PROTOCOLS[r]},S.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||wh(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const a=[];for(const c in n)a.push(n[c]);return a},S.bl=Ze,S.bm=ty,S.bn=iy,S.bo=L_,S.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=gr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Gt(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Gt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:P}=r.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Gt(k),r.canonical),a["text-size"].possiblyEvaluate(new Gt(P),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:P}=r.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Gt(k),r.canonical),a["icon-size"].possiblyEvaluate(new Gt(P),r.canonical)]}const m=n.get("text-line-height")*yr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const k of r.bucket.features){const P=n.get("text-font").evaluate(k,{},r.canonical).join(","),C=x.evaluate(k,{},r.canonical),A=c.layoutTextSize.evaluate(k,{},r.canonical),R=c.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},O=k.text;let $,X=[0,0];if(O){const ae=O.toString(),ge=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*yr,be=Rp(ae)?ge:0,Ve=n.get("text-anchor").evaluate(k,{},r.canonical),st=my(t,k,r.canonical);if(!st){const qe=n.get("text-radial-offset").evaluate(k,{},r.canonical);X=qe?fy(Ve,[qe*yr,vf]):n.get("text-offset").evaluate(k,{},r.canonical).map($e=>$e*yr)}let Oe=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const De=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*yr:1/0,Ye=()=>{r.bucket.allowVerticalPlacement&&Ou(ae)&&(B.vertical=$h(O,r.glyphMap,r.glyphPositions,r.imagePositions,P,De,m,Ve,"left",be,X,S.ah.vertical,!0,A,C))};if(!g&&st){const qe=new Set;if(Oe==="auto")for(let ye=0;ye<st.values.length;ye+=2)qe.add(xf(st.values[ye]));else qe.add(Oe);let $e=!1;for(const ye of qe)if(!B.horizontal[ye])if($e)B.horizontal[ye]=B.horizontal[0];else{const Qe=$h(O,r.glyphMap,r.glyphPositions,r.imagePositions,P,De,m,"center",ye,be,X,S.ah.horizontal,!1,A,C);Qe&&(B.horizontal[ye]=Qe,$e=Qe.positionedLines.length===1)}Ye()}else{Oe==="auto"&&(Oe=xf(Ve));const qe=$h(O,r.glyphMap,r.glyphPositions,r.imagePositions,P,De,m,Ve,Oe,be,X,S.ah.horizontal,!1,A,C);qe&&(B.horizontal[Oe]=qe),Ye(),Ou(ae)&&g&&y&&(B.vertical=$h(O,r.glyphMap,r.glyphPositions,r.imagePositions,P,De,m,Ve,Oe,be,X,S.ah.vertical,!1,A,C))}}let de=!1;if(k.icon&&k.icon.name){const ae=r.imageMap[k.icon.name];ae&&($=dw(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),de=!!ae.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=de:r.bucket.sdfIcons!==de&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ee=_y(B.horizontal)||B.vertical;r.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||$)&&Ew(r.bucket,k,B,$,r.imageMap,c,A,R,X,de,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bq=nf,S.br=ef,S.bs=rf,S.bt=ho,S.bu=of,S.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bw=function(r,t,n,a,c){return d(this,void 0,void 0,function*(){if(ie())try{return yield dt(r,t,n,a,c)}catch{}return function(m,g,y,x,k){const P=m.width,C=m.height;pt&&kt||(pt=new OffscreenCanvas(P,C),kt=pt.getContext("2d",{willReadFrequently:!0})),pt.width=P,pt.height=C,kt.drawImage(m,0,0,P,C);const A=kt.getImageData(g,y,x,k);return kt.clearRect(0,0,P,C),A.data}(r,t,n,a,c)})},S.bx=ey,S.by=G,S.bz=le,S.c=Ui,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=Ge,S.f=r=>new Promise((t,n)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=We})},a.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});a.src=r.byteLength?URL.createObjectURL(c):We}),S.g=ei,S.h=(r,t)=>os(Ge(r,{type:"json"}),t),S.i=Ar,S.j=$n,S.k=Un,S.l=(r,t)=>os(Ge(r,{type:"arrayBuffer"}),t),S.m=os,S.n=function(r){return new of(r).readFields(sw,[])},S.o=Hu,S.p=D_,S.q=f,S.r=Dp,S.s=as,S.t=Ru,S.u=xs,S.v=me,S.w=Ot,S.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.y=ii,S.z=Gt}),b("worker",["./shared"],function(S){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const Z of L){this._layerConfigs[Z.id]=Z;const te=this._layers[Z.id]=S.aA(Z);te._featureFilter=S.a7(te.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of D)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const N=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const Z of N){const te=Z.map(fe=>this._layers[fe.id]),se=te[0];if(se.visibility==="none")continue;const he=se.source||"";let Y=this.familiesBySource[he];Y||(Y=this.familiesBySource[he]={});const _e=se.sourceLayer||"_geojsonTileLayer";let we=Y[_e];we||(we=Y[_e]=[]),we.push(te)}}}class G{constructor(L){const D={},N=[];for(const he in L){const Y=L[he],_e=D[he]={};for(const we in Y){const fe=Y[+we];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Ee={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};N.push(Ee),_e[we]={rect:Ee,metrics:fe.metrics}}}const{w:Z,h:te}=S.p(N),se=new S.o({width:Z||1,height:te||1});for(const he in L){const Y=L[he];for(const _e in Y){const we=Y[+_e];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const fe=D[he][_e].rect;S.o.copy(we.bitmap,se,{x:0,y:0},{x:fe.x+1,y:fe.y+1},we.bitmap)}}this.image=se,this.positions=D}}S.bl("GlyphAtlas",G);class le{constructor(L){this.tileID=new S.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,N,Z){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new S.a5;const te=new S.bm(Object.keys(L.layers).sort()),se=new S.bn(this.tileID,this.promoteId);se.bucketLayerIDs=[];const he={},Y={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},_e=D.familiesBySource[this.source];for(const yt in _e){const Ft=L.layers[yt];if(!Ft)continue;Ft.version===1&&S.w(`Vector tile source "${this.source}" layer "${yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Jt=te.encode(yt),wr=[];for(let Ir=0;Ir<Ft.length;Ir++){const qr=Ft.feature(Ir),Os=se.getId(qr,yt);wr.push({feature:qr,id:Os,index:Ir,sourceLayerIndex:Jt})}for(const Ir of _e[yt]){const qr=Ir[0];qr.source!==this.source&&S.w(`layer.source = ${qr.source} does not equal this.source = ${this.source}`),qr.minzoom&&this.zoom<Math.floor(qr.minzoom)||qr.maxzoom&&this.zoom>=qr.maxzoom||qr.visibility!=="none"&&(xe(Ir,this.zoom,N),(he[qr.id]=qr.createBucket({index:se.bucketLayerIDs.length,layers:Ir,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jt,sourceID:this.source})).populate(wr,Y,this.tileID.canonical),se.bucketLayerIDs.push(Ir.map(Os=>Os.id)))}}const we=S.aF(Y.glyphDependencies,yt=>Object.keys(yt).map(Number));this.inFlightDependencies.forEach(yt=>yt==null?void 0:yt.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(we).length){const yt=new AbortController;this.inFlightDependencies.push(yt),fe=Z.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},yt)}const Ee=Object.keys(Y.iconDependencies);let tt=Promise.resolve({});if(Ee.length){const yt=new AbortController;this.inFlightDependencies.push(yt),tt=Z.sendAsync({type:"GI",data:{icons:Ee,source:this.source,tileID:this.tileID,type:"icons"}},yt)}const nt=Object.keys(Y.patternDependencies);let It=Promise.resolve({});if(nt.length){const yt=new AbortController;this.inFlightDependencies.push(yt),It=Z.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},yt)}const[mt,Pt,xt]=yield Promise.all([fe,tt,It]),fr=new G(mt),er=new S.bo(Pt,xt);for(const yt in he){const Ft=he[yt];Ft instanceof S.a6?(xe(Ft.layers,this.zoom,N),S.bp({bucket:Ft,glyphMap:mt,glyphPositions:fr.positions,imageMap:Pt,imagePositions:er.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ft.hasPattern&&(Ft instanceof S.bq||Ft instanceof S.br||Ft instanceof S.bs)&&(xe(Ft.layers,this.zoom,N),Ft.addFeatures(Y,this.tileID.canonical,er.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(yt=>!yt.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fr.image,imageAtlas:er,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?Pt:null,glyphPositions:this.returnDependencies?fr.positions:null}})}}function xe(W,L,D){const N=new S.z(L);for(const Z of W)Z.recalculate(N,D)}class re{constructor(L,D,N){this.actor=L,this.layerIndex=D,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=yield S.l(L.request,D);try{return{vectorTile:new S.bt.VectorTile(new S.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(Z){const te=new Uint8Array(N.data);let se=`Unable to parse the tile at ${L.request.url}, `;throw se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Z.message}`,new Error(se)}})}loadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid,N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request),Z=new le(L);this.loading[D]=Z;const te=new AbortController;Z.abort=te;try{const se=yield this.loadVectorTile(L,te);if(delete this.loading[D],!se)return null;const he=se.rawData,Y={};se.expires&&(Y.expires=se.expires),se.cacheControl&&(Y.cacheControl=se.cacheControl);const _e={};if(N){const fe=N.finish();fe&&(_e.resourceTiming=JSON.parse(JSON.stringify(fe)))}Z.vectorTile=se.vectorTile;const we=Z.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=Z,this.fetching[D]={rawTileData:he,cacheControl:Y,resourceTiming:_e};try{const fe=yield we;return S.e({rawTileData:he.slice(0)},fe,Y,_e)}finally{delete this.fetching[D]}}catch(se){throw delete this.loading[D],Z.status="done",this.loaded[D]=Z,se}})}reloadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[D];if(N.showCollisionBoxes=L.showCollisionBoxes,N.status==="parsing"){const Z=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[D]){const{rawTileData:se,cacheControl:he,resourceTiming:Y}=this.fetching[D];delete this.fetching[D],te=S.e({rawTileData:se.slice(0)},Z,he,Y)}else te=Z;return te}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return S._(this,void 0,void 0,function*(){const D=this.loading,N=L.uid;D&&D[N]&&D[N].abort&&(D[N].abort.abort(),delete D[N])})}removeTile(L){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class H{constructor(){this.loaded={}}loadTile(L){return S._(this,void 0,void 0,function*(){const{uid:D,encoding:N,rawImageData:Z,redFactor:te,greenFactor:se,blueFactor:he,baseShift:Y}=L,_e=Z.width+2,we=Z.height+2,fe=S.b(Z)?new S.R({width:_e,height:we},yield S.bw(Z,-1,-1,_e,we)):Z,Ee=new S.bx(D,fe,N,te,se,he,Y);return this.loaded=this.loaded||{},this.loaded[D]=Ee,Ee})}removeTile(L){const D=this.loaded,N=L.uid;D&&D[N]&&delete D[N]}}function Le(W,L){if(W.length!==0){Fe(W[0],L);for(var D=1;D<W.length;D++)Fe(W[D],!L)}}function Fe(W,L){for(var D=0,N=0,Z=0,te=W.length,se=te-1;Z<te;se=Z++){var he=(W[Z][0]-W[se][0])*(W[se][1]+W[Z][1]),Y=D+he;N+=Math.abs(D)>=Math.abs(he)?D-Y+he:he-Y+D,D=Y}D+N>=0!=!!L&&W.reverse()}var Be=S.by(function W(L,D){var N,Z=L&&L.type;if(Z==="FeatureCollection")for(N=0;N<L.features.length;N++)W(L.features[N],D);else if(Z==="GeometryCollection")for(N=0;N<L.geometries.length;N++)W(L.geometries[N],D);else if(Z==="Feature")W(L.geometry,D);else if(Z==="Polygon")Le(L.coordinates,D);else if(Z==="MultiPolygon")for(N=0;N<L.coordinates.length;N++)Le(L.coordinates[N],D);return L});const Tt=S.bt.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},ie=S.bz,ue=S.bt.VectorTileFeature,Te=je;function je(W,L){this.options=L||{},this.features=W,this.length=W.length}function He(W,L){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=L||4096}je.prototype.feature=function(W){return new He(this.features[W],this.options.extent)},He.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var L=0;L<W.length;L++){for(var D=W[L],N=[],Z=0;Z<D.length;Z++)N.push(new ie(D[Z][0],D[Z][1]));this.geometry.push(N)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,L=1/0,D=-1/0,N=1/0,Z=-1/0,te=0;te<W.length;te++)for(var se=W[te],he=0;he<se.length;he++){var Y=se[he];L=Math.min(L,Y.x),D=Math.max(D,Y.x),N=Math.min(N,Y.y),Z=Math.max(Z,Y.y)}return[L,N,D,Z]},He.prototype.toGeoJSON=ue.prototype.toGeoJSON;var Ge=S.bA,Se=Te;function it(W){var L=new Ge;return function(D,N){for(var Z in D.layers)N.writeMessage(3,et,D.layers[Z])}(W,L),L.finish()}function et(W,L){var D;L.writeVarintField(15,W.version||1),L.writeStringField(1,W.name||""),L.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)N.feature=W.feature(D),L.writeMessage(2,ht,N);var Z=N.keys;for(D=0;D<Z.length;D++)L.writeStringField(3,Z[D]);var te=N.values;for(D=0;D<te.length;D++)L.writeMessage(4,cn,te[D])}function ht(W,L){var D=W.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,zr,W),L.writeVarintField(3,D.type),L.writeMessage(4,Ar,D)}function zr(W,L){var D=W.feature,N=W.keys,Z=W.values,te=W.keycache,se=W.valuecache;for(var he in D.properties){var Y=D.properties[he],_e=te[he];if(Y!==null){_e===void 0&&(N.push(he),te[he]=_e=N.length-1),L.writeVarint(_e);var we=typeof Y;we!=="string"&&we!=="boolean"&&we!=="number"&&(Y=JSON.stringify(Y));var fe=we+":"+Y,Ee=se[fe];Ee===void 0&&(Z.push(Y),se[fe]=Ee=Z.length-1),L.writeVarint(Ee)}}}function Ot(W,L){return(L<<3)+(7&W)}function lr(W){return W<<1^W>>31}function Ar(W,L){for(var D=W.loadGeometry(),N=W.type,Z=0,te=0,se=D.length,he=0;he<se;he++){var Y=D[he],_e=1;N===1&&(_e=Y.length),L.writeVarint(Ot(1,_e));for(var we=N===3?Y.length-1:Y.length,fe=0;fe<we;fe++){fe===1&&N!==1&&L.writeVarint(Ot(2,we-1));var Ee=Y[fe].x-Z,tt=Y[fe].y-te;L.writeVarint(lr(Ee)),L.writeVarint(lr(tt)),Z+=Ee,te+=tt}N===3&&L.writeVarint(Ot(7,1))}}function cn(W,L){var D=typeof W;D==="string"?L.writeStringField(1,W):D==="boolean"?L.writeBooleanField(7,W):D==="number"&&(W%1!=0?L.writeDoubleField(3,W):W<0?L.writeSVarintField(6,W):L.writeVarintField(5,W))}ce.exports=it,ce.exports.fromVectorTileJs=it,ce.exports.fromGeojsonVt=function(W,L){L=L||{};var D={};for(var N in W)D[N]=new Se(W[N].features,L),D[N].name=N,D[N].version=L.version,D[N].extent=L.extent;return it({layers:D})},ce.exports.GeoJSONWrapper=Se;var Qr=S.by(ce.exports);const We={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},dt=Math.fround||(pt=new Float32Array(1),W=>(pt[0]=+W,pt[0]));var pt;const kt=3,Rt=5,Ui=6;class Dr{constructor(L){this.options=Object.assign(Object.create(We),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:N,maxZoom:Z}=this.options;D&&console.time("total time");const te=`prepare ${L.length} points`;D&&console.time(te),this.points=L;const se=[];for(let Y=0;Y<L.length;Y++){const _e=L[Y];if(!_e.geometry)continue;const[we,fe]=_e.geometry.coordinates,Ee=dt(xr(we)),tt=dt($i(fe));se.push(Ee,tt,1/0,Y,-1,1),this.options.reduce&&se.push(0)}let he=this.trees[Z+1]=this._createTree(se);D&&console.timeEnd(te);for(let Y=Z;Y>=N;Y--){const _e=+Date.now();he=this.trees[Y]=this._createTree(this._cluster(he,Y)),D&&console.log("z%d: %d clusters in %dms",Y,he.numItems,+Date.now()-_e)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let N=((L[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,L[1]));let te=L[2]===180?180:((L[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)N=-180,te=180;else if(N>te){const fe=this.getClusters([N,Z,180,se],D),Ee=this.getClusters([-180,Z,te,se],D);return fe.concat(Ee)}const he=this.trees[this._limitZoom(D)],Y=he.range(xr(N),$i(se),xr(te),$i(Z)),_e=he.data,we=[];for(const fe of Y){const Ee=this.stride*fe;we.push(_e[Ee+Rt]>1?ei(_e,Ee,this.clusterProps):this.points[_e[Ee+kt]])}return we}getChildren(L){const D=this._getOriginId(L),N=this._getOriginZoom(L),Z="No cluster with the specified id.",te=this.trees[N];if(!te)throw new Error(Z);const se=te.data;if(D*this.stride>=se.length)throw new Error(Z);const he=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Y=te.within(se[D*this.stride],se[D*this.stride+1],he),_e=[];for(const we of Y){const fe=we*this.stride;se[fe+4]===L&&_e.push(se[fe+Rt]>1?ei(se,fe,this.clusterProps):this.points[se[fe+kt]])}if(_e.length===0)throw new Error(Z);return _e}getLeaves(L,D,N){const Z=[];return this._appendLeaves(Z,L,D=D||10,N=N||0,0),Z}getTile(L,D,N){const Z=this.trees[this._limitZoom(L)],te=Math.pow(2,L),{extent:se,radius:he}=this.options,Y=he/se,_e=(N-Y)/te,we=(N+1+Y)/te,fe={features:[]};return this._addTileFeatures(Z.range((D-Y)/te,_e,(D+1+Y)/te,we),Z.data,D,N,te,fe),D===0&&this._addTileFeatures(Z.range(1-Y/te,_e,1,we),Z.data,te,N,te,fe),D===te-1&&this._addTileFeatures(Z.range(0,_e,Y/te,we),Z.data,-1,N,te,fe),fe.features.length?fe:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(L);if(D++,N.length!==1)break;L=N[0].properties.cluster_id}return D}_appendLeaves(L,D,N,Z,te){const se=this.getChildren(D);for(const he of se){const Y=he.properties;if(Y&&Y.cluster?te+Y.point_count<=Z?te+=Y.point_count:te=this._appendLeaves(L,Y.cluster_id,N,Z,te):te<Z?te++:L.push(he),L.length===N)break}return te}_createTree(L){const D=new S.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<L.length;N+=this.stride)D.add(L[N],L[N+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,N,Z,te,se){for(const he of L){const Y=he*this.stride,_e=D[Y+Rt]>1;let we,fe,Ee;if(_e)we=ti(D,Y,this.clusterProps),fe=D[Y],Ee=D[Y+1];else{const It=this.points[D[Y+kt]];we=It.properties;const[mt,Pt]=It.geometry.coordinates;fe=xr(mt),Ee=$i(Pt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(fe*te-N)),Math.round(this.options.extent*(Ee*te-Z))]],tags:we};let nt;nt=_e||this.options.generateId?D[Y+kt]:this.points[D[Y+kt]].id,nt!==void 0&&(tt.id=nt),se.features.push(tt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:N,extent:Z,reduce:te,minPoints:se}=this.options,he=N/(Z*Math.pow(2,D)),Y=L.data,_e=[],we=this.stride;for(let fe=0;fe<Y.length;fe+=we){if(Y[fe+2]<=D)continue;Y[fe+2]=D;const Ee=Y[fe],tt=Y[fe+1],nt=L.within(Y[fe],Y[fe+1],he),It=Y[fe+Rt];let mt=It;for(const Pt of nt){const xt=Pt*we;Y[xt+2]>D&&(mt+=Y[xt+Rt])}if(mt>It&&mt>=se){let Pt,xt=Ee*It,fr=tt*It,er=-1;const yt=((fe/we|0)<<5)+(D+1)+this.points.length;for(const Ft of nt){const Jt=Ft*we;if(Y[Jt+2]<=D)continue;Y[Jt+2]=D;const wr=Y[Jt+Rt];xt+=Y[Jt]*wr,fr+=Y[Jt+1]*wr,Y[Jt+4]=yt,te&&(Pt||(Pt=this._map(Y,fe,!0),er=this.clusterProps.length,this.clusterProps.push(Pt)),te(Pt,this._map(Y,Jt)))}Y[fe+4]=yt,_e.push(xt/mt,fr/mt,1/0,yt,-1,mt),te&&_e.push(er)}else{for(let Pt=0;Pt<we;Pt++)_e.push(Y[fe+Pt]);if(mt>1)for(const Pt of nt){const xt=Pt*we;if(!(Y[xt+2]<=D)){Y[xt+2]=D;for(let fr=0;fr<we;fr++)_e.push(Y[xt+fr])}}}}return _e}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,N){if(L[D+Rt]>1){const se=this.clusterProps[L[D+Ui]];return N?Object.assign({},se):se}const Z=this.points[L[D+kt]].properties,te=this.options.map(Z);return N&&te===Z?Object.assign({},te):te}}function ei(W,L,D){return{type:"Feature",id:W[L+kt],properties:ti(W,L,D),geometry:{type:"Point",coordinates:[(N=W[L],360*(N-.5)),os(W[L+1])]}};var N}function ti(W,L,D){const N=W[L+Rt],Z=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,te=W[L+Ui],se=te===-1?{}:Object.assign({},D[te]);return Object.assign(se,{cluster:!0,cluster_id:W[L+kt],point_count:N,point_count_abbreviated:Z})}function xr(W){return W/360+.5}function $i(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function os(W){const L=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function as(W,L,D,N){let Z=N;const te=L+(D-L>>1);let se,he=D-L;const Y=W[L],_e=W[L+1],we=W[D],fe=W[D+1];for(let Ee=L+3;Ee<D;Ee+=3){const tt=Oo(W[Ee],W[Ee+1],Y,_e,we,fe);if(tt>Z)se=Ee,Z=tt;else if(tt===Z){const nt=Math.abs(Ee-te);nt<he&&(se=Ee,he=nt)}}Z>N&&(se-L>3&&as(W,L,se,N),W[se+2]=Z,D-se>3&&as(W,se,D,N))}function Oo(W,L,D,N,Z,te){let se=Z-D,he=te-N;if(se!==0||he!==0){const Y=((W-D)*se+(L-N)*he)/(se*se+he*he);Y>1?(D=Z,N=te):Y>0&&(D+=se*Y,N+=he*Y)}return se=W-D,he=L-N,se*se+he*he}function Pn(W,L,D,N){const Z={id:W??null,type:L,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Un(Z,D);else if(L==="Polygon")Un(Z,D[0]);else if(L==="MultiLineString")for(const te of D)Un(Z,te);else if(L==="MultiPolygon")for(const te of D)Un(Z,te[0]);return Z}function Un(W,L){for(let D=0;D<L.length;D+=3)W.minX=Math.min(W.minX,L[D]),W.minY=Math.min(W.minY,L[D+1]),W.maxX=Math.max(W.maxX,L[D]),W.maxY=Math.max(W.maxY,L[D+1])}function $n(W,L,D,N){if(!L.geometry)return;const Z=L.geometry.coordinates;if(Z&&Z.length===0)return;const te=L.geometry.type,se=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let he=[],Y=L.id;if(D.promoteId?Y=L.properties[D.promoteId]:D.generateId&&(Y=N||0),te==="Point")Fs(Z,he);else if(te==="MultiPoint")for(const _e of Z)Fs(_e,he);else if(te==="LineString")me(Z,he,se,!1);else if(te==="MultiLineString"){if(D.lineMetrics){for(const _e of Z)he=[],me(_e,he,se,!1),W.push(Pn(Y,"LineString",he,L.properties));return}ls(Z,he,se,!1)}else if(te==="Polygon")ls(Z,he,se,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(const _e of L.geometry.geometries)$n(W,{id:Y,geometry:_e,properties:L.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _e of Z){const we=[];ls(_e,we,se,!0),he.push(we)}}W.push(Pn(Y,te,he,L.properties))}function Fs(W,L){L.push(No(W[0]),zt(W[1]),0)}function me(W,L,D,N){let Z,te,se=0;for(let Y=0;Y<W.length;Y++){const _e=No(W[Y][0]),we=zt(W[Y][1]);L.push(_e,we,0),Y>0&&(se+=N?(Z*we-_e*te)/2:Math.sqrt(Math.pow(_e-Z,2)+Math.pow(we-te,2))),Z=_e,te=we}const he=L.length-3;L[2]=1,as(L,0,he,D),L[he+2]=1,L.size=Math.abs(se),L.start=0,L.end=L.size}function ls(W,L,D,N){for(let Z=0;Z<W.length;Z++){const te=[];me(W[Z],te,D,N),L.push(te)}}function No(W){return W/360+.5}function zt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function Qt(W,L,D,N,Z,te,se,he){if(N/=L,te>=(D/=L)&&se<N)return W;if(se<D||te>=N)return null;const Y=[];for(const _e of W){const we=_e.geometry;let fe=_e.type;const Ee=Z===0?_e.minX:_e.minY,tt=Z===0?_e.maxX:_e.maxY;if(Ee>=D&&tt<N){Y.push(_e);continue}if(tt<D||Ee>=N)continue;let nt=[];if(fe==="Point"||fe==="MultiPoint")Vo(we,nt,D,N,Z);else if(fe==="LineString")Zn(we,nt,D,N,Z,!1,he.lineMetrics);else if(fe==="MultiLineString")Bs(we,nt,D,N,Z,!1);else if(fe==="Polygon")Bs(we,nt,D,N,Z,!0);else if(fe==="MultiPolygon")for(const It of we){const mt=[];Bs(It,mt,D,N,Z,!0),mt.length&&nt.push(mt)}if(nt.length){if(he.lineMetrics&&fe==="LineString"){for(const It of nt)Y.push(Pn(_e.id,fe,It,_e.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(nt.length===1?(fe="LineString",nt=nt[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=nt.length===3?"Point":"MultiPoint"),Y.push(Pn(_e.id,fe,nt,_e.tags))}}return Y.length?Y:null}function Vo(W,L,D,N,Z){for(let te=0;te<W.length;te+=3){const se=W[te+Z];se>=D&&se<=N&&Ei(L,W[te],W[te+1],W[te+2])}}function Zn(W,L,D,N,Z,te,se){let he=En(W);const Y=Z===0?jo:Uo;let _e,we,fe=W.start;for(let mt=0;mt<W.length-3;mt+=3){const Pt=W[mt],xt=W[mt+1],fr=W[mt+2],er=W[mt+3],yt=W[mt+4],Ft=Z===0?Pt:xt,Jt=Z===0?er:yt;let wr=!1;se&&(_e=Math.sqrt(Math.pow(Pt-er,2)+Math.pow(xt-yt,2))),Ft<D?Jt>D&&(we=Y(he,Pt,xt,er,yt,D),se&&(he.start=fe+_e*we)):Ft>N?Jt<N&&(we=Y(he,Pt,xt,er,yt,N),se&&(he.start=fe+_e*we)):Ei(he,Pt,xt,fr),Jt<D&&Ft>=D&&(we=Y(he,Pt,xt,er,yt,D),wr=!0),Jt>N&&Ft<=N&&(we=Y(he,Pt,xt,er,yt,N),wr=!0),!te&&wr&&(se&&(he.end=fe+_e*we),L.push(he),he=En(W)),se&&(fe+=_e)}let Ee=W.length-3;const tt=W[Ee],nt=W[Ee+1],It=Z===0?tt:nt;It>=D&&It<=N&&Ei(he,tt,nt,W[Ee+2]),Ee=he.length-3,te&&Ee>=3&&(he[Ee]!==he[0]||he[Ee+1]!==he[1])&&Ei(he,he[0],he[1],he[2]),he.length&&L.push(he)}function En(W){const L=[];return L.size=W.size,L.start=W.start,L.end=W.end,L}function Bs(W,L,D,N,Z,te){for(const se of W)Zn(se,L,D,N,Z,te,!1)}function Ei(W,L,D,N){W.push(L,D,N)}function jo(W,L,D,N,Z,te){const se=(te-L)/(N-L);return Ei(W,te,D+(Z-D)*se,1),se}function Uo(W,L,D,N,Z,te){const se=(te-D)/(Z-D);return Ei(W,L+(N-L)*se,te,1),se}function Ie(W,L){const D=[];for(let N=0;N<W.length;N++){const Z=W[N],te=Z.type;let se;if(te==="Point"||te==="MultiPoint"||te==="LineString")se=hn(Z.geometry,L);else if(te==="MultiLineString"||te==="Polygon"){se=[];for(const he of Z.geometry)se.push(hn(he,L))}else if(te==="MultiPolygon"){se=[];for(const he of Z.geometry){const Y=[];for(const _e of he)Y.push(hn(_e,L));se.push(Y)}}D.push(Pn(Z.id,te,se,Z.tags))}return D}function hn(W,L){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let N=0;N<W.length;N+=3)D.push(W[N]+L,W[N+1],W[N+2]);return D}function Zr(W,L){if(W.transformed)return W;const D=1<<W.z,N=W.x,Z=W.y;for(const te of W.features){const se=te.geometry,he=te.type;if(te.geometry=[],he===1)for(let Y=0;Y<se.length;Y+=2)te.geometry.push(dn(se[Y],se[Y+1],L,D,N,Z));else for(let Y=0;Y<se.length;Y++){const _e=[];for(let we=0;we<se[Y].length;we+=2)_e.push(dn(se[Y][we],se[Y][we+1],L,D,N,Z));te.geometry.push(_e)}}return W.transformed=!0,W}function dn(W,L,D,N,Z,te){return[Math.round(D*(W*N-Z)),Math.round(D*(L*N-te))]}function qn(W,L,D,N,Z){const te=L===Z.maxZoom?0:Z.tolerance/((1<<L)*Z.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:N,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const he of W)ze(se,he,te,Z);return se}function ze(W,L,D,N){const Z=L.geometry,te=L.type,se=[];if(W.minX=Math.min(W.minX,L.minX),W.minY=Math.min(W.minY,L.minY),W.maxX=Math.max(W.maxX,L.maxX),W.maxY=Math.max(W.maxY,L.maxY),te==="Point"||te==="MultiPoint")for(let he=0;he<Z.length;he+=3)se.push(Z[he],Z[he+1]),W.numPoints++,W.numSimplified++;else if(te==="LineString")_t(se,Z,W,D,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(let he=0;he<Z.length;he++)_t(se,Z[he],W,D,te==="Polygon",he===0);else if(te==="MultiPolygon")for(let he=0;he<Z.length;he++){const Y=Z[he];for(let _e=0;_e<Y.length;_e++)_t(se,Y[_e],W,D,!0,_e===0)}if(se.length){let he=L.tags||null;if(te==="LineString"&&N.lineMetrics){he={};for(const _e in L.tags)he[_e]=L.tags[_e];he.mapbox_clip_start=Z.start/Z.size,he.mapbox_clip_end=Z.end/Z.size}const Y={geometry:se,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:he};L.id!==null&&(Y.id=L.id),W.features.push(Y)}}function _t(W,L,D,N,Z,te){const se=N*N;if(N>0&&L.size<(Z?se:N))return void(D.numPoints+=L.length/3);const he=[];for(let Y=0;Y<L.length;Y+=3)(N===0||L[Y+2]>se)&&(D.numSimplified++,he.push(L[Y],L[Y+1])),D.numPoints++;Z&&function(Y,_e){let we=0;for(let fe=0,Ee=Y.length,tt=Ee-2;fe<Ee;tt=fe,fe+=2)we+=(Y[fe]-Y[tt])*(Y[fe+1]+Y[tt+1]);if(we>0===_e)for(let fe=0,Ee=Y.length;fe<Ee/2;fe+=2){const tt=Y[fe],nt=Y[fe+1];Y[fe]=Y[Ee-2-fe],Y[fe+1]=Y[Ee-1-fe],Y[Ee-2-fe]=tt,Y[Ee-1-fe]=nt}}(he,te),W.push(he)}const at={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ri{constructor(L,D){const N=(D=this.options=function(te,se){for(const he in se)te[he]=se[he];return te}(Object.create(at),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let Z=function(te,se){const he=[];if(te.type==="FeatureCollection")for(let Y=0;Y<te.features.length;Y++)$n(he,te.features[Y],se,Y);else $n(he,te.type==="Feature"?te:{geometry:te},se);return he}(L,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(te,se){const he=se.buffer/se.extent;let Y=te;const _e=Qt(te,1,-1-he,he,0,-1,2,se),we=Qt(te,1,1-he,2+he,0,-1,2,se);return(_e||we)&&(Y=Qt(te,1,-he,1+he,0,-1,2,se)||[],_e&&(Y=Ie(_e,1).concat(Y)),we&&(Y=Y.concat(Ie(we,-1)))),Y}(Z,D),Z.length&&this.splitTile(Z,0,0,0),N&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,N,Z,te,se,he){const Y=[L,D,N,Z],_e=this.options,we=_e.debug;for(;Y.length;){Z=Y.pop(),N=Y.pop(),D=Y.pop(),L=Y.pop();const fe=1<<D,Ee=Zi(D,N,Z);let tt=this.tiles[Ee];if(!tt&&(we>1&&console.time("creation"),tt=this.tiles[Ee]=qn(L,D,N,Z,_e),this.tileCoords.push({z:D,x:N,y:Z}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,Z,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const wr=`z${D}`;this.stats[wr]=(this.stats[wr]||0)+1,this.total++}if(tt.source=L,te==null){if(D===_e.indexMaxZoom||tt.numPoints<=_e.indexMaxPoints)continue}else{if(D===_e.maxZoom||D===te)continue;if(te!=null){const wr=te-D;if(N!==se>>wr||Z!==he>>wr)continue}}if(tt.source=null,L.length===0)continue;we>1&&console.time("clipping");const nt=.5*_e.buffer/_e.extent,It=.5-nt,mt=.5+nt,Pt=1+nt;let xt=null,fr=null,er=null,yt=null,Ft=Qt(L,fe,N-nt,N+mt,0,tt.minX,tt.maxX,_e),Jt=Qt(L,fe,N+It,N+Pt,0,tt.minX,tt.maxX,_e);L=null,Ft&&(xt=Qt(Ft,fe,Z-nt,Z+mt,1,tt.minY,tt.maxY,_e),fr=Qt(Ft,fe,Z+It,Z+Pt,1,tt.minY,tt.maxY,_e),Ft=null),Jt&&(er=Qt(Jt,fe,Z-nt,Z+mt,1,tt.minY,tt.maxY,_e),yt=Qt(Jt,fe,Z+It,Z+Pt,1,tt.minY,tt.maxY,_e),Jt=null),we>1&&console.timeEnd("clipping"),Y.push(xt||[],D+1,2*N,2*Z),Y.push(fr||[],D+1,2*N,2*Z+1),Y.push(er||[],D+1,2*N+1,2*Z),Y.push(yt||[],D+1,2*N+1,2*Z+1)}}getTile(L,D,N){L=+L,D=+D,N=+N;const Z=this.options,{extent:te,debug:se}=Z;if(L<0||L>24)return null;const he=1<<L,Y=Zi(L,D=D+he&he-1,N);if(this.tiles[Y])return Zr(this.tiles[Y],te);se>1&&console.log("drilling down to z%d-%d-%d",L,D,N);let _e,we=L,fe=D,Ee=N;for(;!_e&&we>0;)we--,fe>>=1,Ee>>=1,_e=this.tiles[Zi(we,fe,Ee)];return _e&&_e.source?(se>1&&(console.log("found parent tile z%d-%d-%d",we,fe,Ee),console.time("drilling down")),this.splitTile(_e.source,we,fe,Ee,L,D,N),se>1&&console.timeEnd("drilling down"),this.tiles[Y]?Zr(this.tiles[Y],te):null):null}}function Zi(W,L,D){return 32*((1<<W)*D+L)+W}function ft(W,L){return L?W.properties[L]:W.id}function pn(W,L){if(W==null)return!0;if(W.type==="Feature")return ft(W,L)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const N of W.features){const Z=ft(N,L);if(Z==null||D.has(Z))return!1;D.add(Z)}return!0}return!1}function Cn(W,L){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(ft(W,L),W);else for(const N of W.features)D.set(ft(N,L),N);return D}class Gn extends re{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Z=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!Z)return null;const te=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=he.length,this._features=he}feature(he){return new class{constructor(Y){this._feature=Y,this.extent=S.X,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const _e of this._feature.geometry)Y.push([new S.P(_e[0],_e[1])]);return Y}{const Y=[];for(const _e of this._feature.geometry){const we=[];for(const fe of _e)we.push(new S.P(fe[0],fe[1]));Y.push(we)}return Y}}toGeoJSON(Y,_e,we){return Tt.call(this,Y,_e,we)}}(this._features[he])}}(Z.features);let se=Qr(te);return se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),{vectorTile:te,rawData:se.buffer}})}loadData(L){return S._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Dr(function({superclusterOptions:se,clusterProperties:he}){if(!he||!se)return se;const Y={},_e={},we={accumulated:null,zoom:0},fe={properties:null},Ee=Object.keys(he);for(const tt of Ee){const[nt,It]=he[tt],mt=S.bC(It),Pt=S.bC(typeof nt=="string"?[nt,["accumulated"],["get",tt]]:nt);Y[tt]=mt.value,_e[tt]=Pt.value}return se.map=tt=>{fe.properties=tt;const nt={};for(const It of Ee)nt[It]=Y[It].evaluate(we,fe);return nt},se.reduce=(tt,nt)=>{fe.properties=nt;for(const It of Ee)we.accumulated=tt[It],tt[It]=_e[It].evaluate(we,fe)},se}(L)).load((yield this._pendingData).features):(Z=yield this._pendingData,new ri(Z,L.geojsonVtOptions)),this.loaded={};const te={};if(N){const se=N.finish();se&&(te.resourceTiming={},te.resourceTiming[L.source]=JSON.parse(JSON.stringify(se)))}return te}catch(te){if(delete this._pendingRequest,S.bB(te))return{abandoned:!0};throw te}var Z})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return S._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Be(N,!0),L.filter){const Z=S.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(se=>`${se.key}: ${se.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(se=>Z.value.evaluate({zoom:0},se))}}return N})}loadGeoJSON(L,D){return S._(this,void 0,void 0,function*(){const{promoteId:N}=L;if(L.request){const Z=yield S.h(L.request,D);return this._dataUpdateable=pn(Z.data,N)?Cn(Z.data,N):void 0,Z.data}if(typeof L.data=="string")try{const Z=JSON.parse(L.data);return this._dataUpdateable=pn(Z,N)?Cn(Z,N):void 0,Z}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(Z,te,se){var he,Y,_e,we;if(te.removeAll&&Z.clear(),te.remove)for(const fe of te.remove)Z.delete(fe);if(te.add)for(const fe of te.add){const Ee=ft(fe,se);Ee!=null&&Z.set(Ee,fe)}if(te.update)for(const fe of te.update){let Ee=Z.get(fe.id);if(Ee==null)continue;const tt=!fe.removeAllProperties&&(((he=fe.removeProperties)===null||he===void 0?void 0:he.length)>0||((Y=fe.addOrUpdateProperties)===null||Y===void 0?void 0:Y.length)>0);if((fe.newGeometry||fe.removeAllProperties||tt)&&(Ee=Object.assign({},Ee),Z.set(fe.id,Ee),tt&&(Ee.properties=Object.assign({},Ee.properties))),fe.newGeometry&&(Ee.geometry=fe.newGeometry),fe.removeAllProperties)Ee.properties={};else if(((_e=fe.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const nt of fe.removeProperties)Object.prototype.hasOwnProperty.call(Ee.properties,nt)&&delete Ee.properties[nt];if(((we=fe.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:nt,value:It}of fe.addOrUpdateProperties)Ee.properties[nt]=It}}(this._dataUpdateable,L.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class fn{constructor(L){this.self=L,this.actor=new S.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,N)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=N},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=D=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,N)=>this._getDEMWorkerSource(D,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(D,N)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(D,N)=>this._getWorkerSource(D,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(D,N)=>this._getWorkerSource(D,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(D,N)=>this._getWorkerSource(D,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(D,N)=>this._getWorkerSource(D,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(D,N)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const Z=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],Z.removeSource!==void 0&&Z.removeSource(N)})),this.actor.registerMessageHandler("RM",D=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,N)=>S._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(D,N)=>this._syncRTLPluginState(D,N)),this.actor.registerMessageHandler("IS",(D,N)=>S._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(D,N)=>this._setImages(D,N)),this.actor.registerMessageHandler("UL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(N)}))}_setImages(L,D){return S._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const N in this.workerSources[L]){const Z=this.workerSources[L][N];for(const te in Z)Z[te].availableImages=D}})}_syncRTLPluginState(L,D){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(D.pluginStatus!=="loading")return S.bD.setState(D),D;const N=D.pluginURL;if(this.self.importScripts(N),S.bD.isParsed()){const Z={pluginStatus:"loaded",pluginURL:N};return S.bD.setState(Z),Z}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,N){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][N]){const Z={sendAsync:(te,se)=>(te.targetMapId=L,this.actor.sendAsync(te,se))};switch(D){case"vector":this.workerSources[L][D][N]=new re(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][N]=new Gn(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][N]=new this.externalWorkerSourceTypes[D](Z,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][N]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new H),this.demWorkerSources[L][D]}}return S.i(self)&&(self.worker=new fn(self)),fn}),b("index",["exports","./shared"],function(S,d){var G="4.7.1";let le,xe;const re={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(le||(le=document.createElement("a")),le.href=f,le.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xe==null&&(xe=matchMedia("(prefers-reduced-motion: reduce)")),xe.matches)}};class H{static testProp(e){if(!H.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in H.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(e,s){e.style[H.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",H.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=H.getScale(e);return H.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=H.getScale(e);for(let p=0;p<s.length;p++)l.push(H.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(f){!Tt&&Be&&(ce?ie(f):Fe=f)}};let Fe,Be,Tt=!1,ce=!1;function ie(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Be),f.isContextLost())return;Le.supported=!0}catch{}f.deleteTexture(e),Tt=!0}var ue;typeof document<"u"&&(Be=document.createElement("img"),Be.onload=()=>{Fe&&ie(Fe),Fe=null,ce=!0},Be.onerror=()=>{Tt=!0,Fe=null},Be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=T=>{const E=l++;return u[E]=T,E},f.removeThrottleControl=T=>{delete u[T],v()},f.getImage=(T,E,M=!0)=>new Promise((z,F)=>{Le.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:M,state:"queued",onError:V=>{F(V)},onSuccess:V=>{z(V)}}),v()});const p=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:M,onError:z,onSuccess:F,abortController:V}=T,j=M===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((J,Q)=>J&&Q==="accept",!0));s++;const q=j?w(E,V):d.m(E,V);try{const J=yield q;delete T.abortController,T.state="completed",J.data instanceof HTMLImageElement||d.b(J.data)?F(J):J.data&&F({data:yield(K=J.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete T.abortController,z(J)}finally{s--,v()}var K}),v=()=>{const T=(()=>{for(const E of Object.keys(u))if(u[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=s;E<T&&e.length>0;E++){const M=e.shift();M.abortController.signal.aborted?E--:p(M)}},w=(T,E)=>new Promise((M,z)=>{const F=new Image,V=T.url,j=T.credentials;j&&j==="include"?F.crossOrigin="use-credentials":(j&&j==="same-origin"||!d.s(V))&&(F.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{F.src="",z(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,M({data:F})},F.onerror=()=>{F.onerror=F.onload=null,E.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(ue||(ue={})),ue.resetRequestQueue();class Te{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function je(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var He,Ge=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};He=new d.A(3),d.A!=Float32Array&&(He[0]=0,He[1]=0,He[2]=0);var Se=function(f){var e=f[0],s=f[1];return e*e+s*s};function it(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function et(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class ht{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:E,y:M}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,E,M,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,E,M,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function zr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ot extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new d.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ht(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=d.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,T=v.y+1,E=this.getImage(p).data,M=E.width,z=E.height;d.R.copy(E,u,{x:0,y:0},{x:w,y:T},{width:M,height:z}),d.R.copy(E,u,{x:0,y:z-1},{x:w,y:T-1},{width:M,height:1}),d.R.copy(E,u,{x:0,y:0},{x:w,y:T+z},{width:M,height:1}),d.R.copy(E,u,{x:M-1,y:0},{x:w-1,y:T},{width:1,height:z}),d.R.copy(E,u,{x:0,y:0},{x:w+M,y:T},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),zr(l)&&this.updateImage(s,l)}}}const lr=1e20;function Ar(f,e,s,l,u,p,v,w,T){for(let E=e;E<e+l;E++)cn(f,s*p+E,p,u,v,w,T);for(let E=s;E<s+u;E++)cn(f,E*p+e,1,l,v,w,T)}function cn(f,e,s,l,u,p,v){p[0]=0,v[0]=-lr,v[1]=lr,u[0]=f[e];for(let w=1,T=0,E=0;w<l;w++){u[w]=f[e+w*s];const M=w*w;do{const z=p[T];E=(u[w]-u[z]+M-z*z)/(w-z)/2}while(E<=v[T]&&--T>-1);T++,p[T]=w,v[T]=E,v[T+1]=lr}for(let w=0,T=0;w<l;w++){for(;v[T+1]<w;)T++;const E=p[T],M=w-E;f[e+w*s]=u[E]+M*M}}class Qr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=Qr.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new Qr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qr.loadGlyphRange=function(f,e,s,l){return d._(this,void 0,void 0,function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const T={};for(const E of d.n(w.data))T[E.id]=E;return T})},Qr.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,T=this._createCanvas(w),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${p} ${f}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,v+Math.ceil(l)),E=w+2*this.buffer,M=T+2*this.buffer,z=Math.max(E*M,0),F=new Uint8ClampedArray(z),V={data:F,width:E,height:M,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return V;const{ctx:j,buffer:q,gridInner:K,gridOuter:J}=this;j.clearRect(q,q,w,T),j.fillText(f,q,q+v);const Q=j.getImageData(q,q,w,T);J.fill(lr,0,z),K.fill(0,0,z);for(let U=0;U<T;U++)for(let ne=0;ne<w;ne++){const oe=Q.data[4*(U*w+ne)+3]/255;if(oe===0)continue;const pe=(U+q)*E+ne+q;if(oe===1)J[pe]=0,K[pe]=lr;else{const ve=.5-oe;J[pe]=ve>0?ve*ve:0,K[pe]=ve<0?ve*ve:0}}Ar(J,0,0,E,M,E,this.f,this.v,this.z),Ar(K,q,q,w,T,E,this.f,this.v,this.z);for(let U=0;U<z;U++){const ne=Math.sqrt(J[U])-Math.sqrt(K[U]);F[U]=Math.round(255-255*(ne/this.radius+this.cutoff))}return V}};class We{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:d.y.number(e.x,s.x,l),y:d.y.number(e.y,s.y,l),z:d.y.number(e.z,s.z,l)}}}let dt;class pt extends d.E{constructor(e){super(),dt=dt||new d.q({anchor:new d.D(d.v.light.anchor),position:new We,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(dt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const kt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Rt extends d.E{constructor(e){super(),this._transitionable=new d.T(kt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ui{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){w=!w;const M=e[E];p=T*l,T+=M,v=T*l,u.push({left:p,right:v,isDash:w,zeroLength:M===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,T=e[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++w]);const M=Math.abs(E-T.left),z=Math.abs(E-T.right),F=Math.min(M,z);let V;const j=p/l*(u+1);if(T.isDash){const q=u-Math.abs(j);V=Math.sqrt(F*F+q*q)}else V=u-Math.sqrt(F*F+j*j);this.data[v+E]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],E=e[w+1];T.zeroLength?e.splice(w,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const T=Math.abs(w-v.left),E=Math.abs(w-v.right),M=Math.min(T,E);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?M:-M)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,T=this.getDashRanges(e,this.width,w);s?this.addRoundDash(T,w,l):this.addRegularDash(T)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Dr="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Dr]}numActive(){return Object.keys(this.active).length}}const ti=Math.floor(re.hardwareConcurrency/2);let xr,$i;function os(){return xr||(xr=new ei),xr}ei.workerCount=d.C(globalThis)?Math.max(Math.min(ti,3),1):1;class as{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new d.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function Oo(){return $i||($i=new as(os(),d.G),$i.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),$i}function Pn(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Un(f,e,s,l,u,p){const v=function(z,F,V){if(z)for(const j of z){const q=F[j];if(q&&q.source===V&&q.type==="fill-extrusion")return!0}else for(const j in F){const q=F[j];if(q.source===V&&q.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),T=f.tilesIn(l,w,v);T.sort($n);const E=[];for(const z of T)E.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,s,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,u,p,w,Pn(f.transform,z.tileID))});const M=function(z){const F={},V={};for(const j of z){const q=j.queryResults,K=j.wrappedTileID,J=V[K]=V[K]||{};for(const Q in q){const U=q[Q],ne=J[Q]=J[Q]||{},oe=F[Q]=F[Q]||[];for(const pe of U)ne[pe.featureIndex]||(ne[pe.featureIndex]=!0,oe.push(pe))}}return F}(E);for(const z in M)M[z].forEach(F=>{const V=F.feature,j=f.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=j});return M}function $n(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Fs(f,e,s){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield re.frameAsync(s),!l)return null;const u=d.M(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(p=>p.id)),u})}class me{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof d.N)u=e,p=e;else{if(!(e instanceof me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(me.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new d.N(u.lng,u.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=d.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof me?e:e&&new me(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new me(new d.N(e.lng-u,e.lat-l),new d.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new me(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class ls{constructor(e,s,l){this.bounds=me.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(d.O(this.bounds.getWest())*s),u=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),v=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class No extends d.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Fs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new ls(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,v)=>{e.reloadPromise={resolve:p,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class zt extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Fs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new ls(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield ue.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new ht(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Qt extends zt{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield ue.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(p)&&d.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,l=e.height+2;try{return new d.R({width:s,height:l},yield d.W(e,-1,-1,s,l))}catch{}}return re.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Vo extends d.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(re.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(p,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Zn=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class En extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield ue.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(u){let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const F of u)p=Math.min(p,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);const E=Math.max(w-p,T-v),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),z=Math.pow(2,M);return new d.a1(M,Math.floor((p+w)/2*z),Math.floor((v+T)/2*z))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Zn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ht(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Bs extends En{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Zn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new ht(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ei extends En{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Zn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ht(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const jo={},Uo=f=>{switch(f){case"geojson":return Vo;case"image":return En;case"raster":return zt;case"raster-dem":return Qt;case"vector":return No;case"video":return Bs;case"canvas":return Ei}return jo[f]},Ie="RTLPluginLoaded";class hn extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Oo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=re.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zr=null;function dn(){return Zr||(Zr=new hn),Zr}class qn{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const v={};if(!p)return v;for(const w of u){const T=w.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(E=>T.filter(M=>M.id===E)[0]));for(const E of T)v[E.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,dn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ht(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ht(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,T,E,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:w,queryPadding:this.queryPadding*E},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=d.a7(s&&s.filter),{z:T,x:E,y:M}=this.tileID.canonical,z={z:T,x:E,y:M};for(let F=0;F<v.length;F++){const V=v.feature(F);if(w.needGeometry){const K=d.a8(V,!0);if(!w.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!w.filter(new d.z(this.tileID.overscaledZ),V))continue;const j=l.getId(V,p),q=new d.a9(V,T,E,M,j);q.tile=z,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=d.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=s&&s.style&&s.style.getLayer(u);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=re.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class ze{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class _t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class at extends d.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,v,w)=>{const T=new(Uo(p.type))(u,p,v,w);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,s,l,this),this._tiles={},this._cache=new ze(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(ri).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,v=u.tileID,w=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(ri).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=re.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),E=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(w=E)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},T={},E=Object.keys(e),M=re.now();for(const z of E){const F=e[z],V=this._tiles[z];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=M)continue;const j=this.findLoadedParent(F,s),q=this.findLoadedSibling(F),K=j||q||null;K&&(this._addTile(K.tileID),w[K.tileID.key]=K.tileID),T[z]=F}this._retainLoadedChildren(T,u,l,e);for(const z in w)e[z]||(this._coveredTiles[z]=!0,e[z]=w[z]);if(v){const z={},F={};for(const V of p)this._tiles[V.key].hasData()?z[V.key]=V:F[V.key]=V;for(const V in F){const j=F[V].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(z[j[0].key]=e[j[0].key]=j[0],z[j[1].key]=e[j[1].key]=j[1],z[j[2].key]=e[j[2].key]=j[2],z[j[3].key]=e[j[3].key]=j[3],delete F[V])}for(const V in F){const j=F[V],q=this.findLoadedParent(j,this._source.minzoom),K=this.findLoadedSibling(j),J=q||K||null;if(J){z[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const Q in z)z[Q].isChildOf(J.tileID)&&delete z[Q]}}for(const V in this._tiles)z[V]||(this._coveredTiles[V]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new d.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-at.maxOverzooming,this._source.minzoom),v=Math.max(u+at.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of l)if(z.canonical.z>this._source.minzoom){const F=z.scaledTo(z.canonical.z-1);M[F.key]=F;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[V.key]=V}l=l.concat(Object.values(M))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);Zi(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,v,u,l,s);for(const M in T)this._tiles[M].clearFadeHold();const E=d.ab(this._tiles,T);for(const M of E){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-at.maxOverzooming,this._source.minzoom),w=Math.max(s+at.maxUnderzooming,this._source.minzoom),T={};for(const E of e){const M=this._addTile(E);u[E.key]=E,M.hasData()||s<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,s,w,u);for(const E of e){let M=this._tiles[E.key];if(M.hasData())continue;if(s+1>this._source.maxzoom){const F=E.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){u[F.key]=F;continue}}else{const F=E.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let z=M.wasRequested();for(let F=E.overscaledZ-1;F>=v;--F){const V=E.scaledTo(F);if(p[V.key])break;if(p[V.key]=!0,M=this.getTile(V),!M&&z&&(M=this._addTile(V)),M){const j=M.hasData();if((j||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||z)&&(u[V.key]=V),z=M.wasRequested(),j)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new qn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map(j=>p.pointCoordinate(j,this.terrain)),T=v.map(j=>p.pointCoordinate(j,this.terrain)),E=this.getIds();let M=1/0,z=1/0,F=-1/0,V=-1/0;for(const j of T)M=Math.min(M,j.x),z=Math.min(z,j.y),F=Math.max(F,j.x),V=Math.max(V,j.y);for(let j=0;j<E.length;j++){const q=this._tiles[E[j]];if(q.holdingForFade())continue;const K=q.tileID,J=Math.pow(2,p.zoom-q.tileID.overscaledZ),Q=s*q.queryPadding*d.X/q.tileSize/J,U=[K.getTilePoint(new d.Z(M,z)),K.getTilePoint(new d.Z(F,V))];if(U[0].x-Q<d.X&&U[0].y-Q<d.X&&U[1].x+Q>=0&&U[1].y+Q>=0){const ne=w.map(pe=>K.getTilePoint(pe)),oe=T.map(pe=>K.getTilePoint(pe));u.push({tile:q,tileID:K,queryGeometry:ne,cameraQueryGeometry:oe,scale:J})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Zi(this._source.type)){const e=re.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function ri(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Zi(f){return f==="raster"||f==="image"||f==="video"}at.maxOverzooming=10,at.maxUnderzooming=3;class ft{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,T=w>0?(u-v)/w:0;return this.points[p].mult(1-T).add(this.points[s].mult(T))}}function pn(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Cn{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const T=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const M=this.circles[3*E],z=this.circles[3*E+1],F=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:M-F,y1:z-F,x2:M+F,y2:z+F})}}else this._forEachCell(e,s,l,u,this._queryCell,T,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return T}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,T=s-l,E=s+l;if(w<0||v>this.width||E<0||T>this.height)return!1;const M=[];return this._forEachCell(v,T,w,E,this._queryCellCircle,M,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,s,l,u,p,v,w,T){const{seenUids:E,hitTest:M,overlapMode:z}=w,F=this.boxCells[p];if(F!==null){const j=this.bboxes;for(const q of F)if(!E.box[q]){E.box[q]=!0;const K=4*q,J=this.boxKeys[q];if(e<=j[K+2]&&s<=j[K+3]&&l>=j[K+0]&&u>=j[K+1]&&(!T||T(J))&&(!M||!pn(z,J.overlapMode))&&(v.push({key:J,x1:j[K],y1:j[K+1],x2:j[K+2],y2:j[K+3]}),M))return!0}}const V=this.circleCells[p];if(V!==null){const j=this.circles;for(const q of V)if(!E.circle[q]){E.circle[q]=!0;const K=3*q,J=this.circleKeys[q];if(this._circleAndRectCollide(j[K],j[K+1],j[K+2],e,s,l,u)&&(!T||T(J))&&(!M||!pn(z,J.overlapMode))){const Q=j[K],U=j[K+1],ne=j[K+2];if(v.push({key:J,x1:Q-ne,y1:U-ne,x2:Q+ne,y2:U+ne}),M)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,T){const{circle:E,seenUids:M,overlapMode:z}=w,F=this.boxCells[p];if(F!==null){const j=this.bboxes;for(const q of F)if(!M.box[q]){M.box[q]=!0;const K=4*q,J=this.boxKeys[q];if(this._circleAndRectCollide(E.x,E.y,E.radius,j[K+0],j[K+1],j[K+2],j[K+3])&&(!T||T(J))&&!pn(z,J.overlapMode))return v.push(!0),!0}}const V=this.circleCells[p];if(V!==null){const j=this.circles;for(const q of V)if(!M.circle[q]){M.circle[q]=!0;const K=3*q,J=this.circleKeys[q];if(this._circlesCollide(j[K],j[K+1],j[K+2],E.x,E.y,E.radius)&&(!T||T(J))&&!pn(z,J.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,T){const E=this._convertToXCellCoord(e),M=this._convertToYCellCoord(s),z=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let V=E;V<=z;V++)for(let j=M;j<=F;j++)if(p.call(this,e,s,l,u,this.xCellCount*j+V,v,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,T=p-s,E=l+v;return E*E>w*w+T*T}_circleAndRectCollide(e,s,l,u,p,v,w){const T=(v-u)/2,E=Math.abs(e-(u+T));if(E>T+l)return!1;const M=(w-p)/2,z=Math.abs(s-(p+M));if(z>M+l)return!1;if(E<=T||z<=M)return!0;const F=E-T,V=z-M;return F*F+V*V<=l*l}}function Gn(f,e,s,l,u){const p=d.H();return e?(d.K(p,p,[1/u,1/u,1]),s||d.ad(p,p,l.angle)):d.L(p,l.labelPlaneMatrix,f),p}function fn(f,e,s,l,u){if(e){const p=d.ae(f);return d.K(p,p,[u,u,1]),s||d.ad(p,p,-l.angle),p}return l.glCoordMatrix}function W(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],d.af(u,u,s)):(u=[f,e,0,1],It(u,u,s));const p=u[3];return{point:new d.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function N(f,e,s,l,u,p,v,w,T,E,M,z,F,V,j){const q=l?f.textSizeData:f.iconSizeData,K=d.ag(q,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],Q=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();const U=f.lineVertexArray,ne=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=s.transform.width/s.transform.height;let pe=!1;for(let ve=0;ve<ne.length;ve++){const ke=ne.get(ve);if(ke.hidden||ke.writingMode===d.ah.vertical&&!pe){nt(ke.numGlyphs,Q);continue}pe=!1;const Re=W(ke.anchorX,ke.anchorY,e,j);if(!D(Re.point,J)){nt(ke.numGlyphs,Q);continue}const Ue=L(s.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Me=d.ai(q,K,ke),Ce=v?Me/Ue:Me*Ue,Ke={getElevation:j,labelPlaneMatrix:u,lineVertexArray:U,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new d.P(ke.anchorX,ke.anchorY),unwrappedTileID:M,width:z,height:F,translation:V},ct=se(Ke,ke,Ce,!1,w,e,p,f.glyphOffsetArray,Q,oe,T);pe=ct.useVertical,(ct.notEnoughRoom||pe||ct.needsFlipping&&se(Ke,ke,Ce,!0,w,e,p,f.glyphOffsetArray,Q,oe,T).notEnoughRoom)&&nt(ke.numGlyphs,Q)}l?f.text.dynamicLayoutVertexBuffer.updateData(Q):f.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Z(f,e,s,l,u,p,v,w){const T=p.glyphStartIndex+p.numGlyphs,E=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,z=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(T-1),V=Ee(f*z,s,l,u,p.segment,E,M,w,v);if(!V)return null;const j=Ee(f*F,s,l,u,p.segment,E,M,w,v);return j?w.projectionCache.anyProjectionOccluded?null:{first:V,last:j}:null}function te(f,e,s,l){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function se(f,e,s,l,u,p,v,w,T,E,M){const z=s/24,F=e.lineOffsetX*z,V=e.lineOffsetY*z;let j;if(e.numGlyphs>1){const q=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,J=e.lineStartIndex+e.lineLength,Q=Z(z,w,F,V,l,e,M,f);if(!Q)return{notEnoughRoom:!0};const U=W(Q.first.point.x,Q.first.point.y,v,f.getElevation).point,ne=W(Q.last.point.x,Q.last.point.y,v,f.getElevation).point;if(u&&!l){const oe=te(e.writingMode,U,ne,E);if(oe)return oe}j=[Q.first];for(let oe=e.glyphStartIndex+1;oe<q-1;oe++)j.push(Ee(z*w.getoffsetX(oe),F,V,l,e.segment,K,J,f,M));j.push(Q.last)}else{if(u&&!l){const K=W(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,J=e.lineStartIndex+e.segment+1,Q=new d.P(f.lineVertexArray.getx(J),f.lineVertexArray.gety(J)),U=W(Q.x,Q.y,p,f.getElevation),ne=U.signedDistanceFromCamera>0?U.point:function(pe,ve,ke,Re,Ue,Me){return he(pe,ve,ke,1,Ue,Me)}(f.tileAnchorPoint,Q,K,0,p,f),oe=te(e.writingMode,K,ne,E);if(oe)return oe}const q=Ee(z*w.getoffsetX(e.glyphStartIndex),F,V,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,M);if(!q||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};j=[q]}for(const q of j)d.aj(T,q.point,q.angle);return{}}function he(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?W(v.x,v.y,u,p.getElevation).point:_e(v.x,v.y,p).point,T=s.sub(w);return s.add(T._mult(l/T.mag()))}function Y(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=_e(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return function(w,T,E,M,z){return he(w,T,E,M,void 0,z)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function _e(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=W(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function we(f,e,s){return f._unit()._perp()._mult(e*s)}function fe(f,e,s,l,u,p,v,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const E=s.add(e);if(f+T.direction<l||f+T.direction>=u)return w.projectionCache.offsets[f]=E,E;const M=Y(f+T.direction,w,T),z=we(M.sub(s),v,T.direction),F=s.add(z),V=M.add(z);return w.projectionCache.offsets[f]=d.ak(p,E,F,V)||E,w.projectionCache.offsets[f]}function Ee(f,e,s,l,u,p,v,w,T){const E=l?f-e:f+e;let M=E>0?1:-1,z=0;l&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let F,V=M>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=_e(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let j,q,K=F,J=F,Q=0,U=0;const ne=Math.abs(E),oe=[];let pe;for(;Q+U<=ne;){if(V+=M,V<p||V>=v)return null;Q+=U,J=K,q=j;const Re={absOffsetX:ne,direction:M,distanceFromAnchor:Q,previousVertex:J};if(K=Y(V,w,Re),s===0)oe.push(J),pe=K.sub(J);else{let Ue;const Me=K.sub(J);Ue=Me.mag()===0?we(Y(V+M,w,Re).sub(K),s,M):we(Me,s,M),q||(q=J.add(Ue)),j=fe(V,Ue,K,p,v,q,s,w,Re),oe.push(q),pe=j.sub(q)}U=pe.mag()}const ve=pe._mult((ne-Q)/U)._add(q||J),ke=z+Math.atan2(K.y-J.y,K.x-J.x);return oe.push(ve),{point:ve,angle:T?ke:0,path:oe}}const tt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(tt,3*l)}}function It(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const mt=100;class Pt{constructor(e,s,l=new Cn(e.width+200,e.height+200,25),u=new Cn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+mt,this.screenBottomBoundary=e.height+mt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,T,E,M,z){const F=e.anchorPointX+T[0],V=e.anchorPointY+T[1],j=this.projectAndGetPerspectiveRatio(u,F,V,p,M),q=l*j.perspectiveRatio;let K;if(v||w)K=this._projectCollisionBox(e,q,u,p,v,w,T,j,M,z);else{const oe=j.point.x+(z?z.x*q:0),pe=j.point.y+(z?z.y*q:0);K={allPointsOccluded:!1,box:[oe+e.x1*q,pe+e.y1*q,oe+e.x2*q,pe+e.y2*q]}}const[J,Q,U,ne]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?K.allPointsOccluded:this.mapProjection.isOccluded(F,V,p))||j.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(J,Q,U,ne)||s!=="always"&&this.grid.hitTest(J,Q,U,ne,s,E)?{box:[J,Q,U,ne],placeable:!1,offscreen:!1}:{box:[J,Q,U,ne],placeable:!0,offscreen:this.isOffscreen(J,Q,U,ne)}}placeCollisionCircles(e,s,l,u,p,v,w,T,E,M,z,F,V,j,q,K){const J=[],Q=new d.P(s.anchorX,s.anchorY),U=this.getPerspectiveRatio(v,Q.x,Q.y,w,K),ne=(z?p/U:p*U)/d.ap,oe={getElevation:K,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Q,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:q},pe=Z(ne,u,s.lineOffsetX*ne,s.lineOffsetY*ne,!1,s,!1,oe);let ve=!1,ke=!1,Re=!0;if(pe){const Ue=.5*V*U+j,Me=new d.P(-100,-100),Ce=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new ft,ct=pe.first,Ae=pe.last;let Ne=[];for(let gt=ct.path.length-1;gt>=1;gt--)Ne.push(ct.path[gt]);for(let gt=1;gt<Ae.path.length;gt++)Ne.push(Ae.path[gt]);const lt=2.5*Ue;if(E){const gt=this.projectPathToScreenSpace(Ne,oe,E);Ne=gt.some(wt=>wt.signedDistanceFromCamera<=0)?[]:gt.map(wt=>wt.point)}let Ht=[];if(Ne.length>0){const gt=Ne[0].clone(),wt=Ne[0].clone();for(let Wt=1;Wt<Ne.length;Wt++)gt.x=Math.min(gt.x,Ne[Wt].x),gt.y=Math.min(gt.y,Ne[Wt].y),wt.x=Math.max(wt.x,Ne[Wt].x),wt.y=Math.max(wt.y,Ne[Wt].y);Ht=gt.x>=Me.x&&wt.x<=Ce.x&&gt.y>=Me.y&&wt.y<=Ce.y?[Ne]:wt.x<Me.x||gt.x>Ce.x||wt.y<Me.y||gt.y>Ce.y?[]:d.al([Ne],Me.x,Me.y,Ce.x,Ce.y)}for(const gt of Ht){Ke.reset(gt,.25*Ue);let wt=0;wt=Ke.length<=.5*Ue?1:Math.ceil(Ke.paddedLength/lt)+1;for(let Wt=0;Wt<wt;Wt++){const Rr=Wt/Math.max(wt-1,1),Ki=Ke.lerp(Rr),Xt=Ki.x+mt,si=Ki.y+mt;J.push(Xt,si,Ue,0);const Gr=Xt-Ue,Fr=si-Ue,Hr=Xt+Ue,yn=si+Ue;if(Re=Re&&this.isOffscreen(Gr,Fr,Hr,yn),ke=ke||this.isInsideGrid(Gr,Fr,Hr,yn),e!=="always"&&this.grid.hitTestCircle(Xt,si,Ue,e,F)&&(ve=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ve}}}}return{circles:!M&&ve||!ke||U<this.perspectiveRatioCutoff?[]:J,offscreen:Re,collisionDetected:ve}}projectPathToScreenSpace(e,s,l){return e.map(u=>W(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const M of e){const z=new d.P(M.x+mt,M.y+mt);l=Math.min(l,z.x),u=Math.min(u,z.y),p=Math.max(p,z.x),v=Math.max(v,z.y),s.push(z)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),T={},E={};for(const M of w){const z=M.key;if(T[z.bucketInstanceId]===void 0&&(T[z.bucketInstanceId]={}),T[z.bucketInstanceId][z.featureIndex])continue;const F=[new d.P(M.x1,M.y1),new d.P(M.x2,M.y1),new d.P(M.x2,M.y2),new d.P(M.x1,M.y2)];d.am(s,F)&&(T[z.bucketInstanceId][z.featureIndex]=!0,E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]=[]),E[z.bucketInstanceId].push(z.featureIndex))}return E}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let E=0;E<e.length;E+=4)w.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],d.af(v,v,e)):(v=[s,l,0,1],It(v,v,e));const w=v[3];return{point:new d.P((v[0]/w+1)/2*this.transform.width+mt,(-v[1]/w+1)/2*this.transform.height+mt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):W(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<mt||e>=this.screenRightBoundary||u<mt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,T,E,M){let z=new d.P(1,0),F=new d.P(0,1);const V=new d.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const Re=this.projectAndGetPerspectiveRatio(l,V.x+1,V.y,u,E).point.sub(T.point).unit(),Ue=Math.atan(Re.y/Re.x)+(Re.x<0?Math.PI:0),Me=Math.sin(Ue),Ce=Math.cos(Ue);z=new d.P(Ce,Me),F=new d.P(-Me,Ce)}else if(!v&&p){const Re=-this.transform.angle,Ue=Math.sin(Re),Me=Math.cos(Re);z=new d.P(Me,Ue),F=new d.P(-Ue,Me)}let j=T.point,q=s;if(p){j=V;const Re=this.transform.zoom-Math.floor(this.transform.zoom);q=Math.pow(2,-Re),q*=this.mapProjection.getPitchedTextCorrection(this.transform,V,u),M||(q*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(j=j.add(z.mult(M.x*q)).add(F.mult(M.y*q)));const K=e.x1*q,J=e.x2*q,Q=(K+J)/2,U=e.y1*q,ne=e.y2*q,oe=(U+ne)/2,pe=[{offsetX:K,offsetY:U},{offsetX:Q,offsetY:U},{offsetX:J,offsetY:U},{offsetX:J,offsetY:oe},{offsetX:J,offsetY:ne},{offsetX:Q,offsetY:ne},{offsetX:K,offsetY:ne},{offsetX:K,offsetY:oe}];let ve=[];for(const{offsetX:Re,offsetY:Ue}of pe)ve.push(new d.P(j.x+z.x*Re+F.x*Ue,j.y+z.y*Re+F.y*Ue));let ke=!1;if(p){const Re=ve.map(Ue=>this.projectAndGetPerspectiveRatio(l,Ue.x,Ue.y,u,E));ke=Re.some(Ue=>!Ue.isOccluded),ve=Re.map(Ue=>Ue.point)}else ke=!0;return{box:d.ao(ve),allPointsOccluded:!ke}}}function xt(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class fr{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class er{constructor(e,s,l,u,p){this.text=new fr(e?e.text:null,s,l,p),this.icon=new fr(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class Ft{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class Jt{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class wr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Ir(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=d.au(f);return new d.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class qr{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new Pt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new wr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,T=p.layers[0].layout,E=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/d.X,F=l.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(F),j=T.get("text-pitch-alignment")==="map",q=T.get("text-rotation-alignment")==="map",K=xt(l,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),U=Gn(V,j,q,this.transform,K);let ne=null;if(j){const pe=fn(V,j,q,this.transform,K);ne=d.L([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[p.bucketInstanceId]=new Jt(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const oe={bucket:p,layout:T,translationText:J,translationIcon:Q,posMatrix:V,unwrappedTileID:F,textLabelPlaneMatrix:U,labelToScreenMatrix:ne,scale:M,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const pe of p.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:ke,symbolInstanceEnd:Re}=pe;e.push({sortKey:ve,symbolInstanceStart:ke,symbolInstanceEnd:Re,parameters:oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(e,s,l,u,p,v,w,T,E,M,z,F,V,j,q,K,J,Q,U){const ne=d.aq[e.textAnchor],oe=[e.textOffset0,e.textOffset1],pe=Ir(ne,l,u,oe,p),ve=this.collisionIndex.placeCollisionBox(s,F,T,E,M,w,v,K,z.predicate,U,pe);if((!Q||this.collisionIndex.placeCollisionBox(Q,F,T,E,M,w,v,J,z.predicate,U,pe).placeable)&&ve.placeable){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:oe,width:l,height:u,anchor:ne,textBoxScale:p,prevAnchor:ke},this.markUsedJustification(j,ne,V,q),j.allowVerticalPlacement&&(this.markUsedOrientation(j,q,V),this.placedOrientations[V.crossTileID]=q),{shift:pe,placedGlyphBoxes:ve}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:T,unwrappedTileID:E,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:F,holdingForFade:V,collisionBoxArray:j,partiallyEvaluatedTextSize:q,collisionGroup:K}=e.parameters,J=p.get("text-optional"),Q=p.get("icon-optional"),U=d.ar(p,"text-overlap","text-allow-overlap"),ne=U==="always",oe=d.ar(p,"icon-overlap","icon-allow-overlap"),pe=oe==="always",ve=p.get("text-rotation-alignment")==="map",ke=p.get("text-pitch-alignment")==="map",Re=p.get("icon-text-fit")!=="none",Ue=p.get("symbol-z-order")==="viewport-y",Me=ne&&(pe||!u.hasIconData()||Q),Ce=pe&&(ne||!u.hasTextData()||J);!u.collisionArrays&&j&&u.deserializeCollisionBoxes(j);const Ke=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),ct=(Ae,Ne,lt)=>{var Ht,gt;if(s[Ae.crossTileID])return;if(V)return void(this.placements[Ae.crossTileID]=new yt(!1,!1,!1));let wt=!1,Wt=!1,Rr=!0,Ki=null,Xt={box:null,placeable:!1,offscreen:null},si={placeable:!1},Gr=null,Fr=null,Hr=null,yn=0,so=0,al=0;Ne.textFeatureIndex?yn=Ne.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(yn=Ae.featureIndex),Ne.verticalTextFeatureIndex&&(so=Ne.verticalTextFeatureIndex);const oo=Ne.textBox;if(oo){const Li=Pr=>{let Br=d.ah.horizontal;if(u.allowVerticalPlacement&&!Pr&&this.prevPlacement){const xi=this.prevPlacement.placedOrientations[Ae.crossTileID];xi&&(this.placedOrientations[Ae.crossTileID]=xi,Br=xi,this.markUsedOrientation(u,Br,Ae))}return Br},Ri=(Pr,Br)=>{if(u.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const xi of u.writingModes)if(xi===d.ah.vertical?(Xt=Br(),si=Xt):Xt=Pr(),Xt&&Xt.placeable)break}else Xt=Pr()},Xn=Ae.textAnchorOffsetStartIndex,Ji=Ae.textAnchorOffsetEndIndex;if(Ji===Xn){const Pr=(Br,xi)=>{const St=this.collisionIndex.placeCollisionBox(Br,U,F,T,E,ke,ve,v,K.predicate,Ke);return St&&St.placeable&&(this.markUsedOrientation(u,xi,Ae),this.placedOrientations[Ae.crossTileID]=xi),St};Ri(()=>Pr(oo,d.ah.horizontal),()=>{const Br=Ne.verticalTextBox;return u.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Br?Pr(Br,d.ah.vertical):{box:null,offscreen:null}}),Li(Xt&&Xt.placeable)}else{let Pr=d.aq[(gt=(Ht=this.prevPlacement)===null||Ht===void 0?void 0:Ht.variableOffsets[Ae.crossTileID])===null||gt===void 0?void 0:gt.anchor];const Br=(St,ws,ao)=>{const lo=St.x2-St.x1,Mh=St.y2-St.y1,Vp=Ae.textBoxScale,zh=Re&&oe==="never"?ws:null;let Kn=null,Ah=U==="never"?1:2,ul="never";Pr&&Ah++;for(let la=0;la<Ah;la++){for(let cl=Xn;cl<Ji;cl++){const hl=u.textAnchorOffsets.get(cl);if(Pr&&hl.textAnchor!==Pr)continue;const uo=this.attemptAnchorPlacement(hl,St,lo,Mh,Vp,ve,ke,F,T,E,K,ul,Ae,u,ao,v,w,zh,Ke);if(uo&&(Kn=uo.placedGlyphBoxes,Kn&&Kn.placeable))return wt=!0,Ki=uo.shift,Kn}Pr?Pr=null:ul=U}return l&&!Kn&&(Kn={box:this.collisionIndex.placeCollisionBox(oo,"always",F,T,E,ke,ve,v,K.predicate,Ke,new d.P(0,0)).box,offscreen:!1,placeable:!1}),Kn};Ri(()=>Br(oo,Ne.iconBox,d.ah.horizontal),()=>{const St=Ne.verticalTextBox;return u.allowVerticalPlacement&&(!Xt||!Xt.placeable)&&Ae.numVerticalGlyphVertices>0&&St?Br(St,Ne.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Xt&&(wt=Xt.placeable,Rr=Xt.offscreen);const xi=Li(Xt&&Xt.placeable);if(!wt&&this.prevPlacement){const St=this.prevPlacement.variableOffsets[Ae.crossTileID];St&&(this.variableOffsets[Ae.crossTileID]=St,this.markUsedJustification(u,St.anchor,Ae,xi))}}}if(Gr=Xt,wt=Gr&&Gr.placeable,Rr=Gr&&Gr.offscreen,Ae.useRuntimeCollisionCircles){const Li=u.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex),Ri=d.ai(u.textSizeData,q,Li),Xn=p.get("text-padding");Fr=this.collisionIndex.placeCollisionCircles(U,Li,u.lineVertexArray,u.glyphOffsetArray,Ri,T,E,M,z,l,ke,K.predicate,Ae.collisionCircleDiameter,Xn,v,Ke),Fr.circles.length&&Fr.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),wt=ne||Fr.circles.length>0&&!Fr.collisionDetected,Rr=Rr&&Fr.offscreen}if(Ne.iconFeatureIndex&&(al=Ne.iconFeatureIndex),Ne.iconBox){const Li=Ri=>this.collisionIndex.placeCollisionBox(Ri,oe,F,T,E,ke,ve,w,K.predicate,Ke,Re&&Ki?Ki:void 0);si&&si.placeable&&Ne.verticalIconBox?(Hr=Li(Ne.verticalIconBox),Wt=Hr.placeable):(Hr=Li(Ne.iconBox),Wt=Hr.placeable),Rr=Rr&&Hr.offscreen}const Di=J||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,ll=Q||Ae.numIconVertices===0;Di||ll?ll?Di||(Wt=Wt&&wt):wt=Wt&&wt:Wt=wt=Wt&&wt;const $u=Wt&&Hr.placeable;if(wt&&Gr.placeable&&this.collisionIndex.insertCollisionBox(Gr.box,U,p.get("text-ignore-placement"),u.bucketInstanceId,si&&si.placeable&&so?so:yn,K.ID),$u&&this.collisionIndex.insertCollisionBox(Hr.box,oe,p.get("icon-ignore-placement"),u.bucketInstanceId,al,K.ID),Fr&&wt&&this.collisionIndex.insertCollisionCircles(Fr.circles,U,p.get("text-ignore-placement"),u.bucketInstanceId,yn,K.ID),l&&this.storeCollisionData(u.bucketInstanceId,lt,Ne,Gr,Hr,Fr),Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ae.crossTileID]=new yt(wt||Me,Wt||Ce,Rr||u.justReloaded),s[Ae.crossTileID]=!0};if(Ue){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ae=u.getSortedSymbolIndexes(this.transform.angle);for(let Ne=Ae.length-1;Ne>=0;--Ne){const lt=Ae[Ne];ct(u.symbolInstances.get(lt),u.collisionArrays[lt],lt)}}else for(let Ae=e.symbolInstanceStart;Ae<e.symbolInstanceEnd;Ae++)ct(u.symbolInstances.get(Ae),u.collisionArrays[Ae],Ae);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[u.bucketInstanceId];d.as(Ae.invProjMatrix,T),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?T=w.get(s):(T={text:null,icon:null},w.set(s,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new Ft);for(let T=0;T<v.circles.length;T+=4)w.circles.push(v.circles[T+0]),w.circles.push(v.circles[T+1]),w.circles.push(v.circles[T+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],M=p[T];M?(this.opacities[T]=new er(M,u,E.text,E.icon),l=l||E.text!==M.text.placed||E.icon!==M.icon.placed):(this.opacities[T]=new er(null,u,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in p){const E=p[T];if(!this.opacities[T]){const M=new er(E,u,!1,!1);M.isHidden()||(this.opacities[T]=M,l=l||E.text.placed||E.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new er(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),E=v.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",V=v.get("icon-text-fit")!=="none",j=new er(null,0,T&&(E||!e.hasIconData()||v.get("icon-optional")),E&&(T||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const q=(J,Q,U)=>{for(let ne=0;ne<Q/4;ne++)J.opacityVertexArray.emplaceBack(U);J.hasVisibleVertices=J.hasVisibleVertices||U!==Ns},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const Q=e.symbolInstances.get(J),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:ne,crossTileID:oe}=Q;let pe=this.opacities[oe];l[oe]?pe=w:pe||(pe=j,this.opacities[oe]=pe),l[oe]=!0;const ve=Q.numIconVertices>0,ke=this.placedOrientations[Q.crossTileID],Re=ke===d.ah.vertical,Ue=ke===d.ah.horizontal||ke===d.ah.horizontalOnly;if(U>0||ne>0){const Ce=_i(pe.text);q(e.text,U,Re?Ns:Ce),q(e.text,ne,Ue?Ns:Ce);const Ke=pe.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(Ne=>{Ne>=0&&(e.text.placedSymbolArray.get(Ne).hidden=Ke||Re?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Ke||Ue?1:0);const ct=this.variableOffsets[Q.crossTileID];ct&&this.markUsedJustification(e,ct.anchor,Q,ke);const Ae=this.placedOrientations[Q.crossTileID];Ae&&(this.markUsedJustification(e,"left",Q,Ae),this.markUsedOrientation(e,Ae,Q))}if(ve){const Ce=_i(pe.icon),Ke=!(V&&Q.verticalPlacedIconSymbolIndex&&Re);Q.placedIconSymbolIndex>=0&&(q(e.icon,Q.numIconVertices,Ke?Ce:Ns),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=pe.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,Q.numVerticalIconVertices,Ke?Ns:Ce),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}const Me=K&&K.has(J)?K.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ce=e.collisionArrays[J];if(Ce){let Ke=new d.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let ct=!0;if(M){const Ae=this.variableOffsets[oe];Ae?(Ke=Ir(Ae.anchor,Ae.width,Ae.height,Ae.textOffset,Ae.textBoxScale),z&&Ke._rotate(F?this.transform.angle:-this.transform.angle)):ct=!1}if(Ce.textBox||Ce.verticalTextBox){let Ae;Ce.textBox&&(Ae=Re),Ce.verticalTextBox&&(Ae=Ue),Os(e.textCollisionBox.collisionVertexArray,pe.text.placed,!ct||Ae,Me.text,Ke.x,Ke.y)}}if(Ce.iconBox||Ce.verticalIconBox){const ct=!!(!Ue&&Ce.verticalIconBox);let Ae;Ce.iconBox&&(Ae=ct),Ce.verticalIconBox&&(Ae=!ct),Os(e.iconCollisionBox.collisionVertexArray,pe.icon.placed,Ae,Me.icon,V?Ke.x:0,V?Ke.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Os(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-mt,w=l[1]-mt,T=l[2]-mt,E=l[3]-mt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,E),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,E)}const Bt=Math.pow(2,25),eu=Math.pow(2,24),tu=Math.pow(2,17),mi=Math.pow(2,16),gi=Math.pow(2,9),fp=Math.pow(2,8),Ci=Math.pow(2,1);function _i(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Bt+e*eu+s*tu+e*mi+s*gi+e*fp+s*Ci+e}const Ns=0;function us(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(u,p,v,w,T=!1){if(!v[0]&&!v[1])return[0,0];const E=T?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(E){const M=Math.sin(E),z=Math.cos(E);v=[v[0]*z-v[1]*M,v[0]*M+v[1]*z]}return[T?v[0]:xt(p,v[0],u.zoom),T?v[1]:xt(p,v[1],u.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class mr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class $o{constructor(e,s,l,u,p,v,w,T){this.placement=new qr(e,us(),s,v,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=re.now(),p=()=>!this._forceFullPlacement&&re.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new mr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const qi=512/d.X/2;class ur{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,T=u.get(w);T?T.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map(T=>({x:Math.floor(T.anchorX*qi),y:Math.floor(T.anchorY*qi)})),crossTileIDs:v.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new d.av(w.positions.length,16,Uint16Array);for(const{x:E,y:M}of w.positions)T.add(E,M);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:T}=s.canonical,E=qi/Math.pow(2,T-p),M=(w*d.X+e.anchorY)*E,z=u*d.X*qi;return{x:Math.floor((v*d.X+e.anchorX)*E-l*d.X*qi),y:Math.floor(M-z)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const T=this.getScaledCoordinates(v,s);if(w.index){const E=w.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const M of E){const z=w.crossTileIDs[M];if(!l[z]){l[z]=!0,v.crossTileID=z;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const M=w.positions[E],z=w.crossTileIDs[E];if(Math.abs(M.x-T.x)<=u&&Math.abs(M.y-T.y)<=u&&!l[z]){l[z]=!0,v.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ma{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const T=v[w];T.tileID.isChildOf(e)&&T.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ur(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class ru{constructor(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Gi);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),v[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Hi=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),mp=d.aw();class za extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new as(os(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new Ot,this.imageManager.setEventedParent(this),this.glyphManager=new Qr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Ui(256,512),this.crossTileSymbolIndex=new ru,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),dn().on(Ie,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(mp,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Hi(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this.sky=new Rt(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,v,w,T){return d._(this,void 0,void 0,function*(){const E=it(p),M=w>1?"@2x":"",z={},F={};for(const{id:V,url:j}of E){const q=v.transformRequest(et(j,M,".json"),"SpriteJSON");z[V]=d.h(q,T);const K=v.transformRequest(et(j,M,".png"),"SpriteImage");F[V]=ue.getImage(K,T)}return yield Promise.all([...Object.values(z),...Object.values(F)]),function(V,j){return d._(this,void 0,void 0,function*(){const q={};for(const K in V){q[K]={};const J=re.getImageCanvasContext((yield j[K]).data),Q=(yield V[K]).data;for(const U in Q){const{width:ne,height:oe,x:pe,y:ve,sdf:ke,pixelRatio:Re,stretchX:Ue,stretchY:Me,content:Ce,textFitWidth:Ke,textFitHeight:ct}=Q[U];q[K][U]={data:null,pixelRatio:Re,sdf:ke,stretchX:Ue,stretchY:Me,content:Ce,textFitWidth:Ke,textFitHeight:ct,spriteData:{width:ne,height:oe,x:pe,y:ve,context:J}}}}return q})}(z,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(T=>!(T in p)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[v]){const E=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,p[v][T],!1):this.imageManager.addImage(E,p[v][T]),s&&(this._changedImages[E]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?d.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&Hi(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new at(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(Hi(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.aB(e),e=d.e(e,{source:u})),this._validate(d.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const T of e){const E=T[w];if(E)for(const M of E)u.push(M)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let T=u.length-1;T>=0;T--){const E=u[T].feature;if(l[E.layer.id]<v)break;p.push(E),u.pop()}else for(const T of e){const E=T[w];if(E)for(const M of E)p.push(M.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const T=this._layers[w];if(!T)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[T.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push(Un(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push(function(w,T,E,M,z,F,V){const j={},q=F.queryRenderedSymbols(M),K=[];for(const J of Object.keys(q).map(Number))K.push(V[J]);K.sort($n);for(const J of K){const Q=J.featureIndex.lookupSymbolFeatures(q[J.bucketInstanceId],T,J.bucketIndex,J.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const U in Q){const ne=j[U]=j[U]||[],oe=Q[U];oe.sort((pe,ve)=>{const ke=J.featureSortOrder;if(ke){const Re=ke.indexOf(pe.featureIndex);return ke.indexOf(ve.featureIndex)-Re}return ve.featureIndex-pe.featureIndex});for(const pe of oe)ne.push(pe)}}for(const J in j)j[J].forEach(Q=>{const U=Q.feature,ne=E[w[J].source].getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=ne});return j}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,p){const v=u.getRenderableIds().map(E=>u.getTileByID(E)),w=[],T={};for(let E=0;E<v.length;E++){const M=v[E],z=M.tileID.canonical.key;T[z]||(T[z]=!0,M.querySourceFeatures(w,p))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:re.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:re.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&Hi(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),dn().off(Ie,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const T={};for(const E of this._order){const M=this._layers[E];if(M.type!=="symbol")continue;if(!T[M.source]){const F=this.sourceCaches[M.source];T[M.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,j)=>j.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(j.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,T[M.source],e.center.lng);v=v||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.now(),e.zoom))&&(this.pauseablePlacement=new $o(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const E of this._order){const M=this._layers[E];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...it(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=it(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return it(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var cs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const Hn={prelude:At(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:At(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:At(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:At(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:At(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:At(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:At("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:At(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:At(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:At(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:At(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:At(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:At(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:At(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:At(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:At(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:At(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:At(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:At(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:At(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:At(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:At("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:At("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:At("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:At("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function At(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,(T,E,M,z,F)=>(w[F]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(T,E,M,z,F)=>{const V=z==="float"?"vec2":"vec4",j=F.match(/color/)?"color":V;return w[F]?E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class iu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,T,E){this.context=e;let M=this.boundPaintVertexBuffers.length!==u.length;for(let z=0;!M&&z<u.length;z++)this.boundPaintVertexBuffers[z]!==u[z]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(s,l,u,p,v,w,T,E):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,s,l,u,p,v,w,T){const E=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,s.enableAttributes(z,e);for(const F of l)F.enableAttributes(z,e);v&&v.enableAttributes(z,e),w&&w.enableAttributes(z,e),T&&T.enableAttributes(z,e),s.bind(),s.setVertexAttribPointers(z,e,p);for(const F of l)F.bind(),F.setVertexAttribPointers(z,e,p);v&&(v.bind(),v.setVertexAttribPointers(z,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,e,p)),T&&(T.bind(),T.setVertexAttribPointers(z,e,p)),M.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const nu=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function Vs(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class su{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const T=Vs(s.staticAttributes),E=l?l.getBinderAttributes():[],M=T.concat(E),z=Hn.prelude.staticUniforms?Vs(Hn.prelude.staticUniforms):[],F=s.staticUniforms?Vs(s.staticUniforms):[],V=l?l.getBinderUniforms():[],j=z.concat(F).concat(V),q=[];for(const pe of j)q.indexOf(pe)<0&&q.push(pe);const K=l?l.defines():[];p&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;");const J=K.concat(Hn.prelude.fragmentSource,s.fragmentSource).join(`
`),Q=K.concat(Hn.prelude.vertexSource,s.vertexSource).join(`
`),U=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(U,J),w.compileShader(U),!w.getShaderParameter(U,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(U)}`);w.attachShader(this.program,U);const ne=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ne,Q),w.compileShader(ne),!w.getShaderParameter(ne,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ne)}`);w.attachShader(this.program,ne),this.attributes={};const oe={};this.numAttributes=M.length;for(let pe=0;pe<this.numAttributes;pe++)M[pe]&&(w.bindAttribLocation(this.program,pe,M[pe]),this.attributes[M[pe]]=pe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ne),w.deleteShader(U);for(let pe=0;pe<q.length;pe++){const ve=q[pe];if(ve&&!oe[ve]){const ke=w.getUniformLocation(this.program,ve);ke&&(oe[ve]=ke)}}this.fixedUniforms=u(e,oe),this.terrainUniforms=((pe,ve)=>({u_depth:new d.aH(pe,ve.u_depth),u_terrain:new d.aH(pe,ve.u_terrain),u_terrain_dim:new d.aI(pe,ve.u_terrain_dim),u_terrain_matrix:new d.aJ(pe,ve.u_terrain_matrix),u_terrain_unpack:new d.aK(pe,ve.u_terrain_unpack),u_terrain_exaggeration:new d.aI(pe,ve.u_terrain_exaggeration)}))(e,oe),this.binderUniforms=l?l.getUniforms(e,oe):[]}draw(e,s,l,u,p,v,w,T,E,M,z,F,V,j,q,K,J,Q){const U=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),T){e.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,T.depthTexture),e.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,T.texture);for(const oe in this.terrainUniforms)this.terrainUniforms[oe].set(T[oe])}for(const oe in this.fixedUniforms)this.fixedUniforms[oe].set(w[oe]);q&&q.setUniforms(e,this.binderUniforms,V,{zoom:j});let ne=0;switch(s){case U.LINES:ne=2;break;case U.TRIANGLES:ne=3;break;case U.LINE_STRIP:ne=1}for(const oe of F.get()){const pe=oe.vaos||(oe.vaos={});(pe[E]||(pe[E]=new iu)).bind(e,this,M,q?q.getPaintVertexBuffers():[],z,oe.vertexOffset,K,J,Q),U.drawElements(s,oe.primitiveLength*ne,U.UNSIGNED_SHORT,oe.primitiveOffset*ne*2)}}}function Aa(f,e,s){const l=1/xt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Zo=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=function(){var E=new d.A(9);return d.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();u.properties.get("anchor")==="viewport"&&function(E,M){var z=Math.sin(M),F=Math.cos(M);E[0]=F,E[1]=z,E[2]=0,E[3]=-z,E[4]=F,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(w,-e.transform.angle),function(E,M,z){var F=M[0],V=M[1],j=M[2];E[0]=F*z[0]+V*z[3]+j*z[6],E[1]=F*z[1]+V*z[4]+j*z[7],E[2]=F*z[2]+V*z[5]+j*z[8]}(v,v,w);const T=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},Da=(f,e,s,l,u,p,v)=>d.e(Zo(f,e,s,l),Aa(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),js=f=>({u_matrix:f}),Jc=(f,e,s,l)=>d.e(js(f),Aa(s,e,l)),gp=(f,e)=>({u_matrix:f,u_world:e}),Yc=(f,e,s,l,u)=>d.e(Jc(f,e,s,l),{u_world:u}),_p=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=xt(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},hs=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),qo=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),ii=f=>({u_matrix:f}),ni=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:xt(e,1,s),u_intensity:l}),La=(f,e,s,l)=>{const u=d.H();d.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Ra(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.Z(0,l/s).toLngLat().lat,new d.Z(0,(l+1)/s).toLngLat().lat]}const Fa=(f,e,s,l)=>{const u=f.transform;return{u_matrix:th(f,e,s,l),u_ratio:1/xt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Qc=(f,e,s,l,u)=>d.e(Fa(f,e,s,u),{u_image:0,u_image_height:l}),Us=(f,e,s,l,u)=>{const p=f.transform,v=eh(e,p);return{u_matrix:th(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/xt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},yp=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=eh(e,f.transform),T=s.layout.get("line-cap")==="round",E=v.getDash(l.from,T),M=v.getDash(l.to,T),z=E.width*u.fromScale,F=M.width*u.toScale;return d.e(Fa(f,e,s,p),{u_patternscale_a:[w/z,-E.height/2],u_patternscale_b:[w/F,-M.height/2],u_sdfgamma:v.width/(256*Math.min(z,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:M.y,u_mix:u.t})};function eh(f,e){return 1/xt(f,1,e.tileZoom)}function th(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const vp=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:xp(u.paint.get("raster-hue-rotate"))};var p,v};function xp(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const rh=(f,e,s,l,u,p,v,w,T,E,M,z,F,V)=>{const j=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:j.width/j.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:M,u_pitched_scale:V}},Go=(f,e,s,l,u,p,v,w,T,E,M,z,F,V,j)=>{const q=v.transform;return d.e(rh(f,e,s,l,u,p,v,w,T,E,M,z,F,j),{u_gamma_scale:l?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},ou=(f,e,s,l,u,p,v,w,T,E,M,z,F,V)=>d.e(Go(f,e,s,l,u,p,v,w,T,E,M,!0,z,!0,V),{u_texsize_icon:F,u_texture_icon:1}),Ba=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),au=(f,e,s,l,u,p)=>d.e(function(v,w,T,E){const M=T.imageManager.getPattern(v.from.toString()),z=T.imageManager.getPattern(v.to.toString()),{width:F,height:V}=T.imageManager.getPixelSize(),j=Math.pow(2,E.tileID.overscaledZ),q=E.tileSize*Math.pow(2,T.transform.tileZoom)/j,K=q*(E.tileID.canonical.x+E.tileID.wrap*j),J=q*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,V],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/xt(E,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[65535&K,65535&J]}}(l,p,s,u),{u_matrix:f,u_opacity:e}),lu={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class mn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const wp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class uu{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[wp[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ds=new WeakMap;function Wn(f){var e;if(ds.has(f))return ds.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ds.set(f,s),s}}class Dt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oa extends Dt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class bp extends Dt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class $s extends Dt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sp extends Dt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ih extends Dt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Tp extends Dt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class nh extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class cu extends Dt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class sh extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class oh extends Dt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ah extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class lh extends Dt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ps extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class uh extends Dt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class kp extends Dt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ch extends Dt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ho extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Ip extends Dt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Na extends Dt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Pp extends Dt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ep extends Dt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class hh extends Dt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class dh extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ph extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class hu extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class fh extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Va extends Dt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Mn extends Dt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Wn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class du extends Dt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class fu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ja extends Dt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class mu extends ja{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class fs extends ja{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class gu extends ja{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Cp{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new mu(e,w),u)this.depthAttachment=p?new gu(e,w):new fs(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class nr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}nr.Replace=[1,0],nr.disabled=new nr(nr.Replace,d.aM.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,d.aM.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class Mp{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Oa(this),this.clearDepth=new bp(this),this.clearStencil=new $s(this),this.colorMask=new Sp(this),this.depthMask=new ih(this),this.stencilMask=new Tp(this),this.stencilFunc=new nh(this),this.stencilOp=new cu(this),this.stencilTest=new sh(this),this.depthRange=new oh(this),this.depthTest=new ah(this),this.depthFunc=new lh(this),this.blend=new ps(this),this.blendFunc=new uh(this),this.blendColor=new kp(this),this.blendEquation=new ch(this),this.cullFace=new Ho(this),this.cullFaceSide=new Ip(this),this.frontFace=new Na(this),this.program=new Pp(this),this.activeTexture=new Ep(this),this.viewport=new hh(this),this.bindFramebuffer=new dh(this),this.bindRenderbuffer=new ph(this),this.bindTexture=new hu(this),this.bindVertexBuffer=new fh(this),this.bindElementBuffer=new Va(this),this.bindVertexArray=new Mn(this),this.pixelStoreUnpack=new du(this),this.pixelStoreUnpackPremultiplyAlpha=new pu(this),this.pixelStoreUnpackFlipY=new fu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Wn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new mn(this,e,s)}createVertexBuffer(e,s,l){return new uu(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Cp(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Wn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Wn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class vt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const Ua=7680;class $t{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}$t.disabled=new $t({func:519,mask:0},0,0,Ua,Ua,Ua);class Nt{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let ms;function Wo(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),T=[];let E=0,M=0;for(let J=0;J<l.length;J++){const Q=l[J],U=e.getTile(Q).getBucket(s);if(!U)continue;const ne=u?U.textCollisionBox:U.iconCollisionBox,oe=U.collisionCircleArray;if(oe.length>0){const pe=d.H();d.aQ(pe,U.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(pe,pe,U.placementViewportMatrix),T.push({circleArray:oe,circleOffset:M,transform:Q.posMatrix,invTransform:pe,coord:Q}),E+=oe.length/4,M=E}ne&&w.draw(p,v.LINES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,{u_matrix:Q.posMatrix,u_pixel_extrude_scale:[1/(z=f.transform).width,1/z.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q),s.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,f.transform.zoom,null,null,ne.collisionVertexBuffer)}var z;if(!u||!T.length)return;const F=f.useProgram("collisionCircle"),V=new d.aR;V.resize(4*E),V._trim();let j=0;for(const J of T)for(let Q=0;Q<J.circleArray.length/4;Q++){const U=4*Q,ne=J.circleArray[U+0],oe=J.circleArray[U+1],pe=J.circleArray[U+2],ve=J.circleArray[U+3];V.emplace(j++,ne,oe,pe,ve,0),V.emplace(j++,ne,oe,pe,ve,1),V.emplace(j++,ne,oe,pe,ve,2),V.emplace(j++,ne,oe,pe,ve,3)}(!ms||ms.length<2*E)&&(ms=function(J){const Q=2*J,U=new d.aT;U.resize(Q),U._trim();for(let ne=0;ne<Q;ne++){const oe=6*ne;U.uint16[oe+0]=4*ne+0,U.uint16[oe+1]=4*ne+1,U.uint16[oe+2]=4*ne+2,U.uint16[oe+3]=4*ne+2,U.uint16[oe+4]=4*ne+3,U.uint16[oe+5]=4*ne+0}return U}(E));const q=p.createIndexBuffer(ms,!0),K=p.createVertexBuffer(V,d.aS.members,!0);for(const J of T){const Q=hs(J.transform,J.invTransform,f.transform);F.draw(p,v.TRIANGLES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,Q,f.style.map.terrain&&f.style.map.terrain.getTerrainData(J.coord),s.id,K,q,d.a0.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,f.transform.zoom,null,null,null)}K.destroy(),q.destroy()}Nt.disabled=new Nt(!1,1029,2305),Nt.backCCW=new Nt(!0,1029,2305);const Xo=d.an(new Float32Array(16));function _u(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=d.au(f);return new d.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function gs(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const T=v.add(w);return W(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=_e(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function Zs(f,e,s,l,u,p,v,w,T,E,M,z,F,V){const j=f.text.placedSymbolArray,q=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,J={};q.clear();for(let Q=0;Q<j.length;Q++){const U=j.get(Q),ne=U.hidden||!U.crossTileID||f.allowVerticalPlacement&&!U.placedOrientation?null:l[U.crossTileID];if(ne){const oe=new d.P(U.anchorX,U.anchorY),pe={getElevation:V,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:M,tileAnchorPoint:oe,translation:z,unwrappedTileID:F},ve=s?W(oe.x,oe.y,v,V):_e(oe.x,oe.y,pe),ke=L(u.cameraToCenterDistance,ve.signedDistanceFromCamera);let Re=d.ai(f.textSizeData,T,U)*ke/d.ap;s&&(Re*=f.tilePixelRatio/w);const{width:Ue,height:Me,anchor:Ce,textOffset:Ke,textBoxScale:ct}=ne,Ae=_u(Ce,Ue,Me,Ke,ct,Re),Ne=M.getPitchedTextCorrection(u,oe.add(new d.P(z[0],z[1])),F),lt=gs(ve.point,pe,e,Ae,u.angle,Ne),Ht=f.allowVerticalPlacement&&U.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let gt=0;gt<U.numGlyphs;gt++)d.aj(q,lt,Ht);E&&U.associatedIconIndex>=0&&(J[U.associatedIconIndex]={shiftedAnchor:lt,angle:Ht})}else nt(U.numGlyphs,q)}if(E){K.clear();const Q=f.icon.placedSymbolArray;for(let U=0;U<Q.length;U++){const ne=Q.get(U);if(ne.hidden)nt(ne.numGlyphs,K);else{const oe=J[U];if(oe)for(let pe=0;pe<ne.numGlyphs;pe++)d.aj(K,oe.shiftedAnchor,oe.angle);else nt(ne.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(q)}function Mi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function yu(f,e,s,l,u,p,v,w,T,E,M,z){const F=f.context,V=F.gl,j=f.transform,q=us(),K=w==="map",J=T==="map",Q=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",U=K&&!J&&!Q,ne=!J&&Q,oe=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const ve=f.depthModeForSublayer(0,vt.ReadOnly),ke=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],Ue=q.getCircleRadiusCorrection(j);for(const Me of l){const Ce=e.getTile(Me),Ke=Ce.getBucket(s);if(!Ke)continue;const ct=u?Ke.text:Ke.icon;if(!ct||!ct.segments.get().length||!ct.hasVisibleVertices)continue;const Ae=ct.programConfigurations.get(s.id),Ne=u||Ke.sdfIcons,lt=u?Ke.textSizeData:Ke.iconSizeData,Ht=J||j.pitch!==0,gt=f.useProgram(Mi(Ne,u,Ke),Ae),wt=d.ag(lt,j.zoom),Wt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me);let Rr,Ki,Xt,si,Gr=[0,0],Fr=null;if(u)Ki=Ce.glyphAtlasTexture,Xt=V.LINEAR,Rr=Ce.glyphAtlasTexture.size,Ke.iconsInText&&(Gr=Ce.imageAtlasTexture.size,Fr=Ce.imageAtlasTexture,si=Ht||f.options.rotating||f.options.zooming||lt.kind==="composite"||lt.kind==="camera"?V.LINEAR:V.NEAREST);else{const St=s.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;Ki=Ce.imageAtlasTexture,Xt=Ne||f.options.rotating||f.options.zooming||St||Ht?V.LINEAR:V.NEAREST,Rr=Ce.imageAtlasTexture.size}const Hr=xt(Ce,1,f.transform.zoom),yn=ne?Me.posMatrix:Xo,so=Gn(yn,J,K,f.transform,Hr),al=fn(yn,J,K,f.transform,Hr),oo=fn(Me.posMatrix,J,K,f.transform,Hr),Di=q.translatePosition(f.transform,Ce,p,v),ll=ke&&Ke.hasTextData(),$u=s.layout.get("icon-text-fit")!=="none"&&ll&&Ke.hasIconData();if(Q){const St=f.style.map.terrain?(ao,lo)=>f.style.map.terrain.getElevation(Me,ao,lo):null,ws=s.layout.get("text-rotation-alignment")==="map";N(Ke,Me.posMatrix,f,u,so,oo,J,E,ws,q,Me.toUnwrapped(),j.width,j.height,Di,St)}const Li=Me.posMatrix,Ri=u&&ke||$u,Xn=Q||Ri?Xo:so,Ji=al,Pr=Ne&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Br;Br=Ne?Ke.iconsInText?ou(lt.kind,wt,U,J,Q,Ri,f,Li,Xn,Ji,Di,Rr,Gr,Ue):Go(lt.kind,wt,U,J,Q,Ri,f,Li,Xn,Ji,Di,u,Rr,!0,Ue):rh(lt.kind,wt,U,J,Q,Ri,f,Li,Xn,Ji,Di,u,Rr,Ue);const xi={program:gt,buffers:ct,uniformValues:Br,atlasTexture:Ki,atlasTextureIcon:Fr,atlasInterpolation:Xt,atlasInterpolationIcon:si,isSDF:Ne,hasHalo:Pr};if(oe&&Ke.canOverlap){pe=!0;const St=ct.segments.get();for(const ws of St)Re.push({segments:new d.a0([ws]),sortKey:ws.sortKey,state:xi,terrainData:Wt})}else Re.push({segments:ct.segments,sortKey:0,state:xi,terrainData:Wt})}pe&&Re.sort((Me,Ce)=>Me.sortKey-Ce.sortKey);for(const Me of Re){const Ce=Me.state;if(F.activeTexture.set(V.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,V.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ce.isSDF){const Ke=Ce.uniformValues;Ce.hasHalo&&(Ke.u_is_halo=1,vu(Ce.buffers,Me.segments,s,f,Ce.program,ve,M,z,Ke,Me.terrainData)),Ke.u_is_halo=0}vu(Ce.buffers,Me.segments,s,f,Ce.program,ve,M,z,Ce.uniformValues,Me.terrainData)}}function vu(f,e,s,l,u,p,v,w,T,E){const M=l.context;u.draw(M,M.gl.TRIANGLES,p,v,w,Nt.disabled,T,E,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function xu(f,e,s,l){const u=f.context,p=u.gl,v=$t.disabled,w=new nr([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(s);if(!T)return;const E=l.key;let M=s.heatmapFbos.get(E);M||(M=Ko(u,e.tileSize,e.tileSize),s.heatmapFbos.set(E,M)),u.bindFramebuffer.set(M.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:d.aM.transparent});const z=T.programConfigurations.get(s.id),F=f.useProgram("heatmap",z),V=f.style.map.terrain.getTerrainData(l);F.draw(u,p.TRIANGLES,vt.disabled,v,w,Nt.disabled,ni(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),V,s.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,s.paint,f.transform.zoom,z)}function _s(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=Jo(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,vt.disabled,$t.disabled,f.colorModeForRenderPass(),Nt.disabled,La(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function Ko(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,s,0,p.RGBA,w,null);const E=f.createFramebuffer(e,s,!1,!1);return E.colorAttachment.set(v),E}function Jo(f,e){return e.colorRampTexture||(e.colorRampTexture=new ht(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function qs(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const T=u.getPaintProperty(e);v=p[T],w=p[T]}v&&w&&f.setConstantPatternPositions(v,w)}function Yo(f,e,s,l,u,p,v){const w=f.context.gl,T="fill-pattern",E=s.paint.get(T),M=E&&E.constantOr(1),z=s.getCrossfadeParameters();let F,V,j,q,K;v?(V=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(V=M?"fillPattern":"fill",F=w.TRIANGLES);const J=E.constantOr(null);for(const Q of l){const U=e.getTile(Q);if(M&&!U.patternsLoaded())continue;const ne=U.getBucket(s);if(!ne)continue;const oe=ne.programConfigurations.get(s.id),pe=f.useProgram(V,oe),ve=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q);M&&(f.context.activeTexture.set(w.TEXTURE0),U.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),oe.updatePaintBuffers(z)),qs(oe,T,J,U,s);const ke=ve?Q:null,Re=f.translatePosMatrix(ke?ke.posMatrix:Q.posMatrix,U,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){q=ne.indexBuffer2,K=ne.segments2;const Ue=[w.drawingBufferWidth,w.drawingBufferHeight];j=V==="fillOutlinePattern"&&M?Yc(Re,f,z,U,Ue):gp(Re,Ue)}else q=ne.indexBuffer,K=ne.segments,j=M?Jc(Re,f,z,U):js(Re);pe.draw(f.context,F,u,f.stencilModeForClipping(Q),p,Nt.disabled,j,ve,s.id,ne.layoutVertexBuffer,q,K,s.paint,f.transform.zoom,oe)}}function $a(f,e,s,l,u,p,v){const w=f.context,T=w.gl,E="fill-extrusion-pattern",M=s.paint.get(E),z=M.constantOr(1),F=s.getCrossfadeParameters(),V=s.paint.get("fill-extrusion-opacity"),j=M.constantOr(null);for(const q of l){const K=e.getTile(q),J=K.getBucket(s);if(!J)continue;const Q=f.style.map.terrain&&f.style.map.terrain.getTerrainData(q),U=J.programConfigurations.get(s.id),ne=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",U);z&&(f.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),U.updatePaintBuffers(F)),qs(U,E,j,K,s);const oe=f.translatePosMatrix(q.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pe=s.paint.get("fill-extrusion-vertical-gradient"),ve=z?Da(oe,f,pe,V,q,F,K):Zo(oe,f,pe,V);ne.draw(w,w.gl.TRIANGLES,u,p,v,Nt.backCCW,ve,Q,s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,f.transform.zoom,U,f.style.map.terrain&&J.centroidVertexBuffer)}}function Gs(f,e,s,l,u,p,v){const w=f.context,T=w.gl,E=s.fbo;if(!E)return;const M=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment.get()),M.draw(w,T.TRIANGLES,u,p,v,Nt.disabled,((F,V,j,q)=>{const K=j.paint.get("hillshade-shadow-color"),J=j.paint.get("hillshade-highlight-color"),Q=j.paint.get("hillshade-accent-color");let U=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(U-=F.transform.angle);const ne=!F.options.moving;return{u_matrix:q?q.posMatrix:F.transform.calculatePosMatrix(V.tileID.toUnwrapped(),ne),u_image:0,u_latrange:Ra(0,V.tileID),u_light:[j.paint.get("hillshade-exaggeration"),U],u_shadow:K,u_highlight:J,u_accent:Q}})(f,s,l,z?e:null),z,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Hs(f,e,s,l,u,p){const v=f.context,w=v.gl,T=e.dem;if(T&&T.data){const E=T.dim,M=T.stride,z=T.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(M),e.demTexture){const V=e.demTexture;V.update(z,{premultiply:!1}),V.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new ht(v,z,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const V=new ht(v,{width:E,height:E,data:null},w.RGBA);V.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(E,E,!0,!1),F.colorAttachment.set(V.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,E,E]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,Nt.disabled,((V,j)=>{const q=j.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[q,q],u_zoom:V.overscaledZ,u_unpack:j.getUnpackVector()}})(e.tileID,T),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function mh(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=re.now(),T=(w-f.timeAdded)/v,E=e?(w-e.timeAdded)/v:-1,M=s.getSource(),z=u.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),V=F&&f.refreshedUponExpiration?1:d.ac(F?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const wu=new d.aM(1,0,0,1),Ct=new d.aM(0,1,0,1),Za=new d.aM(0,0,1,1),zp=new d.aM(1,0,1,1),gh=new d.aM(0,1,1,1);function Ws(f,e,s,l){qa(f,0,e+s/2,f.transform.width,s,l)}function _h(f,e,s,l){qa(f,e-s/2,0,s,f.transform.height,l)}function qa(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function yh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=vt.disabled,T=$t.disabled,E=f.colorModeForRenderPass(),M="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,V=Math.floor((F&&F.byteLength||0)/1024),j=e.getTile(s).tileSize,q=512/Math.min(j,512)*(s.overscaledZ/f.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(J,Q){J.initDebugOverlayCanvas();const U=J.debugOverlayCanvas,ne=J.context.gl,oe=J.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,U.width,U.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(Q,5,5),oe.strokeText(Q,5,5),J.debugOverlayTexture.update(U),J.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(f,`${K} ${V}kB`),v.draw(l,u.TRIANGLES,w,T,nr.alphaBlended,Nt.disabled,qo(p,d.aM.transparent,q),null,M,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,T,E,Nt.disabled,qo(p,d.aM.red),z,M,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function vh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new vt(u.LEQUAL,vt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const E of s){const M=f.renderToTexture.getTexture(E),z=e.getTerrainData(E.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,M.texture);const F=f.transform.calculatePosMatrix(E.tileID.toUnwrapped()),V=e.getMeshFrameDelta(f.transform.zoom),j=f.transform.calculateFogMatrix(E.tileID.toUnwrapped()),q=nu(F,V,j,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,$t.disabled,p,Nt.backCCW,q,z,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Ga{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ha{constructor(e,s){this.context=new Mp(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=at.maxUnderzooming+at.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ru}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,cs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.X,0),l.emplaceBack(0,d.X),l.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(l,cs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const u=new d.$;u.emplaceBack(0,0,0,0),u.emplaceBack(d.X,0,d.X,0),u.emplaceBack(0,d.X,0,d.X),u.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,Zn.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,cs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new $t({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.H();d.aP(l,0,this.width,this.height,0,0,1),d.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,vt.disabled,this.stencilClearMode,nr.disabled,Nt.disabled,ii(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(nr.disabled),l.setDepthMode(vt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,vt.disabled,new $t({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),nr.disabled,Nt.disabled,ii(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new $t({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new $t({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new $t({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:$t.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new nr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nr.unblended:nr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return vt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(re.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const T in u){const E=u[T];E.used&&E.prepare(this.context),p[T]=E.getVisibleCoordinates(),v[T]=p[T].slice().reverse(),w[T]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const E=this.style._layers[T];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const M=v[E.source];(E.type==="custom"||M.length)&&this.renderLayer(this,u[E.source],E,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,E){const M=T.context,z=M.gl,F=((J,Q,U)=>({u_sky_color:J.properties.get("sky-color"),u_horizon_color:J.properties.get("horizon-color"),u_horizon:(Q.height/2+Q.getHorizon())*U,u_sky_horizon_blend:J.properties.get("sky-horizon-blend")*Q.height/2*U}))(E,T.style.map.transform,T.pixelRatio),V=new vt(z.LEQUAL,vt.ReadWrite,[0,1]),j=$t.disabled,q=T.colorModeForRenderPass(),K=T.useProgram("sky");if(!E.mesh){const J=new d.aX;J.emplaceBack(-1,-1),J.emplaceBack(1,-1),J.emplaceBack(1,1),J.emplaceBack(-1,1);const Q=new d.aY;Q.emplaceBack(0,1,2),Q.emplaceBack(0,2,3),E.mesh=new Ga(M.createVertexBuffer(J,cs.members),M.createIndexBuffer(Q),d.a0.simpleSegment(0,0,J.length,Q.length))}K.draw(M,z.TRIANGLES,V,j,q,Nt.disabled,F,void 0,"sky",E.mesh.vertexBuffer,E.mesh.indexBuffer,E.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],E=u[T.source],M=p[T.source];this._renderTileClippingMasks(T,M),this.renderLayer(this,E,T,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],E=u[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const M=(T.type==="symbol"?w:v)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,E,T,M)}if(this.options.showTileBoundaries){const T=function(E,M){let z=null;const F=Object.values(E._layers).flatMap(K=>K.source&&!K.isHidden(M)?[E.sourceCaches[K.source]]:[]),V=F.filter(K=>K.getSource().type==="vector"),j=F.filter(K=>K.getSource().type!=="vector"),q=K=>{(!z||z.getSource().maxzoom<K.getSource().maxzoom)&&(z=K)};return V.forEach(K=>q(K)),z||j.forEach(K=>q(K)),z}(this.style,this.transform.zoom);T&&function(E,M,z){for(let F=0;F<z.length;F++)yh(E,M,z[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const E=T.transform.padding;Ws(T,T.transform.height-(E.top||0),3,wu),Ws(T,E.bottom||0,3,Ct),_h(T,E.left||0,3,Za),_h(T,T.transform.width-(E.right||0),3,zp);const M=T.transform.centerPoint;(function(z,F,V,j){qa(z,F-1,V-10,2,20,j),qa(z,F-10,V-1,20,2,j)})(T,M.x,T.transform.height-M.y,gh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.a_(s,l):!d.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,v){const w=p.context,T=w.gl,E=nr.unblended,M=new vt(T.LEQUAL,vt.ReadWrite,[0,1]),z=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1});for(const j of F){const q=v.getTerrainData(j.tileID),K={u_matrix:p.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};V.draw(w,T.TRIANGLES,M,$t.disabled,E,Nt.backCCW,K,q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,v){const w=p.context,T=w.gl,E=nr.unblended,M=new vt(T.LEQUAL,vt.ReadWrite,[0,1]),z=v.getTerrainMesh(),F=v.getCoordsTexture(),V=v.sourceCache.getRenderableTiles(),j=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const q of V){const K=v.getTerrainData(q.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const J={u_matrix:p.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};j.draw(w,T.TRIANGLES,M,$t.disabled,E,Nt.backCCW,J,K,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),v.coordsIndex.push(q.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,T,E){if(p.renderPass!=="translucent")return;const M=$t.disabled,z=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,V,j,q,K,J,Q,U,ne){const oe=V.transform,pe=us(),ve=K==="map",ke=J==="map";for(const Re of F){const Ue=q.getTile(Re),Me=Ue.getBucket(j);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const Ce=d.ag(Me.textSizeData,oe.zoom),Ke=xt(Ue,1,V.transform.zoom),ct=Gn(Re.posMatrix,ke,ve,V.transform,Ke),Ae=j.layout.get("icon-text-fit")!=="none"&&Me.hasIconData();if(Ce){const Ne=Math.pow(2,oe.zoom-Ue.tileID.overscaledZ),lt=V.style.map.terrain?(gt,wt)=>V.style.map.terrain.getElevation(Re,gt,wt):null,Ht=pe.translatePosition(oe,Ue,Q,U);Zs(Me,ve,ke,ne,oe,ct,Re.posMatrix,Ne,Ce,Ae,pe,Ht,Re.toUnwrapped(),lt)}}}(T,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),E),w.paint.get("icon-opacity").constantOr(1)!==0&&yu(p,v,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,z),w.paint.get("text-opacity").constantOr(1)!==0&&yu(p,v,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,z),v.map.showCollisionBoxes&&(Wo(p,v,w,T,!0),Wo(p,v,w,T,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const E=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const V=p.context,j=V.gl,q=p.depthModeForSublayer(0,vt.ReadOnly),K=$t.disabled,J=p.colorModeForRenderPass(),Q=[];for(let U=0;U<T.length;U++){const ne=T[U],oe=v.getTile(ne),pe=oe.getBucket(w);if(!pe)continue;const ve=pe.programConfigurations.get(w.id),ke=p.useProgram("circle",ve),Re=pe.layoutVertexBuffer,Ue=pe.indexBuffer,Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ne),Ce={programConfiguration:ve,program:ke,layoutVertexBuffer:Re,indexBuffer:Ue,uniformValues:_p(p,ne,oe,w),terrainData:Me};if(F){const Ke=pe.segments.get();for(const ct of Ke)Q.push({segments:new d.a0([ct]),sortKey:ct.sortKey,state:Ce})}else Q.push({segments:pe.segments,sortKey:0,state:Ce})}F&&Q.sort((U,ne)=>U.sortKey-ne.sortKey);for(const U of Q){const{programConfiguration:ne,program:oe,layoutVertexBuffer:pe,indexBuffer:ve,uniformValues:ke,terrainData:Re}=U.state;oe.draw(V,j.TRIANGLES,q,K,J,Nt.disabled,ke,Re,w.id,pe,ve,U.segments,w.paint,p.transform.zoom,ne)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,T){if(w.paint.get("heatmap-opacity")===0)return;const E=p.context;if(p.style.map.terrain){for(const M of T){const z=v.getTile(M);v.hasRenderableParent(M)||(p.renderPass==="offscreen"?xu(p,z,w,M):p.renderPass==="translucent"&&_s(p,w,M))}E.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(M,z,F,V){const j=M.context,q=j.gl,K=$t.disabled,J=new nr([q.ONE,q.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(Q,U,ne){const oe=Q.gl;Q.activeTexture.set(oe.TEXTURE1),Q.viewport.set([0,0,U.width/4,U.height/4]);let pe=ne.heatmapFbos.get(d.aU);pe?(oe.bindTexture(oe.TEXTURE_2D,pe.colorAttachment.get()),Q.bindFramebuffer.set(pe.framebuffer)):(pe=Ko(Q,U.width/4,U.height/4),ne.heatmapFbos.set(d.aU,pe))})(j,M,F),j.clear({color:d.aM.transparent});for(let Q=0;Q<V.length;Q++){const U=V[Q];if(z.hasRenderableParent(U))continue;const ne=z.getTile(U),oe=ne.getBucket(F);if(!oe)continue;const pe=oe.programConfigurations.get(F.id),ve=M.useProgram("heatmap",pe),{zoom:ke}=M.transform;ve.draw(j,q.TRIANGLES,vt.disabled,K,J,Nt.disabled,ni(U.posMatrix,ne,ke,F.paint.get("heatmap-intensity")),null,F.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,F.paint,M.transform.zoom,pe)}j.viewport.set([0,0,M.width,M.height])}(p,v,w,T):p.renderPass==="translucent"&&function(M,z){const F=M.context,V=F.gl;F.setColorMode(M.colorModeForRenderPass());const j=z.heatmapFbos.get(d.aU);j&&(F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,j.colorAttachment.get()),F.activeTexture.set(V.TEXTURE1),Jo(F,z).bind(V.LINEAR,V.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(F,V.TRIANGLES,vt.disabled,$t.disabled,M.colorModeForRenderPass(),Nt.disabled,La(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const E=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(E.constantOr(1)===0||M.constantOr(1)===0)return;const z=p.depthModeForSublayer(0,vt.ReadOnly),F=p.colorModeForRenderPass(),V=w.paint.get("line-dasharray"),j=w.paint.get("line-pattern"),q=j.constantOr(1),K=w.paint.get("line-gradient"),J=w.getCrossfadeParameters(),Q=q?"linePattern":V?"lineSDF":K?"lineGradient":"line",U=p.context,ne=U.gl;let oe=!0;for(const pe of T){const ve=v.getTile(pe);if(q&&!ve.patternsLoaded())continue;const ke=ve.getBucket(w);if(!ke)continue;const Re=ke.programConfigurations.get(w.id),Ue=p.context.program.get(),Me=p.useProgram(Q,Re),Ce=oe||Me.program!==Ue,Ke=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe),ct=j.constantOr(null);if(ct&&ve.imageAtlas){const lt=ve.imageAtlas,Ht=lt.patternPositions[ct.to.toString()],gt=lt.patternPositions[ct.from.toString()];Ht&&gt&&Re.setConstantPatternPositions(Ht,gt)}const Ae=Ke?pe:null,Ne=q?Us(p,ve,w,J,Ae):V?yp(p,ve,w,V,J,Ae):K?Qc(p,ve,w,ke.lineClipsArray.length,Ae):Fa(p,ve,w,Ae);if(q)U.activeTexture.set(ne.TEXTURE0),ve.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Re.updatePaintBuffers(J);else if(V&&(Ce||p.lineAtlas.dirty))U.activeTexture.set(ne.TEXTURE0),p.lineAtlas.bind(U);else if(K){const lt=ke.gradients[w.id];let Ht=lt.texture;if(w.gradientVersion!==lt.version){let gt=256;if(w.stepInterpolant){const wt=v.getSource().maxzoom,Wt=pe.canonical.z===wt?Math.ceil(1<<p.transform.maxZoom-pe.canonical.z):1;gt=d.ac(d.aV(ke.maxLineLength/d.X*1024*Wt),256,U.maxTextureSize)}lt.gradient=d.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:gt,image:lt.gradient||void 0,clips:ke.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new ht(U,lt.gradient,ne.RGBA),lt.version=w.gradientVersion,Ht=lt.texture}U.activeTexture.set(ne.TEXTURE0),Ht.bind(w.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Me.draw(U,ne.TRIANGLES,z,p.stencilModeForClipping(pe),F,Nt.disabled,Ne,Ke,w.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,w.paint,p.transform.zoom,Re,ke.layoutVertexBuffer2),oe=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,T){const E=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=p.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(d.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===V){const j=p.depthModeForSublayer(1,p.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);Yo(p,v,w,T,j,z,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const j=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);Yo(p,v,w,T,j,z,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,T){const E=w.paint.get("fill-extrusion-opacity");if(E!==0&&p.renderPass==="translucent"){const M=new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D);if(E!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))$a(p,v,w,T,M,$t.disabled,nr.disabled),$a(p,v,w,T,M,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const z=p.colorModeForRenderPass();$a(p,v,w,T,M,$t.disabled,z)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const E=p.context,M=p.depthModeForSublayer(0,vt.ReadOnly),z=p.colorModeForRenderPass(),[F,V]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const j of V){const q=v.getTile(j);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&p.renderPass==="offscreen"?Hs(p,q,w,M,$t.disabled,z):p.renderPass==="translucent"&&Gs(p,j,q,w,M,F[j.overscaledZ],z)}E.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,T){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const E=p.context,M=E.gl,z=v.getSource(),F=p.useProgram("raster"),V=p.colorModeForRenderPass(),[j,q]=z instanceof En?[{},T]:p.stencilConfigForOverlap(T),K=q[q.length-1].overscaledZ,J=!p.options.moving;for(const Q of q){const U=p.depthModeForSublayer(Q.overscaledZ-K,w.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,M.LESS),ne=v.getTile(Q);ne.registerFadeDuration(w.paint.get("raster-fade-duration"));const oe=v.findLoadedParent(Q,0),pe=v.findLoadedSibling(Q),ve=mh(ne,oe||pe||null,v,w,p.transform,p.style.map.terrain);let ke,Re;const Ue=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;E.activeTexture.set(M.TEXTURE0),ne.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(M.TEXTURE1),oe?(oe.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ke=Math.pow(2,oe.tileID.overscaledZ-ne.tileID.overscaledZ),Re=[ne.tileID.canonical.x*ke%1,ne.tileID.canonical.y*ke%1]):ne.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ne.texture.useMipmap&&E.extTextureFilterAnisotropic&&p.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),Ce=Me?Q:null,Ke=Ce?Ce.posMatrix:p.transform.calculatePosMatrix(Q.toUnwrapped(),J),ct=vp(Ke,Re||[0,0],ke||1,ve,w);z instanceof En?F.draw(E,M.TRIANGLES,U,$t.disabled,V,Nt.disabled,ct,Me,w.id,z.boundsBuffer,p.quadTriangleIndexBuffer,z.boundsSegments):F.draw(E,M.TRIANGLES,U,j[Q.overscaledZ],V,Nt.disabled,ct,Me,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,T){const E=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const z=p.context,F=z.gl,V=p.transform,j=V.tileSize,q=w.paint.get("background-pattern");if(p.isPatternMissing(q))return;const K=!q&&E.a===1&&M===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==K)return;const J=$t.disabled,Q=p.depthModeForSublayer(0,K==="opaque"?vt.ReadWrite:vt.ReadOnly),U=p.colorModeForRenderPass(),ne=p.useProgram(q?"backgroundPattern":"background"),oe=T||V.coveringTiles({tileSize:j,terrain:p.style.map.terrain});q&&(z.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const pe=w.getCrossfadeParameters();for(const ve of oe){const ke=T?ve.posMatrix:p.transform.calculatePosMatrix(ve.toUnwrapped()),Re=q?au(ke,M,p,q,{tileID:ve,tileSize:j},pe):Ba(ke,M,E),Ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ve);ne.draw(z,F.TRIANGLES,Q,J,U,Nt.disabled,Re,Ue,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const T=p.context,E=w.implementation;if(p.renderPass==="offscreen"){const M=E.prerender;M&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),M.call(E,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode($t.disabled);const M=E.renderingMode==="3d"?new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,vt.ReadOnly);T.setDepthMode(M),E.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const E=Math.sin(v),M=Math.cos(v);l=[l[0]*M-l[1]*E,l[0]*E+l[1]*M]}const w=[p?l[0]:xt(s,l[0],this.transform.zoom),p?l[1]:xt(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,w),T}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new su(this.context,Hn[e],s,lu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ht(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Xs{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=1/(w=d.af([],w,e))[3]/s*u;return d.b1(w,w,[T,T,1/w[3],T])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=function(F,V){var j=V[0],q=V[1],K=V[2],J=j*j+q*q+K*K;return J>0&&(J=1/Math.sqrt(J)),F[0]=V[0]*J,F[1]=V[1]*J,F[2]=V[2]*J,F}([],function(F,V,j){var q=V[0],K=V[1],J=V[2],Q=j[0],U=j[1],ne=j[2];return F[0]=K*ne-J*U,F[1]=J*Q-q*ne,F[2]=q*U-K*Q,F}([],Ge([],p[w[0]],p[w[1]]),Ge([],p[w[2]],p[w[1]]))),E=-((M=T)[0]*(z=p[w[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return T.concat(E)});return new Xs(p,v)}}class Ks{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=je(this.min),u=je(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Ks(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)d.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][u]-this.min[u];p=Math.min(p,T),v=Math.max(v,T)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class Js{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=d.ac((this.left+e-this.right)/2,0,e),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bu=85.051129;class Ys{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Js,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Ys(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,p){var v=u[0],w=u[1],T=u[2],E=u[3],M=Math.sin(p),z=Math.cos(p);l[0]=v*z+T*M,l[1]=w*z+E*M,l[2]=v*-M+T*z,l[3]=w*-M+E*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),T=Math.floor(Math.max(l.x,u.x,p.x,v.x)),E=1;for(let M=w-E;M<=T+E;M++)M!==0&&s.push(new d.b4(M,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Z.fromLngLat(this.center),T=Math.pow(2,u),E=[T*v.x,T*v.y,0],M=[T*w.x,T*w.y,0],z=Xs.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,j=U=>({aabb:new Ks([U*T,0,0],[(U+1)*T,T,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),q=[],K=[],J=u,Q=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let U=1;U<=3;U++)q.push(j(-U)),q.push(j(U));for(q.push(j(0));q.length>0;){const U=q.pop(),ne=U.x,oe=U.y;let pe=U.fullyVisible;if(!pe){const Me=U.aabb.intersects(z);if(Me===0)continue;pe=Me===2}const ve=e.terrain?E:M,ke=U.aabb.distanceX(ve),Re=U.aabb.distanceY(ve),Ue=Math.max(Math.abs(ke),Math.abs(Re));if(U.zoom===J||Ue>V+(1<<J-U.zoom)-2&&U.zoom>=F){const Me=J-U.zoom,Ce=E[0]-.5-(ne<<Me),Ke=E[1]-.5-(oe<<Me);K.push({tileID:new d.S(U.zoom===J?Q:U.zoom,U.wrap,U.zoom,ne,oe),distanceSq:Se([M[0]-.5-ne,M[1]-.5-oe]),tileDistanceToCamera:Math.sqrt(Ce*Ce+Ke*Ke)})}else for(let Me=0;Me<4;Me++){const Ce=(ne<<1)+Me%2,Ke=(oe<<1)+(Me>>1),ct=U.zoom+1;let Ae=U.aabb.quadrant(Me);if(e.terrain){const Ne=new d.S(ct,U.wrap,ct,Ce,Ke),lt=e.terrain.getMinMaxElevation(Ne),Ht=(s=lt.minElevation)!==null&&s!==void 0?s:this.elevation,gt=(l=lt.maxElevation)!==null&&l!==void 0?l:this.elevation;Ae=new Ks([Ae.min[0],Ae.min[1],Ht],[Ae.max[0],Ae.max[1],gt])}q.push({aabb:Ae,zoom:ct,x:Ce,y:Ke,wrap:U.wrap,fullyVisible:pe})}}return K.sort((U,ne)=>U.distanceSq-ne.distanceSq).map(U=>U.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,bu);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,u.lat),T=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=T}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new d.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,T=u[1]/v,E=l[2]/p,M=u[2]/v,z=E===M?0:(0-E)/(M-E);return new d.Z(d.y.number(l[0]/p,u[0]/v,z)/this.worldSize,d.y.number(w,T,z)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new me().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new me([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,bu])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[u*l,s.y*l,0]),d.K(p,p,[l/d.X,l/d.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return d.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const U=179.9999999999;u=[-U,U]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,T=0,E=p,M=0,z=0;const{x:F,y:V}=this.size;if(this.latRange){const U=this.latRange;v=d.Q(U[1])*p,w=d.Q(U[0])*p,w-v<V&&(M=V/(w-v))}u&&(T=d.b3(d.O(u[0])*p,0,p),E=d.b3(d.O(u[1])*p,0,p),E<T&&(E+=p),E-T<F&&(z=F/(E-T)));const{x:j,y:q}=this.project.call({worldSize:p},e);let K,J;const Q=Math.max(z||0,M||0);if(Q){const U=new d.P(z?(E+T)/2:j,M?(w+v)/2:q);return l.center=this.unproject.call({worldSize:p},U).wrap(),l.zoom+=this.scaleZoom(Q),l}if(this.latRange){const U=V/2;q-U<v&&(J=v+U),q+U>w&&(J=w-U)}if(u){const U=(T+E)/2;let ne=j;this._renderWorldCopies&&(ne=d.b3(j,U-p/2,U+p/2));const oe=F/2;ne-oe<T&&(K=T+oe),ne+oe>E&&(K=E-oe)}if(K!==void 0||J!==void 0){const U=new d.P(K??j,J??q);l.center=this.unproject.call({worldSize:p},U).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.K(u,u,[this.width/2,-this.height/2,1]),d.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.K(u,u,[1,-1,1]),d.J(u,u,[-1,-1,0]),d.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),T=v<0?w:p,E=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*T/Math.sin(d.ac(Math.PI-E-M,.01,Math.PI-.01)),F=this.getHorizon(),V=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),j=Math.sin(V)*T/Math.sin(d.ac(Math.PI-E-V,.01,Math.PI-.01)),q=Math.min(z,j);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*q+T),this.nearZ=this.height/50,u=new Float64Array(16),d.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=d.ae(u),d.K(u,u,[1,-1,1]),d.J(u,u,[0,0,-this.cameraToCenterDistance]),d.b7(u,u,this._pitch),d.ad(u,u,this.angle),d.J(u,u,[-s,-l,0]),this.mercatorMatrix=d.K([],u,[this.worldSize,this.worldSize,this.worldSize]),d.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,u),d.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=d.as([],u),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,u);const K=this.width%2/2,J=this.height%2/2,Q=Math.cos(this.angle),U=Math.sin(this.angle),ne=s-Math.round(s)+Q*K+U*J,oe=l-Math.round(l)+Q*J+U*K,pe=new Float64Array(u);if(d.J(pe,pe,[ne>.5?ne-1:ne,oe>.5?oe-1:oe,0]),this.alignedModelViewProjectionMatrix=pe,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new d.P(l,u),new d.P(p,u),new d.P(p,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function Qo(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class Wa{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Qo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,T=this._map.getBearing(),E=this._map.getPitch();let M="";if(M+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(T||E)&&(M+="/"+Math.round(10*T)/10),E&&(M+=`/${Math.round(E)}`),this._hashName){const z=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map(j=>{const q=j.split("=")[0];return q===z?(F=!0,`${q}=${M}`):j}).filter(j=>j);return F||V.push(`${z}=${M}`),`#${V.join("&")}`}return`#${M}`}}const Xa={linearity:.3,easing:d.b8(0,0,.3,1)},Su=d.e({deceleration:2500,maxSpeed:1400},Xa),Ap=d.e({deceleration:20,maxSpeed:1400},Xa),xh=d.e({deceleration:1e3,maxSpeed:360},Xa),Ka=d.e({deceleration:1e3,maxSpeed:90},Xa);class Tu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=re.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=ta(s.pan.mag(),l,d.e({},Su,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,ea(u,p)}if(s.zoom){const p=ta(s.zoom,l,Ap);u.zoom=this._map.transform.zoom+p.amount,ea(u,p)}if(s.bearing){const p=ta(s.bearing,l,xh);u.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),ea(u,p)}if(s.pitch){const p=ta(s.pitch,l,Ka);u.pitch=this._map.transform.pitch+p.amount,ea(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function ea(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function ta(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=d.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class Lr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=H.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,d.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class ys extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=H.touchPos(s.getCanvasContainer(),u),v=p.map(T=>s.unproject(T)),w=p.reduce((T,E,M,z)=>T.add(E.div(z.length)),new d.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class wh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class bh{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new wh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Lr(e.type,this._map,e))}mouseup(e){this._map.fire(new Lr(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Lr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Lr(e.type,this._map,e))}mouseover(e){this._map.fire(new Lr(e.type,this._map,e))}mouseout(e){this._map.fire(new Lr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ys(e.type,this._map,e))}touchmove(e){this._map.fire(new ys(e.type,this._map,e))}touchend(e){this._map.fire(new ys(e.type,this._map,e))}touchcancel(e){this._map.fire(new ys(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Lr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Lr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wi{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class yi{constructor(e,s){this._map=e,this._tr=new Wi(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(H.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),T=Math.max(u.y,l.y);H.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),H.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function ra(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class ku{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const p=new d.P(0,0);for(const v of u)p._add(v);return p.div(u.length)}(s),this.touches=ra(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=ra(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ja{constructor(e){this.singleTap=new ku(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Qs{constructor(e){this._tr=new Wi(e),this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&H.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Iu={0:1,2:2};class Ya{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=H.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Iu[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return H.mouseButton(e)===this._eventButton}}class Pu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Qa=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Eu=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Ya({checkCorrectEvent:u=>H.mouseButton(u)===0&&u.ctrlKey||H.mouseButton(u)===2});return new zn({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:Qa})},Cu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Ya({checkCorrectEvent:u=>H.mouseButton(u)===0&&u.ctrlKey||H.mouseButton(u)===2});return new zn({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:Qa})};class vs{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=ra(l,s),p=new d.P(0,0),v=new d.P(0,0);let w=0;for(const E in u){const M=u[E],z=this._touches[E];z&&(p._add(M),v._add(M.sub(z)),w++,u[E]=M)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const T=v.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class el{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=ia(l,s,u),w=ia(l,s,p);if(!v||!w)return;const T=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],T,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=ia(l,s,u),w=ia(l,s,p);v&&w||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ia(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Mu(f,e){return Math.log(f/e)/Math.LN2}class zu extends el{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,l),pinchAround:s}}}function Au(f,e){return 180*f.angleWith(e)/Math.PI}class Du extends el{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Au(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Au(e,this._startVector);return Math.abs(l)<s}}function tl(f){return Math.abs(f.y)>Math.abs(f.x)}class na extends el{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,tl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return tl(e)&&tl(s)&&v}}const Sh={panStep:100,bearingStep:15,pitchStep:10};class zi{constructor(e){this._tr=new Wi(e);const s=Sh;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:gn,zoom:s?Math.round(T.zoom)+s*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gn(f){return f*(2-f)}const Lu=4.000244140625;class Xi{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Wi(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=re.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Lu==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=H.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.N.convert(this._aroundCenter?l.center:l.unproject(s)):d.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Lu?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&E!==0&&(E=1/E);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=re.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const T=Math.min(w/200,1),E=u(T);p=d.y.number(l,s,E),T<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const l=this._prevEase,u=(re.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=d.b8(v,w,.25,1)}return this._prevEase={start:re.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xs{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dp{constructor(e){this._tr=new Wi(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lp{constructor(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kh{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ru{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class eo{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=H.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(H.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ai=f=>f.zoom||f.drag||f.pitch||f.rotate;class Ze extends d.k{}function rl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Fu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},T={},E={},M=u.touches,z=M?this._getMapTouches(M):void 0,F=z?H.touchPos(this._map.getCanvas(),z):H.mousePos(this._map.getCanvas(),u);for(const{handlerName:q,handler:K,allowed:J}of this._handlers){if(!K.isEnabled())continue;let Q;this._blockedByActive(E,J,q)?K.reset():K[p||u.type]&&(Q=K[p||u.type](u,F,z),this.mergeHandlerResult(w,T,Q,q,v),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||K.isActive())&&(E[q]=K)}const V={};for(const q in this._previousActiveHandlers)E[q]||(V[q]=v);this._previousActiveHandlers=E,(Object.keys(V).length||rl(w))&&(this._changes.push([w,T,V]),this._triggerRenderFrame()),(Object.keys(E).length||rl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=w;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tu(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)H.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)H.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new bh(s,e));const u=s.boxZoom=new yi(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new eo(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new Qs(s),w=new Dp(s);s.doubleClickZoom=new xs(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Lp;this._add("tapDragZoom",T);const E=s.touchPitch=new na(s);this._add("touchPitch",E),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const M=Eu(e),z=Cu(e);s.dragRotate=new kh(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:Q,clickTolerance:U})=>{const ne=new Ya({checkCorrectEvent:oe=>H.mouseButton(oe)===0&&!oe.ctrlKey});return new zn({clickTolerance:U,move:(oe,pe)=>({around:pe,panDelta:pe.sub(oe)}),activateOnStart:!0,moveStateManager:ne,enable:Q,assignEvents:Qa})})(e),V=new vs(e,s);s.dragPan=new Th(l,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const j=new Du,q=new zu;s.touchZoomRotate=new Ru(l,q,j,T),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const K=s.scrollZoom=new Xi(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const J=s.keyboard=new zi(s);this._add("keyboard",J),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new sr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ai(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;d.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(s,p),d.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(rl(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:T,bearingDelta:E,pitchDelta:M,around:z,pinchAround:F}=e;F!==void 0&&(z=F),u._stop(!0),z=z||u.transform.centerPoint;const V=p.pointLocation(w?z.sub(w):z);E&&(p.bearing+=E),M&&(p.pitch+=M),T&&(p.zoom+=T),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(V,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(V,z)):p.setLocationAtPoint(V,z),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Ai(this._eventsInProgress),p=Ai(e),v={};for(const z in e){const{originalEvent:F}=e[z];this._eventsInProgress[z]||(v[`${z}start`]=F),this._eventsInProgress[z]=e[z]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const z in v)this._fireEvent(z,v[z]);p&&this._fireEvent("move",p.originalEvent);for(const z in e){const{originalEvent:F}=e[z];this._fireEvent(z,F)}const w={};let T;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],T=s[F]||V,w[`${z}end`]=T)}for(const z in w)this._fireEvent(z,w[z]);const E=Ai(this._eventsInProgress),M=(u||p)&&!E;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(l&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&re.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ze("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ih extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((re.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(d.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(d.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(d.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=me.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Me=u.padding;u.padding={top:Me,bottom:Me,right:Me,left:Me}}u.padding=d.e(p,u.padding);const v=this.transform,w=v.padding,T=new me(e,s),E=v.project(T.getNorthWest()),M=v.project(T.getNorthEast()),z=v.project(T.getSouthEast()),F=v.project(T.getSouthWest()),V=d.ba(-l),j=E.rotate(V),q=M.rotate(V),K=z.rotate(V),J=F.rotate(V),Q=new d.P(Math.max(j.x,q.x,J.x,K.x),Math.max(j.y,q.y,J.y,K.y)),U=new d.P(Math.min(j.x,q.x,J.x,K.x),Math.min(j.y,q.y,J.y,K.y)),ne=Q.sub(U),oe=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/ne.x,pe=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/ne.y;if(pe<0||oe<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ve=Math.min(v.scaleZoom(v.scale*Math.min(oe,pe)),u.maxZoom),ke=d.P.convert(u.offset),Re=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.ba(l)),Ue=ke.add(Re).mult(v.scale/v.zoomScale(ve));return{center:v.unproject(E.add(z).div(2).sub(Ue)),zoom:ve,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=d.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=d.Z.fromLngLat(e,s),v=d.Z.fromLngLat(l,u),w=v.x-p.x,T=v.y-p.y,E=v.z-p.z,M=Math.hypot(w,T,E);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),V=180*Math.atan2(w,-T)/Math.PI;let j=180*Math.acos(z/M)/Math.PI;return j=E<0?90-j:90+j,{center:v.toLngLat(),zoom:F,pitch:j,bearing:V}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&re.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,E="bearing"in e?this._normalizeBearing(e.bearing,v):v,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let V=u.centerPoint.add(F);const j=u.pointLocation(V),{center:q,zoom:K}=u.getConstrained(d.N.convert(e.center||j),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(q,u);const J=u.project(j),Q=u.project(q).sub(J),U=u.zoomScale(K-p);let ne,oe;e.around&&(ne=d.N.convert(e.around),oe=u.locationPoint(ne));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==p,this._rotating=this._rotating||v!==E,this._pitching=this._pitching||M!==w,this._padding=!u.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,pe),this.terrain&&this._prepareElevation(q),this._ease(ve=>{if(this._zooming&&(u.zoom=d.y.number(p,K,ve)),this._rotating&&(u.bearing=d.y.number(v,E,ve)),this._pitching&&(u.pitch=d.y.number(w,M,ve)),this._padding&&(u.interpolatePadding(T,z,ve),V=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(ve),ne)u.setLocationAtPoint(ne,oe);else{const ke=u.zoomScale(u.zoom-p),Re=K>p?Math.min(2,U):Math.max(.5,U),Ue=Math.pow(Re,1-ve),Me=u.unproject(J.add(Q.mult(ve*Ue)).mult(ke));u.setLocationAtPoint(u.renderWorldCopies?Me.wrap():Me,V)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},ve=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,ve)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:T,bearing:E,elevation:M}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),T!==void 0&&(p.pitch=T),E!==void 0&&(p.bearing=E),M!==void 0&&(p.elevation=M),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",e)),u&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&re.prefersReducedMotion){const Ne=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ne,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,E="bearing"in e?this._normalizeBearing(e.bearing,v):v,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let V=u.centerPoint.add(F);const j=u.pointLocation(V),{center:q,zoom:K}=u.getConstrained(d.N.convert(e.center||j),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(q,u);const J=u.zoomScale(K-p),Q=u.project(j),U=u.project(q).sub(Q);let ne=e.curve;const oe=Math.max(u.width,u.height),pe=oe/J,ve=U.mag();if("minZoom"in e){const Ne=d.ac(Math.min(e.minZoom,p,K),u.minZoom,u.maxZoom),lt=oe/u.zoomScale(Ne-p);ne=Math.sqrt(lt/ve*2)}const ke=ne*ne;function Re(Ne){const lt=(pe*pe-oe*oe+(Ne?-1:1)*ke*ke*ve*ve)/(2*(Ne?pe:oe)*ke*ve);return Math.log(Math.sqrt(lt*lt+1)-lt)}function Ue(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function Me(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Ce=Re(!1);let Ke=function(Ne){return Me(Ce)/Me(Ce+ne*Ne)},ct=function(Ne){return oe*((Me(Ce)*(Ue(lt=Ce+ne*Ne)/Me(lt))-Ue(Ce))/ke)/ve;var lt},Ae=(Re(!0)-Ce)/ne;if(Math.abs(ve)<1e-6||!isFinite(Ae)){if(Math.abs(oe-pe)<1e-6)return this.easeTo(e,s);const Ne=pe<oe?-1:1;Ae=Math.abs(Math.log(pe/oe))/ne,ct=()=>0,Ke=lt=>Math.exp(Ne*ne*lt)}return e.duration="duration"in e?+e.duration:1e3*Ae/("screenSpeed"in e?+e.screenSpeed/ne:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==E,this._pitching=M!==w,this._padding=!u.isPaddingEqual(z),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(q),this._ease(Ne=>{const lt=Ne*Ae,Ht=1/Ke(lt);u.zoom=Ne===1?K:p+u.scaleZoom(Ht),this._rotating&&(u.bearing=d.y.number(v,E,Ne)),this._pitching&&(u.pitch=d.y.number(w,M,Ne)),this._padding&&(u.interpolatePadding(T,z,Ne),V=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ne);const gt=Ne===1?q:u.unproject(Q.add(U.mult(ct(lt))).mult(Ht));u.setLocationAtPoint(u.renderWorldCopies?gt.wrap():gt,V),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=re.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const to={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ro{constructor(e=to){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,p)=>u.length-p.length),e=e.filter((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Bu{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const s=H.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class bt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ou=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Rp extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aP(u.posMatrix,0,d.X,0,d.X,0,1),this._tiles[u.key]=new qn(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),T=u.canonical.y-(u.canonical.y>>v<<v),E=d.X>>v;d.aP(p.posMatrix,0,E,0,E,0,1),d.J(p.posMatrix,p.posMatrix,[-w*E,-T*E,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),T=e.canonical.y-(e.canonical.y>>v<<v),E=d.X>>v;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[w*E,T*E,0]),d.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Nu{constructor(e,s,l){this.painter=e,this.sourceCache=new Rp(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=d.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const T=function(j,q,K){var J=q[0],Q=q[1];return j[0]=K[0]*J+K[4]*Q+K[12],j[1]=K[1]*J+K[5]*Q+K[13],j}([],[s/u*d.X,l/u*d.X],v.u_terrain_matrix),E=[T[0]*w.dim,T[1]*w.dim],M=Math.floor(E[0]),z=Math.floor(E[1]),F=E[0]-M,V=E[1]-z;return w.get(M,z)*(1-F)*(1-V)+w.get(M+1,z)*F*(1-V)+w.get(M,z+1)*(1-F)*V+w.get(M+1,z+1)*F*V}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%d.X,p%d.X,d.X)}getElevation(e,s,l,u=d.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ht(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ht(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new ht(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(T,T,[v*d.X,w*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ht(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ht(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new ht(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),E=s[1]+((15&s[2])<<8),M=this.coordsIndex[255-s[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const F=this._coordsTextureSize,V=(1<<z.tileID.canonical.z)*F;return new d.Z((z.tileID.canonical.x*F+T)/V+z.tileID.wrap,(z.tileID.canonical.y*F+E)/V,this.getElevation(z.tileID,T,E,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,l=new d.aY,u=this.meshSize,p=d.X/u,v=u*u;for(let z=0;z<=u;z++)for(let F=0;F<=u;F++)s.emplaceBack(F*p,z*p,0);for(let z=0;z<v;z+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+z,u+F+z+1,u+F+z+2),l.emplaceBack(F+z,u+F+z+2,F+z+1);const w=s.length,T=w+2*(u+1);for(const z of[0,1])for(let F=0;F<=u;F++)for(const V of[0,1])s.emplaceBack(F*p,z*d.X,V);for(let z=0;z<2*u;z+=2)l.emplaceBack(T+z,T+z+1,T+z+3),l.emplaceBack(T+z,T+z+3,T+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const E=s.length,M=E+2*(u+1);for(const z of[0,1])for(let F=0;F<=u;F++)for(const V of[0,1])s.emplaceBack(z*d.X,F*p,V);for(let z=0;z<2*u;z+=2)l.emplaceBack(E+z,E+z+1,E+z+3),l.emplaceBack(E+z,E+z+3,E+z+2),l.emplaceBack(M+z,M+z+3,M+z+1),l.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new Ga(e.createVertexBuffer(s,Ou.members),e.createIndexBuffer(l),d.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=d.Z.fromLngLat(e.wrap()),u=(1<<s)*d.X,p=l.x*u,v=l.y*u,w=Math.floor(p/d.X),T=Math.floor(v/d.X);return{tileID:new d.S(s,0,s,w,T),mercatorX:p,mercatorY:v}}}class Fp{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new ht(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const io={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ph{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Fp(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(io[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(io[s]&&(this._prevType&&io[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(io[this._prevType]||io[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(vh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const E=this.pool.getObjectForId(w.rtt[p].id);if(E.stamp===w.rtt[p].stamp){this.pool.useObject(E);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[p]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:d.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let E=0;E<v.length;E++){const M=l.style._layers[v[E]],z=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(M,z),l.renderLayer(l,l.style.sourceCaches[M.source],M,z),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return vh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),io[s]}return!1}}const Vu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Eh=G,Bp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:to,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ju=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Op={showCompass:!0,showZoom:!0,visualizePitch:!1};class Np{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),H.mousePos(this.element,v)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,H.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Eu({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const E=new Pu;return new zn({clickTolerance:w,move:(M,z)=>({bearingDelta:(z.x-M.x)*T}),moveStateManager:E,enable:v,assignEvents:ju})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Cu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const E=new Pu;return new zn({clickTolerance:w,move:(M,z)=>({pitchDelta:(z.y-M.y)*T}),moveStateManager:E,enable:v,assignEvents:ju})})({clickTolerance:p,enable:!0})),H.addEventListener(s,"mousedown",this.mousedown),H.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),H.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),H.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;H.removeEventListener(e,"mousedown",this.mousedown),H.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let vi;function Gt(f,e,s){const l=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const u=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const no={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function il(f,e,s){const l=f.classList;for(const u in no)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class nl extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Gt(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${no[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),re.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div");const s=H.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=H.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=H.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=H.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of T){const Q=H.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",J.rx),Q.setAttributeNS(null,"ry",J.ry),w.appendChild(Q)}const E=H.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const M=H.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(M);const z=H.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=H.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const V=H.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const j=H.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const q=H.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");const K=H.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),j.appendChild(q),j.appendChild(K),v.appendChild(w),v.appendChild(E),v.appendChild(z),v.appendChild(V),v.appendChild(j),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),il(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*w,E=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),M=u.transform.lngLatToCameraDepth(this._lngLat,v+T)-E>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Ch={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let sa=0,oa=!1;const _n={maxWidth:100,unit:"metric"};function aa(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*w;T>5280?Xe(e,l,T/5280,f._getUIString("ScaleControl.Miles")):Xe(e,l,T,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Xe(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Xe(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):Xe(e,l,w,f._getUIString("ScaleControl.Meters"))}function Xe(f,e,s,l){const u=function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(w),v*w}(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const ot={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},sl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ol(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return ol(new d.P(0,0))}const Uu=G;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=ro,S.BoxZoomHandler=yi,S.CanvasSource=Ei,S.CooperativeGesturesHandler=eo,S.DoubleClickZoomHandler=xs,S.DragPanHandler=Th,S.DragRotateHandler=kh,S.EdgeInsets=Js,S.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Vo,S.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=d.e({bearing:u},this.options.fitBoundsOptions),v=me.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&oa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nl({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Ch,f)}onAdd(f){return this._map=f,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(vi!==void 0&&!e)return vi;if(window.navigator.permissions===void 0)return vi=!!window.navigator.geolocation,vi;try{vi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{vi=!!window.navigator.geolocation}return vi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,sa=0,oa=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":sa--,oa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),sa++,sa>1?(f={maximumAge:6e5,timeout:0},oa=!0):(f=this.options.positionOptions,oa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Wa,S.ImageSource=En,S.KeyboardHandler=zi,S.LngLatBounds=me,S.LogoControl=Bu,S.Map=class extends Ih{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},Bp),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ys(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new bt,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Vu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new Te(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=Qo(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Fu(this,e),this._hash=e.hash&&new Wa(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ro(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Bu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,T),this.painter.resize(l,u,T)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),v&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(me.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter(T=>this.getLayer(T)),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new Lr(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new Lr(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Lr(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter(w=>this.getLayer(w)),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(v=>e.includes(v))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const p=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[p,new d.P(v.x,p.y),v,new d.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new za(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new za(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Nu(this.painter,e,f),this.painter.renderToTexture=new Ph(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:E}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:F}=e,V=e;return this.style.addImage(f,{data:new d.R({width:M,height:z},new Uint8Array(F)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:E,sdf:u,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f),this}}{const{width:M,height:z,data:F}=re.getImageData(e);this.style.addImage(f,{data:new d.R({width:M,height:z},F),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:E,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?re.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return ue.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=H.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=H.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{p[v]=H.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Ha(s,this.transform),Le.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=re.now();this.style.zoomHistory.update(u,p);const v=new d.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Eh}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Lr,S.MapTouchEvent=ys,S.MapWheelEvent=wh,S.Marker=nl,S.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Op,f),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Np(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=H.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},S.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Gt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=ol(this.options.offset);if(!u){const w=this._container.offsetWidth,T=this._container.offsetHeight;let E;E=l.y+p.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<w/2?E.push("left"):l.x>this._map.transform.width-w/2&&E.push("right"),u=E.length===0?"bottom":E.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),H.setTransform(this._container,`${no[u]} translate(${v.x}px,${v.y}px)`),il(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(ot),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(sl);f&&f.focus()}},S.RasterDEMTileSource=Qt,S.RasterTileSource=zt,S.ScaleControl=class{constructor(f){this._onMove=()=>{aa(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,aa(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_n),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Xi,S.Style=za,S.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=na,S.TwoFingersTouchRotateHandler=Du,S.TwoFingersTouchZoomHandler=zu,S.TwoFingersTouchZoomRotateHandler=Ru,S.VectorTileSource=No,S.VideoSource=Bs,S.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(Uo(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{jo[s]=l})(f,e)}),S.clearPrewarmedResources=function(){const f=xr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Dr),xr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return dn().getRTLTextPluginStatus()},S.getVersion=function(){return Uu},S.getWorkerCount=function(){return ei.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(f){return Oo().broadcast("IS",f)},S.prewarm=function(){os().acquire(Dr)},S.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},S.setRTLTextPlugin=function(f,e){return dn().setRTLTextPlugin(f,e)},S.setWorkerCount=function(f){ei.workerCount=f},S.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var I=h;return I})})(W0);var gS=W0.exports;const Rv=$w(gS),_S="#1a1a2e",yS=1,vS=40,xS=5e3,wS=10;function bS(){const i=Si.useRef(null),o=Si.useRef(null),h=Si.useRef(null),_=Si.useRef(null),b=Si.useRef(null),I=Si.useRef([]),[S,d]=Si.useState([]),[G,le]=Si.useState(null),[xe,re]=Si.useState("Requesting location permission..."),H=Si.useRef(null);Si.useEffect(()=>{I.current=S},[S]),Si.useEffect(()=>{if(!o.current)return o.current=new Rv.Map({container:i.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[34.7818,32.0853],zoom:15,attributionControl:!1}),o.current.on("load",()=>{ce(),Le()}),o.current.on("move",ue),o.current.on("zoom",ue),window.addEventListener("resize",ie),()=>{var Se;window.removeEventListener("resize",ie),b.current&&clearInterval(b.current),(Se=o.current)==null||Se.remove()}},[]);const Le=async()=>{if(!navigator.geolocation){re("Geolocation not supported in this browser");return}re("Requesting location permission..."),navigator.geolocation.getCurrentPosition(Se=>{var ht;re("Permission granted! Tracking started."),Be(Se);const{latitude:it,longitude:et}=Se.coords;(ht=o.current)==null||ht.flyTo({center:[et,it],zoom:16}),Fe()},Se=>{Tt(Se)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})},Fe=()=>{b.current&&clearInterval(b.current),b.current=setInterval(()=>{navigator.geolocation.getCurrentPosition(Be,Se=>{Se.code!==Se.TIMEOUT&&Tt(Se)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},xS)},Be=Se=>{const{latitude:it,longitude:et,accuracy:ht}=Se.coords;le({lat:it,lng:et});const zr=I.current.length;re(`Tracking (${Math.round(ht)}m) | ${zr} points explored`),Te(it,et),je(it,et)&&He(it,et)},Tt=Se=>{switch(Se.code){case Se.PERMISSION_DENIED:re("Permission denied. Please allow location access and refresh the page.");break;case Se.POSITION_UNAVAILABLE:re("Location unavailable. Check GPS/Location settings.");break;case Se.TIMEOUT:re("Getting location...");break;default:re(`Error: ${Se.message}`)}},ce=()=>{const Se=document.createElement("canvas");Se.id="fog-canvas",Se.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    `;const it=i.current.getBoundingClientRect();Se.width=it.width*window.devicePixelRatio,Se.height=it.height*window.devicePixelRatio,i.current.appendChild(Se),h.current=Se,ue()},ie=()=>{if(!h.current||!i.current)return;const Se=i.current.getBoundingClientRect();h.current.width=Se.width*window.devicePixelRatio,h.current.height=Se.height*window.devicePixelRatio,ue()},ue=()=>{const Se=h.current;if(!Se||!o.current)return;const it=Se.getContext("2d"),et=window.devicePixelRatio,ht=I.current;it.clearRect(0,0,Se.width,Se.height),it.fillStyle=_S,it.globalAlpha=yS,it.fillRect(0,0,Se.width,Se.height),it.globalAlpha=1,it.globalCompositeOperation="destination-out",ht.forEach(zr=>{const Ot=o.current.project([zr.lng,zr.lat]),lr=SS(zr.lat,vS,o.current.getZoom()),Ar=it.createRadialGradient(Ot.x*et,Ot.y*et,0,Ot.x*et,Ot.y*et,lr*et);Ar.addColorStop(0,"rgba(0,0,0,1)"),Ar.addColorStop(.7,"rgba(0,0,0,1)"),Ar.addColorStop(1,"rgba(0,0,0,0)"),it.fillStyle=Ar,it.beginPath(),it.arc(Ot.x*et,Ot.y*et,lr*et,0,Math.PI*2),it.fill()}),it.globalCompositeOperation="source-over"};Si.useEffect(()=>{ue()},[S]);const Te=(Se,it)=>{if(o.current)if(_.current)_.current.setLngLat([it,Se]);else{const et=document.createElement("div");et.innerHTML=`
        <div style="
          width: 20px;
          height: 20px;
          background: #1976d2;
          border: 3px solid white;
          border-radius: 50%;
          box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        "></div>
        <div style="
          position: absolute;
          top: -10px;
          left: -10px;
          width: 40px;
          height: 40px;
          background: rgba(25,118,210,0.3);
          border-radius: 50%;
          animation: pulse 2s infinite;
        "></div>
      `,et.style.cssText="position: relative; width: 20px; height: 20px;",_.current=new Rv.Marker({element:et}).setLngLat([it,Se]).addTo(o.current)}},je=(Se,it)=>H.current?TS(H.current.lat,H.current.lng,Se,it)>=wS:!0,He=(Se,it)=>{const et={lat:Se,lng:it,timestamp:Date.now()};d(ht=>[...ht,et]),H.current={lat:Se,lng:it}},Ge=()=>{G&&o.current&&o.current.flyTo({center:[G.lng,G.lat],zoom:16})};return kl.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[kl.jsx("div",{ref:i,style:{width:"100%",height:"100%"}}),kl.jsx("div",{style:{position:"absolute",top:10,left:10,right:10,padding:"12px 16px",background:"rgba(0,0,0,0.85)",borderRadius:12,color:"white",fontSize:14,zIndex:10},children:xe}),kl.jsx("button",{onClick:Ge,disabled:!G,style:{position:"absolute",bottom:30,right:10,width:56,height:56,borderRadius:"50%",border:"none",background:G?"#1976d2":"rgba(0,0,0,0.5)",color:"white",fontSize:24,cursor:G?"pointer":"not-allowed",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"}}),kl.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: scale(0.5); opacity: 1; }
          100% { transform: scale(1.5); opacity: 0; }
        }
      `})]})}function SS(i,o,h){const b=256*Math.pow(2,h)/(40075016686e-3*Math.cos(i*Math.PI/180));return o*b}function TS(i,o,h,_){const I=(h-i)*Math.PI/180,S=(_-o)*Math.PI/180,d=Math.sin(I/2)*Math.sin(I/2)+Math.cos(i*Math.PI/180)*Math.cos(h*Math.PI/180)*Math.sin(S/2)*Math.sin(S/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}rm.createRoot(document.getElementById("root")).render(kl.jsx(bS,{}));
